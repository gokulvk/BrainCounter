//INPUT:             1. Need to select a folder where Images are stored
//                        2.Need to select folder for RESULTS when prompted.
//                        3.Image to be analyzed must be named with figure to analyze with as last 2 digits
//                        4.Requires there be a parent folder with 1 folder - Atlas Left, 1 folder - Atlas Right, 1 folder - Images to analyze
//WHAT IT DOES: This program will count number of cells in important brain regions in a specific slice for every image in the folder.
//OUTPUT:            It will create a new results folder where it will put a text document with a 
//                         table with all the names of important brain regions and their specific cell count.
//                         It will also create an image with the specific atlas overlaid over the image.
//
//Need to change anything with *********

Dialog.create("Important");
Dialog.addMessage("INPUT\n1. Select folder where Images are stored. (1st Step)\n2. Select a folder for the Results (2nd Step)\n3. Ensure that folder of Atlases are in same directory as folder for images.");
Dialog.addMessage("OUTPUT:\n1. Text file with counts from important brain regions\n2. Original image with appropriate atlas overlaid on top.");
Dialog.show();

Dialog.create("Side of Brain");
Dialog.addMessage("Hemisphere of Brain to Analyze:\nDo not select both.");
Dialog.addCheckbox("Left Side", false)
Dialog.addCheckbox("Right Side", false)
Dialog.show();
leftSide = Dialog.getCheckbox();
rightSide = Dialog.getCheckbox();;


//asks for a folder of images and folder to save results in 
dirImages = getDirectory("Choose a Folder of Images");
dirResults = getDirectory("Choose a Folder for Results");
setBatchMode(true);

print("Directory of Images:");
print(dirImages);
print("Directory of Results:");
print(dirResults);

names = processFiles(dirImages, dirResults);

print("");
print("Successfully completed analyzing: ");
for (i=0; i<names.length; i++) {
   print(names[i]);
}

//FUNCTIONS
//goes through every image and makes a new folder to put results in
function processFiles(dirImages, dirResults) {
   list = getFileList(dirImages);
   names = newArray(0);
   print("");
   print("Total number of Images: " + list.length);
   print("");
   print("Processing Files");
   for (i=0; i<list.length; i++) {
       imagePath = "" + dirImages + list[i];
       print(list[i]);
       name = substring(list[i], 0, lengthOf(list[i]) - 4);
       names = append(names, name);
       File.makeDirectory(dirResults + name);
       dirResult = dirResults + name + "\\";
       atlasNum = substring(name, lengthOf(name) - 2, lengthOf(name));
       print("Analyzing based on Atlas Number: " + atlasNum);
       if (atlasNum == "08") {
          processFile08(imagePath, dirResult);
       }
       else if (atlasNum == "09") {
          processFile09(imagePath, dirResult);
       }
       else if (atlasNum == "10") {
          processFile10(imagePath, dirResult);
       }
       else if (atlasNum == "11") {
          processFile11(imagePath, dirResult);
       }
       else if (atlasNum == "12") {
          processFile12(imagePath, dirResult);
       }
       else if (atlasNum == "13") {
          processFile13(imagePath, dirResult);
       }
       else if (atlasNum == "14") {
          processFile14(imagePath, dirResult);
       }
       else if (atlasNum == "15") {
          processFile15(imagePath, dirResult);
       }
       else if (atlasNum == "16") {
          processFile16(imagePath, dirResult);
       }
       else if (atlasNum == "17") {
          processFile17(imagePath, dirResult);
       }
       else if (atlasNum == "18") {
          processFile18(imagePath, dirResult);
       }
       else if (atlasNum == "19") {
          processFile19(imagePath, dirResult);
       }
       else if (atlasNum == "20") {
          processFile20(imagePath, dirResult);
       }
       else if (atlasNum == "21") {
          processFile21(imagePath, dirResult);
       }
       else if (atlasNum == "22") {
          processFile22(imagePath, dirResult);
       }
       else if (atlasNum == "23") {
          processFile23(imagePath, dirResult);
       }
       else if (atlasNum == "24") {
          processFile24(imagePath, dirResult);
       }
       else if (atlasNum == "25") {
          processFile25(imagePath, dirResult);
       }
       else if (atlasNum == "26") {
          processFile26(imagePath, dirResult);
       }
       else if (atlasNum == "27") {
          processFile27(imagePath, dirResult);
       }
       else if (atlasNum == "28") {
          processFile28(imagePath, dirResult);
       }
       else if (atlasNum == "29") {
          processFile29(imagePath, dirResult);
       }
       else if (atlasNum == "30") {
          processFile30(imagePath, dirResult);
       }
       else if (atlasNum == "31") {
          processFile31(imagePath, dirResult);
       }
       else if (atlasNum == "32") {
          processFile32(imagePath, dirResult);
       }
       else if (atlasNum == "33") {
          processFile33(imagePath, dirResult);
       }
       else if (atlasNum == "34") {
          processFile34(imagePath, dirResult);
       }
       else if (atlasNum == "35") {
          processFile35(imagePath, dirResult);
       }
       else if (atlasNum == "36") {
          processFile36(imagePath, dirResult);
       }
       else if (atlasNum == "37") {
          processFile37(imagePath, dirResult);
       }
       else if (atlasNum == "38") {
          processFile38(imagePath, dirResult);
       }
       else if (atlasNum == "39") {
          processFile39(imagePath, dirResult);
       }
       else if (atlasNum == "40") {
          processFile40(imagePath, dirResult);
       }
       else if (atlasNum == "41") {
          processFile41(imagePath, dirResult);
       }
       else if (atlasNum == "42") {
          processFile42(imagePath, dirResult);
       }
       else if (atlasNum == "43") {
          processFile43(imagePath, dirResult);
       }
       else if (atlasNum == "44") {
          processFile44(imagePath, dirResult);
       }
       else if (atlasNum == "45") {
          processFile45(imagePath, dirResult);
       }
       else if (atlasNum == "46") {
          processFile46(imagePath, dirResult);
       }
       else if (atlasNum == "47") {
          processFile47(imagePath, dirResult);
       }
       else if (atlasNum == "48") {
          processFile48(imagePath, dirResult);
       }
       else if (atlasNum == "49") {
          processFile49(imagePath, dirResult);
       }
       else if (atlasNum == "50") {
          processFile50(imagePath, dirResult);
       }
       else if (atlasNum == "51") {
          processFile51(imagePath, dirResult);
       }
       else if (atlasNum == "52") {
          processFile52(imagePath, dirResult);
       }
       else if (atlasNum == "53") {
          processFile53(imagePath, dirResult);
       }
       else if (atlasNum == "54") {
          processFile54(imagePath, dirResult);
       }
       else if (atlasNum == "55") {
          processFile55(imagePath, dirResult);
       }
       else if (atlasNum == "56") {
          processFile56(imagePath, dirResult);
       }
       else if (atlasNum == "57") {
          processFile57(imagePath, dirResult);
       }
       else if (atlasNum == "58") {
          processFile58(imagePath, dirResult);
       }
       else if (atlasNum == "59") {
          processFile59(imagePath, dirResult);
       }
       else if (atlasNum == "60") {
          processFile60(imagePath, dirResult);
       }
       else if (atlasNum == "61") {
          processFile61(imagePath, dirResult);
       }
       else if (atlasNum == "62") {
          processFile62(imagePath, dirResult);
       }
       else if (atlasNum == "63") {
          processFile63(imagePath, dirResult);
       }
       else if (atlasNum == "64") {
          processFile64(imagePath, dirResult);
       }
       else if (atlasNum == "65") {
          processFile65(imagePath, dirResult);
       }
       else if (atlasNum == "66") {
          processFile66(imagePath, dirResult);
       }
       else if (atlasNum == "67") {
          processFile67(imagePath, dirResult);
       }
       else if (atlasNum == "68") {
          processFile68(imagePath, dirResult);
       }
       else if (atlasNum == "69") {
          processFile69(imagePath, dirResult);
       }
       else if (atlasNum == "70") {
          processFile70(imagePath, dirResult);
       }
       else if (atlasNum == "71") {
          processFile71(imagePath, dirResult);
       }
       else if (atlasNum == "72") {
          processFile72(imagePath, dirResult);
       }
       else if (atlasNum == "73") {
          processFile73(imagePath, dirResult);
       }
       else if (atlasNum == "74") {
          processFile74(imagePath, dirResult);
       }
       else if (atlasNum == "75") {
          processFile75(imagePath, dirResult);
       }
       else if (atlasNum == "76") {
          processFile76(imagePath, dirResult);
       }
       else if (atlasNum == "77") {
          processFile77(imagePath, dirResult);
       }
       else if (atlasNum == "78") {
          processFile78(imagePath, dirResult);
       }
       else if (atlasNum == "79") {
          processFile79(imagePath, dirResult);
       }
       else if (atlasNum == "80") {
          processFile80(imagePath, dirResult);
       }
       else if (atlasNum == "81") {
          processFile81(imagePath, dirResult);
       }
       else if (atlasNum == "82") {
          processFile82(imagePath, dirResult);
       }
       else if (atlasNum == "83") {
          processFile83(imagePath, dirResult);
       }
       else if (atlasNum == "84") {
          processFile84(imagePath, dirResult);
       }
       else if (atlasNum == "85") {
          processFile85(imagePath, dirResult);
       }
       else if (atlasNum == "86") {
          processFile86(imagePath, dirResult);
       }
       else if (atlasNum == "87") {
          processFile87(imagePath, dirResult);
       }
       else if (atlasNum == "88") {
          processFile88(imagePath, dirResult);
       }
       else if (atlasNum == "89") {
          processFile89(imagePath, dirResult);
       }
       else if (atlasNum == "90") {
          processFile90(imagePath, dirResult);
       }
       else {
          names = deleteLastValue(names);
          print("The file named: " + name + " is invalid because " + atlasNum + " is not a valid atlas.");
       }
       actualNum = parseInt(atlasNum);
       if ((actualNum >= 8) && (actualNum <= 99)) {
           print("\\Update:Analysis based on Atlas Number: " + atlasNum + " - Completed");
       }
       else {
           print("\\Update:Analysis based on Atlas Number: " + atlasNum + " - not successful");
       }
   }
   return names;
}

//for adding values to an array
function append(arr, value) {
      arr2 = newArray(arr.length+1);
      for (i=0; i<arr.length; i++)
          arr2[i] = arr[i];
      arr2[arr.length] = value;
      return arr2;
}

function deleteLastValue(arr) {
      arr2 = newArray(arr.length - 1);
      for (i=0; i< (arr.length - 1); i++)
           arr2[i] = arr[i];
      return arr2;
}

//prints a line in the ouput file if given the file, array of cell count, name of the brain part, index of brain part
function print_line(f, partNames, d, i) {
   countPerArea = parseInt(d[i*2+1]) / parseInt(d[i*2]); 
   print(f, partNames[i] + "\t\t" + d[i*2] + "\t\t" + d[i*2+1] + "\t\t" + countPerArea);
}

//counts cells based on 50-300 and returns an updated array with the new cell count appended
function analyze_pic(d) {
   run("Set Scale...", "distance=300 known=1 pixel=1 unit=inch");
   run("Measure");
   size = getResult("Area", 0);
   close("Results");

   run("Analyze Particles...", "size=50-300 pixel display exclude clear include add in_situ");

   hasResults = false;
   allWindowsList = getList("window.titles");
   for (i = 0; i < allWindowsList.length; i++) {
      if (allWindowsList[i] == "Results") {
         hasResults = true;
      }
   }

   if (hasResults == true) {
      selectWindow("Results");
      n = nResults;
      close("Results");
   } else if (hasResults == false) {
      n = 0;
   }

   d = append(d, size);
   d = append(d, n);
   return d;
}

//rescales atlas image and overlays it over slide, then saves it in results folder
function overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide) {
   open(path + name);
   open(atlasPath);
   run("Scale...", "x=- y=- width=" + w + " height=" + h + " interpolation=Bilinear average create title=scaled.tif");
   selectWindow(name);
   run("Add Image...", "image=scaled.tif x=0 y=0 opacity=20");
   run("Flatten");
   atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));

   if (leftSide) {
      if ((indexOf(toLowerCase(imageName), "left")) == -1) {
      saveAs("Tiff",  dirResults + imageName + "_left_overlay.tif");
      close();
      }
      if ((indexOf(toLowerCase(imageName), "left")) > -1) {
      saveAs("Tiff",  dirResults + imageName + "_overlay.tif");
      close();
      }
      selectWindow(atlasNum + "_left.tif");
      close();
   }
   if (rightSide) {
      if ((indexOf(toLowerCase(imageName), "right")) == -1) {
      saveAs("Tiff",  dirResults + imageName + "_right_overlay.tif");
      close();
      }
      if ((indexOf(toLowerCase(imageName), "right")) > -1) {
      saveAs("Tiff",  dirResults + imageName + "_overlay.tif");
      close();
      }
      selectWindow(atlasNum + "_right.tif");
      close();
   }

   selectWindow(name);
   close();
   selectWindow("scaled.tif");
   close();
}

function processFile08(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 524;
var baseHeight = 776;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "VO, LO, PrL, Cg1, Pir1a, Pir1b, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//VO
selectWindow(name);
makePolygon(484*ratiow,577*ratioh,480*ratiow,565*ratioh,475*ratiow,550*ratioh,471*ratiow,539*ratioh,462*ratiow,512*ratioh,455*ratiow,492*ratioh,449*ratiow,476*ratioh,443*ratiow,462*ratioh,442*ratiow,460*ratioh,438*ratiow,461*ratioh,435*ratiow,461*ratioh,431*ratiow,459*ratioh,426*ratiow,455*ratioh,422*ratiow,449*ratioh,417*ratiow,441*ratioh,412*ratiow,433*ratioh,409*ratiow,425*ratioh,406*ratiow,418*ratioh,402*ratiow,412*ratioh,400*ratiow,407*ratioh,397*ratiow,402*ratioh,392*ratiow,396*ratioh,386*ratiow,387*ratioh,379*ratiow,379*ratioh,375*ratiow,374*ratioh,370*ratiow,369*ratioh,364*ratiow,364*ratioh,359*ratiow,359*ratioh,354*ratiow,356*ratioh,349*ratiow,352*ratioh,344*ratiow,348*ratioh,339*ratiow,345*ratioh,338*ratiow,344*ratioh,338*ratiow,349*ratioh,341*ratiow,359*ratioh,343*ratiow,365*ratioh,344*ratiow,372*ratioh,345*ratiow,381*ratioh,346*ratiow,389*ratioh,347*ratiow,397*ratioh,348*ratiow,405*ratioh,348*ratiow,413*ratioh,348*ratiow,422*ratioh,348*ratiow,432*ratioh,348*ratiow,440*ratioh,348*ratiow,448*ratioh,347*ratiow,458*ratioh,346*ratiow,468*ratioh,344*ratiow,480*ratioh,343*ratiow,489*ratioh,342*ratiow,499*ratioh,340*ratiow,506*ratioh,338*ratiow,513*ratioh,337*ratiow,519*ratioh,337*ratiow,521*ratioh,338*ratiow,521*ratioh,343*ratiow,522*ratioh,355*ratiow,527*ratioh,365*ratiow,531*ratioh,378*ratiow,537*ratioh,388*ratiow,542*ratioh,397*ratiow,547*ratioh,406*ratiow,553*ratioh,420*ratiow,561*ratioh,432*ratiow,567*ratioh,445*ratiow,573*ratioh,458*ratiow,577*ratioh,470*ratiow,579*ratioh,477*ratiow,578*ratioh);
data = analyze_pic(data);

//LO
selectWindow(name);
makePolygon(334*ratiow,342*ratioh,329*ratiow,338*ratioh,321*ratiow,333*ratioh,312*ratiow,328*ratioh,304*ratiow,323*ratioh,295*ratiow,318*ratioh,289*ratiow,314*ratioh,285*ratiow,321*ratioh,279*ratiow,331*ratioh,273*ratiow,342*ratioh,267*ratiow,353*ratioh,261*ratiow,363*ratioh,253*ratiow,377*ratioh,246*ratiow,390*ratioh,238*ratiow,405*ratioh,231*ratiow,417*ratioh,224*ratiow,432*ratioh,215*ratiow,448*ratioh,207*ratiow,464*ratioh,200*ratiow,477*ratioh,191*ratiow,495*ratioh,183*ratiow,513*ratioh,175*ratiow,528*ratioh,168*ratiow,544*ratioh,162*ratiow,558*ratioh,156*ratiow,575*ratioh,151*ratiow,589*ratioh,151*ratiow,591*ratioh,164*ratiow,588*ratioh,184*ratiow,579*ratioh,199*ratiow,569*ratioh,224*ratiow,556*ratioh,246*ratiow,546*ratioh,253*ratiow,543*ratioh,286*ratiow,529*ratioh,305*ratiow,522*ratioh,316*ratiow,519*ratioh,321*ratiow,518*ratioh,329*ratiow,519*ratioh,337*ratiow,521*ratioh,340*ratiow,505*ratioh,344*ratiow,487*ratioh,346*ratiow,470*ratioh,348*ratiow,454*ratioh,349*ratiow,430*ratioh,348*ratiow,412*ratioh,347*ratiow,396*ratioh,345*ratiow,378*ratioh,343*ratiow,365*ratioh,340*ratiow,354*ratioh,338*ratiow,344*ratioh);
data = analyze_pic(data);

//PrL
selectWindow(name);
makePolygon(351*ratiow,265*ratioh,357*ratiow,260*ratioh,366*ratiow,256*ratioh,378*ratiow,248*ratioh,388*ratiow,242*ratioh,401*ratiow,235*ratioh,412*ratiow,230*ratioh,426*ratiow,224*ratioh,439*ratiow,218*ratioh,453*ratiow,211*ratioh,468*ratiow,205*ratioh,481*ratiow,200*ratioh,492*ratiow,196*ratioh,509*ratiow,190*ratioh,522*ratiow,186*ratioh,523*ratiow,185*ratioh,523*ratiow,416*ratioh,516*ratiow,417*ratioh,504*ratiow,416*ratioh,488*ratiow,415*ratioh,474*ratiow,414*ratioh,460*ratiow,413*ratioh,446*ratiow,412*ratioh,435*ratiow,410*ratioh,428*ratiow,409*ratioh,426*ratiow,402*ratioh,423*ratiow,394*ratioh,418*ratiow,378*ratioh,412*ratiow,363*ratioh,406*ratiow,349*ratioh,399*ratiow,333*ratioh,391*ratiow,320*ratioh,383*ratiow,307*ratioh,375*ratiow,295*ratioh,367*ratiow,284*ratioh,359*ratiow,274*ratioh);
data = analyze_pic(data);

//Cg1
selectWindow(name);
makePolygon(330*ratiow,247*ratioh,352*ratiow,218*ratioh,377*ratiow,190*ratioh,402*ratiow,163*ratioh,427*ratiow,137*ratioh,451*ratiow,112*ratioh,471*ratiow,92*ratioh,489*ratiow,76*ratioh,503*ratiow,64*ratioh,510*ratiow,76*ratioh,516*ratiow,91*ratioh,521*ratiow,109*ratioh,523*ratiow,122*ratioh,523*ratiow,185*ratioh,512*ratiow,189*ratioh,494*ratiow,196*ratioh,483*ratiow,200*ratioh,466*ratiow,206*ratioh,448*ratiow,214*ratioh,431*ratiow,221*ratioh,414*ratiow,229*ratioh,396*ratiow,239*ratioh,377*ratiow,248*ratioh,361*ratiow,258*ratioh,351*ratiow,265*ratioh,345*ratiow,259*ratioh,340*ratiow,254*ratioh,335*ratiow,251*ratioh);
data = analyze_pic(data);

//Pir1a
selectWindow(name);
makePolygon(477*ratiow,696*ratioh,485*ratiow,705*ratioh,492*ratiow,714*ratioh,496*ratiow,719*ratioh,488*ratiow,727*ratioh,477*ratiow,735*ratioh,466*ratiow,742*ratioh,454*ratiow,751*ratioh,447*ratiow,759*ratioh,438*ratiow,766*ratioh,427*ratiow,772*ratioh,413*ratiow,772*ratioh,399*ratiow,770*ratioh,382*ratiow,766*ratioh,364*ratiow,761*ratioh,313*ratiow,741*ratioh,294*ratiow,735*ratioh,282*ratiow,725*ratioh,265*ratiow,713*ratioh,241*ratiow,697*ratioh,225*ratiow,682*ratioh,203*ratiow,663*ratioh,188*ratiow,648*ratioh,174*ratiow,636*ratioh,167*ratiow,627*ratioh,164*ratiow,617*ratioh,162*ratiow,604*ratioh,164*ratiow,593*ratioh,175*ratiow,582*ratioh,198*ratiow,570*ratioh,219*ratiow,558*ratioh,257*ratiow,541*ratioh,284*ratiow,530*ratioh,308*ratiow,521*ratioh,320*ratiow,518*ratioh,333*ratiow,519*ratioh,345*ratiow,523*ratioh,358*ratiow,528*ratioh,378*ratiow,537*ratioh,380*ratiow,538*ratioh,386*ratiow,549*ratioh,393*ratiow,564*ratioh,383*ratiow,559*ratioh,371*ratiow,554*ratioh,361*ratiow,550*ratioh,351*ratiow,547*ratioh,338*ratiow,546*ratioh,323*ratiow,545*ratioh,310*ratiow,546*ratioh,289*ratiow,550*ratioh,269*ratiow,556*ratioh,247*ratiow,563*ratioh,229*ratiow,570*ratioh,214*ratiow,577*ratioh,201*ratiow,583*ratioh,189*ratiow,592*ratioh,182*ratiow,600*ratioh,180*ratiow,606*ratioh,180*ratiow,616*ratioh,182*ratiow,624*ratioh,188*ratiow,632*ratioh,195*ratiow,637*ratioh,202*ratiow,642*ratioh,210*ratiow,647*ratioh,222*ratiow,656*ratioh,265*ratiow,692*ratioh,275*ratiow,699*ratioh,286*ratiow,707*ratioh,293*ratiow,711*ratioh,316*ratiow,724*ratioh,326*ratiow,730*ratioh,342*ratiow,735*ratioh,353*ratiow,739*ratioh,395*ratiow,751*ratioh,400*ratiow,752*ratioh,404*ratiow,759*ratioh,408*ratiow,763*ratioh,412*ratiow,764*ratioh,420*ratiow,760*ratioh,430*ratiow,752*ratioh,440*ratiow,744*ratioh,459*ratiow,726*ratioh,465*ratiow,719*ratioh,469*ratiow,712*ratioh,474*ratiow,704*ratioh,476*ratiow,698*ratioh);
data = analyze_pic(data);

//Pir1b
selectWindow(name);
makePolygon(398*ratiow,714*ratioh,396*ratiow,725*ratioh,395*ratiow,735*ratioh,396*ratiow,743*ratioh,399*ratiow,750*ratioh,398*ratiow,752*ratioh,388*ratiow,749*ratioh,377*ratiow,746*ratioh,369*ratiow,744*ratioh,361*ratiow,741*ratioh,353*ratiow,739*ratioh,328*ratiow,730*ratioh,317*ratiow,725*ratioh,308*ratiow,720*ratioh,301*ratiow,716*ratioh,293*ratiow,711*ratioh,270*ratiow,696*ratioh,261*ratiow,688*ratioh,254*ratiow,682*ratioh,247*ratiow,676*ratioh,233*ratiow,664*ratioh,221*ratiow,656*ratioh,213*ratiow,650*ratioh,206*ratiow,645*ratioh,200*ratiow,641*ratioh,191*ratiow,635*ratioh,187*ratiow,631*ratioh,184*ratiow,627*ratioh,182*ratiow,623*ratioh,180*ratiow,617*ratioh,180*ratiow,610*ratioh,181*ratiow,604*ratioh,184*ratiow,598*ratioh,188*ratiow,592*ratioh,194*ratiow,588*ratioh,204*ratiow,582*ratioh,213*ratiow,578*ratioh,223*ratiow,573*ratioh,234*ratiow,569*ratioh,244*ratiow,565*ratioh,264*ratiow,558*ratioh,276*ratiow,554*ratioh,283*ratiow,552*ratioh,311*ratiow,547*ratioh,321*ratiow,546*ratioh,332*ratiow,546*ratioh,339*ratiow,546*ratioh,350*ratiow,547*ratioh,359*ratiow,549*ratioh,367*ratiow,552*ratioh,375*ratiow,555*ratioh,383*ratiow,559*ratioh,391*ratiow,563*ratioh,394*ratiow,565*ratioh,398*ratiow,574*ratioh,393*ratiow,572*ratioh,386*ratiow,569*ratioh,379*ratiow,566*ratioh,371*ratiow,563*ratioh,362*ratiow,561*ratioh,355*ratiow,559*ratioh,344*ratiow,558*ratioh,333*ratiow,558*ratioh,325*ratiow,558*ratioh,317*ratiow,559*ratioh,304*ratiow,561*ratioh,292*ratiow,563*ratioh,282*ratiow,566*ratioh,274*ratiow,568*ratioh,260*ratiow,572*ratioh,250*ratiow,576*ratioh,237*ratiow,581*ratioh,227*ratiow,585*ratioh,217*ratiow,590*ratioh,209*ratiow,594*ratioh,202*ratiow,600*ratioh,198*ratiow,608*ratioh,198*ratiow,616*ratioh,199*ratiow,622*ratioh,202*ratiow,626*ratioh,207*ratiow,631*ratioh,214*ratiow,634*ratioh,220*ratiow,637*ratioh,234*ratiow,644*ratioh,244*ratiow,649*ratioh,252*ratiow,655*ratioh,259*ratiow,662*ratioh,277*ratiow,681*ratioh,283*ratiow,688*ratioh,290*ratiow,695*ratioh,298*ratiow,702*ratioh,304*ratiow,705*ratioh,311*ratiow,710*ratioh,316*ratiow,712*ratioh,323*ratiow,713*ratioh,335*ratiow,713*ratioh,345*ratiow,712*ratioh,375*ratiow,708*ratioh,388*ratiow,706*ratioh,396*ratiow,705*ratioh,402*ratiow,703*ratioh,402*ratiow,706*ratioh,401*ratiow,710*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(318*ratiow,702*ratioh,314*ratiow,708*ratioh,313*ratiow,710*ratioh,307*ratiow,708*ratioh,300*ratiow,703*ratioh,294*ratiow,698*ratioh,287*ratiow,691*ratioh,280*ratiow,684*ratioh,273*ratiow,677*ratioh,268*ratiow,671*ratioh,262*ratiow,664*ratioh,256*ratiow,659*ratioh,249*ratiow,653*ratioh,241*ratiow,648*ratioh,234*ratiow,643*ratioh,225*ratiow,640*ratioh,218*ratiow,636*ratioh,210*ratiow,632*ratioh,203*ratiow,627*ratioh,199*ratiow,622*ratioh,198*ratiow,612*ratioh,199*ratiow,603*ratioh,206*ratiow,596*ratioh,214*ratiow,591*ratioh,227*ratiow,585*ratioh,266*ratiow,570*ratioh,285*ratiow,565*ratioh,296*ratiow,562*ratioh,321*ratiow,558*ratioh,336*ratiow,557*ratioh,347*ratiow,558*ratioh,357*ratiow,560*ratioh,382*ratiow,567*ratioh,394*ratiow,572*ratioh,398*ratiow,573*ratioh,401*ratiow,582*ratioh,396*ratiow,581*ratioh,389*ratiow,579*ratioh,381*ratiow,576*ratioh,372*ratiow,574*ratioh,363*ratiow,571*ratioh,349*ratiow,569*ratioh,338*ratiow,568*ratioh,329*ratiow,568*ratioh,319*ratiow,568*ratioh,305*ratiow,570*ratioh,291*ratiow,573*ratioh,279*ratiow,577*ratioh,270*ratiow,581*ratioh,256*ratiow,587*ratioh,245*ratiow,593*ratioh,235*ratiow,598*ratioh,225*ratiow,603*ratioh,222*ratiow,605*ratioh,218*ratiow,609*ratioh,219*ratiow,615*ratioh,222*ratiow,620*ratioh,226*ratiow,623*ratioh,229*ratiow,625*ratioh,237*ratiow,629*ratioh,245*ratiow,634*ratioh,252*ratiow,639*ratioh,281*ratiow,661*ratioh,291*ratiow,671*ratioh,300*ratiow,679*ratioh,314*ratiow,697*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(353*ratiow,660*ratioh,343*ratiow,672*ratioh,332*ratiow,685*ratioh,324*ratiow,694*ratioh,318*ratiow,702*ratioh,313*ratiow,696*ratioh,306*ratiow,688*ratioh,299*ratiow,678*ratioh,291*ratiow,671*ratioh,283*ratiow,663*ratioh,277*ratiow,658*ratioh,264*ratiow,648*ratioh,257*ratiow,643*ratioh,250*ratiow,638*ratioh,242*ratiow,632*ratioh,233*ratiow,627*ratioh,226*ratiow,624*ratioh,220*ratiow,617*ratioh,218*ratiow,611*ratioh,219*ratiow,607*ratioh,226*ratiow,602*ratioh,236*ratiow,598*ratioh,250*ratiow,591*ratioh,260*ratiow,586*ratioh,275*ratiow,579*ratioh,282*ratiow,576*ratioh,291*ratiow,573*ratioh,299*ratiow,571*ratioh,307*ratiow,570*ratioh,315*ratiow,569*ratioh,324*ratiow,568*ratioh,333*ratiow,568*ratioh,341*ratiow,567*ratioh,350*ratiow,569*ratioh,362*ratiow,571*ratioh,370*ratiow,573*ratioh,377*ratiow,575*ratioh,384*ratiow,578*ratioh,392*ratiow,580*ratioh,399*ratiow,582*ratioh,401*ratiow,583*ratioh,405*ratiow,591*ratioh,403*ratiow,591*ratioh,395*ratiow,588*ratioh,388*ratiow,586*ratioh,378*ratiow,584*ratioh,368*ratiow,583*ratioh,359*ratiow,581*ratioh,345*ratiow,580*ratioh,334*ratiow,581*ratioh,324*ratiow,582*ratioh,315*ratiow,585*ratioh,309*ratiow,588*ratioh,304*ratiow,592*ratioh,297*ratiow,601*ratioh,294*ratiow,611*ratioh,293*ratiow,619*ratioh,294*ratiow,626*ratioh,297*ratiow,632*ratioh,300*ratiow,636*ratioh,304*ratiow,641*ratioh,312*ratiow,648*ratioh,320*ratiow,653*ratioh,329*ratiow,657*ratioh,336*ratiow,659*ratioh,344*ratiow,660*ratioh,353*ratiow,660*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//VO
selectWindow(name);
makePolygon(40*ratiow,577*ratioh,44*ratiow,565*ratioh,49*ratiow,550*ratioh,53*ratiow,539*ratioh,62*ratiow,512*ratioh,69*ratiow,492*ratioh,75*ratiow,476*ratioh,81*ratiow,462*ratioh,82*ratiow,460*ratioh,86*ratiow,461*ratioh,89*ratiow,461*ratioh,93*ratiow,459*ratioh,98*ratiow,455*ratioh,102*ratiow,449*ratioh,107*ratiow,441*ratioh,112*ratiow,433*ratioh,115*ratiow,425*ratioh,118*ratiow,418*ratioh,122*ratiow,412*ratioh,124*ratiow,407*ratioh,127*ratiow,402*ratioh,132*ratiow,396*ratioh,138*ratiow,387*ratioh,145*ratiow,379*ratioh,149*ratiow,374*ratioh,154*ratiow,369*ratioh,160*ratiow,364*ratioh,165*ratiow,359*ratioh,170*ratiow,356*ratioh,175*ratiow,352*ratioh,180*ratiow,348*ratioh,185*ratiow,345*ratioh,186*ratiow,344*ratioh,186*ratiow,349*ratioh,183*ratiow,359*ratioh,181*ratiow,365*ratioh,180*ratiow,372*ratioh,179*ratiow,381*ratioh,178*ratiow,389*ratioh,177*ratiow,397*ratioh,176*ratiow,405*ratioh,176*ratiow,413*ratioh,176*ratiow,422*ratioh,176*ratiow,432*ratioh,176*ratiow,440*ratioh,176*ratiow,448*ratioh,177*ratiow,458*ratioh,178*ratiow,468*ratioh,180*ratiow,480*ratioh,181*ratiow,489*ratioh,182*ratiow,499*ratioh,184*ratiow,506*ratioh,186*ratiow,513*ratioh,187*ratiow,519*ratioh,187*ratiow,521*ratioh,186*ratiow,521*ratioh,181*ratiow,522*ratioh,169*ratiow,527*ratioh,159*ratiow,531*ratioh,146*ratiow,537*ratioh,136*ratiow,542*ratioh,127*ratiow,547*ratioh,118*ratiow,553*ratioh,104*ratiow,561*ratioh,92*ratiow,567*ratioh,79*ratiow,573*ratioh,66*ratiow,577*ratioh,54*ratiow,579*ratioh,47*ratiow,578*ratioh);
data = analyze_pic(data);

//LO
selectWindow(name);
makePolygon(190*ratiow,342*ratioh,195*ratiow,338*ratioh,203*ratiow,333*ratioh,212*ratiow,328*ratioh,220*ratiow,323*ratioh,229*ratiow,318*ratioh,235*ratiow,314*ratioh,239*ratiow,321*ratioh,245*ratiow,331*ratioh,251*ratiow,342*ratioh,257*ratiow,353*ratioh,263*ratiow,363*ratioh,271*ratiow,377*ratioh,278*ratiow,390*ratioh,286*ratiow,405*ratioh,293*ratiow,417*ratioh,300*ratiow,432*ratioh,309*ratiow,448*ratioh,317*ratiow,464*ratioh,324*ratiow,477*ratioh,333*ratiow,495*ratioh,341*ratiow,513*ratioh,349*ratiow,528*ratioh,356*ratiow,544*ratioh,362*ratiow,558*ratioh,368*ratiow,575*ratioh,373*ratiow,589*ratioh,373*ratiow,591*ratioh,360*ratiow,588*ratioh,340*ratiow,579*ratioh,325*ratiow,569*ratioh,300*ratiow,556*ratioh,278*ratiow,546*ratioh,271*ratiow,543*ratioh,238*ratiow,529*ratioh,219*ratiow,522*ratioh,208*ratiow,519*ratioh,203*ratiow,518*ratioh,195*ratiow,519*ratioh,187*ratiow,521*ratioh,184*ratiow,505*ratioh,180*ratiow,487*ratioh,178*ratiow,470*ratioh,176*ratiow,454*ratioh,175*ratiow,430*ratioh,176*ratiow,412*ratioh,177*ratiow,396*ratioh,179*ratiow,378*ratioh,181*ratiow,365*ratioh,184*ratiow,354*ratioh,186*ratiow,344*ratioh);
data = analyze_pic(data);

//PrL
selectWindow(name);
makePolygon(173*ratiow,265*ratioh,167*ratiow,260*ratioh,158*ratiow,256*ratioh,146*ratiow,248*ratioh,136*ratiow,242*ratioh,123*ratiow,235*ratioh,112*ratiow,230*ratioh,98*ratiow,224*ratioh,85*ratiow,218*ratioh,71*ratiow,211*ratioh,56*ratiow,205*ratioh,43*ratiow,200*ratioh,32*ratiow,196*ratioh,15*ratiow,190*ratioh,2*ratiow,186*ratioh,1*ratiow,185*ratioh,1*ratiow,416*ratioh,8*ratiow,417*ratioh,20*ratiow,416*ratioh,36*ratiow,415*ratioh,50*ratiow,414*ratioh,64*ratiow,413*ratioh,78*ratiow,412*ratioh,89*ratiow,410*ratioh,96*ratiow,409*ratioh,98*ratiow,402*ratioh,101*ratiow,394*ratioh,106*ratiow,378*ratioh,112*ratiow,363*ratioh,118*ratiow,349*ratioh,125*ratiow,333*ratioh,133*ratiow,320*ratioh,141*ratiow,307*ratioh,149*ratiow,295*ratioh,157*ratiow,284*ratioh,165*ratiow,274*ratioh);
data = analyze_pic(data);

//Cg1
selectWindow(name);
makePolygon(194*ratiow,247*ratioh,172*ratiow,218*ratioh,147*ratiow,190*ratioh,122*ratiow,163*ratioh,97*ratiow,137*ratioh,73*ratiow,112*ratioh,53*ratiow,92*ratioh,35*ratiow,76*ratioh,21*ratiow,64*ratioh,14*ratiow,76*ratioh,8*ratiow,91*ratioh,3*ratiow,109*ratioh,1*ratiow,122*ratioh,1*ratiow,185*ratioh,12*ratiow,189*ratioh,30*ratiow,196*ratioh,41*ratiow,200*ratioh,58*ratiow,206*ratioh,76*ratiow,214*ratioh,93*ratiow,221*ratioh,110*ratiow,229*ratioh,128*ratiow,239*ratioh,147*ratiow,248*ratioh,163*ratiow,258*ratioh,173*ratiow,265*ratioh,179*ratiow,259*ratioh,184*ratiow,254*ratioh,189*ratiow,251*ratioh);
data = analyze_pic(data);

//Pir1a
selectWindow(name);
makePolygon(47*ratiow,696*ratioh,39*ratiow,705*ratioh,32*ratiow,714*ratioh,28*ratiow,719*ratioh,36*ratiow,727*ratioh,47*ratiow,735*ratioh,58*ratiow,742*ratioh,70*ratiow,751*ratioh,77*ratiow,759*ratioh,86*ratiow,766*ratioh,97*ratiow,772*ratioh,111*ratiow,772*ratioh,125*ratiow,770*ratioh,142*ratiow,766*ratioh,160*ratiow,761*ratioh,211*ratiow,741*ratioh,230*ratiow,735*ratioh,242*ratiow,725*ratioh,259*ratiow,713*ratioh,283*ratiow,697*ratioh,299*ratiow,682*ratioh,321*ratiow,663*ratioh,336*ratiow,648*ratioh,350*ratiow,636*ratioh,357*ratiow,627*ratioh,360*ratiow,617*ratioh,362*ratiow,604*ratioh,360*ratiow,593*ratioh,349*ratiow,582*ratioh,326*ratiow,570*ratioh,305*ratiow,558*ratioh,267*ratiow,541*ratioh,240*ratiow,530*ratioh,216*ratiow,521*ratioh,204*ratiow,518*ratioh,191*ratiow,519*ratioh,179*ratiow,523*ratioh,166*ratiow,528*ratioh,146*ratiow,537*ratioh,144*ratiow,538*ratioh,138*ratiow,549*ratioh,131*ratiow,564*ratioh,141*ratiow,559*ratioh,153*ratiow,554*ratioh,163*ratiow,550*ratioh,173*ratiow,547*ratioh,186*ratiow,546*ratioh,201*ratiow,545*ratioh,214*ratiow,546*ratioh,235*ratiow,550*ratioh,255*ratiow,556*ratioh,277*ratiow,563*ratioh,295*ratiow,570*ratioh,310*ratiow,577*ratioh,323*ratiow,583*ratioh,335*ratiow,592*ratioh,342*ratiow,600*ratioh,344*ratiow,606*ratioh,344*ratiow,616*ratioh,342*ratiow,624*ratioh,336*ratiow,632*ratioh,329*ratiow,637*ratioh,322*ratiow,642*ratioh,314*ratiow,647*ratioh,302*ratiow,656*ratioh,259*ratiow,692*ratioh,249*ratiow,699*ratioh,238*ratiow,707*ratioh,231*ratiow,711*ratioh,208*ratiow,724*ratioh,198*ratiow,730*ratioh,182*ratiow,735*ratioh,171*ratiow,739*ratioh,129*ratiow,751*ratioh,124*ratiow,752*ratioh,120*ratiow,759*ratioh,116*ratiow,763*ratioh,112*ratiow,764*ratioh,104*ratiow,760*ratioh,94*ratiow,752*ratioh,84*ratiow,744*ratioh,65*ratiow,726*ratioh,59*ratiow,719*ratioh,55*ratiow,712*ratioh,50*ratiow,704*ratioh,48*ratiow,698*ratioh);
data = analyze_pic(data);

//Pir1b
selectWindow(name);
makePolygon(126*ratiow,714*ratioh,128*ratiow,725*ratioh,129*ratiow,735*ratioh,128*ratiow,743*ratioh,125*ratiow,750*ratioh,126*ratiow,752*ratioh,136*ratiow,749*ratioh,147*ratiow,746*ratioh,155*ratiow,744*ratioh,163*ratiow,741*ratioh,171*ratiow,739*ratioh,196*ratiow,730*ratioh,207*ratiow,725*ratioh,216*ratiow,720*ratioh,223*ratiow,716*ratioh,231*ratiow,711*ratioh,254*ratiow,696*ratioh,263*ratiow,688*ratioh,270*ratiow,682*ratioh,277*ratiow,676*ratioh,291*ratiow,664*ratioh,303*ratiow,656*ratioh,311*ratiow,650*ratioh,318*ratiow,645*ratioh,324*ratiow,641*ratioh,333*ratiow,635*ratioh,337*ratiow,631*ratioh,340*ratiow,627*ratioh,342*ratiow,623*ratioh,344*ratiow,617*ratioh,344*ratiow,610*ratioh,343*ratiow,604*ratioh,340*ratiow,598*ratioh,336*ratiow,592*ratioh,330*ratiow,588*ratioh,320*ratiow,582*ratioh,311*ratiow,578*ratioh,301*ratiow,573*ratioh,290*ratiow,569*ratioh,280*ratiow,565*ratioh,260*ratiow,558*ratioh,248*ratiow,554*ratioh,241*ratiow,552*ratioh,213*ratiow,547*ratioh,203*ratiow,546*ratioh,192*ratiow,546*ratioh,185*ratiow,546*ratioh,174*ratiow,547*ratioh,165*ratiow,549*ratioh,157*ratiow,552*ratioh,149*ratiow,555*ratioh,141*ratiow,559*ratioh,133*ratiow,563*ratioh,130*ratiow,565*ratioh,126*ratiow,574*ratioh,131*ratiow,572*ratioh,138*ratiow,569*ratioh,145*ratiow,566*ratioh,153*ratiow,563*ratioh,162*ratiow,561*ratioh,169*ratiow,559*ratioh,180*ratiow,558*ratioh,191*ratiow,558*ratioh,199*ratiow,558*ratioh,207*ratiow,559*ratioh,220*ratiow,561*ratioh,232*ratiow,563*ratioh,242*ratiow,566*ratioh,250*ratiow,568*ratioh,264*ratiow,572*ratioh,274*ratiow,576*ratioh,287*ratiow,581*ratioh,297*ratiow,585*ratioh,307*ratiow,590*ratioh,315*ratiow,594*ratioh,322*ratiow,600*ratioh,326*ratiow,608*ratioh,326*ratiow,616*ratioh,325*ratiow,622*ratioh,322*ratiow,626*ratioh,317*ratiow,631*ratioh,310*ratiow,634*ratioh,304*ratiow,637*ratioh,290*ratiow,644*ratioh,280*ratiow,649*ratioh,272*ratiow,655*ratioh,265*ratiow,662*ratioh,247*ratiow,681*ratioh,241*ratiow,688*ratioh,234*ratiow,695*ratioh,226*ratiow,702*ratioh,220*ratiow,705*ratioh,213*ratiow,710*ratioh,208*ratiow,712*ratioh,201*ratiow,713*ratioh,189*ratiow,713*ratioh,179*ratiow,712*ratioh,149*ratiow,708*ratioh,136*ratiow,706*ratioh,128*ratiow,705*ratioh,122*ratiow,703*ratioh,122*ratiow,706*ratioh,123*ratiow,710*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(206*ratiow,702*ratioh,210*ratiow,708*ratioh,211*ratiow,710*ratioh,217*ratiow,708*ratioh,224*ratiow,703*ratioh,230*ratiow,698*ratioh,237*ratiow,691*ratioh,244*ratiow,684*ratioh,251*ratiow,677*ratioh,256*ratiow,671*ratioh,262*ratiow,664*ratioh,268*ratiow,659*ratioh,275*ratiow,653*ratioh,283*ratiow,648*ratioh,290*ratiow,643*ratioh,299*ratiow,640*ratioh,306*ratiow,636*ratioh,314*ratiow,632*ratioh,321*ratiow,627*ratioh,325*ratiow,622*ratioh,326*ratiow,612*ratioh,325*ratiow,603*ratioh,318*ratiow,596*ratioh,310*ratiow,591*ratioh,297*ratiow,585*ratioh,258*ratiow,570*ratioh,239*ratiow,565*ratioh,228*ratiow,562*ratioh,203*ratiow,558*ratioh,188*ratiow,557*ratioh,177*ratiow,558*ratioh,167*ratiow,560*ratioh,142*ratiow,567*ratioh,130*ratiow,572*ratioh,126*ratiow,573*ratioh,123*ratiow,582*ratioh,128*ratiow,581*ratioh,135*ratiow,579*ratioh,143*ratiow,576*ratioh,152*ratiow,574*ratioh,161*ratiow,571*ratioh,175*ratiow,569*ratioh,186*ratiow,568*ratioh,195*ratiow,568*ratioh,205*ratiow,568*ratioh,219*ratiow,570*ratioh,233*ratiow,573*ratioh,245*ratiow,577*ratioh,254*ratiow,581*ratioh,268*ratiow,587*ratioh,279*ratiow,593*ratioh,289*ratiow,598*ratioh,299*ratiow,603*ratioh,302*ratiow,605*ratioh,306*ratiow,609*ratioh,305*ratiow,615*ratioh,302*ratiow,620*ratioh,298*ratiow,623*ratioh,295*ratiow,625*ratioh,287*ratiow,629*ratioh,279*ratiow,634*ratioh,272*ratiow,639*ratioh,243*ratiow,661*ratioh,233*ratiow,671*ratioh,224*ratiow,679*ratioh,210*ratiow,697*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(171*ratiow,660*ratioh,181*ratiow,672*ratioh,192*ratiow,685*ratioh,200*ratiow,694*ratioh,206*ratiow,702*ratioh,211*ratiow,696*ratioh,218*ratiow,688*ratioh,225*ratiow,678*ratioh,233*ratiow,671*ratioh,241*ratiow,663*ratioh,247*ratiow,658*ratioh,260*ratiow,648*ratioh,267*ratiow,643*ratioh,274*ratiow,638*ratioh,282*ratiow,632*ratioh,291*ratiow,627*ratioh,298*ratiow,624*ratioh,304*ratiow,617*ratioh,306*ratiow,611*ratioh,305*ratiow,607*ratioh,298*ratiow,602*ratioh,288*ratiow,598*ratioh,274*ratiow,591*ratioh,264*ratiow,586*ratioh,249*ratiow,579*ratioh,242*ratiow,576*ratioh,233*ratiow,573*ratioh,225*ratiow,571*ratioh,217*ratiow,570*ratioh,209*ratiow,569*ratioh,200*ratiow,568*ratioh,191*ratiow,568*ratioh,183*ratiow,567*ratioh,174*ratiow,569*ratioh,162*ratiow,571*ratioh,154*ratiow,573*ratioh,147*ratiow,575*ratioh,140*ratiow,578*ratioh,132*ratiow,580*ratioh,125*ratiow,582*ratioh,123*ratiow,583*ratioh,119*ratiow,591*ratioh,121*ratiow,591*ratioh,129*ratiow,588*ratioh,136*ratiow,586*ratioh,146*ratiow,584*ratioh,156*ratiow,583*ratioh,165*ratiow,581*ratioh,179*ratiow,580*ratioh,190*ratiow,581*ratioh,200*ratiow,582*ratioh,209*ratiow,585*ratioh,215*ratiow,588*ratioh,220*ratiow,592*ratioh,227*ratiow,601*ratioh,230*ratiow,611*ratioh,231*ratiow,619*ratioh,230*ratiow,626*ratioh,227*ratiow,632*ratioh,224*ratiow,636*ratioh,220*ratiow,641*ratioh,212*ratiow,648*ratioh,204*ratiow,653*ratioh,195*ratiow,657*ratioh,188*ratiow,659*ratioh,180*ratiow,660*ratioh,171*ratiow,660*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}


function processFile09(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 568;
var baseHeight = 778;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "PrL, IL, Cg1, LO, VO, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//PrL
selectWindow(name);
makePolygon(403*ratiow,252*ratioh,415*ratiow,248*ratioh,430*ratiow,243*ratioh,449*ratiow,237*ratioh,466*ratiow,232*ratioh,483*ratiow,228*ratioh,499*ratiow,224*ratioh,514*ratiow,220*ratioh,525*ratiow,217*ratioh,539*ratiow,214*ratioh,553*ratiow,211*ratioh,565*ratiow,209*ratioh,566*ratiow,208*ratioh,567*ratiow,439*ratioh,461*ratiow,440*ratioh,458*ratiow,427*ratioh,454*ratiow,414*ratioh,450*ratiow,398*ratioh,445*ratiow,381*ratioh,440*ratiow,364*ratioh,436*ratiow,348*ratioh,431*ratiow,329*ratioh,426*ratiow,313*ratioh,421*ratiow,298*ratioh,417*ratiow,285*ratioh,412*ratiow,273*ratioh,408*ratiow,263*ratioh,405*ratiow,256*ratioh);
data = analyze_pic(data);

//IL
selectWindow(name);
makePolygon(475*ratiow,515*ratioh,474*ratiow,500*ratioh,472*ratiow,483*ratioh,469*ratiow,470*ratioh,466*ratiow,456*ratioh,462*ratiow,447*ratioh,461*ratiow,440*ratioh,567*ratiow,439*ratioh,567*ratiow,515*ratioh);
data = analyze_pic(data);

//Cg1
selectWindow(name);
makePolygon(389*ratiow,231*ratioh,431*ratiow,189*ratioh,464*ratiow,154*ratioh,493*ratiow,124*ratioh,511*ratiow,105*ratioh,533*ratiow,82*ratioh,542*ratiow,74*ratioh,548*ratiow,82*ratioh,554*ratiow,91*ratioh,559*ratiow,105*ratioh,564*ratiow,120*ratioh,567*ratiow,137*ratioh,567*ratiow,208*ratioh,526*ratiow,217*ratioh,494*ratiow,225*ratioh,457*ratiow,235*ratioh,426*ratiow,244*ratioh,411*ratiow,250*ratioh,403*ratiow,253*ratioh,401*ratiow,248*ratioh,398*ratiow,240*ratioh,395*ratiow,236*ratioh);
data = analyze_pic(data);

//LO
selectWindow(name);
makePolygon(133*ratiow,620*ratioh,153*ratiow,591*ratioh,170*ratiow,566*ratioh,184*ratiow,544*ratioh,197*ratiow,525*ratioh,210*ratiow,505*ratioh,219*ratiow,493*ratioh,231*ratiow,473*ratioh,248*ratiow,448*ratioh,259*ratiow,431*ratioh,270*ratiow,414*ratioh,280*ratiow,399*ratioh,288*ratiow,388*ratioh,295*ratiow,377*ratioh,297*ratiow,374*ratioh,304*ratiow,378*ratioh,312*ratiow,382*ratioh,320*ratiow,385*ratioh,329*ratiow,387*ratioh,336*ratiow,389*ratioh,346*ratiow,392*ratioh,349*ratiow,393*ratioh,350*ratiow,398*ratioh,353*ratiow,406*ratioh,357*ratiow,421*ratioh,359*ratiow,433*ratioh,361*ratiow,444*ratioh,362*ratiow,456*ratioh,362*ratiow,466*ratioh,361*ratiow,475*ratioh,358*ratiow,490*ratioh,353*ratiow,502*ratioh,350*ratiow,510*ratioh,345*ratiow,518*ratioh,340*ratiow,526*ratioh,334*ratiow,533*ratioh,319*ratiow,547*ratioh,309*ratiow,554*ratioh,297*ratiow,561*ratioh,286*ratiow,567*ratioh,258*ratiow,581*ratioh,228*ratiow,593*ratioh,209*ratiow,601*ratioh,181*ratiow,611*ratioh,170*ratiow,618*ratioh,165*ratiow,620*ratioh,158*ratiow,622*ratioh,154*ratiow,623*ratioh,147*ratiow,623*ratioh,140*ratiow,622*ratioh);
data = analyze_pic(data);

//VO
selectWindow(name);
makePolygon(336*ratiow,581*ratioh,311*ratiow,553*ratioh,327*ratiow,541*ratioh,339*ratiow,527*ratioh,349*ratiow,511*ratioh,356*ratiow,496*ratioh,361*ratiow,480*ratioh,362*ratiow,462*ratioh,361*ratiow,446*ratioh,359*ratiow,432*ratioh,357*ratiow,423*ratioh,355*ratiow,412*ratioh,352*ratiow,401*ratioh,349*ratiow,393*ratioh,355*ratiow,394*ratioh,365*ratiow,398*ratioh,373*ratiow,400*ratioh,382*ratiow,404*ratioh,392*ratiow,409*ratioh,405*ratiow,415*ratioh,417*ratiow,423*ratioh,428*ratiow,433*ratioh,436*ratiow,442*ratioh,444*ratiow,452*ratioh,454*ratiow,465*ratioh,460*ratiow,474*ratioh,467*ratiow,485*ratioh,473*ratiow,499*ratioh,475*ratiow,506*ratioh,477*ratiow,531*ratioh,478*ratiow,549*ratioh,478*ratiow,562*ratioh,481*ratiow,570*ratioh,481*ratiow,573*ratioh,473*ratiow,567*ratioh,461*ratiow,562*ratioh,449*ratiow,558*ratioh,439*ratiow,555*ratioh,427*ratiow,551*ratioh,412*ratiow,548*ratioh,400*ratiow,547*ratioh,388*ratiow,549*ratioh,368*ratiow,556*ratioh,357*ratiow,563*ratioh,347*ratiow,571*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(363*ratiow,739*ratioh,361*ratiow,774*ratioh,346*ratiow,773*ratioh,328*ratiow,771*ratioh,315*ratiow,768*ratioh,302*ratiow,764*ratioh,287*ratiow,757*ratioh,275*ratiow,749*ratioh,266*ratiow,743*ratioh,254*ratiow,736*ratioh,245*ratiow,727*ratioh,239*ratiow,720*ratioh,234*ratiow,711*ratioh,230*ratiow,702*ratioh,226*ratiow,696*ratioh,223*ratiow,693*ratioh,218*ratiow,690*ratioh,210*ratiow,687*ratioh,198*ratiow,685*ratioh,190*ratiow,684*ratioh,180*ratiow,683*ratioh,171*ratiow,678*ratioh,166*ratiow,668*ratioh,161*ratiow,657*ratioh,158*ratiow,644*ratioh,159*ratiow,633*ratioh,164*ratiow,624*ratioh,172*ratiow,617*ratioh,187*ratiow,609*ratioh,207*ratiow,602*ratioh,225*ratiow,595*ratioh,255*ratiow,582*ratioh,279*ratiow,572*ratioh,295*ratiow,563*ratioh,306*ratiow,556*ratioh,336*ratiow,581*ratioh,330*ratiow,583*ratioh,320*ratiow,587*ratioh,301*ratiow,597*ratioh,290*ratiow,602*ratioh,277*ratiow,607*ratioh,265*ratiow,610*ratioh,243*ratiow,616*ratioh,226*ratiow,620*ratioh,212*ratiow,623*ratioh,199*ratiow,628*ratioh,189*ratiow,634*ratioh,186*ratiow,638*ratioh,185*ratiow,643*ratioh,185*ratiow,648*ratioh,186*ratiow,653*ratioh,190*ratiow,657*ratioh,194*ratiow,660*ratioh,199*ratiow,662*ratioh,207*ratiow,662*ratioh,216*ratiow,663*ratioh,224*ratiow,664*ratioh,232*ratiow,665*ratioh,239*ratiow,667*ratioh,246*ratiow,674*ratioh,250*ratiow,680*ratioh,252*ratiow,686*ratioh,255*ratiow,692*ratioh,258*ratiow,699*ratioh,262*ratiow,705*ratioh,266*ratiow,710*ratioh,269*ratiow,713*ratioh,278*ratiow,721*ratioh,288*ratiow,725*ratioh,297*ratiow,727*ratioh,301*ratiow,727*ratioh,304*ratiow,731*ratioh,308*ratiow,736*ratioh,322*ratiow,738*ratioh,335*ratiow,739*ratioh,347*ratiow,740*ratioh,359*ratiow,740*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(356*ratiow,728*ratioh,361*ratiow,729*ratioh,366*ratiow,731*ratioh,367*ratiow,734*ratioh,366*ratiow,737*ratioh,362*ratiow,740*ratioh,352*ratiow,740*ratioh,338*ratiow,739*ratioh,323*ratiow,738*ratioh,312*ratiow,737*ratioh,308*ratiow,736*ratioh,304*ratiow,732*ratioh,303*ratiow,729*ratioh,300*ratiow,727*ratioh,294*ratiow,726*ratioh,287*ratiow,725*ratioh,281*ratiow,722*ratioh,273*ratiow,717*ratioh,267*ratiow,711*ratioh,262*ratiow,705*ratioh,256*ratiow,695*ratioh,253*ratiow,687*ratioh,250*ratiow,679*ratioh,245*ratiow,673*ratioh,240*ratiow,668*ratioh,235*ratiow,666*ratioh,228*ratiow,665*ratioh,220*ratiow,664*ratioh,211*ratiow,663*ratioh,202*ratiow,662*ratioh,196*ratiow,661*ratioh,190*ratiow,657*ratioh,186*ratiow,653*ratioh,185*ratiow,646*ratioh,185*ratiow,639*ratioh,190*ratiow,633*ratioh,196*ratiow,629*ratioh,204*ratiow,626*ratioh,214*ratiow,623*ratioh,224*ratiow,620*ratioh,236*ratiow,618*ratioh,248*ratiow,615*ratioh,258*ratiow,612*ratioh,268*ratiow,610*ratioh,285*ratiow,604*ratioh,293*ratiow,601*ratioh,301*ratiow,597*ratioh,314*ratiow,590*ratioh,324*ratiow,585*ratioh,333*ratiow,582*ratioh,337*ratiow,582*ratioh,339*ratiow,585*ratioh,340*ratiow,587*ratioh,335*ratiow,591*ratioh,316*ratiow,601*ratioh,305*ratiow,607*ratioh,285*ratiow,617*ratioh,272*ratiow,622*ratioh,261*ratiow,625*ratioh,237*ratiow,630*ratioh,222*ratiow,634*ratioh,215*ratiow,636*ratioh,209*ratiow,638*ratioh,204*ratiow,642*ratioh,204*ratiow,646*ratioh,208*ratiow,649*ratioh,212*ratiow,651*ratioh,221*ratiow,651*ratioh,237*ratiow,651*ratioh,244*ratiow,653*ratioh,251*ratiow,656*ratioh,256*ratiow,660*ratioh,262*ratiow,667*ratioh,265*ratiow,672*ratioh,268*ratiow,679*ratioh,272*ratiow,687*ratioh,276*ratiow,694*ratioh,282*ratiow,702*ratioh,288*ratiow,705*ratioh,296*ratiow,708*ratioh,306*ratiow,708*ratioh,312*ratiow,711*ratioh,319*ratiow,719*ratioh,326*ratiow,724*ratioh,331*ratiow,726*ratioh,338*ratiow,727*ratioh,344*ratiow,727*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(357*ratiow,689*ratioh,355*ratiow,695*ratioh,353*ratiow,702*ratioh,353*ratiow,711*ratioh,355*ratiow,719*ratioh,359*ratiow,726*ratioh,360*ratiow,728*ratioh,353*ratiow,728*ratioh,340*ratiow,727*ratioh,330*ratiow,726*ratioh,322*ratiow,722*ratioh,316*ratiow,716*ratioh,311*ratiow,710*ratioh,305*ratiow,708*ratioh,291*ratiow,707*ratioh,283*ratiow,703*ratioh,278*ratiow,698*ratioh,271*ratiow,686*ratioh,267*ratiow,677*ratioh,263*ratiow,668*ratioh,258*ratiow,662*ratioh,251*ratiow,657*ratioh,244*ratiow,653*ratioh,235*ratiow,651*ratioh,222*ratiow,651*ratioh,210*ratiow,650*ratioh,205*ratiow,647*ratioh,203*ratiow,644*ratioh,205*ratiow,640*ratioh,211*ratiow,637*ratioh,222*ratiow,634*ratioh,231*ratiow,632*ratioh,243*ratiow,629*ratioh,253*ratiow,627*ratioh,288*ratiow,616*ratioh,301*ratiow,610*ratioh,311*ratiow,605*ratioh,327*ratiow,595*ratioh,336*ratiow,590*ratioh,340*ratiow,587*ratioh,344*ratiow,590*ratioh,351*ratiow,595*ratioh,358*ratiow,600*ratioh,360*ratiow,602*ratioh,358*ratiow,604*ratioh,346*ratiow,608*ratioh,336*ratiow,612*ratioh,326*ratiow,617*ratioh,319*ratiow,622*ratioh,312*ratiow,627*ratioh,306*ratiow,635*ratioh,305*ratiow,642*ratioh,304*ratiow,652*ratioh,306*ratiow,660*ratioh,309*ratiow,668*ratioh,314*ratiow,675*ratioh,322*ratiow,681*ratioh,331*ratiow,685*ratioh,339*ratiow,686*ratioh,348*ratiow,686*ratioh,357*ratiow,686*ratioh,359*ratiow,686*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//PrL
selectWindow(name);
makePolygon(165*ratiow,252*ratioh,153*ratiow,248*ratioh,138*ratiow,243*ratioh,119*ratiow,237*ratioh,102*ratiow,232*ratioh,85*ratiow,228*ratioh,69*ratiow,224*ratioh,54*ratiow,220*ratioh,43*ratiow,217*ratioh,29*ratiow,214*ratioh,15*ratiow,211*ratioh,3*ratiow,209*ratioh,2*ratiow,208*ratioh,1*ratiow,439*ratioh,107*ratiow,440*ratioh,110*ratiow,427*ratioh,114*ratiow,414*ratioh,118*ratiow,398*ratioh,123*ratiow,381*ratioh,128*ratiow,364*ratioh,132*ratiow,348*ratioh,137*ratiow,329*ratioh,142*ratiow,313*ratioh,147*ratiow,298*ratioh,151*ratiow,285*ratioh,156*ratiow,273*ratioh,160*ratiow,263*ratioh,163*ratiow,256*ratioh);
data = analyze_pic(data);

//IL
selectWindow(name);
makePolygon(93*ratiow,515*ratioh,94*ratiow,500*ratioh,96*ratiow,483*ratioh,99*ratiow,470*ratioh,102*ratiow,456*ratioh,106*ratiow,447*ratioh,107*ratiow,440*ratioh,1*ratiow,439*ratioh,1*ratiow,515*ratioh);
data = analyze_pic(data);

//Cg1
selectWindow(name);
makePolygon(179*ratiow,231*ratioh,137*ratiow,189*ratioh,104*ratiow,154*ratioh,75*ratiow,124*ratioh,57*ratiow,105*ratioh,35*ratiow,82*ratioh,26*ratiow,74*ratioh,20*ratiow,82*ratioh,14*ratiow,91*ratioh,9*ratiow,105*ratioh,4*ratiow,120*ratioh,1*ratiow,137*ratioh,1*ratiow,208*ratioh,42*ratiow,217*ratioh,74*ratiow,225*ratioh,111*ratiow,235*ratioh,142*ratiow,244*ratioh,157*ratiow,250*ratioh,165*ratiow,253*ratioh,167*ratiow,248*ratioh,170*ratiow,240*ratioh,173*ratiow,236*ratioh);
data = analyze_pic(data);

//LO
selectWindow(name);
makePolygon(435*ratiow,620*ratioh,415*ratiow,591*ratioh,398*ratiow,566*ratioh,384*ratiow,544*ratioh,371*ratiow,525*ratioh,358*ratiow,505*ratioh,349*ratiow,493*ratioh,337*ratiow,473*ratioh,320*ratiow,448*ratioh,309*ratiow,431*ratioh,298*ratiow,414*ratioh,288*ratiow,399*ratioh,280*ratiow,388*ratioh,273*ratiow,377*ratioh,271*ratiow,374*ratioh,264*ratiow,378*ratioh,256*ratiow,382*ratioh,248*ratiow,385*ratioh,239*ratiow,387*ratioh,232*ratiow,389*ratioh,222*ratiow,392*ratioh,219*ratiow,393*ratioh,218*ratiow,398*ratioh,215*ratiow,406*ratioh,211*ratiow,421*ratioh,209*ratiow,433*ratioh,207*ratiow,444*ratioh,206*ratiow,456*ratioh,206*ratiow,466*ratioh,207*ratiow,475*ratioh,210*ratiow,490*ratioh,215*ratiow,502*ratioh,218*ratiow,510*ratioh,223*ratiow,518*ratioh,228*ratiow,526*ratioh,234*ratiow,533*ratioh,249*ratiow,547*ratioh,259*ratiow,554*ratioh,271*ratiow,561*ratioh,282*ratiow,567*ratioh,310*ratiow,581*ratioh,340*ratiow,593*ratioh,359*ratiow,601*ratioh,387*ratiow,611*ratioh,398*ratiow,618*ratioh,403*ratiow,620*ratioh,410*ratiow,622*ratioh,414*ratiow,623*ratioh,421*ratiow,623*ratioh,428*ratiow,622*ratioh);
data = analyze_pic(data);

//VO
selectWindow(name);
makePolygon(232*ratiow,581*ratioh,257*ratiow,553*ratioh,241*ratiow,541*ratioh,229*ratiow,527*ratioh,219*ratiow,511*ratioh,212*ratiow,496*ratioh,207*ratiow,480*ratioh,206*ratiow,462*ratioh,207*ratiow,446*ratioh,209*ratiow,432*ratioh,211*ratiow,423*ratioh,213*ratiow,412*ratioh,216*ratiow,401*ratioh,219*ratiow,393*ratioh,213*ratiow,394*ratioh,203*ratiow,398*ratioh,195*ratiow,400*ratioh,186*ratiow,404*ratioh,176*ratiow,409*ratioh,163*ratiow,415*ratioh,151*ratiow,423*ratioh,140*ratiow,433*ratioh,132*ratiow,442*ratioh,124*ratiow,452*ratioh,114*ratiow,465*ratioh,108*ratiow,474*ratioh,101*ratiow,485*ratioh,95*ratiow,499*ratioh,93*ratiow,506*ratioh,91*ratiow,531*ratioh,90*ratiow,549*ratioh,90*ratiow,562*ratioh,87*ratiow,570*ratioh,87*ratiow,573*ratioh,95*ratiow,567*ratioh,107*ratiow,562*ratioh,119*ratiow,558*ratioh,129*ratiow,555*ratioh,141*ratiow,551*ratioh,156*ratiow,548*ratioh,168*ratiow,547*ratioh,180*ratiow,549*ratioh,200*ratiow,556*ratioh,211*ratiow,563*ratioh,221*ratiow,571*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(205*ratiow,739*ratioh,207*ratiow,774*ratioh,222*ratiow,773*ratioh,240*ratiow,771*ratioh,253*ratiow,768*ratioh,266*ratiow,764*ratioh,281*ratiow,757*ratioh,293*ratiow,749*ratioh,302*ratiow,743*ratioh,314*ratiow,736*ratioh,323*ratiow,727*ratioh,329*ratiow,720*ratioh,334*ratiow,711*ratioh,338*ratiow,702*ratioh,342*ratiow,696*ratioh,345*ratiow,693*ratioh,350*ratiow,690*ratioh,358*ratiow,687*ratioh,370*ratiow,685*ratioh,378*ratiow,684*ratioh,388*ratiow,683*ratioh,397*ratiow,678*ratioh,402*ratiow,668*ratioh,407*ratiow,657*ratioh,410*ratiow,644*ratioh,409*ratiow,633*ratioh,404*ratiow,624*ratioh,396*ratiow,617*ratioh,381*ratiow,609*ratioh,361*ratiow,602*ratioh,343*ratiow,595*ratioh,313*ratiow,582*ratioh,289*ratiow,572*ratioh,273*ratiow,563*ratioh,262*ratiow,556*ratioh,232*ratiow,581*ratioh,238*ratiow,583*ratioh,248*ratiow,587*ratioh,267*ratiow,597*ratioh,278*ratiow,602*ratioh,291*ratiow,607*ratioh,303*ratiow,610*ratioh,325*ratiow,616*ratioh,342*ratiow,620*ratioh,356*ratiow,623*ratioh,369*ratiow,628*ratioh,379*ratiow,634*ratioh,382*ratiow,638*ratioh,383*ratiow,643*ratioh,383*ratiow,648*ratioh,382*ratiow,653*ratioh,378*ratiow,657*ratioh,374*ratiow,660*ratioh,369*ratiow,662*ratioh,361*ratiow,662*ratioh,352*ratiow,663*ratioh,344*ratiow,664*ratioh,336*ratiow,665*ratioh,329*ratiow,667*ratioh,322*ratiow,674*ratioh,318*ratiow,680*ratioh,316*ratiow,686*ratioh,313*ratiow,692*ratioh,310*ratiow,699*ratioh,306*ratiow,705*ratioh,302*ratiow,710*ratioh,299*ratiow,713*ratioh,290*ratiow,721*ratioh,280*ratiow,725*ratioh,271*ratiow,727*ratioh,267*ratiow,727*ratioh,264*ratiow,731*ratioh,260*ratiow,736*ratioh,246*ratiow,738*ratioh,233*ratiow,739*ratioh,221*ratiow,740*ratioh,209*ratiow,740*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(212*ratiow,728*ratioh,207*ratiow,729*ratioh,202*ratiow,731*ratioh,201*ratiow,734*ratioh,202*ratiow,737*ratioh,206*ratiow,740*ratioh,216*ratiow,740*ratioh,230*ratiow,739*ratioh,245*ratiow,738*ratioh,256*ratiow,737*ratioh,260*ratiow,736*ratioh,264*ratiow,732*ratioh,265*ratiow,729*ratioh,268*ratiow,727*ratioh,274*ratiow,726*ratioh,281*ratiow,725*ratioh,287*ratiow,722*ratioh,295*ratiow,717*ratioh,301*ratiow,711*ratioh,306*ratiow,705*ratioh,312*ratiow,695*ratioh,315*ratiow,687*ratioh,318*ratiow,679*ratioh,323*ratiow,673*ratioh,328*ratiow,668*ratioh,333*ratiow,666*ratioh,340*ratiow,665*ratioh,348*ratiow,664*ratioh,357*ratiow,663*ratioh,366*ratiow,662*ratioh,372*ratiow,661*ratioh,378*ratiow,657*ratioh,382*ratiow,653*ratioh,383*ratiow,646*ratioh,383*ratiow,639*ratioh,378*ratiow,633*ratioh,372*ratiow,629*ratioh,364*ratiow,626*ratioh,354*ratiow,623*ratioh,344*ratiow,620*ratioh,332*ratiow,618*ratioh,320*ratiow,615*ratioh,310*ratiow,612*ratioh,300*ratiow,610*ratioh,283*ratiow,604*ratioh,275*ratiow,601*ratioh,267*ratiow,597*ratioh,254*ratiow,590*ratioh,244*ratiow,585*ratioh,235*ratiow,582*ratioh,231*ratiow,582*ratioh,229*ratiow,585*ratioh,228*ratiow,587*ratioh,233*ratiow,591*ratioh,252*ratiow,601*ratioh,263*ratiow,607*ratioh,283*ratiow,617*ratioh,296*ratiow,622*ratioh,307*ratiow,625*ratioh,331*ratiow,630*ratioh,346*ratiow,634*ratioh,353*ratiow,636*ratioh,359*ratiow,638*ratioh,364*ratiow,642*ratioh,364*ratiow,646*ratioh,360*ratiow,649*ratioh,356*ratiow,651*ratioh,347*ratiow,651*ratioh,331*ratiow,651*ratioh,324*ratiow,653*ratioh,317*ratiow,656*ratioh,312*ratiow,660*ratioh,306*ratiow,667*ratioh,303*ratiow,672*ratioh,300*ratiow,679*ratioh,296*ratiow,687*ratioh,292*ratiow,694*ratioh,286*ratiow,702*ratioh,280*ratiow,705*ratioh,272*ratiow,708*ratioh,262*ratiow,708*ratioh,256*ratiow,711*ratioh,249*ratiow,719*ratioh,242*ratiow,724*ratioh,237*ratiow,726*ratioh,230*ratiow,727*ratioh,224*ratiow,727*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(211*ratiow,689*ratioh,213*ratiow,695*ratioh,215*ratiow,702*ratioh,215*ratiow,711*ratioh,213*ratiow,719*ratioh,209*ratiow,726*ratioh,208*ratiow,728*ratioh,215*ratiow,728*ratioh,228*ratiow,727*ratioh,238*ratiow,726*ratioh,246*ratiow,722*ratioh,252*ratiow,716*ratioh,257*ratiow,710*ratioh,263*ratiow,708*ratioh,277*ratiow,707*ratioh,285*ratiow,703*ratioh,290*ratiow,698*ratioh,297*ratiow,686*ratioh,301*ratiow,677*ratioh,305*ratiow,668*ratioh,310*ratiow,662*ratioh,317*ratiow,657*ratioh,324*ratiow,653*ratioh,333*ratiow,651*ratioh,346*ratiow,651*ratioh,358*ratiow,650*ratioh,363*ratiow,647*ratioh,365*ratiow,644*ratioh,363*ratiow,640*ratioh,357*ratiow,637*ratioh,346*ratiow,634*ratioh,337*ratiow,632*ratioh,325*ratiow,629*ratioh,315*ratiow,627*ratioh,280*ratiow,616*ratioh,267*ratiow,610*ratioh,257*ratiow,605*ratioh,241*ratiow,595*ratioh,232*ratiow,590*ratioh,228*ratiow,587*ratioh,224*ratiow,590*ratioh,217*ratiow,595*ratioh,210*ratiow,600*ratioh,208*ratiow,602*ratioh,210*ratiow,604*ratioh,222*ratiow,608*ratioh,232*ratiow,612*ratioh,242*ratiow,617*ratioh,249*ratiow,622*ratioh,256*ratiow,627*ratioh,262*ratiow,635*ratioh,263*ratiow,642*ratioh,264*ratiow,652*ratioh,262*ratiow,660*ratioh,259*ratiow,668*ratioh,254*ratiow,675*ratioh,246*ratiow,681*ratioh,237*ratiow,685*ratioh,229*ratiow,686*ratioh,220*ratiow,686*ratioh,211*ratiow,686*ratioh,209*ratiow,686*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile10(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 602;
var baseHeight = 828;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "PrL, IL, Cg1, AcbSh, LO, VO, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//PrL
selectWindow(name);
makePolygon(427*ratiow,260*ratioh,601*ratiow,177*ratioh,601*ratiow,423*ratioh,478*ratiow,422*ratioh,474*ratiow,405*ratioh,469*ratiow,386*ratioh,463*ratiow,366*ratioh,457*ratiow,347*ratioh,450*ratiow,326*ratioh,444*ratiow,307*ratioh,439*ratiow,287*ratioh,434*ratiow,273*ratioh);
data = analyze_pic(data);

//IL
selectWindow(name);
makePolygon(477*ratiow,422*ratioh,601*ratiow,424*ratioh,601*ratiow,533*ratioh,477*ratiow,529*ratioh,479*ratiow,524*ratioh,480*ratiow,516*ratioh,480*ratiow,508*ratioh,480*ratiow,498*ratioh,481*ratiow,494*ratioh,483*ratiow,487*ratioh,484*ratiow,479*ratioh,484*ratiow,469*ratioh,483*ratiow,460*ratioh,482*ratiow,451*ratioh,481*ratiow,441*ratioh,479*ratiow,432*ratioh);
data = analyze_pic(data);

//Cg1
selectWindow(name);
makePolygon(415*ratiow,248*ratioh,426*ratiow,230*ratioh,444*ratiow,204*ratioh,466*ratiow,172*ratioh,485*ratiow,144*ratioh,501*ratiow,120*ratioh,517*ratiow,97*ratioh,530*ratiow,78*ratioh,543*ratiow,60*ratioh,546*ratiow,54*ratioh,555*ratiow,62*ratioh,569*ratiow,73*ratioh,584*ratiow,87*ratioh,594*ratiow,100*ratioh,600*ratiow,111*ratioh,601*ratiow,117*ratioh,601*ratiow,177*ratioh,587*ratiow,183*ratioh,551*ratiow,201*ratioh,505*ratiow,222*ratioh,474*ratiow,238*ratioh,445*ratiow,251*ratioh,427*ratiow,260*ratioh,423*ratiow,254*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(429*ratiow,635*ratioh,437*ratiow,630*ratioh,445*ratiow,626*ratioh,453*ratiow,623*ratioh,462*ratiow,620*ratioh,470*ratiow,620*ratioh,476*ratiow,623*ratioh,483*ratiow,628*ratioh,488*ratiow,629*ratioh,488*ratiow,636*ratioh,483*ratiow,642*ratioh,476*ratiow,648*ratioh,469*ratiow,653*ratioh,462*ratiow,657*ratioh,454*ratiow,660*ratioh,446*ratiow,655*ratioh,438*ratiow,652*ratioh,430*ratiow,650*ratioh,424*ratiow,648*ratioh,425*ratiow,641*ratioh);
data = analyze_pic(data);

//LO
selectWindow(name);
makePolygon(175*ratiow,654*ratioh,183*ratiow,634*ratioh,190*ratiow,615*ratioh,202*ratiow,590*ratioh,213*ratiow,567*ratioh,225*ratiow,547*ratioh,236*ratiow,527*ratioh,249*ratiow,509*ratioh,264*ratiow,486*ratioh,280*ratiow,466*ratioh,296*ratiow,449*ratioh,311*ratiow,436*ratioh,320*ratiow,428*ratioh,327*ratiow,435*ratioh,338*ratiow,439*ratioh,351*ratiow,443*ratioh,363*ratiow,445*ratioh,372*ratiow,448*ratioh,372*ratiow,463*ratioh,372*ratiow,478*ratioh,372*ratiow,489*ratioh,369*ratiow,509*ratioh,366*ratiow,526*ratioh,360*ratiow,546*ratioh,353*ratiow,562*ratioh,345*ratiow,576*ratioh,333*ratiow,591*ratioh,319*ratiow,602*ratioh,302*ratiow,613*ratioh,281*ratiow,623*ratioh,261*ratiow,629*ratioh,237*ratiow,636*ratioh,213*ratiow,644*ratioh,193*ratiow,650*ratioh,184*ratiow,654*ratioh);
data = analyze_pic(data);

//VO
selectWindow(name);
makePolygon(311*ratiow,607*ratioh,323*ratiow,599*ratioh,335*ratiow,589*ratioh,345*ratiow,575*ratioh,356*ratiow,556*ratioh,362*ratiow,542*ratioh,366*ratiow,524*ratioh,370*ratiow,504*ratioh,371*ratiow,485*ratioh,372*ratiow,465*ratioh,371*ratiow,449*ratioh,371*ratiow,447*ratioh,381*ratiow,452*ratioh,396*ratiow,458*ratioh,410*ratiow,466*ratioh,423*ratiow,478*ratioh,437*ratiow,490*ratioh,447*ratiow,508*ratioh,453*ratiow,522*ratioh,457*ratiow,532*ratioh,459*ratiow,537*ratioh,465*ratiow,540*ratioh,469*ratiow,539*ratioh,472*ratiow,536*ratioh,473*ratiow,548*ratioh,472*ratiow,565*ratioh,470*ratiow,576*ratioh,467*ratiow,588*ratioh,464*ratiow,596*ratioh,454*ratiow,602*ratioh,438*ratiow,611*ratioh,428*ratiow,616*ratioh,416*ratiow,623*ratioh,398*ratiow,632*ratioh,384*ratiow,641*ratioh,373*ratiow,646*ratioh,354*ratiow,645*ratioh,333*ratiow,644*ratioh,319*ratiow,642*ratioh,315*ratiow,641*ratioh,315*ratiow,631*ratioh,314*ratiow,623*ratioh,313*ratiow,616*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(401*ratiow,772*ratioh,394*ratiow,780*ratioh,386*ratiow,788*ratioh,381*ratiow,793*ratioh,377*ratiow,801*ratioh,374*ratiow,809*ratioh,373*ratiow,813*ratioh,369*ratiow,807*ratioh,360*ratiow,800*ratioh,345*ratiow,791*ratioh,334*ratiow,783*ratioh,325*ratiow,777*ratioh,310*ratiow,764*ratioh,300*ratiow,754*ratioh,288*ratiow,742*ratioh,278*ratiow,736*ratioh,265*ratiow,735*ratioh,249*ratiow,739*ratioh,239*ratiow,744*ratioh,229*ratiow,738*ratioh,207*ratiow,721*ratioh,192*ratiow,706*ratioh,181*ratiow,688*ratioh,178*ratiow,677*ratioh,178*ratiow,665*ratioh,182*ratiow,656*ratioh,190*ratiow,651*ratioh,212*ratiow,644*ratioh,269*ratiow,627*ratioh,283*ratiow,622*ratioh,292*ratiow,618*ratioh,300*ratiow,614*ratioh,312*ratiow,607*ratioh,314*ratiow,626*ratioh,315*ratiow,635*ratioh,315*ratiow,636*ratioh,297*ratiow,643*ratioh,271*ratiow,649*ratioh,246*ratiow,655*ratioh,228*ratiow,660*ratioh,213*ratiow,665*ratioh,202*ratiow,672*ratioh,199*ratiow,676*ratioh,200*ratiow,688*ratioh,203*ratiow,695*ratioh,211*ratiow,698*ratioh,220*ratiow,698*ratioh,238*ratiow,699*ratioh,255*ratiow,699*ratioh,270*ratiow,699*ratioh,282*ratiow,701*ratioh,291*ratiow,703*ratioh,298*ratiow,708*ratioh,303*ratiow,716*ratioh,309*ratiow,726*ratioh,314*ratiow,735*ratioh,319*ratiow,740*ratioh,326*ratiow,742*ratioh,332*ratiow,740*ratioh,333*ratiow,746*ratioh,334*ratiow,753*ratioh,338*ratiow,756*ratioh,346*ratiow,760*ratioh,354*ratiow,761*ratioh,365*ratiow,764*ratioh,377*ratiow,767*ratioh,393*ratiow,770*ratioh,401*ratiow,770*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(407*ratiow,755*ratioh,406*ratiow,763*ratioh,402*ratiow,769*ratioh,395*ratiow,770*ratioh,384*ratiow,768*ratioh,373*ratiow,766*ratioh,360*ratiow,763*ratioh,349*ratiow,760*ratioh,341*ratiow,758*ratioh,336*ratiow,754*ratioh,333*ratiow,749*ratioh,333*ratiow,742*ratioh,333*ratiow,739*ratioh,330*ratiow,741*ratioh,324*ratiow,742*ratioh,319*ratiow,740*ratioh,315*ratiow,735*ratioh,310*ratiow,727*ratioh,305*ratiow,718*ratioh,301*ratiow,711*ratioh,297*ratiow,707*ratioh,294*ratiow,704*ratioh,287*ratiow,702*ratioh,281*ratiow,700*ratioh,269*ratiow,699*ratioh,255*ratiow,699*ratioh,226*ratiow,699*ratioh,215*ratiow,698*ratioh,207*ratiow,697*ratioh,202*ratiow,693*ratioh,199*ratiow,686*ratioh,199*ratiow,676*ratioh,205*ratiow,670*ratioh,213*ratiow,665*ratioh,223*ratiow,662*ratioh,237*ratiow,658*ratioh,271*ratiow,649*ratioh,289*ratiow,645*ratioh,305*ratiow,640*ratioh,315*ratiow,635*ratioh,317*ratiow,642*ratioh,314*ratiow,645*ratioh,306*ratiow,651*ratioh,295*ratiow,654*ratioh,276*ratiow,658*ratioh,260*ratiow,662*ratioh,244*ratiow,666*ratioh,229*ratiow,670*ratioh,220*ratiow,673*ratioh,214*ratiow,678*ratioh,213*ratiow,684*ratioh,217*ratiow,687*ratioh,226*ratiow,688*ratioh,266*ratiow,688*ratioh,294*ratiow,690*ratioh,307*ratiow,691*ratioh,312*ratiow,694*ratioh,316*ratiow,699*ratioh,317*ratiow,708*ratioh,319*ratiow,717*ratioh,323*ratiow,724*ratioh,327*ratiow,729*ratioh,339*ratiow,730*ratioh,342*ratiow,733*ratioh,343*ratiow,744*ratioh,345*ratiow,747*ratioh,353*ratiow,747*ratioh,363*ratiow,746*ratioh,370*ratiow,747*ratioh,376*ratiow,752*ratioh,383*ratiow,756*ratioh,393*ratiow,752*ratioh,399*ratiow,750*ratioh,405*ratiow,752*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(417*ratiow,712*ratioh,413*ratiow,731*ratioh,409*ratiow,749*ratioh,407*ratiow,754*ratioh,404*ratiow,751*ratioh,399*ratiow,751*ratioh,392*ratiow,752*ratioh,387*ratiow,755*ratioh,383*ratiow,756*ratioh,380*ratiow,755*ratioh,375*ratiow,751*ratioh,372*ratiow,747*ratioh,367*ratiow,746*ratioh,358*ratiow,746*ratioh,350*ratiow,747*ratioh,344*ratiow,746*ratioh,342*ratiow,742*ratioh,342*ratiow,733*ratioh,340*ratiow,730*ratioh,333*ratiow,730*ratioh,328*ratiow,730*ratioh,323*ratiow,725*ratioh,321*ratiow,719*ratioh,319*ratiow,715*ratioh,317*ratiow,707*ratioh,315*ratiow,698*ratioh,311*ratiow,693*ratioh,301*ratiow,690*ratioh,287*ratiow,690*ratioh,277*ratiow,689*ratioh,255*ratiow,688*ratioh,223*ratiow,688*ratioh,216*ratiow,686*ratioh,213*ratiow,683*ratioh,213*ratiow,679*ratioh,217*ratiow,676*ratioh,226*ratiow,671*ratioh,235*ratiow,668*ratioh,248*ratiow,665*ratioh,261*ratiow,662*ratioh,275*ratiow,659*ratioh,295*ratiow,654*ratioh,307*ratiow,651*ratioh,314*ratiow,645*ratioh,317*ratiow,641*ratioh,323*ratiow,643*ratioh,339*ratiow,644*ratioh,361*ratiow,645*ratioh,375*ratiow,645*ratioh,372*ratiow,647*ratioh,365*ratiow,651*ratioh,359*ratiow,655*ratioh,352*ratiow,661*ratioh,346*ratiow,668*ratioh,344*ratiow,678*ratioh,347*ratiow,687*ratioh,352*ratiow,695*ratioh,358*ratiow,701*ratioh,365*ratiow,706*ratioh,374*ratiow,712*ratioh,383*ratiow,715*ratioh,394*ratiow,716*ratioh,405*ratiow,715*ratioh,415*ratiow,710*ratioh,417*ratiow,710*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//PrL
selectWindow(name);
makePolygon(175*ratiow,260*ratioh,1*ratiow,177*ratioh,1*ratiow,423*ratioh,124*ratiow,422*ratioh,128*ratiow,405*ratioh,133*ratiow,386*ratioh,139*ratiow,366*ratioh,145*ratiow,347*ratioh,152*ratiow,326*ratioh,158*ratiow,307*ratioh,163*ratiow,287*ratioh,168*ratiow,273*ratioh);
data = analyze_pic(data);

//IL
selectWindow(name);
makePolygon(125*ratiow,422*ratioh,1*ratiow,424*ratioh,1*ratiow,533*ratioh,125*ratiow,529*ratioh,123*ratiow,524*ratioh,122*ratiow,516*ratioh,122*ratiow,508*ratioh,122*ratiow,498*ratioh,121*ratiow,494*ratioh,119*ratiow,487*ratioh,118*ratiow,479*ratioh,118*ratiow,469*ratioh,119*ratiow,460*ratioh,120*ratiow,451*ratioh,121*ratiow,441*ratioh,123*ratiow,432*ratioh);
data = analyze_pic(data);

//Cg1
selectWindow(name);
makePolygon(187*ratiow,248*ratioh,176*ratiow,230*ratioh,158*ratiow,204*ratioh,136*ratiow,172*ratioh,117*ratiow,144*ratioh,101*ratiow,120*ratioh,85*ratiow,97*ratioh,72*ratiow,78*ratioh,59*ratiow,60*ratioh,56*ratiow,54*ratioh,47*ratiow,62*ratioh,33*ratiow,73*ratioh,18*ratiow,87*ratioh,8*ratiow,100*ratioh,2*ratiow,111*ratioh,1*ratiow,117*ratioh,1*ratiow,177*ratioh,15*ratiow,183*ratioh,51*ratiow,201*ratioh,97*ratiow,222*ratioh,128*ratiow,238*ratioh,157*ratiow,251*ratioh,175*ratiow,260*ratioh,179*ratiow,254*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(173*ratiow,635*ratioh,165*ratiow,630*ratioh,157*ratiow,626*ratioh,149*ratiow,623*ratioh,140*ratiow,620*ratioh,132*ratiow,620*ratioh,126*ratiow,623*ratioh,119*ratiow,628*ratioh,114*ratiow,629*ratioh,114*ratiow,636*ratioh,119*ratiow,642*ratioh,126*ratiow,648*ratioh,133*ratiow,653*ratioh,140*ratiow,657*ratioh,148*ratiow,660*ratioh,156*ratiow,655*ratioh,164*ratiow,652*ratioh,172*ratiow,650*ratioh,178*ratiow,648*ratioh,177*ratiow,641*ratioh);
data = analyze_pic(data);

//LO
selectWindow(name);
makePolygon(427*ratiow,654*ratioh,419*ratiow,634*ratioh,412*ratiow,615*ratioh,400*ratiow,590*ratioh,389*ratiow,567*ratioh,377*ratiow,547*ratioh,366*ratiow,527*ratioh,353*ratiow,509*ratioh,338*ratiow,486*ratioh,322*ratiow,466*ratioh,306*ratiow,449*ratioh,291*ratiow,436*ratioh,282*ratiow,428*ratioh,275*ratiow,435*ratioh,264*ratiow,439*ratioh,251*ratiow,443*ratioh,239*ratiow,445*ratioh,230*ratiow,448*ratioh,230*ratiow,463*ratioh,230*ratiow,478*ratioh,230*ratiow,489*ratioh,233*ratiow,509*ratioh,236*ratiow,526*ratioh,242*ratiow,546*ratioh,249*ratiow,562*ratioh,257*ratiow,576*ratioh,269*ratiow,591*ratioh,283*ratiow,602*ratioh,300*ratiow,613*ratioh,321*ratiow,623*ratioh,341*ratiow,629*ratioh,365*ratiow,636*ratioh,389*ratiow,644*ratioh,409*ratiow,650*ratioh,418*ratiow,654*ratioh);
data = analyze_pic(data);

//VO
selectWindow(name);
makePolygon(291*ratiow,607*ratioh,279*ratiow,599*ratioh,267*ratiow,589*ratioh,257*ratiow,575*ratioh,246*ratiow,556*ratioh,240*ratiow,542*ratioh,236*ratiow,524*ratioh,232*ratiow,504*ratioh,231*ratiow,485*ratioh,230*ratiow,465*ratioh,231*ratiow,449*ratioh,231*ratiow,447*ratioh,221*ratiow,452*ratioh,206*ratiow,458*ratioh,192*ratiow,466*ratioh,179*ratiow,478*ratioh,165*ratiow,490*ratioh,155*ratiow,508*ratioh,149*ratiow,522*ratioh,145*ratiow,532*ratioh,143*ratiow,537*ratioh,137*ratiow,540*ratioh,133*ratiow,539*ratioh,130*ratiow,536*ratioh,129*ratiow,548*ratioh,130*ratiow,565*ratioh,132*ratiow,576*ratioh,135*ratiow,588*ratioh,138*ratiow,596*ratioh,148*ratiow,602*ratioh,164*ratiow,611*ratioh,174*ratiow,616*ratioh,186*ratiow,623*ratioh,204*ratiow,632*ratioh,218*ratiow,641*ratioh,229*ratiow,646*ratioh,248*ratiow,645*ratioh,269*ratiow,644*ratioh,283*ratiow,642*ratioh,287*ratiow,641*ratioh,287*ratiow,631*ratioh,288*ratiow,623*ratioh,289*ratiow,616*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(201*ratiow,772*ratioh,208*ratiow,780*ratioh,216*ratiow,788*ratioh,221*ratiow,793*ratioh,225*ratiow,801*ratioh,228*ratiow,809*ratioh,229*ratiow,813*ratioh,233*ratiow,807*ratioh,242*ratiow,800*ratioh,257*ratiow,791*ratioh,268*ratiow,783*ratioh,277*ratiow,777*ratioh,292*ratiow,764*ratioh,302*ratiow,754*ratioh,314*ratiow,742*ratioh,324*ratiow,736*ratioh,337*ratiow,735*ratioh,353*ratiow,739*ratioh,363*ratiow,744*ratioh,373*ratiow,738*ratioh,395*ratiow,721*ratioh,410*ratiow,706*ratioh,421*ratiow,688*ratioh,424*ratiow,677*ratioh,424*ratiow,665*ratioh,420*ratiow,656*ratioh,412*ratiow,651*ratioh,390*ratiow,644*ratioh,333*ratiow,627*ratioh,319*ratiow,622*ratioh,310*ratiow,618*ratioh,302*ratiow,614*ratioh,290*ratiow,607*ratioh,288*ratiow,626*ratioh,287*ratiow,635*ratioh,287*ratiow,636*ratioh,305*ratiow,643*ratioh,331*ratiow,649*ratioh,356*ratiow,655*ratioh,374*ratiow,660*ratioh,389*ratiow,665*ratioh,400*ratiow,672*ratioh,403*ratiow,676*ratioh,402*ratiow,688*ratioh,399*ratiow,695*ratioh,391*ratiow,698*ratioh,382*ratiow,698*ratioh,364*ratiow,699*ratioh,347*ratiow,699*ratioh,332*ratiow,699*ratioh,320*ratiow,701*ratioh,311*ratiow,703*ratioh,304*ratiow,708*ratioh,299*ratiow,716*ratioh,293*ratiow,726*ratioh,288*ratiow,735*ratioh,283*ratiow,740*ratioh,276*ratiow,742*ratioh,270*ratiow,740*ratioh,269*ratiow,746*ratioh,268*ratiow,753*ratioh,264*ratiow,756*ratioh,256*ratiow,760*ratioh,248*ratiow,761*ratioh,237*ratiow,764*ratioh,225*ratiow,767*ratioh,209*ratiow,770*ratioh,201*ratiow,770*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(195*ratiow,755*ratioh,196*ratiow,763*ratioh,200*ratiow,769*ratioh,207*ratiow,770*ratioh,218*ratiow,768*ratioh,229*ratiow,766*ratioh,242*ratiow,763*ratioh,253*ratiow,760*ratioh,261*ratiow,758*ratioh,266*ratiow,754*ratioh,269*ratiow,749*ratioh,269*ratiow,742*ratioh,269*ratiow,739*ratioh,272*ratiow,741*ratioh,278*ratiow,742*ratioh,283*ratiow,740*ratioh,287*ratiow,735*ratioh,292*ratiow,727*ratioh,297*ratiow,718*ratioh,301*ratiow,711*ratioh,305*ratiow,707*ratioh,308*ratiow,704*ratioh,315*ratiow,702*ratioh,321*ratiow,700*ratioh,333*ratiow,699*ratioh,347*ratiow,699*ratioh,376*ratiow,699*ratioh,387*ratiow,698*ratioh,395*ratiow,697*ratioh,400*ratiow,693*ratioh,403*ratiow,686*ratioh,403*ratiow,676*ratioh,397*ratiow,670*ratioh,389*ratiow,665*ratioh,379*ratiow,662*ratioh,365*ratiow,658*ratioh,331*ratiow,649*ratioh,313*ratiow,645*ratioh,297*ratiow,640*ratioh,287*ratiow,635*ratioh,285*ratiow,642*ratioh,288*ratiow,645*ratioh,296*ratiow,651*ratioh,307*ratiow,654*ratioh,326*ratiow,658*ratioh,342*ratiow,662*ratioh,358*ratiow,666*ratioh,373*ratiow,670*ratioh,382*ratiow,673*ratioh,388*ratiow,678*ratioh,389*ratiow,684*ratioh,385*ratiow,687*ratioh,376*ratiow,688*ratioh,336*ratiow,688*ratioh,308*ratiow,690*ratioh,295*ratiow,691*ratioh,290*ratiow,694*ratioh,286*ratiow,699*ratioh,285*ratiow,708*ratioh,283*ratiow,717*ratioh,279*ratiow,724*ratioh,275*ratiow,729*ratioh,263*ratiow,730*ratioh,260*ratiow,733*ratioh,259*ratiow,744*ratioh,257*ratiow,747*ratioh,249*ratiow,747*ratioh,239*ratiow,746*ratioh,232*ratiow,747*ratioh,226*ratiow,752*ratioh,219*ratiow,756*ratioh,209*ratiow,752*ratioh,203*ratiow,750*ratioh,197*ratiow,752*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(185*ratiow,712*ratioh,189*ratiow,731*ratioh,193*ratiow,749*ratioh,195*ratiow,754*ratioh,198*ratiow,751*ratioh,203*ratiow,751*ratioh,210*ratiow,752*ratioh,215*ratiow,755*ratioh,219*ratiow,756*ratioh,222*ratiow,755*ratioh,227*ratiow,751*ratioh,230*ratiow,747*ratioh,235*ratiow,746*ratioh,244*ratiow,746*ratioh,252*ratiow,747*ratioh,258*ratiow,746*ratioh,260*ratiow,742*ratioh,260*ratiow,733*ratioh,262*ratiow,730*ratioh,269*ratiow,730*ratioh,274*ratiow,730*ratioh,279*ratiow,725*ratioh,281*ratiow,719*ratioh,283*ratiow,715*ratioh,285*ratiow,707*ratioh,287*ratiow,698*ratioh,291*ratiow,693*ratioh,301*ratiow,690*ratioh,315*ratiow,690*ratioh,325*ratiow,689*ratioh,347*ratiow,688*ratioh,379*ratiow,688*ratioh,386*ratiow,686*ratioh,389*ratiow,683*ratioh,389*ratiow,679*ratioh,385*ratiow,676*ratioh,376*ratiow,671*ratioh,367*ratiow,668*ratioh,354*ratiow,665*ratioh,341*ratiow,662*ratioh,327*ratiow,659*ratioh,307*ratiow,654*ratioh,295*ratiow,651*ratioh,288*ratiow,645*ratioh,285*ratiow,641*ratioh,279*ratiow,643*ratioh,263*ratiow,644*ratioh,241*ratiow,645*ratioh,227*ratiow,645*ratioh,230*ratiow,647*ratioh,237*ratiow,651*ratioh,243*ratiow,655*ratioh,250*ratiow,661*ratioh,256*ratiow,668*ratioh,258*ratiow,678*ratioh,255*ratiow,687*ratioh,250*ratiow,695*ratioh,244*ratiow,701*ratioh,237*ratiow,706*ratioh,228*ratiow,712*ratioh,219*ratiow,715*ratioh,208*ratiow,716*ratioh,197*ratiow,715*ratioh,187*ratiow,710*ratioh,185*ratiow,710*ratioh);
data = analyze_pic(data);
}



//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile11(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 591;
var baseHeight = 832;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "PrL, IL, Cg1, AcbC, AcbSh, LO, VO, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//PrL
selectWindow(name);
makePolygon(422*ratiow,257*ratioh,436*ratiow,255*ratioh,456*ratiow,247*ratioh,477*ratiow,238*ratioh,498*ratiow,232*ratioh,518*ratiow,226*ratioh,540*ratiow,220*ratioh,565*ratiow,215*ratioh,582*ratiow,212*ratioh,590*ratiow,211*ratioh,590*ratiow,436*ratioh,582*ratiow,437*ratioh,568*ratiow,438*ratioh,556*ratiow,440*ratioh,543*ratiow,441*ratioh,529*ratiow,441*ratioh,514*ratiow,439*ratioh,493*ratiow,434*ratioh,475*ratiow,426*ratioh,471*ratiow,424*ratioh,470*ratiow,412*ratioh,466*ratiow,392*ratioh,461*ratiow,370*ratioh,454*ratiow,345*ratioh,448*ratiow,325*ratioh,441*ratiow,304*ratioh,435*ratiow,287*ratioh,429*ratiow,271*ratioh);
data = analyze_pic(data);

//IL
selectWindow(name);
makePolygon(471*ratiow,425*ratioh,484*ratiow,430*ratioh,500*ratiow,435*ratioh,520*ratiow,439*ratioh,536*ratiow,441*ratioh,549*ratiow,441*ratioh,564*ratiow,439*ratioh,579*ratiow,437*ratioh,590*ratiow,437*ratioh,590*ratiow,511*ratioh,588*ratiow,519*ratioh,586*ratiow,534*ratioh,572*ratiow,535*ratioh,549*ratiow,534*ratioh,535*ratiow,532*ratioh,519*ratiow,530*ratioh,504*ratiow,526*ratioh,490*ratiow,520*ratioh,482*ratiow,516*ratioh,479*ratiow,485*ratioh,476*ratiow,456*ratioh);
data = analyze_pic(data);

//Cg1
selectWindow(name);
makePolygon(399*ratiow,243*ratioh,408*ratiow,232*ratioh,421*ratiow,214*ratioh,433*ratiow,197*ratioh,444*ratiow,181*ratioh,455*ratiow,167*ratioh,465*ratiow,151*ratioh,475*ratiow,135*ratioh,485*ratiow,118*ratioh,496*ratiow,100*ratioh,506*ratiow,84*ratioh,516*ratiow,68*ratioh,526*ratiow,53*ratioh,534*ratiow,40*ratioh,542*ratiow,47*ratioh,553*ratiow,57*ratioh,562*ratiow,69*ratioh,571*ratiow,82*ratioh,581*ratiow,98*ratioh,588*ratiow,115*ratioh,590*ratiow,128*ratioh,590*ratiow,212*ratioh,572*ratiow,214*ratioh,545*ratiow,219*ratioh,528*ratiow,223*ratioh,508*ratiow,228*ratioh,484*ratiow,236*ratioh,459*ratiow,245*ratioh,436*ratiow,255*ratioh,423*ratiow,258*ratioh,419*ratiow,251*ratioh,413*ratiow,246*ratioh,406*ratiow,244*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(379*ratiow,650*ratioh,399*ratiow,630*ratioh,403*ratiow,627*ratioh,406*ratiow,629*ratioh,407*ratiow,637*ratioh,410*ratiow,647*ratioh,412*ratiow,655*ratioh,416*ratiow,666*ratioh,422*ratiow,677*ratioh,426*ratiow,686*ratioh,427*ratiow,695*ratioh,424*ratiow,704*ratioh,419*ratiow,711*ratioh,414*ratiow,715*ratioh,414*ratiow,703*ratioh,410*ratiow,688*ratioh,406*ratiow,676*ratioh,399*ratiow,668*ratioh,394*ratiow,664*ratioh,388*ratiow,661*ratioh,375*ratiow,660*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(427*ratiow,712*ratioh,418*ratiow,715*ratioh,413*ratiow,716*ratioh,416*ratiow,713*ratioh,423*ratiow,705*ratioh,426*ratiow,697*ratioh,427*ratiow,688*ratioh,423*ratiow,679*ratioh,418*ratiow,670*ratioh,414*ratiow,659*ratioh,410*ratiow,648*ratioh,408*ratiow,636*ratioh,406*ratiow,630*ratioh,402*ratiow,626*ratioh,417*ratiow,615*ratioh,425*ratiow,608*ratioh,431*ratiow,603*ratioh,437*ratiow,599*ratioh,439*ratiow,601*ratioh,445*ratiow,598*ratioh,452*ratiow,596*ratioh,457*ratiow,598*ratioh,463*ratiow,602*ratioh,469*ratiow,607*ratioh,474*ratiow,612*ratioh,478*ratiow,612*ratioh,482*ratiow,615*ratioh,486*ratiow,621*ratioh,489*ratiow,628*ratioh,491*ratiow,637*ratioh,492*ratiow,645*ratioh,485*ratiow,652*ratioh,477*ratiow,663*ratioh,469*ratiow,672*ratioh,462*ratiow,681*ratioh,453*ratiow,692*ratioh,444*ratiow,703*ratioh,437*ratiow,708*ratioh,430*ratiow,711*ratioh);
data = analyze_pic(data);

//LO
selectWindow(name);
makePolygon(215*ratiow,636*ratioh,223*ratiow,609*ratioh,237*ratiow,577*ratioh,250*ratiow,547*ratioh,262*ratiow,522*ratioh,273*ratiow,499*ratioh,285*ratiow,476*ratioh,296*ratiow,454*ratioh,304*ratiow,458*ratioh,316*ratiow,460*ratioh,332*ratiow,461*ratioh,351*ratiow,461*ratioh,370*ratiow,466*ratioh,386*ratiow,475*ratioh,401*ratiow,487*ratioh,393*ratiow,507*ratioh,383*ratiow,527*ratioh,370*ratiow,550*ratioh,352*ratiow,571*ratioh,329*ratiow,594*ratioh,307*ratiow,609*ratioh,286*ratiow,622*ratioh,261*ratiow,634*ratioh,245*ratiow,640*ratioh,240*ratiow,634*ratioh,232*ratiow,630*ratioh,221*ratiow,634*ratioh);
data = analyze_pic(data);

//VO
selectWindow(name);
makePolygon(250*ratiow,655*ratioh,251*ratiow,650*ratioh,248*ratiow,644*ratioh,245*ratiow,639*ratioh,258*ratiow,635*ratioh,272*ratiow,628*ratioh,290*ratiow,620*ratioh,304*ratiow,611*ratioh,320*ratiow,600*ratioh,333*ratiow,590*ratioh,350*ratiow,573*ratioh,362*ratiow,560*ratioh,372*ratiow,547*ratioh,379*ratiow,534*ratioh,388*ratiow,516*ratioh,394*ratiow,503*ratioh,399*ratiow,490*ratioh,400*ratiow,487*ratioh,404*ratiow,491*ratioh,409*ratiow,498*ratioh,413*ratiow,506*ratioh,415*ratiow,514*ratioh,414*ratiow,543*ratioh,414*ratiow,551*ratioh,418*ratiow,558*ratioh,422*ratiow,562*ratioh,427*ratiow,563*ratioh,435*ratiow,560*ratioh,442*ratiow,553*ratioh,450*ratiow,544*ratioh,456*ratiow,533*ratioh,459*ratiow,525*ratioh,464*ratiow,539*ratioh,485*ratiow,589*ratioh,491*ratiow,607*ratioh,496*ratiow,624*ratioh,500*ratiow,640*ratioh,500*ratiow,643*ratioh,496*ratiow,644*ratioh,491*ratiow,646*ratioh,491*ratiow,637*ratioh,490*ratiow,628*ratioh,485*ratiow,620*ratioh,481*ratiow,614*ratioh,478*ratiow,611*ratioh,477*ratiow,606*ratioh,473*ratiow,598*ratioh,468*ratiow,589*ratioh,464*ratiow,581*ratioh,461*ratiow,575*ratioh,459*ratiow,575*ratioh,453*ratiow,575*ratioh,448*ratiow,577*ratioh,437*ratiow,580*ratioh,425*ratiow,585*ratioh,414*ratiow,593*ratioh,402*ratiow,601*ratioh,391*ratiow,607*ratioh,377*ratiow,614*ratioh,364*ratiow,618*ratioh,348*ratiow,624*ratioh,333*ratiow,629*ratioh,322*ratiow,635*ratioh,291*ratiow,647*ratioh,275*ratiow,651*ratioh,261*ratiow,654*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(296*ratiow,783*ratioh,286*ratiow,791*ratioh,279*ratiow,799*ratioh,277*ratiow,803*ratioh,265*ratiow,794*ratioh,246*ratiow,778*ratioh,231*ratiow,764*ratioh,220*ratiow,754*ratioh,207*ratiow,741*ratioh,198*ratiow,736*ratioh,187*ratiow,733*ratioh,181*ratiow,734*ratioh,173*ratiow,737*ratioh,168*ratiow,742*ratioh,159*ratiow,732*ratioh,146*ratiow,715*ratioh,139*ratiow,699*ratioh,136*ratiow,689*ratioh,137*ratiow,679*ratioh,147*ratiow,670*ratioh,169*ratiow,660*ratioh,191*ratiow,650*ratioh,208*ratiow,642*ratioh,218*ratiow,636*ratioh,227*ratiow,631*ratioh,234*ratiow,630*ratioh,239*ratiow,632*ratioh,243*ratiow,637*ratioh,246*ratiow,642*ratioh,251*ratiow,649*ratioh,251*ratiow,653*ratioh,250*ratiow,657*ratioh,246*ratiow,660*ratioh,239*ratiow,662*ratioh,231*ratiow,663*ratioh,224*ratiow,664*ratioh,220*ratiow,662*ratioh,213*ratiow,661*ratioh,205*ratiow,661*ratioh,194*ratiow,665*ratioh,187*ratiow,668*ratioh,179*ratiow,673*ratioh,172*ratiow,680*ratioh,166*ratiow,688*ratioh,164*ratiow,695*ratioh,161*ratiow,702*ratioh,160*ratiow,709*ratioh,161*ratiow,714*ratioh,166*ratiow,717*ratioh,173*ratiow,718*ratioh,182*ratiow,714*ratioh,191*ratiow,710*ratioh,198*ratiow,707*ratioh,207*ratiow,706*ratioh,216*ratiow,706*ratioh,225*ratiow,709*ratioh,232*ratiow,713*ratioh,237*ratiow,720*ratioh,241*ratiow,727*ratioh,244*ratiow,735*ratioh,247*ratiow,743*ratioh,251*ratiow,750*ratioh,255*ratiow,757*ratioh,262*ratiow,762*ratioh,270*ratiow,767*ratioh,279*ratiow,770*ratioh,288*ratiow,770*ratioh,296*ratiow,768*ratioh,301*ratiow,764*ratioh,304*ratiow,763*ratioh,305*ratiow,764*ratioh,305*ratiow,767*ratioh,303*ratiow,770*ratioh,302*ratiow,772*ratioh,303*ratiow,774*ratioh,305*ratiow,776*ratioh,306*ratiow,777*ratioh,302*ratiow,780*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(316*ratiow,772*ratioh,310*ratiow,775*ratioh,306*ratiow,776*ratioh,302*ratiow,774*ratioh,303*ratiow,769*ratioh,306*ratiow,766*ratioh,304*ratiow,763*ratioh,301*ratiow,764*ratioh,295*ratiow,768*ratioh,288*ratiow,770*ratioh,278*ratiow,771*ratioh,270*ratiow,767*ratioh,261*ratiow,762*ratioh,253*ratiow,754*ratioh,249*ratiow,747*ratioh,246*ratiow,740*ratioh,243*ratiow,732*ratioh,240*ratiow,724*ratioh,235*ratiow,718*ratioh,232*ratiow,713*ratioh,227*ratiow,710*ratioh,221*ratiow,707*ratioh,208*ratiow,706*ratioh,194*ratiow,708*ratioh,184*ratiow,713*ratioh,176*ratiow,717*ratioh,171*ratiow,718*ratioh,165*ratiow,717*ratioh,161*ratiow,712*ratioh,160*ratiow,707*ratioh,161*ratiow,700*ratioh,163*ratiow,696*ratioh,171*ratiow,681*ratioh,176*ratiow,676*ratioh,182*ratiow,671*ratioh,189*ratiow,667*ratioh,203*ratiow,662*ratioh,209*ratiow,661*ratioh,217*ratiow,661*ratioh,223*ratiow,663*ratioh,225*ratiow,664*ratioh,217*ratiow,667*ratioh,207*ratiow,672*ratioh,196*ratiow,675*ratioh,188*ratiow,677*ratioh,182*ratiow,680*ratioh,177*ratiow,685*ratioh,173*ratiow,691*ratioh,172*ratiow,697*ratioh,175*ratiow,699*ratioh,178*ratiow,700*ratioh,185*ratiow,700*ratioh,193*ratiow,698*ratioh,202*ratiow,696*ratioh,211*ratiow,694*ratioh,220*ratiow,693*ratioh,228*ratiow,695*ratioh,234*ratiow,696*ratioh,245*ratiow,699*ratioh,249*ratiow,702*ratioh,252*ratiow,705*ratioh,256*ratiow,712*ratioh,261*ratiow,721*ratioh,265*ratiow,727*ratioh,270*ratiow,733*ratioh,278*ratiow,741*ratioh,285*ratiow,746*ratioh,293*ratiow,748*ratioh,301*ratiow,750*ratioh,309*ratiow,750*ratioh,314*ratiow,755*ratioh,316*ratiow,758*ratioh,317*ratiow,763*ratioh,317*ratiow,768*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(340*ratiow,755*ratioh,332*ratiow,762*ratioh,322*ratiow,769*ratioh,317*ratiow,772*ratioh,316*ratiow,770*ratioh,317*ratiow,761*ratioh,315*ratiow,755*ratioh,310*ratiow,750*ratioh,296*ratiow,749*ratioh,286*ratiow,746*ratioh,279*ratiow,742*ratioh,273*ratiow,737*ratioh,262*ratiow,722*ratioh,257*ratiow,715*ratioh,254*ratiow,708*ratioh,250*ratiow,702*ratioh,245*ratiow,699*ratioh,236*ratiow,696*ratioh,227*ratiow,695*ratioh,217*ratiow,693*ratioh,205*ratiow,695*ratioh,192*ratiow,698*ratioh,182*ratiow,700*ratioh,174*ratiow,699*ratioh,172*ratiow,696*ratioh,173*ratiow,690*ratioh,178*ratiow,683*ratioh,184*ratiow,679*ratioh,193*ratiow,676*ratioh,204*ratiow,673*ratioh,211*ratiow,670*ratioh,224*ratiow,664*ratioh,235*ratiow,663*ratioh,245*ratiow,661*ratioh,251*ratiow,655*ratioh,257*ratiow,655*ratioh,266*ratiow,653*ratioh,291*ratiow,647*ratioh,302*ratiow,643*ratioh,313*ratiow,639*ratioh,322*ratiow,635*ratioh,316*ratiow,643*ratioh,309*ratiow,653*ratioh,305*ratiow,662*ratioh,301*ratiow,675*ratioh,299*ratiow,683*ratioh,299*ratiow,692*ratioh,300*ratiow,698*ratioh,302*ratiow,703*ratioh,306*ratiow,708*ratioh,313*ratiow,715*ratioh,320*ratiow,720*ratioh,327*ratiow,723*ratioh,333*ratiow,727*ratioh,339*ratiow,731*ratioh,345*ratiow,737*ratioh,350*ratiow,745*ratioh,351*ratiow,747*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//PrL
selectWindow(name);
makePolygon(169*ratiow,257*ratioh,155*ratiow,255*ratioh,135*ratiow,247*ratioh,114*ratiow,238*ratioh,93*ratiow,232*ratioh,73*ratiow,226*ratioh,51*ratiow,220*ratioh,26*ratiow,215*ratioh,9*ratiow,212*ratioh,1*ratiow,211*ratioh,1*ratiow,436*ratioh,9*ratiow,437*ratioh,23*ratiow,438*ratioh,35*ratiow,440*ratioh,48*ratiow,441*ratioh,62*ratiow,441*ratioh,77*ratiow,439*ratioh,98*ratiow,434*ratioh,116*ratiow,426*ratioh,120*ratiow,424*ratioh,121*ratiow,412*ratioh,125*ratiow,392*ratioh,130*ratiow,370*ratioh,137*ratiow,345*ratioh,143*ratiow,325*ratioh,150*ratiow,304*ratioh,156*ratiow,287*ratioh,162*ratiow,271*ratioh);
data = analyze_pic(data);

//IL
selectWindow(name);
makePolygon(120*ratiow,425*ratioh,107*ratiow,430*ratioh,91*ratiow,435*ratioh,71*ratiow,439*ratioh,55*ratiow,441*ratioh,42*ratiow,441*ratioh,27*ratiow,439*ratioh,12*ratiow,437*ratioh,1*ratiow,437*ratioh,1*ratiow,511*ratioh,3*ratiow,519*ratioh,5*ratiow,534*ratioh,19*ratiow,535*ratioh,42*ratiow,534*ratioh,56*ratiow,532*ratioh,72*ratiow,530*ratioh,87*ratiow,526*ratioh,101*ratiow,520*ratioh,109*ratiow,516*ratioh,112*ratiow,485*ratioh,115*ratiow,456*ratioh);
data = analyze_pic(data);

//Cg1
selectWindow(name);
makePolygon(192*ratiow,243*ratioh,183*ratiow,232*ratioh,170*ratiow,214*ratioh,158*ratiow,197*ratioh,147*ratiow,181*ratioh,136*ratiow,167*ratioh,126*ratiow,151*ratioh,116*ratiow,135*ratioh,106*ratiow,118*ratioh,95*ratiow,100*ratioh,85*ratiow,84*ratioh,75*ratiow,68*ratioh,65*ratiow,53*ratioh,57*ratiow,40*ratioh,49*ratiow,47*ratioh,38*ratiow,57*ratioh,29*ratiow,69*ratioh,20*ratiow,82*ratioh,10*ratiow,98*ratioh,3*ratiow,115*ratioh,1*ratiow,128*ratioh,1*ratiow,212*ratioh,19*ratiow,214*ratioh,46*ratiow,219*ratioh,63*ratiow,223*ratioh,83*ratiow,228*ratioh,107*ratiow,236*ratioh,132*ratiow,245*ratioh,155*ratiow,255*ratioh,168*ratiow,258*ratioh,172*ratiow,251*ratioh,178*ratiow,246*ratioh,185*ratiow,244*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(212*ratiow,650*ratioh,192*ratiow,630*ratioh,188*ratiow,627*ratioh,185*ratiow,629*ratioh,184*ratiow,637*ratioh,181*ratiow,647*ratioh,179*ratiow,655*ratioh,175*ratiow,666*ratioh,169*ratiow,677*ratioh,165*ratiow,686*ratioh,164*ratiow,695*ratioh,167*ratiow,704*ratioh,172*ratiow,711*ratioh,177*ratiow,715*ratioh,177*ratiow,703*ratioh,181*ratiow,688*ratioh,185*ratiow,676*ratioh,192*ratiow,668*ratioh,197*ratiow,664*ratioh,203*ratiow,661*ratioh,216*ratiow,660*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(164*ratiow,712*ratioh,173*ratiow,715*ratioh,178*ratiow,716*ratioh,175*ratiow,713*ratioh,168*ratiow,705*ratioh,165*ratiow,697*ratioh,164*ratiow,688*ratioh,168*ratiow,679*ratioh,173*ratiow,670*ratioh,177*ratiow,659*ratioh,181*ratiow,648*ratioh,183*ratiow,636*ratioh,185*ratiow,630*ratioh,189*ratiow,626*ratioh,174*ratiow,615*ratioh,166*ratiow,608*ratioh,160*ratiow,603*ratioh,154*ratiow,599*ratioh,152*ratiow,601*ratioh,146*ratiow,598*ratioh,139*ratiow,596*ratioh,134*ratiow,598*ratioh,128*ratiow,602*ratioh,122*ratiow,607*ratioh,117*ratiow,612*ratioh,113*ratiow,612*ratioh,109*ratiow,615*ratioh,105*ratiow,621*ratioh,102*ratiow,628*ratioh,100*ratiow,637*ratioh,99*ratiow,645*ratioh,106*ratiow,652*ratioh,114*ratiow,663*ratioh,122*ratiow,672*ratioh,129*ratiow,681*ratioh,138*ratiow,692*ratioh,147*ratiow,703*ratioh,154*ratiow,708*ratioh,161*ratiow,711*ratioh);
data = analyze_pic(data);

//LO
selectWindow(name);
makePolygon(376*ratiow,636*ratioh,368*ratiow,609*ratioh,354*ratiow,577*ratioh,341*ratiow,547*ratioh,329*ratiow,522*ratioh,318*ratiow,499*ratioh,306*ratiow,476*ratioh,295*ratiow,454*ratioh,287*ratiow,458*ratioh,275*ratiow,460*ratioh,259*ratiow,461*ratioh,240*ratiow,461*ratioh,221*ratiow,466*ratioh,205*ratiow,475*ratioh,190*ratiow,487*ratioh,198*ratiow,507*ratioh,208*ratiow,527*ratioh,221*ratiow,550*ratioh,239*ratiow,571*ratioh,262*ratiow,594*ratioh,284*ratiow,609*ratioh,305*ratiow,622*ratioh,330*ratiow,634*ratioh,346*ratiow,640*ratioh,351*ratiow,634*ratioh,359*ratiow,630*ratioh,370*ratiow,634*ratioh);
data = analyze_pic(data);

//VO
selectWindow(name);
makePolygon(341*ratiow,655*ratioh,340*ratiow,650*ratioh,343*ratiow,644*ratioh,346*ratiow,639*ratioh,333*ratiow,635*ratioh,319*ratiow,628*ratioh,301*ratiow,620*ratioh,287*ratiow,611*ratioh,271*ratiow,600*ratioh,258*ratiow,590*ratioh,241*ratiow,573*ratioh,229*ratiow,560*ratioh,219*ratiow,547*ratioh,212*ratiow,534*ratioh,203*ratiow,516*ratioh,197*ratiow,503*ratioh,192*ratiow,490*ratioh,191*ratiow,487*ratioh,187*ratiow,491*ratioh,182*ratiow,498*ratioh,178*ratiow,506*ratioh,176*ratiow,514*ratioh,177*ratiow,543*ratioh,177*ratiow,551*ratioh,173*ratiow,558*ratioh,169*ratiow,562*ratioh,164*ratiow,563*ratioh,156*ratiow,560*ratioh,149*ratiow,553*ratioh,141*ratiow,544*ratioh,135*ratiow,533*ratioh,132*ratiow,525*ratioh,127*ratiow,539*ratioh,106*ratiow,589*ratioh,100*ratiow,607*ratioh,95*ratiow,624*ratioh,91*ratiow,640*ratioh,91*ratiow,643*ratioh,95*ratiow,644*ratioh,100*ratiow,646*ratioh,100*ratiow,637*ratioh,101*ratiow,628*ratioh,106*ratiow,620*ratioh,110*ratiow,614*ratioh,113*ratiow,611*ratioh,114*ratiow,606*ratioh,118*ratiow,598*ratioh,123*ratiow,589*ratioh,127*ratiow,581*ratioh,130*ratiow,575*ratioh,132*ratiow,575*ratioh,138*ratiow,575*ratioh,143*ratiow,577*ratioh,154*ratiow,580*ratioh,166*ratiow,585*ratioh,177*ratiow,593*ratioh,189*ratiow,601*ratioh,200*ratiow,607*ratioh,214*ratiow,614*ratioh,227*ratiow,618*ratioh,243*ratiow,624*ratioh,258*ratiow,629*ratioh,269*ratiow,635*ratioh,300*ratiow,647*ratioh,316*ratiow,651*ratioh,330*ratiow,654*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(295*ratiow,783*ratioh,305*ratiow,791*ratioh,312*ratiow,799*ratioh,314*ratiow,803*ratioh,326*ratiow,794*ratioh,345*ratiow,778*ratioh,360*ratiow,764*ratioh,371*ratiow,754*ratioh,384*ratiow,741*ratioh,393*ratiow,736*ratioh,404*ratiow,733*ratioh,410*ratiow,734*ratioh,418*ratiow,737*ratioh,423*ratiow,742*ratioh,432*ratiow,732*ratioh,445*ratiow,715*ratioh,452*ratiow,699*ratioh,455*ratiow,689*ratioh,454*ratiow,679*ratioh,444*ratiow,670*ratioh,422*ratiow,660*ratioh,400*ratiow,650*ratioh,383*ratiow,642*ratioh,373*ratiow,636*ratioh,364*ratiow,631*ratioh,357*ratiow,630*ratioh,352*ratiow,632*ratioh,348*ratiow,637*ratioh,345*ratiow,642*ratioh,340*ratiow,649*ratioh,340*ratiow,653*ratioh,341*ratiow,657*ratioh,345*ratiow,660*ratioh,352*ratiow,662*ratioh,360*ratiow,663*ratioh,367*ratiow,664*ratioh,371*ratiow,662*ratioh,378*ratiow,661*ratioh,386*ratiow,661*ratioh,397*ratiow,665*ratioh,404*ratiow,668*ratioh,412*ratiow,673*ratioh,419*ratiow,680*ratioh,425*ratiow,688*ratioh,427*ratiow,695*ratioh,430*ratiow,702*ratioh,431*ratiow,709*ratioh,430*ratiow,714*ratioh,425*ratiow,717*ratioh,418*ratiow,718*ratioh,409*ratiow,714*ratioh,400*ratiow,710*ratioh,393*ratiow,707*ratioh,384*ratiow,706*ratioh,375*ratiow,706*ratioh,366*ratiow,709*ratioh,359*ratiow,713*ratioh,354*ratiow,720*ratioh,350*ratiow,727*ratioh,347*ratiow,735*ratioh,344*ratiow,743*ratioh,340*ratiow,750*ratioh,336*ratiow,757*ratioh,329*ratiow,762*ratioh,321*ratiow,767*ratioh,312*ratiow,770*ratioh,303*ratiow,770*ratioh,295*ratiow,768*ratioh,290*ratiow,764*ratioh,287*ratiow,763*ratioh,286*ratiow,764*ratioh,286*ratiow,767*ratioh,288*ratiow,770*ratioh,289*ratiow,772*ratioh,288*ratiow,774*ratioh,286*ratiow,776*ratioh,285*ratiow,777*ratioh,289*ratiow,780*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(275*ratiow,772*ratioh,281*ratiow,775*ratioh,285*ratiow,776*ratioh,289*ratiow,774*ratioh,288*ratiow,769*ratioh,285*ratiow,766*ratioh,287*ratiow,763*ratioh,290*ratiow,764*ratioh,296*ratiow,768*ratioh,303*ratiow,770*ratioh,313*ratiow,771*ratioh,321*ratiow,767*ratioh,330*ratiow,762*ratioh,338*ratiow,754*ratioh,342*ratiow,747*ratioh,345*ratiow,740*ratioh,348*ratiow,732*ratioh,351*ratiow,724*ratioh,356*ratiow,718*ratioh,359*ratiow,713*ratioh,364*ratiow,710*ratioh,370*ratiow,707*ratioh,383*ratiow,706*ratioh,397*ratiow,708*ratioh,407*ratiow,713*ratioh,415*ratiow,717*ratioh,420*ratiow,718*ratioh,426*ratiow,717*ratioh,430*ratiow,712*ratioh,431*ratiow,707*ratioh,430*ratiow,700*ratioh,428*ratiow,696*ratioh,420*ratiow,681*ratioh,415*ratiow,676*ratioh,409*ratiow,671*ratioh,402*ratiow,667*ratioh,388*ratiow,662*ratioh,382*ratiow,661*ratioh,374*ratiow,661*ratioh,368*ratiow,663*ratioh,366*ratiow,664*ratioh,374*ratiow,667*ratioh,384*ratiow,672*ratioh,395*ratiow,675*ratioh,403*ratiow,677*ratioh,409*ratiow,680*ratioh,414*ratiow,685*ratioh,418*ratiow,691*ratioh,419*ratiow,697*ratioh,416*ratiow,699*ratioh,413*ratiow,700*ratioh,406*ratiow,700*ratioh,398*ratiow,698*ratioh,389*ratiow,696*ratioh,380*ratiow,694*ratioh,371*ratiow,693*ratioh,363*ratiow,695*ratioh,357*ratiow,696*ratioh,346*ratiow,699*ratioh,342*ratiow,702*ratioh,339*ratiow,705*ratioh,335*ratiow,712*ratioh,330*ratiow,721*ratioh,326*ratiow,727*ratioh,321*ratiow,733*ratioh,313*ratiow,741*ratioh,306*ratiow,746*ratioh,298*ratiow,748*ratioh,290*ratiow,750*ratioh,282*ratiow,750*ratioh,277*ratiow,755*ratioh,275*ratiow,758*ratioh,274*ratiow,763*ratioh,274*ratiow,768*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(251*ratiow,755*ratioh,259*ratiow,762*ratioh,269*ratiow,769*ratioh,274*ratiow,772*ratioh,275*ratiow,770*ratioh,274*ratiow,761*ratioh,276*ratiow,755*ratioh,281*ratiow,750*ratioh,295*ratiow,749*ratioh,305*ratiow,746*ratioh,312*ratiow,742*ratioh,318*ratiow,737*ratioh,329*ratiow,722*ratioh,334*ratiow,715*ratioh,337*ratiow,708*ratioh,341*ratiow,702*ratioh,346*ratiow,699*ratioh,355*ratiow,696*ratioh,364*ratiow,695*ratioh,374*ratiow,693*ratioh,386*ratiow,695*ratioh,399*ratiow,698*ratioh,409*ratiow,700*ratioh,417*ratiow,699*ratioh,419*ratiow,696*ratioh,418*ratiow,690*ratioh,413*ratiow,683*ratioh,407*ratiow,679*ratioh,398*ratiow,676*ratioh,387*ratiow,673*ratioh,380*ratiow,670*ratioh,367*ratiow,664*ratioh,356*ratiow,663*ratioh,346*ratiow,661*ratioh,340*ratiow,655*ratioh,334*ratiow,655*ratioh,325*ratiow,653*ratioh,300*ratiow,647*ratioh,289*ratiow,643*ratioh,278*ratiow,639*ratioh,269*ratiow,635*ratioh,275*ratiow,643*ratioh,282*ratiow,653*ratioh,286*ratiow,662*ratioh,290*ratiow,675*ratioh,292*ratiow,683*ratioh,292*ratiow,692*ratioh,291*ratiow,698*ratioh,289*ratiow,703*ratioh,285*ratiow,708*ratioh,278*ratiow,715*ratioh,271*ratiow,720*ratioh,264*ratiow,723*ratioh,258*ratiow,727*ratioh,252*ratiow,731*ratioh,246*ratiow,737*ratioh,241*ratiow,745*ratioh,240*ratiow,747*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile12(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 530;
var baseHeight = 716;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "PrL, IL, Cg1, AcbC, AcbSh, CPu, LO, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//PrL
selectWindow(name);
makePolygon(396*ratiow,218*ratioh,434*ratiow,207*ratioh,491*ratiow,193*ratioh,529*ratiow,183*ratioh,529*ratiow,380*ratioh,513*ratiow,382*ratioh,491*ratiow,382*ratioh,465*ratiow,379*ratioh,439*ratiow,372*ratioh,439*ratiow,349*ratioh,433*ratiow,322*ratioh,416*ratiow,276*ratioh);
data = analyze_pic(data);

//IL
selectWindow(name);
makePolygon(529*ratiow,449*ratioh,502*ratiow,449*ratioh,460*ratiow,439*ratioh,444*ratiow,433*ratioh,441*ratiow,406*ratioh,440*ratiow,372*ratioh,461*ratiow,378*ratioh,498*ratiow,383*ratioh,529*ratiow,380*ratioh,529*ratiow,388*ratioh,527*ratiow,389*ratioh,525*ratiow,394*ratioh,525*ratiow,400*ratioh,526*ratiow,405*ratioh,529*ratiow,406*ratioh);
data = analyze_pic(data);

//Cg1
selectWindow(name);
makePolygon(375*ratiow,190*ratioh,401*ratiow,162*ratioh,434*ratiow,124*ratioh,464*ratiow,90*ratioh,489*ratiow,61*ratioh,503*ratiow,45*ratioh,512*ratiow,57*ratioh,525*ratiow,77*ratioh,529*ratiow,86*ratioh,529*ratiow,184*ratioh,491*ratiow,193*ratioh,441*ratiow,205*ratioh,400*ratiow,217*ratioh,395*ratiow,219*ratioh,390*ratiow,207*ratioh,383*ratiow,197*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(367*ratiow,599*ratioh,376*ratiow,597*ratioh,393*ratiow,588*ratioh,412*ratiow,568*ratioh,425*ratiow,544*ratioh,433*ratiow,521*ratioh,437*ratiow,503*ratioh,437*ratiow,493*ratioh,430*ratiow,482*ratioh,422*ratiow,474*ratioh,409*ratiow,469*ratioh,389*ratiow,474*ratioh,373*ratiow,487*ratioh,357*ratiow,506*ratioh,340*ratiow,533*ratioh,336*ratiow,553*ratioh,335*ratiow,562*ratioh,348*ratiow,558*ratioh,355*ratiow,558*ratioh,360*ratiow,560*ratioh,366*ratiow,568*ratioh,369*ratiow,581*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(349*ratiow,599*ratioh,353*ratiow,618*ratioh,356*ratiow,625*ratioh,368*ratiow,629*ratioh,385*ratiow,632*ratioh,400*ratiow,631*ratioh,419*ratiow,628*ratioh,433*ratiow,621*ratioh,446*ratiow,605*ratioh,456*ratiow,585*ratioh,461*ratiow,566*ratioh,461*ratiow,547*ratioh,458*ratiow,530*ratioh,453*ratiow,517*ratioh,447*ratiow,506*ratioh,436*ratiow,492*ratioh,437*ratiow,505*ratioh,430*ratiow,532*ratioh,420*ratiow,556*ratioh,402*ratiow,580*ratioh,389*ratiow,591*ratioh,377*ratiow,597*ratioh,367*ratiow,599*ratioh,365*ratiow,603*ratioh,361*ratiow,604*ratioh,357*ratiow,604*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(340*ratiow,306*ratioh,348*ratiow,309*ratioh,356*ratiow,315*ratioh,359*ratiow,324*ratioh,360*ratiow,331*ratioh,358*ratiow,337*ratioh,353*ratiow,342*ratioh,345*ratiow,346*ratioh,332*ratiow,347*ratioh,321*ratiow,344*ratioh,316*ratiow,340*ratioh,314*ratiow,333*ratioh,314*ratiow,325*ratioh,316*ratiow,319*ratioh,319*ratiow,313*ratioh,328*ratiow,308*ratioh);
data = analyze_pic(data);

//LO
selectWindow(name);
makePolygon(183*ratiow,560*ratioh,202*ratiow,563*ratioh,227*ratiow,563*ratioh,257*ratiow,559*ratioh,291*ratiow,546*ratioh,318*ratiow,529*ratioh,350*ratiow,500*ratioh,368*ratiow,478*ratioh,360*ratiow,478*ratioh,354*ratiow,477*ratioh,351*ratiow,471*ratioh,349*ratiow,457*ratioh,342*ratiow,442*ratioh,335*ratiow,435*ratioh,328*ratiow,430*ratioh,313*ratiow,450*ratioh,279*ratiow,495*ratioh,262*ratiow,514*ratioh,239*ratiow,538*ratioh,214*ratiow,552*ratioh,197*ratiow,557*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(271*ratiow,672*ratioh,261*ratiow,687*ratioh,256*ratiow,697*ratioh,240*ratiow,682*ratioh,223*ratiow,666*ratioh,208*ratiow,648*ratioh,197*ratiow,639*ratioh,186*ratiow,638*ratioh,172*ratiow,639*ratioh,161*ratiow,643*ratioh,149*ratiow,635*ratioh,128*ratiow,617*ratioh,119*ratiow,597*ratioh,114*ratiow,583*ratioh,116*ratiow,573*ratioh,128*ratiow,563*ratioh,138*ratiow,559*ratioh,180*ratiow,559*ratioh,190*ratiow,562*ratioh,207*ratiow,563*ratioh,214*ratiow,564*ratioh,204*ratiow,566*ratioh,177*ratiow,574*ratioh,155*ratiow,580*ratioh,141*ratiow,585*ratioh,134*ratiow,590*ratioh,134*ratiow,597*ratioh,141*ratiow,607*ratioh,148*ratiow,613*ratioh,163*ratiow,614*ratioh,185*ratiow,609*ratioh,199*ratiow,607*ratioh,211*ratiow,609*ratioh,219*ratiow,614*ratioh,229*ratiow,629*ratioh,241*ratiow,647*ratioh,257*ratiow,664*ratioh,266*ratiow,670*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(281*ratiow,663*ratioh,271*ratiow,673*ratioh,258*ratiow,665*ratioh,246*ratiow,652*ratioh,232*ratiow,634*ratioh,222*ratiow,617*ratioh,216*ratiow,611*ratioh,210*ratiow,608*ratioh,200*ratiow,607*ratioh,170*ratiow,612*ratioh,153*ratiow,614*ratioh,143*ratiow,610*ratioh,135*ratiow,599*ratioh,133*ratiow,592*ratioh,137*ratiow,587*ratioh,159*ratiow,579*ratioh,171*ratiow,575*ratioh,212*ratiow,565*ratioh,209*ratiow,568*ratioh,189*ratiow,576*ratioh,166*ratiow,586*ratioh,154*ratiow,591*ratioh,150*ratiow,596*ratioh,150*ratiow,602*ratioh,157*ratiow,605*ratioh,173*ratiow,602*ratioh,201*ratiow,598*ratioh,210*ratiow,597*ratioh,217*ratiow,598*ratioh,224*ratiow,602*ratioh,235*ratiow,612*ratioh,243*ratiow,627*ratioh,251*ratiow,641*ratioh,259*ratiow,651*ratioh,269*ratiow,658*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(280*ratiow,663*ratioh,266*ratiow,657*ratioh,253*ratiow,644*ratioh,242*ratiow,627*ratioh,234*ratiow,611*ratioh,223*ratiow,601*ratioh,209*ratiow,597*ratioh,181*ratiow,601*ratioh,162*ratiow,604*ratioh,152*ratiow,603*ratioh,149*ratiow,599*ratioh,150*ratiow,593*ratioh,164*ratiow,586*ratioh,185*ratiow,577*ratioh,213*ratiow,566*ratioh,219*ratiow,563*ratioh,242*ratiow,561*ratioh,258*ratiow,559*ratioh,277*ratiow,552*ratioh,290*ratiow,545*ratioh,294*ratiow,545*ratioh,283*ratiow,555*ratioh,277*ratiow,565*ratioh,275*ratiow,574*ratioh,280*ratiow,584*ratioh,294*ratiow,601*ratioh,310*ratiow,620*ratioh,323*ratiow,634*ratioh,330*ratiow,639*ratioh,314*ratiow,645*ratioh,297*ratiow,653*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//PrL
selectWindow(name);
makePolygon(134*ratiow,218*ratioh,96*ratiow,207*ratioh,39*ratiow,193*ratioh,1*ratiow,183*ratioh,1*ratiow,380*ratioh,17*ratiow,382*ratioh,39*ratiow,382*ratioh,65*ratiow,379*ratioh,91*ratiow,372*ratioh,91*ratiow,349*ratioh,97*ratiow,322*ratioh,114*ratiow,276*ratioh);
data = analyze_pic(data);

//IL
selectWindow(name);
makePolygon(1*ratiow,449*ratioh,28*ratiow,449*ratioh,70*ratiow,439*ratioh,86*ratiow,433*ratioh,89*ratiow,406*ratioh,90*ratiow,372*ratioh,69*ratiow,378*ratioh,32*ratiow,383*ratioh,1*ratiow,380*ratioh,1*ratiow,388*ratioh,3*ratiow,389*ratioh,5*ratiow,394*ratioh,5*ratiow,400*ratioh,4*ratiow,405*ratioh,1*ratiow,406*ratioh);
data = analyze_pic(data);

//Cg1
selectWindow(name);
makePolygon(155*ratiow,190*ratioh,129*ratiow,162*ratioh,96*ratiow,124*ratioh,66*ratiow,90*ratioh,41*ratiow,61*ratioh,27*ratiow,45*ratioh,18*ratiow,57*ratioh,5*ratiow,77*ratioh,1*ratiow,86*ratioh,1*ratiow,184*ratioh,39*ratiow,193*ratioh,89*ratiow,205*ratioh,130*ratiow,217*ratioh,135*ratiow,219*ratioh,140*ratiow,207*ratioh,147*ratiow,197*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(163*ratiow,599*ratioh,154*ratiow,597*ratioh,137*ratiow,588*ratioh,118*ratiow,568*ratioh,105*ratiow,544*ratioh,97*ratiow,521*ratioh,93*ratiow,503*ratioh,93*ratiow,493*ratioh,100*ratiow,482*ratioh,108*ratiow,474*ratioh,121*ratiow,469*ratioh,141*ratiow,474*ratioh,157*ratiow,487*ratioh,173*ratiow,506*ratioh,190*ratiow,533*ratioh,194*ratiow,553*ratioh,195*ratiow,562*ratioh,182*ratiow,558*ratioh,175*ratiow,558*ratioh,170*ratiow,560*ratioh,164*ratiow,568*ratioh,161*ratiow,581*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(181*ratiow,599*ratioh,177*ratiow,618*ratioh,174*ratiow,625*ratioh,162*ratiow,629*ratioh,145*ratiow,632*ratioh,130*ratiow,631*ratioh,111*ratiow,628*ratioh,97*ratiow,621*ratioh,84*ratiow,605*ratioh,74*ratiow,585*ratioh,69*ratiow,566*ratioh,69*ratiow,547*ratioh,72*ratiow,530*ratioh,77*ratiow,517*ratioh,83*ratiow,506*ratioh,94*ratiow,492*ratioh,93*ratiow,505*ratioh,100*ratiow,532*ratioh,110*ratiow,556*ratioh,128*ratiow,580*ratioh,141*ratiow,591*ratioh,153*ratiow,597*ratioh,163*ratiow,599*ratioh,165*ratiow,603*ratioh,169*ratiow,604*ratioh,173*ratiow,604*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(190*ratiow,306*ratioh,182*ratiow,309*ratioh,174*ratiow,315*ratioh,171*ratiow,324*ratioh,170*ratiow,331*ratioh,172*ratiow,337*ratioh,177*ratiow,342*ratioh,185*ratiow,346*ratioh,198*ratiow,347*ratioh,209*ratiow,344*ratioh,214*ratiow,340*ratioh,216*ratiow,333*ratioh,216*ratiow,325*ratioh,214*ratiow,319*ratioh,211*ratiow,313*ratioh,202*ratiow,308*ratioh);
data = analyze_pic(data);

//LO
selectWindow(name);
makePolygon(347*ratiow,560*ratioh,328*ratiow,563*ratioh,303*ratiow,563*ratioh,273*ratiow,559*ratioh,239*ratiow,546*ratioh,212*ratiow,529*ratioh,180*ratiow,500*ratioh,162*ratiow,478*ratioh,170*ratiow,478*ratioh,176*ratiow,477*ratioh,179*ratiow,471*ratioh,181*ratiow,457*ratioh,188*ratiow,442*ratioh,195*ratiow,435*ratioh,202*ratiow,430*ratioh,217*ratiow,450*ratioh,251*ratiow,495*ratioh,268*ratiow,514*ratioh,291*ratiow,538*ratioh,316*ratiow,552*ratioh,333*ratiow,557*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(259*ratiow,672*ratioh,269*ratiow,687*ratioh,274*ratiow,697*ratioh,290*ratiow,682*ratioh,307*ratiow,666*ratioh,322*ratiow,648*ratioh,333*ratiow,639*ratioh,344*ratiow,638*ratioh,358*ratiow,639*ratioh,369*ratiow,643*ratioh,381*ratiow,635*ratioh,402*ratiow,617*ratioh,411*ratiow,597*ratioh,416*ratiow,583*ratioh,414*ratiow,573*ratioh,402*ratiow,563*ratioh,392*ratiow,559*ratioh,350*ratiow,559*ratioh,340*ratiow,562*ratioh,323*ratiow,563*ratioh,316*ratiow,564*ratioh,326*ratiow,566*ratioh,353*ratiow,574*ratioh,375*ratiow,580*ratioh,389*ratiow,585*ratioh,396*ratiow,590*ratioh,396*ratiow,597*ratioh,389*ratiow,607*ratioh,382*ratiow,613*ratioh,367*ratiow,614*ratioh,345*ratiow,609*ratioh,331*ratiow,607*ratioh,319*ratiow,609*ratioh,311*ratiow,614*ratioh,301*ratiow,629*ratioh,289*ratiow,647*ratioh,273*ratiow,664*ratioh,264*ratiow,670*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(249*ratiow,663*ratioh,259*ratiow,673*ratioh,272*ratiow,665*ratioh,284*ratiow,652*ratioh,298*ratiow,634*ratioh,308*ratiow,617*ratioh,314*ratiow,611*ratioh,320*ratiow,608*ratioh,330*ratiow,607*ratioh,360*ratiow,612*ratioh,377*ratiow,614*ratioh,387*ratiow,610*ratioh,395*ratiow,599*ratioh,397*ratiow,592*ratioh,393*ratiow,587*ratioh,371*ratiow,579*ratioh,359*ratiow,575*ratioh,318*ratiow,565*ratioh,321*ratiow,568*ratioh,341*ratiow,576*ratioh,364*ratiow,586*ratioh,376*ratiow,591*ratioh,380*ratiow,596*ratioh,380*ratiow,602*ratioh,373*ratiow,605*ratioh,357*ratiow,602*ratioh,329*ratiow,598*ratioh,320*ratiow,597*ratioh,313*ratiow,598*ratioh,306*ratiow,602*ratioh,295*ratiow,612*ratioh,287*ratiow,627*ratioh,279*ratiow,641*ratioh,271*ratiow,651*ratioh,261*ratiow,658*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(250*ratiow,663*ratioh,264*ratiow,657*ratioh,277*ratiow,644*ratioh,288*ratiow,627*ratioh,296*ratiow,611*ratioh,307*ratiow,601*ratioh,321*ratiow,597*ratioh,349*ratiow,601*ratioh,368*ratiow,604*ratioh,378*ratiow,603*ratioh,381*ratiow,599*ratioh,380*ratiow,593*ratioh,366*ratiow,586*ratioh,345*ratiow,577*ratioh,317*ratiow,566*ratioh,311*ratiow,563*ratioh,288*ratiow,561*ratioh,272*ratiow,559*ratioh,253*ratiow,552*ratioh,240*ratiow,545*ratioh,236*ratiow,545*ratioh,247*ratiow,555*ratioh,253*ratiow,565*ratioh,255*ratiow,574*ratioh,250*ratiow,584*ratioh,236*ratiow,601*ratioh,220*ratiow,620*ratioh,207*ratiow,634*ratioh,200*ratiow,639*ratioh,216*ratiow,645*ratioh,233*ratiow,653*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile13(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 537;
var baseHeight = 750;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "PrL, IL, Cg1, AcbC, AcbSh, CPu, LO, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//PrL
selectWindow(name);
makePolygon(401*ratiow,235*ratioh,438*ratiow,225*ratioh,509*ratiow,202*ratioh,536*ratiow,193*ratioh,536*ratiow,358*ratioh,519*ratiow,362*ratioh,500*ratiow,365*ratioh,492*ratiow,365*ratioh,481*ratiow,362*ratioh,465*ratiow,350*ratioh,458*ratiow,345*ratioh,446*ratiow,327*ratioh,435*ratiow,305*ratioh,422*ratiow,282*ratioh,412*ratiow,260*ratioh);
data = analyze_pic(data);

//IL
selectWindow(name);
makePolygon(458*ratiow,344*ratioh,473*ratiow,355*ratioh,486*ratiow,364*ratioh,492*ratiow,366*ratioh,501*ratiow,366*ratioh,522*ratiow,361*ratioh,536*ratiow,357*ratioh,536*ratiow,368*ratioh,533*ratiow,371*ratioh,534*ratiow,375*ratioh,534*ratiow,381*ratioh,536*ratiow,386*ratioh,536*ratiow,447*ratioh,520*ratiow,450*ratioh,508*ratiow,452*ratioh,496*ratiow,449*ratioh,479*ratiow,443*ratioh,460*ratiow,435*ratioh,460*ratiow,424*ratioh,466*ratiow,403*ratioh,468*ratiow,383*ratioh,466*ratiow,368*ratioh);
data = analyze_pic(data);

//Cg1
selectWindow(name);
makePolygon(391*ratiow,212*ratioh,437*ratiow,153*ratioh,484*ratiow,92*ratioh,519*ratiow,47*ratioh,526*ratiow,57*ratioh,533*ratiow,71*ratioh,536*ratiow,81*ratioh,535*ratiow,193*ratioh,499*ratiow,205*ratioh,459*ratiow,218*ratioh,421*ratiow,230*ratioh,401*ratiow,235*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(371*ratiow,628*ratioh,385*ratiow,637*ratioh,392*ratiow,639*ratioh,406*ratiow,632*ratioh,429*ratiow,615*ratioh,443*ratiow,596*ratioh,456*ratiow,570*ratioh,461*ratiow,544*ratioh,463*ratiow,511*ratioh,457*ratiow,507*ratioh,449*ratiow,498*ratioh,445*ratiow,493*ratioh,427*ratiow,491*ratioh,411*ratiow,493*ratioh,397*ratiow,498*ratioh,380*ratiow,507*ratioh,361*ratiow,522*ratioh,347*ratiow,534*ratioh,341*ratiow,541*ratioh,337*ratiow,553*ratioh,332*ratiow,569*ratioh,330*ratiow,586*ratioh,331*ratiow,599*ratioh,337*ratiow,606*ratioh,342*ratiow,599*ratioh,354*ratiow,594*ratioh,371*ratiow,588*ratioh,378*ratiow,587*ratioh,383*ratiow,588*ratioh,387*ratiow,593*ratioh,390*ratiow,603*ratioh,391*ratiow,619*ratioh,390*ratiow,627*ratioh,387*ratiow,630*ratioh,383*ratiow,630*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(360*ratiow,623*ratioh,357*ratiow,637*ratioh,349*ratiow,651*ratioh,334*ratiow,666*ratioh,323*ratiow,673*ratioh,344*ratiow,671*ratioh,367*ratiow,671*ratioh,390*ratiow,673*ratioh,423*ratiow,679*ratioh,433*ratiow,679*ratioh,444*ratiow,677*ratioh,461*ratiow,669*ratioh,477*ratiow,657*ratioh,479*ratiow,642*ratioh,486*ratiow,611*ratioh,492*ratiow,582*ratioh,492*ratiow,572*ratioh,487*ratiow,552*ratioh,479*ratiow,535*ratioh,471*ratiow,521*ratioh,468*ratiow,518*ratioh,463*ratiow,510*ratioh,462*ratiow,521*ratioh,461*ratiow,543*ratioh,458*ratiow,562*ratioh,452*ratiow,578*ratioh,440*ratiow,602*ratioh,424*ratiow,620*ratioh,403*ratiow,634*ratioh,391*ratiow,639*ratioh,380*ratiow,634*ratioh,369*ratiow,626*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(346*ratiow,535*ratioh,364*ratiow,519*ratioh,389*ratiow,500*ratioh,411*ratiow,492*ratioh,440*ratiow,492*ratioh,445*ratiow,493*ratioh,438*ratiow,481*ratioh,433*ratiow,468*ratioh,428*ratiow,448*ratioh,419*ratiow,419*ratioh,409*ratiow,392*ratioh,388*ratiow,347*ratioh,376*ratiow,326*ratioh,369*ratiow,318*ratioh,347*ratiow,308*ratioh,333*ratiow,306*ratioh,322*ratiow,307*ratioh,312*ratiow,312*ratioh,301*ratiow,322*ratioh,293*ratiow,336*ratioh,289*ratiow,354*ratioh,289*ratiow,371*ratioh,295*ratiow,388*ratioh,302*ratiow,398*ratioh,313*ratiow,407*ratioh,325*ratiow,415*ratioh,354*ratiow,425*ratioh,374*ratiow,431*ratioh,386*ratiow,435*ratioh,390*ratiow,438*ratioh,394*ratiow,444*ratioh,397*ratiow,450*ratioh,397*ratiow,461*ratioh,395*ratiow,471*ratioh,389*ratiow,483*ratioh,384*ratiow,492*ratioh,359*ratiow,515*ratioh,349*ratiow,525*ratioh);
data = analyze_pic(data);

//LO
selectWindow(name);
makePolygon(223*ratiow,604*ratioh,243*ratiow,597*ratioh,292*ratiow,572*ratioh,326*ratiow,554*ratioh,339*ratiow,547*ratioh,341*ratiow,541*ratioh,334*ratiow,538*ratioh,322*ratiow,519*ratioh,315*ratiow,509*ratioh,299*ratiow,498*ratioh,293*ratiow,504*ratioh,271*ratiow,530*ratioh,248*ratiow,559*ratioh,236*ratiow,572*ratioh,225*ratiow,590*ratioh,223*ratiow,602*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(264*ratiow,717*ratioh,250*ratiow,708*ratioh,236*ratiow,700*ratioh,228*ratiow,692*ratioh,217*ratiow,680*ratioh,210*ratiow,674*ratioh,198*ratiow,674*ratioh,186*ratiow,676*ratioh,169*ratiow,682*ratioh,159*ratiow,674*ratioh,145*ratiow,652*ratioh,138*ratiow,633*ratioh,137*ratiow,619*ratioh,144*ratiow,613*ratioh,159*ratiow,608*ratioh,179*ratiow,602*ratioh,188*ratiow,599*ratioh,194*ratiow,599*ratioh,200*ratiow,603*ratioh,194*ratiow,607*ratioh,186*ratiow,614*ratioh,165*ratiow,632*ratioh,160*ratiow,638*ratioh,162*ratiow,645*ratioh,166*ratiow,655*ratioh,173*ratiow,660*ratioh,179*ratiow,658*ratioh,195*ratiow,648*ratioh,213*ratiow,641*ratioh,227*ratiow,640*ratioh,236*ratiow,642*ratioh,242*ratiow,647*ratioh,251*ratiow,657*ratioh,264*ratiow,679*ratioh,276*ratiow,692*ratioh,278*ratiow,698*ratioh,275*ratiow,704*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(484*ratiow,676*ratioh,483*ratiow,681*ratioh,475*ratiow,689*ratioh,469*ratiow,694*ratioh,464*ratiow,702*ratioh,456*ratiow,705*ratioh,449*ratiow,715*ratioh,443*ratiow,719*ratioh,429*ratiow,723*ratioh,420*ratiow,727*ratioh,409*ratiow,726*ratioh,397*ratiow,731*ratioh,390*ratiow,730*ratioh,380*ratiow,726*ratioh,374*ratiow,719*ratioh,363*ratiow,711*ratioh,356*ratiow,709*ratioh,348*ratiow,709*ratioh,332*ratiow,717*ratioh,315*ratiow,722*ratioh,307*ratiow,721*ratioh,300*ratiow,714*ratioh,281*ratiow,712*ratioh,277*ratiow,709*ratioh,278*ratiow,700*ratioh,277*ratiow,692*ratioh,262*ratiow,675*ratioh,253*ratiow,661*ratioh,245*ratiow,649*ratioh,239*ratiow,644*ratioh,233*ratiow,641*ratioh,225*ratiow,640*ratioh,217*ratiow,640*ratioh,210*ratiow,642*ratioh,200*ratiow,645*ratioh,186*ratiow,654*ratioh,174*ratiow,660*ratioh,172*ratiow,660*ratioh,166*ratiow,656*ratioh,162*ratiow,646*ratioh,160*ratiow,639*ratioh,169*ratiow,628*ratioh,189*ratiow,612*ratioh,198*ratiow,606*ratioh,201*ratiow,604*ratioh,204*ratiow,610*ratioh,197*ratiow,613*ratioh,189*ratiow,621*ratioh,178*ratiow,631*ratioh,172*ratiow,640*ratioh,173*ratiow,646*ratioh,179*ratiow,648*ratioh,192*ratiow,640*ratioh,201*ratiow,636*ratioh,216*ratiow,632*ratioh,237*ratiow,632*ratioh,247*ratiow,634*ratioh,256*ratiow,644*ratioh,268*ratiow,660*ratioh,277*ratiow,675*ratioh,286*ratiow,692*ratioh,287*ratiow,699*ratioh,289*ratiow,703*ratioh,299*ratiow,706*ratioh,319*ratiow,708*ratioh,330*ratiow,707*ratioh,341*ratiow,703*ratioh,357*ratiow,700*ratioh,372*ratiow,705*ratioh,390*ratiow,715*ratioh,399*ratiow,715*ratioh,411*ratiow,712*ratioh,420*ratiow,714*ratioh,428*ratiow,712*ratioh,432*ratiow,712*ratioh,437*ratiow,715*ratioh,441*ratiow,714*ratioh,447*ratiow,702*ratioh,462*ratiow,684*ratioh,475*ratiow,675*ratioh,480*ratiow,673*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(286*ratiow,692*ratioh,278*ratiow,677*ratioh,265*ratiow,656*ratioh,254*ratiow,641*ratioh,247*ratiow,634*ratioh,239*ratiow,632*ratioh,228*ratiow,631*ratioh,211*ratiow,633*ratioh,196*ratiow,638*ratioh,181*ratiow,646*ratioh,178*ratiow,648*ratioh,173*ratiow,644*ratioh,173*ratiow,638*ratioh,182*ratiow,627*ratioh,203*ratiow,608*ratioh,207*ratiow,612*ratioh,220*ratiow,606*ratioh,247*ratiow,595*ratioh,269*ratiow,584*ratioh,311*ratiow,562*ratioh,326*ratiow,554*ratioh,337*ratiow,548*ratioh,338*ratiow,550*ratioh,332*ratiow,570*ratioh,322*ratiow,571*ratioh,294*ratiow,580*ratioh,282*ratiow,590*ratioh,276*ratiow,598*ratioh,274*ratiow,612*ratioh,278*ratiow,626*ratioh,289*ratiow,637*ratioh,299*ratiow,645*ratioh,312*ratiow,660*ratioh,320*ratiow,674*ratioh,305*ratiow,681*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//PrL
selectWindow(name);
makePolygon(136*ratiow,235*ratioh,99*ratiow,225*ratioh,28*ratiow,202*ratioh,1*ratiow,193*ratioh,1*ratiow,358*ratioh,18*ratiow,362*ratioh,37*ratiow,365*ratioh,45*ratiow,365*ratioh,56*ratiow,362*ratioh,72*ratiow,350*ratioh,79*ratiow,345*ratioh,91*ratiow,327*ratioh,102*ratiow,305*ratioh,115*ratiow,282*ratioh,125*ratiow,260*ratioh);
data = analyze_pic(data);

//IL
selectWindow(name);
makePolygon(79*ratiow,344*ratioh,64*ratiow,355*ratioh,51*ratiow,364*ratioh,45*ratiow,366*ratioh,36*ratiow,366*ratioh,15*ratiow,361*ratioh,1*ratiow,357*ratioh,1*ratiow,368*ratioh,4*ratiow,371*ratioh,3*ratiow,375*ratioh,3*ratiow,381*ratioh,1*ratiow,386*ratioh,1*ratiow,447*ratioh,17*ratiow,450*ratioh,29*ratiow,452*ratioh,41*ratiow,449*ratioh,58*ratiow,443*ratioh,77*ratiow,435*ratioh,77*ratiow,424*ratioh,71*ratiow,403*ratioh,69*ratiow,383*ratioh,71*ratiow,368*ratioh);
data = analyze_pic(data);

//Cg1
selectWindow(name);
makePolygon(146*ratiow,212*ratioh,100*ratiow,153*ratioh,53*ratiow,92*ratioh,18*ratiow,47*ratioh,11*ratiow,57*ratioh,4*ratiow,71*ratioh,1*ratiow,81*ratioh,2*ratiow,193*ratioh,38*ratiow,205*ratioh,78*ratiow,218*ratioh,116*ratiow,230*ratioh,136*ratiow,235*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(166*ratiow,628*ratioh,152*ratiow,637*ratioh,145*ratiow,639*ratioh,131*ratiow,632*ratioh,108*ratiow,615*ratioh,94*ratiow,596*ratioh,81*ratiow,570*ratioh,76*ratiow,544*ratioh,74*ratiow,511*ratioh,80*ratiow,507*ratioh,88*ratiow,498*ratioh,92*ratiow,493*ratioh,110*ratiow,491*ratioh,126*ratiow,493*ratioh,140*ratiow,498*ratioh,157*ratiow,507*ratioh,176*ratiow,522*ratioh,190*ratiow,534*ratioh,196*ratiow,541*ratioh,200*ratiow,553*ratioh,205*ratiow,569*ratioh,207*ratiow,586*ratioh,206*ratiow,599*ratioh,200*ratiow,606*ratioh,195*ratiow,599*ratioh,183*ratiow,594*ratioh,166*ratiow,588*ratioh,159*ratiow,587*ratioh,154*ratiow,588*ratioh,150*ratiow,593*ratioh,147*ratiow,603*ratioh,146*ratiow,619*ratioh,147*ratiow,627*ratioh,150*ratiow,630*ratioh,154*ratiow,630*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(177*ratiow,623*ratioh,180*ratiow,637*ratioh,188*ratiow,651*ratioh,203*ratiow,666*ratioh,214*ratiow,673*ratioh,193*ratiow,671*ratioh,170*ratiow,671*ratioh,147*ratiow,673*ratioh,114*ratiow,679*ratioh,104*ratiow,679*ratioh,93*ratiow,677*ratioh,76*ratiow,669*ratioh,60*ratiow,657*ratioh,58*ratiow,642*ratioh,51*ratiow,611*ratioh,45*ratiow,582*ratioh,45*ratiow,572*ratioh,50*ratiow,552*ratioh,58*ratiow,535*ratioh,66*ratiow,521*ratioh,69*ratiow,518*ratioh,74*ratiow,510*ratioh,75*ratiow,521*ratioh,76*ratiow,543*ratioh,79*ratiow,562*ratioh,85*ratiow,578*ratioh,97*ratiow,602*ratioh,113*ratiow,620*ratioh,134*ratiow,634*ratioh,146*ratiow,639*ratioh,157*ratiow,634*ratioh,168*ratiow,626*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(191*ratiow,535*ratioh,173*ratiow,519*ratioh,148*ratiow,500*ratioh,126*ratiow,492*ratioh,97*ratiow,492*ratioh,92*ratiow,493*ratioh,99*ratiow,481*ratioh,104*ratiow,468*ratioh,109*ratiow,448*ratioh,118*ratiow,419*ratioh,128*ratiow,392*ratioh,149*ratiow,347*ratioh,161*ratiow,326*ratioh,168*ratiow,318*ratioh,190*ratiow,308*ratioh,204*ratiow,306*ratioh,215*ratiow,307*ratioh,225*ratiow,312*ratioh,236*ratiow,322*ratioh,244*ratiow,336*ratioh,248*ratiow,354*ratioh,248*ratiow,371*ratioh,242*ratiow,388*ratioh,235*ratiow,398*ratioh,224*ratiow,407*ratioh,212*ratiow,415*ratioh,183*ratiow,425*ratioh,163*ratiow,431*ratioh,151*ratiow,435*ratioh,147*ratiow,438*ratioh,143*ratiow,444*ratioh,140*ratiow,450*ratioh,140*ratiow,461*ratioh,142*ratiow,471*ratioh,148*ratiow,483*ratioh,153*ratiow,492*ratioh,178*ratiow,515*ratioh,188*ratiow,525*ratioh);
data = analyze_pic(data);

//LO
selectWindow(name);
makePolygon(314*ratiow,604*ratioh,294*ratiow,597*ratioh,245*ratiow,572*ratioh,211*ratiow,554*ratioh,198*ratiow,547*ratioh,196*ratiow,541*ratioh,203*ratiow,538*ratioh,215*ratiow,519*ratioh,222*ratiow,509*ratioh,238*ratiow,498*ratioh,244*ratiow,504*ratioh,266*ratiow,530*ratioh,289*ratiow,559*ratioh,301*ratiow,572*ratioh,312*ratiow,590*ratioh,314*ratiow,602*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(273*ratiow,717*ratioh,287*ratiow,708*ratioh,301*ratiow,700*ratioh,309*ratiow,692*ratioh,320*ratiow,680*ratioh,327*ratiow,674*ratioh,339*ratiow,674*ratioh,351*ratiow,676*ratioh,368*ratiow,682*ratioh,378*ratiow,674*ratioh,392*ratiow,652*ratioh,399*ratiow,633*ratioh,400*ratiow,619*ratioh,393*ratiow,613*ratioh,378*ratiow,608*ratioh,358*ratiow,602*ratioh,349*ratiow,599*ratioh,343*ratiow,599*ratioh,337*ratiow,603*ratioh,343*ratiow,607*ratioh,351*ratiow,614*ratioh,372*ratiow,632*ratioh,377*ratiow,638*ratioh,375*ratiow,645*ratioh,371*ratiow,655*ratioh,364*ratiow,660*ratioh,358*ratiow,658*ratioh,342*ratiow,648*ratioh,324*ratiow,641*ratioh,310*ratiow,640*ratioh,301*ratiow,642*ratioh,295*ratiow,647*ratioh,286*ratiow,657*ratioh,273*ratiow,679*ratioh,261*ratiow,692*ratioh,259*ratiow,698*ratioh,262*ratiow,704*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(53*ratiow,676*ratioh,54*ratiow,681*ratioh,62*ratiow,689*ratioh,68*ratiow,694*ratioh,73*ratiow,702*ratioh,81*ratiow,705*ratioh,88*ratiow,715*ratioh,94*ratiow,719*ratioh,108*ratiow,723*ratioh,117*ratiow,727*ratioh,128*ratiow,726*ratioh,140*ratiow,731*ratioh,147*ratiow,730*ratioh,157*ratiow,726*ratioh,163*ratiow,719*ratioh,174*ratiow,711*ratioh,181*ratiow,709*ratioh,189*ratiow,709*ratioh,205*ratiow,717*ratioh,222*ratiow,722*ratioh,230*ratiow,721*ratioh,237*ratiow,714*ratioh,256*ratiow,712*ratioh,260*ratiow,709*ratioh,259*ratiow,700*ratioh,260*ratiow,692*ratioh,275*ratiow,675*ratioh,284*ratiow,661*ratioh,292*ratiow,649*ratioh,298*ratiow,644*ratioh,304*ratiow,641*ratioh,312*ratiow,640*ratioh,320*ratiow,640*ratioh,327*ratiow,642*ratioh,337*ratiow,645*ratioh,351*ratiow,654*ratioh,363*ratiow,660*ratioh,365*ratiow,660*ratioh,371*ratiow,656*ratioh,375*ratiow,646*ratioh,377*ratiow,639*ratioh,368*ratiow,628*ratioh,348*ratiow,612*ratioh,339*ratiow,606*ratioh,336*ratiow,604*ratioh,333*ratiow,610*ratioh,340*ratiow,613*ratioh,348*ratiow,621*ratioh,359*ratiow,631*ratioh,365*ratiow,640*ratioh,364*ratiow,646*ratioh,358*ratiow,648*ratioh,345*ratiow,640*ratioh,336*ratiow,636*ratioh,321*ratiow,632*ratioh,300*ratiow,632*ratioh,290*ratiow,634*ratioh,281*ratiow,644*ratioh,269*ratiow,660*ratioh,260*ratiow,675*ratioh,251*ratiow,692*ratioh,250*ratiow,699*ratioh,248*ratiow,703*ratioh,238*ratiow,706*ratioh,218*ratiow,708*ratioh,207*ratiow,707*ratioh,196*ratiow,703*ratioh,180*ratiow,700*ratioh,165*ratiow,705*ratioh,147*ratiow,715*ratioh,138*ratiow,715*ratioh,126*ratiow,712*ratioh,117*ratiow,714*ratioh,109*ratiow,712*ratioh,105*ratiow,712*ratioh,100*ratiow,715*ratioh,96*ratiow,714*ratioh,90*ratiow,702*ratioh,75*ratiow,684*ratioh,62*ratiow,675*ratioh,57*ratiow,673*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(251*ratiow,692*ratioh,259*ratiow,677*ratioh,272*ratiow,656*ratioh,283*ratiow,641*ratioh,290*ratiow,634*ratioh,298*ratiow,632*ratioh,309*ratiow,631*ratioh,326*ratiow,633*ratioh,341*ratiow,638*ratioh,356*ratiow,646*ratioh,359*ratiow,648*ratioh,364*ratiow,644*ratioh,364*ratiow,638*ratioh,355*ratiow,627*ratioh,334*ratiow,608*ratioh,330*ratiow,612*ratioh,317*ratiow,606*ratioh,290*ratiow,595*ratioh,268*ratiow,584*ratioh,226*ratiow,562*ratioh,211*ratiow,554*ratioh,200*ratiow,548*ratioh,199*ratiow,550*ratioh,205*ratiow,570*ratioh,215*ratiow,571*ratioh,243*ratiow,580*ratioh,255*ratiow,590*ratioh,261*ratiow,598*ratioh,263*ratiow,612*ratioh,259*ratiow,626*ratioh,248*ratiow,637*ratioh,238*ratiow,645*ratioh,225*ratiow,660*ratioh,217*ratiow,674*ratioh,232*ratiow,681*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile14(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 552;
var baseHeight = 766;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, AcbC, AcbSh, CPu, Pir1, Pir2, Pir3, aca";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(404*ratiow,198*ratioh,430*ratiow,159*ratioh,466*ratiow,105*ratioh,500*ratiow,54*ratioh,515*ratiow,30*ratioh,521*ratiow,35*ratioh,528*ratiow,45*ratioh,535*ratiow,58*ratioh,542*ratiow,75*ratioh,548*ratiow,93*ratioh,551*ratiow,121*ratioh,551*ratiow,166*ratioh,523*ratiow,175*ratioh,479*ratiow,191*ratioh,436*ratiow,207*ratioh,416*ratiow,215*ratioh,413*ratiow,208*ratioh,410*ratiow,203*ratioh,407*ratiow,200*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(416*ratiow,214*ratioh,488*ratiow,188*ratioh,535*ratiow,171*ratioh,551*ratiow,165*ratioh,551*ratiow,303*ratioh,548*ratiow,317*ratioh,542*ratiow,328*ratioh,540*ratiow,332*ratioh,540*ratiow,333*ratioh,548*ratiow,335*ratioh,551*ratiow,340*ratioh,551*ratiow,344*ratioh,547*ratiow,346*ratioh,546*ratiow,351*ratioh,547*ratiow,355*ratioh,550*ratiow,356*ratioh,549*ratiow,360*ratioh,533*ratiow,357*ratioh,511*ratiow,347*ratioh,491*ratiow,335*ratioh,475*ratiow,320*ratioh,463*ratiow,306*ratioh,452*ratiow,292*ratioh,439*ratiow,271*ratioh,429*ratiow,248*ratioh,421*ratiow,227*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(462*ratiow,486*ratioh,445*ratiow,495*ratioh,425*ratiow,509*ratioh,402*ratiow,527*ratioh,383*ratiow,544*ratioh,366*ratiow,561*ratioh,353*ratiow,575*ratioh,339*ratiow,594*ratioh,333*ratiow,610*ratioh,330*ratiow,631*ratioh,333*ratiow,648*ratioh,343*ratiow,658*ratioh,356*ratiow,663*ratioh,370*ratiow,661*ratioh,392*ratiow,652*ratioh,416*ratiow,638*ratioh,435*ratiow,621*ratioh,452*ratiow,595*ratioh,463*ratiow,552*ratioh,468*ratiow,498*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(323*ratiow,676*ratioh,338*ratiow,653*ratioh,349*ratiow,661*ratioh,362*ratiow,663*ratioh,386*ratiow,655*ratioh,413*ratiow,640*ratioh,432*ratiow,625*ratioh,447*ratiow,604*ratioh,459*ratiow,572*ratioh,466*ratiow,533*ratioh,467*ratiow,506*ratioh,467*ratiow,497*ratioh,469*ratiow,499*ratioh,471*ratiow,498*ratioh,478*ratiow,507*ratioh,489*ratiow,529*ratioh,499*ratiow,554*ratioh,505*ratiow,577*ratioh,506*ratiow,607*ratioh,502*ratiow,627*ratioh,494*ratiow,643*ratioh,481*ratiow,659*ratioh,475*ratiow,656*ratioh,470*ratiow,659*ratioh,468*ratiow,665*ratioh,468*ratiow,669*ratioh,465*ratiow,673*ratioh,464*ratiow,678*ratioh,464*ratiow,682*ratioh,459*ratiow,685*ratioh,450*ratiow,688*ratioh,441*ratiow,693*ratioh,439*ratiow,685*ratioh,437*ratiow,681*ratioh,433*ratiow,678*ratioh,427*ratiow,678*ratioh,425*ratiow,685*ratioh,419*ratiow,696*ratioh,391*ratiow,692*ratioh,377*ratiow,690*ratioh,378*ratiow,682*ratioh,374*ratiow,678*ratioh,369*ratiow,677*ratioh,368*ratiow,681*ratioh,366*ratiow,686*ratioh,361*ratiow,683*ratioh,354*ratiow,681*ratioh,345*ratiow,674*ratioh,335*ratiow,673*ratioh,329*ratiow,676*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(304*ratiow,616*ratioh,332*ratiow,613*ratioh,338*ratiow,598*ratioh,353*ratiow,575*ratioh,376*ratiow,550*ratioh,402*ratiow,527*ratioh,430*ratiow,506*ratioh,450*ratiow,492*ratioh,462*ratiow,486*ratioh,457*ratiow,472*ratioh,452*ratiow,446*ratioh,449*ratiow,432*ratioh,446*ratiow,411*ratioh,441*ratiow,389*ratioh,439*ratiow,383*ratioh,433*ratiow,372*ratioh,418*ratiow,352*ratioh,404*ratiow,336*ratioh,398*ratiow,328*ratioh,392*ratiow,319*ratioh,389*ratiow,311*ratioh,385*ratiow,303*ratioh,378*ratiow,295*ratioh,365*ratiow,288*ratioh,344*ratiow,280*ratioh,322*ratiow,278*ratioh,303*ratiow,282*ratioh,287*ratiow,290*ratioh,270*ratiow,302*ratioh,254*ratiow,321*ratioh,241*ratiow,348*ratioh,236*ratiow,385*ratioh,240*ratiow,419*ratioh,249*ratiow,441*ratioh,265*ratiow,462*ratioh,276*ratiow,474*ratioh,281*ratiow,481*ratioh,286*ratiow,491*ratioh,289*ratiow,509*ratioh,292*ratiow,540*ratioh,293*ratiow,577*ratioh,297*ratiow,600*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(258*ratiow,725*ratioh,254*ratiow,734*ratioh,248*ratiow,728*ratioh,234*ratiow,716*ratioh,218*ratiow,704*ratioh,198*ratiow,690*ratioh,186*ratiow,684*ratioh,169*ratiow,686*ratioh,161*ratiow,690*ratioh,154*ratiow,694*ratioh,139*ratiow,685*ratioh,125*ratiow,673*ratioh,113*ratiow,657*ratioh,104*ratiow,638*ratioh,102*ratiow,622*ratioh,102*ratiow,617*ratioh,116*ratiow,608*ratioh,130*ratiow,605*ratioh,137*ratiow,605*ratioh,145*ratiow,608*ratioh,151*ratiow,612*ratioh,153*ratiow,614*ratioh,143*ratiow,615*ratioh,135*ratiow,617*ratioh,127*ratiow,623*ratioh,124*ratiow,634*ratioh,124*ratiow,645*ratioh,129*ratiow,657*ratioh,136*ratiow,663*ratioh,141*ratiow,665*ratioh,153*ratiow,666*ratioh,164*ratiow,665*ratioh,183*ratiow,658*ratioh,195*ratiow,654*ratioh,201*ratiow,653*ratioh,208*ratiow,657*ratioh,217*ratiow,663*ratioh,222*ratiow,669*ratioh,225*ratiow,679*ratioh,228*ratiow,690*ratioh,235*ratiow,697*ratioh,244*ratiow,699*ratioh,253*ratiow,702*ratioh,258*ratiow,706*ratioh,258*ratiow,714*ratioh,257*ratiow,719*ratioh,254*ratiow,721*ratioh,256*ratiow,725*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(265*ratiow,713*ratioh,258*ratiow,725*ratioh,255*ratiow,723*ratioh,256*ratiow,717*ratioh,258*ratiow,708*ratioh,254*ratiow,703*ratioh,246*ratiow,700*ratioh,236*ratiow,697*ratioh,228*ratiow,691*ratioh,225*ratiow,682*ratioh,224*ratiow,672*ratioh,217*ratiow,663*ratioh,206*ratiow,655*ratioh,198*ratiow,653*ratioh,185*ratiow,657*ratioh,164*ratiow,665*ratioh,152*ratiow,666*ratioh,142*ratiow,665*ratioh,132*ratiow,661*ratioh,125*ratiow,651*ratioh,123*ratiow,636*ratioh,126*ratiow,624*ratioh,136*ratiow,616*ratioh,152*ratiow,614*ratioh,150*ratiow,618*ratioh,143*ratiow,628*ratioh,141*ratiow,643*ratioh,142*ratiow,652*ratioh,146*ratiow,656*ratioh,152*ratiow,657*ratioh,165*ratiow,655*ratioh,181*ratiow,648*ratioh,200*ratiow,644*ratioh,210*ratiow,645*ratioh,217*ratiow,648*ratioh,227*ratiow,655*ratioh,234*ratiow,663*ratioh,239*ratiow,678*ratioh,243*ratiow,685*ratioh,247*ratiow,687*ratioh,255*ratiow,690*ratioh,260*ratiow,694*ratioh,265*ratiow,700*ratioh,266*ratiow,707*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(264*ratiow,714*ratioh,266*ratiow,705*ratioh,263*ratiow,696*ratioh,257*ratiow,691*ratioh,244*ratiow,686*ratioh,238*ratiow,679*ratioh,235*ratiow,665*ratioh,224*ratiow,651*ratioh,209*ratiow,644*ratioh,200*ratiow,644*ratioh,180*ratiow,649*ratioh,159*ratiow,656*ratioh,148*ratiow,657*ratioh,143*ratiow,653*ratioh,140*ratiow,646*ratioh,142*ratiow,632*ratioh,146*ratiow,623*ratioh,154*ratiow,614*ratioh,177*ratiow,609*ratioh,214*ratiow,597*ratioh,235*ratiow,591*ratioh,231*ratiow,601*ratioh,229*ratiow,613*ratioh,232*ratiow,619*ratioh,246*ratiow,627*ratioh,260*ratiow,639*ratioh,265*ratiow,650*ratioh,278*ratiow,674*ratioh,286*ratiow,688*ratioh,292*ratiow,691*ratioh,278*ratiow,703*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(358*ratiow,625*ratioh,380*ratiow,617*ratioh,392*ratiow,608*ratioh,395*ratiow,599*ratioh,394*ratiow,594*ratioh,387*ratiow,591*ratioh,376*ratiow,591*ratioh,363*ratiow,596*ratioh,352*ratiow,605*ratioh,347*ratiow,614*ratioh,348*ratiow,621*ratioh,352*ratiow,625*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(148*ratiow,198*ratioh,122*ratiow,159*ratioh,86*ratiow,105*ratioh,52*ratiow,54*ratioh,37*ratiow,30*ratioh,31*ratiow,35*ratioh,24*ratiow,45*ratioh,17*ratiow,58*ratioh,10*ratiow,75*ratioh,4*ratiow,93*ratioh,1*ratiow,121*ratioh,1*ratiow,166*ratioh,29*ratiow,175*ratioh,73*ratiow,191*ratioh,116*ratiow,207*ratioh,136*ratiow,215*ratioh,139*ratiow,208*ratioh,142*ratiow,203*ratioh,145*ratiow,200*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(136*ratiow,214*ratioh,64*ratiow,188*ratioh,17*ratiow,171*ratioh,1*ratiow,165*ratioh,1*ratiow,303*ratioh,4*ratiow,317*ratioh,10*ratiow,328*ratioh,12*ratiow,332*ratioh,12*ratiow,333*ratioh,4*ratiow,335*ratioh,1*ratiow,340*ratioh,1*ratiow,344*ratioh,5*ratiow,346*ratioh,6*ratiow,351*ratioh,5*ratiow,355*ratioh,2*ratiow,356*ratioh,3*ratiow,360*ratioh,19*ratiow,357*ratioh,41*ratiow,347*ratioh,61*ratiow,335*ratioh,77*ratiow,320*ratioh,89*ratiow,306*ratioh,100*ratiow,292*ratioh,113*ratiow,271*ratioh,123*ratiow,248*ratioh,131*ratiow,227*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(90*ratiow,486*ratioh,107*ratiow,495*ratioh,127*ratiow,509*ratioh,150*ratiow,527*ratioh,169*ratiow,544*ratioh,186*ratiow,561*ratioh,199*ratiow,575*ratioh,213*ratiow,594*ratioh,219*ratiow,610*ratioh,222*ratiow,631*ratioh,219*ratiow,648*ratioh,209*ratiow,658*ratioh,196*ratiow,663*ratioh,182*ratiow,661*ratioh,160*ratiow,652*ratioh,136*ratiow,638*ratioh,117*ratiow,621*ratioh,100*ratiow,595*ratioh,89*ratiow,552*ratioh,84*ratiow,498*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(229*ratiow,676*ratioh,214*ratiow,653*ratioh,203*ratiow,661*ratioh,190*ratiow,663*ratioh,166*ratiow,655*ratioh,139*ratiow,640*ratioh,120*ratiow,625*ratioh,105*ratiow,604*ratioh,93*ratiow,572*ratioh,86*ratiow,533*ratioh,85*ratiow,506*ratioh,85*ratiow,497*ratioh,83*ratiow,499*ratioh,81*ratiow,498*ratioh,74*ratiow,507*ratioh,63*ratiow,529*ratioh,53*ratiow,554*ratioh,47*ratiow,577*ratioh,46*ratiow,607*ratioh,50*ratiow,627*ratioh,58*ratiow,643*ratioh,71*ratiow,659*ratioh,77*ratiow,656*ratioh,82*ratiow,659*ratioh,84*ratiow,665*ratioh,84*ratiow,669*ratioh,87*ratiow,673*ratioh,88*ratiow,678*ratioh,88*ratiow,682*ratioh,93*ratiow,685*ratioh,102*ratiow,688*ratioh,111*ratiow,693*ratioh,113*ratiow,685*ratioh,115*ratiow,681*ratioh,119*ratiow,678*ratioh,125*ratiow,678*ratioh,127*ratiow,685*ratioh,133*ratiow,696*ratioh,161*ratiow,692*ratioh,175*ratiow,690*ratioh,174*ratiow,682*ratioh,178*ratiow,678*ratioh,183*ratiow,677*ratioh,184*ratiow,681*ratioh,186*ratiow,686*ratioh,191*ratiow,683*ratioh,198*ratiow,681*ratioh,207*ratiow,674*ratioh,217*ratiow,673*ratioh,223*ratiow,676*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(248*ratiow,616*ratioh,220*ratiow,613*ratioh,214*ratiow,598*ratioh,199*ratiow,575*ratioh,176*ratiow,550*ratioh,150*ratiow,527*ratioh,122*ratiow,506*ratioh,102*ratiow,492*ratioh,90*ratiow,486*ratioh,95*ratiow,472*ratioh,100*ratiow,446*ratioh,103*ratiow,432*ratioh,106*ratiow,411*ratioh,111*ratiow,389*ratioh,113*ratiow,383*ratioh,119*ratiow,372*ratioh,134*ratiow,352*ratioh,148*ratiow,336*ratioh,154*ratiow,328*ratioh,160*ratiow,319*ratioh,163*ratiow,311*ratioh,167*ratiow,303*ratioh,174*ratiow,295*ratioh,187*ratiow,288*ratioh,208*ratiow,280*ratioh,230*ratiow,278*ratioh,249*ratiow,282*ratioh,265*ratiow,290*ratioh,282*ratiow,302*ratioh,298*ratiow,321*ratioh,311*ratiow,348*ratioh,316*ratiow,385*ratioh,312*ratiow,419*ratioh,303*ratiow,441*ratioh,287*ratiow,462*ratioh,276*ratiow,474*ratioh,271*ratiow,481*ratioh,266*ratiow,491*ratioh,263*ratiow,509*ratioh,260*ratiow,540*ratioh,259*ratiow,577*ratioh,255*ratiow,600*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(294*ratiow,725*ratioh,298*ratiow,734*ratioh,304*ratiow,728*ratioh,318*ratiow,716*ratioh,334*ratiow,704*ratioh,354*ratiow,690*ratioh,366*ratiow,684*ratioh,383*ratiow,686*ratioh,391*ratiow,690*ratioh,398*ratiow,694*ratioh,413*ratiow,685*ratioh,427*ratiow,673*ratioh,439*ratiow,657*ratioh,448*ratiow,638*ratioh,450*ratiow,622*ratioh,450*ratiow,617*ratioh,436*ratiow,608*ratioh,422*ratiow,605*ratioh,415*ratiow,605*ratioh,407*ratiow,608*ratioh,401*ratiow,612*ratioh,399*ratiow,614*ratioh,409*ratiow,615*ratioh,417*ratiow,617*ratioh,425*ratiow,623*ratioh,428*ratiow,634*ratioh,428*ratiow,645*ratioh,423*ratiow,657*ratioh,416*ratiow,663*ratioh,411*ratiow,665*ratioh,399*ratiow,666*ratioh,388*ratiow,665*ratioh,369*ratiow,658*ratioh,357*ratiow,654*ratioh,351*ratiow,653*ratioh,344*ratiow,657*ratioh,335*ratiow,663*ratioh,330*ratiow,669*ratioh,327*ratiow,679*ratioh,324*ratiow,690*ratioh,317*ratiow,697*ratioh,308*ratiow,699*ratioh,299*ratiow,702*ratioh,294*ratiow,706*ratioh,294*ratiow,714*ratioh,295*ratiow,719*ratioh,298*ratiow,721*ratioh,296*ratiow,725*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(287*ratiow,713*ratioh,294*ratiow,725*ratioh,297*ratiow,723*ratioh,296*ratiow,717*ratioh,294*ratiow,708*ratioh,298*ratiow,703*ratioh,306*ratiow,700*ratioh,316*ratiow,697*ratioh,324*ratiow,691*ratioh,327*ratiow,682*ratioh,328*ratiow,672*ratioh,335*ratiow,663*ratioh,346*ratiow,655*ratioh,354*ratiow,653*ratioh,367*ratiow,657*ratioh,388*ratiow,665*ratioh,400*ratiow,666*ratioh,410*ratiow,665*ratioh,420*ratiow,661*ratioh,427*ratiow,651*ratioh,429*ratiow,636*ratioh,426*ratiow,624*ratioh,416*ratiow,616*ratioh,400*ratiow,614*ratioh,402*ratiow,618*ratioh,409*ratiow,628*ratioh,411*ratiow,643*ratioh,410*ratiow,652*ratioh,406*ratiow,656*ratioh,400*ratiow,657*ratioh,387*ratiow,655*ratioh,371*ratiow,648*ratioh,352*ratiow,644*ratioh,342*ratiow,645*ratioh,335*ratiow,648*ratioh,325*ratiow,655*ratioh,318*ratiow,663*ratioh,313*ratiow,678*ratioh,309*ratiow,685*ratioh,305*ratiow,687*ratioh,297*ratiow,690*ratioh,292*ratiow,694*ratioh,287*ratiow,700*ratioh,286*ratiow,707*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(288*ratiow,714*ratioh,286*ratiow,705*ratioh,289*ratiow,696*ratioh,295*ratiow,691*ratioh,308*ratiow,686*ratioh,314*ratiow,679*ratioh,317*ratiow,665*ratioh,328*ratiow,651*ratioh,343*ratiow,644*ratioh,352*ratiow,644*ratioh,372*ratiow,649*ratioh,393*ratiow,656*ratioh,404*ratiow,657*ratioh,409*ratiow,653*ratioh,412*ratiow,646*ratioh,410*ratiow,632*ratioh,406*ratiow,623*ratioh,398*ratiow,614*ratioh,375*ratiow,609*ratioh,338*ratiow,597*ratioh,317*ratiow,591*ratioh,321*ratiow,601*ratioh,323*ratiow,613*ratioh,320*ratiow,619*ratioh,306*ratiow,627*ratioh,292*ratiow,639*ratioh,287*ratiow,650*ratioh,274*ratiow,674*ratioh,266*ratiow,688*ratioh,260*ratiow,691*ratioh,274*ratiow,703*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(194*ratiow,625*ratioh,172*ratiow,617*ratioh,160*ratiow,608*ratioh,157*ratiow,599*ratioh,158*ratiow,594*ratioh,165*ratiow,591*ratioh,176*ratiow,591*ratioh,189*ratiow,596*ratioh,200*ratiow,605*ratioh,205*ratiow,614*ratioh,204*ratiow,621*ratioh,200*ratiow,625*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile15(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 550;
var baseHeight = 776;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, AcbC, AcbSh, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(404*ratiow,205*ratioh,434*ratiow,157*ratioh,466*ratiow,105*ratioh,491*ratiow,64*ratioh,507*ratiow,40*ratioh,511*ratiow,33*ratioh,518*ratiow,39*ratioh,525*ratiow,47*ratioh,532*ratiow,56*ratioh,538*ratiow,67*ratioh,542*ratiow,80*ratioh,546*ratiow,93*ratioh,548*ratiow,102*ratioh,549*ratiow,108*ratioh,549*ratiow,164*ratioh,535*ratiow,168*ratioh,514*ratiow,175*ratioh,489*ratiow,183*ratioh,464*ratiow,192*ratioh,440*ratiow,201*ratioh,422*ratiow,208*ratioh,412*ratiow,212*ratioh,409*ratiow,210*ratioh,407*ratiow,207*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(412*ratiow,212*ratioh,470*ratiow,189*ratioh,501*ratiow,179*ratioh,529*ratiow,170*ratioh,544*ratiow,165*ratioh,549*ratiow,164*ratioh,549*ratiow,306*ratioh,547*ratiow,312*ratioh,541*ratiow,318*ratioh,539*ratiow,320*ratioh,542*ratiow,323*ratioh,544*ratiow,327*ratioh,546*ratiow,332*ratioh,545*ratiow,335*ratioh,547*ratiow,340*ratioh,549*ratiow,341*ratioh,542*ratiow,343*ratioh,530*ratiow,341*ratioh,516*ratiow,335*ratioh,505*ratiow,329*ratioh,493*ratiow,322*ratioh,484*ratiow,316*ratioh,477*ratiow,309*ratioh,469*ratiow,302*ratioh,461*ratiow,292*ratioh,453*ratiow,284*ratioh,444*ratiow,273*ratioh,435*ratiow,261*ratioh,426*ratiow,245*ratioh,420*ratiow,230*ratioh,415*ratiow,219*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(462*ratiow,493*ratioh,453*ratiow,496*ratioh,445*ratiow,501*ratioh,436*ratiow,508*ratioh,427*ratiow,515*ratioh,418*ratiow,523*ratioh,409*ratiow,531*ratioh,397*ratiow,544*ratioh,388*ratiow,554*ratioh,379*ratiow,565*ratioh,369*ratiow,577*ratioh,361*ratiow,587*ratioh,353*ratiow,599*ratioh,350*ratiow,610*ratioh,350*ratiow,619*ratioh,352*ratiow,627*ratioh,353*ratiow,634*ratioh,358*ratiow,640*ratioh,362*ratiow,645*ratioh,369*ratiow,649*ratioh,376*ratiow,653*ratioh,384*ratiow,655*ratioh,395*ratiow,656*ratioh,406*ratiow,654*ratioh,419*ratiow,649*ratioh,428*ratiow,642*ratioh,436*ratiow,635*ratioh,443*ratiow,626*ratioh,449*ratiow,617*ratioh,453*ratiow,608*ratioh,456*ratiow,599*ratioh,460*ratiow,588*ratioh,463*ratiow,576*ratioh,466*ratiow,562*ratioh,468*ratiow,550*ratioh,469*ratiow,536*ratioh,469*ratiow,522*ratioh,470*ratiow,511*ratioh,470*ratiow,499*ratioh,470*ratiow,496*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(473*ratiow,497*ratioh,480*ratiow,504*ratioh,485*ratiow,513*ratioh,491*ratiow,524*ratioh,496*ratiow,534*ratioh,500*ratiow,544*ratioh,504*ratiow,552*ratioh,507*ratiow,562*ratioh,511*ratiow,576*ratioh,512*ratiow,584*ratioh,510*ratiow,595*ratioh,508*ratiow,606*ratioh,507*ratiow,616*ratioh,506*ratiow,628*ratioh,505*ratiow,640*ratioh,507*ratiow,654*ratioh,502*ratiow,670*ratioh,495*ratiow,677*ratioh,485*ratiow,683*ratioh,477*ratiow,686*ratioh,473*ratiow,690*ratioh,470*ratiow,696*ratioh,466*ratiow,703*ratioh,461*ratiow,707*ratioh,452*ratiow,709*ratioh,443*ratiow,709*ratioh,435*ratiow,708*ratioh,425*ratiow,707*ratioh,417*ratiow,707*ratioh,413*ratiow,711*ratioh,412*ratiow,716*ratioh,407*ratiow,715*ratioh,399*ratiow,713*ratioh,385*ratiow,712*ratioh,378*ratiow,712*ratioh,377*ratiow,711*ratioh,383*ratiow,707*ratioh,385*ratiow,701*ratioh,383*ratiow,696*ratioh,380*ratiow,694*ratioh,373*ratiow,697*ratioh,365*ratiow,699*ratioh,359*ratiow,696*ratioh,354*ratiow,691*ratioh,349*ratiow,687*ratioh,344*ratiow,683*ratioh,344*ratiow,679*ratioh,344*ratiow,674*ratioh,340*ratiow,667*ratioh,338*ratiow,660*ratioh,336*ratiow,653*ratioh,333*ratiow,645*ratioh,330*ratiow,640*ratioh,326*ratiow,636*ratioh,323*ratiow,634*ratioh,350*ratiow,621*ratioh,351*ratiow,626*ratioh,353*ratiow,632*ratioh,358*ratiow,640*ratioh,363*ratiow,645*ratioh,370*ratiow,650*ratioh,380*ratiow,654*ratioh,385*ratiow,655*ratioh,394*ratiow,656*ratioh,402*ratiow,655*ratioh,410*ratiow,653*ratioh,425*ratiow,645*ratioh,431*ratiow,640*ratioh,437*ratiow,634*ratioh,442*ratiow,628*ratioh,449*ratiow,616*ratioh,452*ratiow,610*ratioh,455*ratiow,604*ratioh,457*ratiow,597*ratioh,465*ratiow,570*ratioh,466*ratiow,561*ratioh,467*ratiow,554*ratioh,469*ratiow,540*ratioh,469*ratiow,533*ratioh,469*ratiow,524*ratioh,470*ratiow,504*ratioh,470*ratiow,497*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(323*ratiow,634*ratioh,350*ratiow,622*ratioh,350*ratiow,615*ratioh,351*ratiow,607*ratioh,353*ratiow,600*ratioh,357*ratiow,594*ratioh,362*ratiow,587*ratioh,383*ratiow,560*ratioh,395*ratiow,546*ratioh,406*ratiow,535*ratioh,416*ratiow,525*ratioh,421*ratiow,521*ratioh,433*ratiow,510*ratioh,443*ratiow,503*ratioh,454*ratiow,496*ratioh,462*ratiow,493*ratioh,463*ratiow,492*ratioh,459*ratiow,486*ratioh,457*ratiow,478*ratioh,456*ratiow,467*ratioh,455*ratiow,447*ratioh,454*ratiow,428*ratioh,452*ratiow,414*ratioh,450*ratiow,404*ratioh,449*ratiow,393*ratioh,445*ratiow,382*ratioh,426*ratiow,352*ratioh,412*ratiow,335*ratioh,404*ratiow,325*ratioh,396*ratiow,319*ratioh,387*ratiow,310*ratioh,378*ratiow,300*ratioh,369*ratiow,293*ratioh,360*ratiow,286*ratioh,353*ratiow,281*ratioh,349*ratiow,277*ratioh,339*ratiow,275*ratioh,328*ratiow,274*ratioh,313*ratiow,277*ratioh,297*ratiow,284*ratioh,284*ratiow,292*ratioh,273*ratiow,300*ratioh,263*ratiow,310*ratioh,256*ratiow,318*ratioh,247*ratiow,331*ratioh,240*ratiow,347*ratioh,235*ratiow,364*ratioh,232*ratiow,378*ratioh,231*ratiow,391*ratioh,230*ratiow,402*ratioh,233*ratiow,414*ratioh,244*ratiow,440*ratioh,248*ratiow,456*ratioh,253*ratiow,470*ratioh,258*ratiow,483*ratioh,265*ratiow,498*ratioh,272*ratiow,516*ratioh,277*ratiow,531*ratioh,280*ratiow,546*ratioh,284*ratiow,562*ratioh,285*ratiow,576*ratioh,287*ratiow,590*ratioh,289*ratiow,604*ratioh,292*ratiow,613*ratioh,296*ratiow,621*ratioh,303*ratiow,629*ratioh,309*ratiow,635*ratioh,316*ratiow,633*ratioh,320*ratiow,633*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(260*ratiow,723*ratioh,254*ratiow,728*ratioh,249*ratiow,733*ratioh,248*ratiow,740*ratioh,248*ratiow,745*ratioh,240*ratiow,741*ratioh,232*ratiow,735*ratioh,225*ratiow,727*ratioh,220*ratiow,719*ratioh,215*ratiow,712*ratioh,210*ratiow,706*ratioh,207*ratiow,703*ratioh,201*ratiow,701*ratioh,188*ratiow,703*ratioh,173*ratiow,708*ratioh,163*ratiow,712*ratioh,156*ratiow,708*ratioh,144*ratiow,696*ratioh,134*ratiow,688*ratioh,123*ratiow,676*ratioh,117*ratiow,664*ratioh,111*ratiow,651*ratioh,108*ratiow,641*ratioh,104*ratiow,632*ratioh,110*ratiow,628*ratioh,118*ratiow,626*ratioh,129*ratiow,621*ratioh,141*ratiow,619*ratioh,150*ratiow,621*ratioh,157*ratiow,623*ratioh,157*ratiow,628*ratioh,154*ratiow,627*ratioh,150*ratiow,627*ratioh,146*ratiow,629*ratioh,143*ratiow,632*ratioh,138*ratiow,637*ratioh,134*ratiow,641*ratioh,134*ratiow,646*ratioh,134*ratiow,650*ratioh,135*ratiow,656*ratioh,136*ratiow,659*ratioh,138*ratiow,664*ratioh,141*ratiow,670*ratioh,144*ratiow,674*ratioh,148*ratiow,679*ratioh,153*ratiow,683*ratioh,158*ratiow,684*ratioh,165*ratiow,683*ratioh,173*ratiow,679*ratioh,179*ratiow,675*ratioh,188*ratiow,671*ratioh,197*ratiow,667*ratioh,203*ratiow,666*ratioh,208*ratiow,666*ratioh,213*ratiow,667*ratioh,217*ratiow,671*ratioh,221*ratiow,676*ratioh,222*ratiow,681*ratioh,224*ratiow,688*ratioh,226*ratiow,694*ratioh,230*ratiow,701*ratioh,235*ratiow,706*ratioh,240*ratiow,711*ratioh,246*ratiow,715*ratioh,253*ratiow,719*ratioh,257*ratiow,721*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(268*ratiow,718*ratioh,261*ratiow,723*ratioh,253*ratiow,719*ratioh,245*ratiow,715*ratioh,237*ratiow,708*ratioh,230*ratiow,700*ratioh,226*ratiow,693*ratioh,223*ratiow,684*ratioh,221*ratiow,677*ratioh,218*ratiow,671*ratioh,212*ratiow,667*ratioh,204*ratiow,665*ratioh,191*ratiow,669*ratioh,178*ratiow,676*ratioh,168*ratiow,681*ratioh,161*ratiow,684*ratioh,154*ratiow,683*ratioh,149*ratiow,680*ratioh,144*ratiow,674*ratioh,140*ratiow,668*ratioh,136*ratiow,662*ratioh,134*ratiow,654*ratioh,133*ratiow,647*ratioh,135*ratiow,640*ratioh,138*ratiow,636*ratioh,144*ratiow,631*ratioh,150*ratiow,627*ratioh,154*ratiow,627*ratioh,157*ratiow,628*ratioh,158*ratiow,630*ratioh,159*ratiow,633*ratioh,158*ratiow,636*ratioh,155*ratiow,640*ratioh,153*ratiow,643*ratioh,152*ratiow,648*ratioh,151*ratiow,657*ratioh,152*ratiow,664*ratioh,155*ratiow,669*ratioh,160*ratiow,670*ratioh,164*ratiow,669*ratioh,170*ratiow,667*ratioh,177*ratiow,664*ratioh,190*ratiow,658*ratioh,198*ratiow,655*ratioh,205*ratiow,653*ratioh,213*ratiow,654*ratioh,220*ratiow,658*ratioh,226*ratiow,663*ratioh,231*ratiow,668*ratioh,234*ratiow,674*ratioh,239*ratiow,680*ratioh,242*ratiow,686*ratioh,250*ratiow,698*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(295*ratiow,704*ratioh,284*ratiow,709*ratioh,274*ratiow,715*ratioh,268*ratiow,719*ratioh,263*ratiow,713*ratioh,254*ratiow,703*ratioh,248*ratiow,696*ratioh,242*ratiow,686*ratioh,237*ratiow,678*ratioh,229*ratiow,666*ratioh,225*ratiow,661*ratioh,218*ratiow,656*ratioh,210*ratiow,654*ratioh,201*ratiow,654*ratioh,192*ratiow,657*ratioh,172*ratiow,666*ratioh,161*ratiow,670*ratioh,155*ratiow,668*ratioh,151*ratiow,661*ratioh,151*ratiow,650*ratioh,154*ratiow,642*ratioh,158*ratiow,636*ratioh,159*ratiow,633*ratioh,155*ratiow,627*ratioh,157*ratiow,623*ratioh,165*ratiow,626*ratioh,174*ratiow,627*ratioh,184*ratiow,623*ratioh,200*ratiow,615*ratioh,206*ratiow,611*ratioh,209*ratiow,609*ratioh,209*ratiow,614*ratioh,212*ratiow,620*ratioh,216*ratiow,626*ratioh,223*ratiow,629*ratioh,231*ratiow,631*ratioh,244*ratiow,636*ratioh,252*ratiow,639*ratioh,258*ratiow,643*ratioh,263*ratiow,647*ratioh,266*ratiow,653*ratioh,273*ratiow,666*ratioh,277*ratiow,674*ratioh,281*ratiow,680*ratioh,287*ratiow,688*ratioh,293*ratiow,693*ratioh,297*ratiow,696*ratioh,302*ratiow,699*ratioh,303*ratiow,700*ratioh,295*ratiow,704*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(146*ratiow,205*ratioh,116*ratiow,157*ratioh,84*ratiow,105*ratioh,59*ratiow,64*ratioh,43*ratiow,40*ratioh,39*ratiow,33*ratioh,32*ratiow,39*ratioh,25*ratiow,47*ratioh,18*ratiow,56*ratioh,12*ratiow,67*ratioh,8*ratiow,80*ratioh,4*ratiow,93*ratioh,2*ratiow,102*ratioh,1*ratiow,108*ratioh,1*ratiow,164*ratioh,15*ratiow,168*ratioh,36*ratiow,175*ratioh,61*ratiow,183*ratioh,86*ratiow,192*ratioh,110*ratiow,201*ratioh,128*ratiow,208*ratioh,138*ratiow,212*ratioh,141*ratiow,210*ratioh,143*ratiow,207*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(138*ratiow,212*ratioh,80*ratiow,189*ratioh,49*ratiow,179*ratioh,21*ratiow,170*ratioh,6*ratiow,165*ratioh,1*ratiow,164*ratioh,1*ratiow,306*ratioh,3*ratiow,312*ratioh,9*ratiow,318*ratioh,11*ratiow,320*ratioh,8*ratiow,323*ratioh,6*ratiow,327*ratioh,4*ratiow,332*ratioh,5*ratiow,335*ratioh,3*ratiow,340*ratioh,1*ratiow,341*ratioh,8*ratiow,343*ratioh,20*ratiow,341*ratioh,34*ratiow,335*ratioh,45*ratiow,329*ratioh,57*ratiow,322*ratioh,66*ratiow,316*ratioh,73*ratiow,309*ratioh,81*ratiow,302*ratioh,89*ratiow,292*ratioh,97*ratiow,284*ratioh,106*ratiow,273*ratioh,115*ratiow,261*ratioh,124*ratiow,245*ratioh,130*ratiow,230*ratioh,135*ratiow,219*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(88*ratiow,493*ratioh,97*ratiow,496*ratioh,105*ratiow,501*ratioh,114*ratiow,508*ratioh,123*ratiow,515*ratioh,132*ratiow,523*ratioh,141*ratiow,531*ratioh,153*ratiow,544*ratioh,162*ratiow,554*ratioh,171*ratiow,565*ratioh,181*ratiow,577*ratioh,189*ratiow,587*ratioh,197*ratiow,599*ratioh,200*ratiow,610*ratioh,200*ratiow,619*ratioh,198*ratiow,627*ratioh,197*ratiow,634*ratioh,192*ratiow,640*ratioh,188*ratiow,645*ratioh,181*ratiow,649*ratioh,174*ratiow,653*ratioh,166*ratiow,655*ratioh,155*ratiow,656*ratioh,144*ratiow,654*ratioh,131*ratiow,649*ratioh,122*ratiow,642*ratioh,114*ratiow,635*ratioh,107*ratiow,626*ratioh,101*ratiow,617*ratioh,97*ratiow,608*ratioh,94*ratiow,599*ratioh,90*ratiow,588*ratioh,87*ratiow,576*ratioh,84*ratiow,562*ratioh,82*ratiow,550*ratioh,81*ratiow,536*ratioh,81*ratiow,522*ratioh,80*ratiow,511*ratioh,80*ratiow,499*ratioh,80*ratiow,496*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(77*ratiow,497*ratioh,70*ratiow,504*ratioh,65*ratiow,513*ratioh,59*ratiow,524*ratioh,54*ratiow,534*ratioh,50*ratiow,544*ratioh,46*ratiow,552*ratioh,43*ratiow,562*ratioh,39*ratiow,576*ratioh,38*ratiow,584*ratioh,40*ratiow,595*ratioh,42*ratiow,606*ratioh,43*ratiow,616*ratioh,44*ratiow,628*ratioh,45*ratiow,640*ratioh,43*ratiow,654*ratioh,48*ratiow,670*ratioh,55*ratiow,677*ratioh,65*ratiow,683*ratioh,73*ratiow,686*ratioh,77*ratiow,690*ratioh,80*ratiow,696*ratioh,84*ratiow,703*ratioh,89*ratiow,707*ratioh,98*ratiow,709*ratioh,107*ratiow,709*ratioh,115*ratiow,708*ratioh,125*ratiow,707*ratioh,133*ratiow,707*ratioh,137*ratiow,711*ratioh,138*ratiow,716*ratioh,143*ratiow,715*ratioh,151*ratiow,713*ratioh,165*ratiow,712*ratioh,172*ratiow,712*ratioh,173*ratiow,711*ratioh,167*ratiow,707*ratioh,165*ratiow,701*ratioh,167*ratiow,696*ratioh,170*ratiow,694*ratioh,177*ratiow,697*ratioh,185*ratiow,699*ratioh,191*ratiow,696*ratioh,196*ratiow,691*ratioh,201*ratiow,687*ratioh,206*ratiow,683*ratioh,206*ratiow,679*ratioh,206*ratiow,674*ratioh,210*ratiow,667*ratioh,212*ratiow,660*ratioh,214*ratiow,653*ratioh,217*ratiow,645*ratioh,220*ratiow,640*ratioh,224*ratiow,636*ratioh,227*ratiow,634*ratioh,200*ratiow,621*ratioh,199*ratiow,626*ratioh,197*ratiow,632*ratioh,192*ratiow,640*ratioh,187*ratiow,645*ratioh,180*ratiow,650*ratioh,170*ratiow,654*ratioh,165*ratiow,655*ratioh,156*ratiow,656*ratioh,148*ratiow,655*ratioh,140*ratiow,653*ratioh,125*ratiow,645*ratioh,119*ratiow,640*ratioh,113*ratiow,634*ratioh,108*ratiow,628*ratioh,101*ratiow,616*ratioh,98*ratiow,610*ratioh,95*ratiow,604*ratioh,93*ratiow,597*ratioh,85*ratiow,570*ratioh,84*ratiow,561*ratioh,83*ratiow,554*ratioh,81*ratiow,540*ratioh,81*ratiow,533*ratioh,81*ratiow,524*ratioh,80*ratiow,504*ratioh,80*ratiow,497*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(227*ratiow,634*ratioh,200*ratiow,622*ratioh,200*ratiow,615*ratioh,199*ratiow,607*ratioh,197*ratiow,600*ratioh,193*ratiow,594*ratioh,188*ratiow,587*ratioh,167*ratiow,560*ratioh,155*ratiow,546*ratioh,144*ratiow,535*ratioh,134*ratiow,525*ratioh,129*ratiow,521*ratioh,117*ratiow,510*ratioh,107*ratiow,503*ratioh,96*ratiow,496*ratioh,88*ratiow,493*ratioh,87*ratiow,492*ratioh,91*ratiow,486*ratioh,93*ratiow,478*ratioh,94*ratiow,467*ratioh,95*ratiow,447*ratioh,96*ratiow,428*ratioh,98*ratiow,414*ratioh,100*ratiow,404*ratioh,101*ratiow,393*ratioh,105*ratiow,382*ratioh,124*ratiow,352*ratioh,138*ratiow,335*ratioh,146*ratiow,325*ratioh,154*ratiow,319*ratioh,163*ratiow,310*ratioh,172*ratiow,300*ratioh,181*ratiow,293*ratioh,190*ratiow,286*ratioh,197*ratiow,281*ratioh,201*ratiow,277*ratioh,211*ratiow,275*ratioh,222*ratiow,274*ratioh,237*ratiow,277*ratioh,253*ratiow,284*ratioh,266*ratiow,292*ratioh,277*ratiow,300*ratioh,287*ratiow,310*ratioh,294*ratiow,318*ratioh,303*ratiow,331*ratioh,310*ratiow,347*ratioh,315*ratiow,364*ratioh,318*ratiow,378*ratioh,319*ratiow,391*ratioh,320*ratiow,402*ratioh,317*ratiow,414*ratioh,306*ratiow,440*ratioh,302*ratiow,456*ratioh,297*ratiow,470*ratioh,292*ratiow,483*ratioh,285*ratiow,498*ratioh,278*ratiow,516*ratioh,273*ratiow,531*ratioh,270*ratiow,546*ratioh,266*ratiow,562*ratioh,265*ratiow,576*ratioh,263*ratiow,590*ratioh,261*ratiow,604*ratioh,258*ratiow,613*ratioh,254*ratiow,621*ratioh,247*ratiow,629*ratioh,241*ratiow,635*ratioh,234*ratiow,633*ratioh,230*ratiow,633*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(290*ratiow,723*ratioh,296*ratiow,728*ratioh,301*ratiow,733*ratioh,302*ratiow,740*ratioh,302*ratiow,745*ratioh,310*ratiow,741*ratioh,318*ratiow,735*ratioh,325*ratiow,727*ratioh,330*ratiow,719*ratioh,335*ratiow,712*ratioh,340*ratiow,706*ratioh,343*ratiow,703*ratioh,349*ratiow,701*ratioh,362*ratiow,703*ratioh,377*ratiow,708*ratioh,387*ratiow,712*ratioh,394*ratiow,708*ratioh,406*ratiow,696*ratioh,416*ratiow,688*ratioh,427*ratiow,676*ratioh,433*ratiow,664*ratioh,439*ratiow,651*ratioh,442*ratiow,641*ratioh,446*ratiow,632*ratioh,440*ratiow,628*ratioh,432*ratiow,626*ratioh,421*ratiow,621*ratioh,409*ratiow,619*ratioh,400*ratiow,621*ratioh,393*ratiow,623*ratioh,393*ratiow,628*ratioh,396*ratiow,627*ratioh,400*ratiow,627*ratioh,404*ratiow,629*ratioh,407*ratiow,632*ratioh,412*ratiow,637*ratioh,416*ratiow,641*ratioh,416*ratiow,646*ratioh,416*ratiow,650*ratioh,415*ratiow,656*ratioh,414*ratiow,659*ratioh,412*ratiow,664*ratioh,409*ratiow,670*ratioh,406*ratiow,674*ratioh,402*ratiow,679*ratioh,397*ratiow,683*ratioh,392*ratiow,684*ratioh,385*ratiow,683*ratioh,377*ratiow,679*ratioh,371*ratiow,675*ratioh,362*ratiow,671*ratioh,353*ratiow,667*ratioh,347*ratiow,666*ratioh,342*ratiow,666*ratioh,337*ratiow,667*ratioh,333*ratiow,671*ratioh,329*ratiow,676*ratioh,328*ratiow,681*ratioh,326*ratiow,688*ratioh,324*ratiow,694*ratioh,320*ratiow,701*ratioh,315*ratiow,706*ratioh,310*ratiow,711*ratioh,304*ratiow,715*ratioh,297*ratiow,719*ratioh,293*ratiow,721*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(282*ratiow,718*ratioh,289*ratiow,723*ratioh,297*ratiow,719*ratioh,305*ratiow,715*ratioh,313*ratiow,708*ratioh,320*ratiow,700*ratioh,324*ratiow,693*ratioh,327*ratiow,684*ratioh,329*ratiow,677*ratioh,332*ratiow,671*ratioh,338*ratiow,667*ratioh,346*ratiow,665*ratioh,359*ratiow,669*ratioh,372*ratiow,676*ratioh,382*ratiow,681*ratioh,389*ratiow,684*ratioh,396*ratiow,683*ratioh,401*ratiow,680*ratioh,406*ratiow,674*ratioh,410*ratiow,668*ratioh,414*ratiow,662*ratioh,416*ratiow,654*ratioh,417*ratiow,647*ratioh,415*ratiow,640*ratioh,412*ratiow,636*ratioh,406*ratiow,631*ratioh,400*ratiow,627*ratioh,396*ratiow,627*ratioh,393*ratiow,628*ratioh,392*ratiow,630*ratioh,391*ratiow,633*ratioh,392*ratiow,636*ratioh,395*ratiow,640*ratioh,397*ratiow,643*ratioh,398*ratiow,648*ratioh,399*ratiow,657*ratioh,398*ratiow,664*ratioh,395*ratiow,669*ratioh,390*ratiow,670*ratioh,386*ratiow,669*ratioh,380*ratiow,667*ratioh,373*ratiow,664*ratioh,360*ratiow,658*ratioh,352*ratiow,655*ratioh,345*ratiow,653*ratioh,337*ratiow,654*ratioh,330*ratiow,658*ratioh,324*ratiow,663*ratioh,319*ratiow,668*ratioh,316*ratiow,674*ratioh,311*ratiow,680*ratioh,308*ratiow,686*ratioh,300*ratiow,698*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(255*ratiow,704*ratioh,266*ratiow,709*ratioh,276*ratiow,715*ratioh,282*ratiow,719*ratioh,287*ratiow,713*ratioh,296*ratiow,703*ratioh,302*ratiow,696*ratioh,308*ratiow,686*ratioh,313*ratiow,678*ratioh,321*ratiow,666*ratioh,325*ratiow,661*ratioh,332*ratiow,656*ratioh,340*ratiow,654*ratioh,349*ratiow,654*ratioh,358*ratiow,657*ratioh,378*ratiow,666*ratioh,389*ratiow,670*ratioh,395*ratiow,668*ratioh,399*ratiow,661*ratioh,399*ratiow,650*ratioh,396*ratiow,642*ratioh,392*ratiow,636*ratioh,391*ratiow,633*ratioh,395*ratiow,627*ratioh,393*ratiow,623*ratioh,385*ratiow,626*ratioh,376*ratiow,627*ratioh,366*ratiow,623*ratioh,350*ratiow,615*ratioh,344*ratiow,611*ratioh,341*ratiow,609*ratioh,341*ratiow,614*ratioh,338*ratiow,620*ratioh,334*ratiow,626*ratioh,327*ratiow,629*ratioh,319*ratiow,631*ratioh,306*ratiow,636*ratioh,298*ratiow,639*ratioh,292*ratiow,643*ratioh,287*ratiow,647*ratioh,284*ratiow,653*ratioh,277*ratiow,666*ratioh,273*ratiow,674*ratioh,269*ratiow,680*ratioh,263*ratiow,688*ratioh,257*ratiow,693*ratioh,253*ratiow,696*ratioh,248*ratiow,699*ratioh,247*ratiow,700*ratioh,255*ratiow,704*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile16(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 551;
var baseHeight = 789;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, AcbC, AcbSh, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(413*ratiow,193*ratioh,482*ratiow,91*ratioh,510*ratiow,46*ratioh,522*ratiow,27*ratioh,530*ratiow,36*ratioh,536*ratiow,45*ratioh,542*ratiow,54*ratioh,547*ratiow,66*ratioh,550*ratiow,75*ratioh,549*ratiow,166*ratioh,465*ratiow,194*ratioh,425*ratiow,206*ratioh,422*ratiow,201*ratioh,418*ratiow,199*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(426*ratiow,206*ratioh,488*ratiow,186*ratioh,534*ratiow,172*ratioh,550*ratiow,166*ratioh,550*ratiow,305*ratioh,547*ratiow,311*ratioh,543*ratiow,316*ratioh,541*ratiow,318*ratioh,546*ratiow,321*ratioh,544*ratiow,326*ratioh,546*ratiow,330*ratioh,547*ratiow,334*ratioh,531*ratiow,331*ratioh,509*ratiow,323*ratioh,498*ratiow,314*ratioh,484*ratiow,303*ratioh,473*ratiow,292*ratioh,462*ratiow,281*ratioh,453*ratiow,268*ratioh,445*ratiow,251*ratioh,439*ratiow,234*ratioh,434*ratiow,220*ratioh,431*ratiow,212*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(463*ratiow,498*ratioh,453*ratiow,503*ratioh,442*ratiow,510*ratioh,428*ratiow,519*ratioh,406*ratiow,537*ratioh,385*ratiow,557*ratioh,366*ratiow,576*ratioh,351*ratiow,595*ratioh,345*ratiow,608*ratioh,342*ratiow,620*ratioh,344*ratiow,632*ratioh,349*ratiow,643*ratioh,358*ratiow,651*ratioh,370*ratiow,656*ratioh,385*ratiow,659*ratioh,400*ratiow,655*ratioh,417*ratiow,646*ratioh,426*ratiow,640*ratioh,437*ratiow,630*ratioh,445*ratiow,615*ratioh,452*ratiow,601*ratioh,455*ratiow,590*ratioh,460*ratiow,571*ratioh,462*ratiow,553*ratioh,465*ratiow,534*ratioh,466*ratiow,516*ratioh,465*ratiow,502*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(472*ratiow,499*ratioh,476*ratiow,501*ratioh,482*ratiow,507*ratioh,490*ratiow,517*ratioh,496*ratiow,527*ratioh,500*ratiow,537*ratioh,506*ratiow,549*ratioh,508*ratiow,561*ratioh,506*ratiow,573*ratioh,504*ratiow,587*ratioh,502*ratiow,611*ratioh,500*ratiow,626*ratioh,498*ratiow,637*ratioh,499*ratiow,644*ratioh,502*ratiow,648*ratioh,499*ratiow,655*ratioh,490*ratiow,668*ratioh,475*ratiow,681*ratioh,468*ratiow,685*ratioh,458*ratiow,689*ratioh,449*ratiow,694*ratioh,443*ratiow,702*ratioh,438*ratiow,707*ratioh,431*ratiow,711*ratioh,418*ratiow,713*ratioh,395*ratiow,713*ratioh,389*ratiow,714*ratioh,384*ratiow,714*ratioh,379*ratiow,712*ratioh,378*ratiow,707*ratioh,378*ratiow,704*ratioh,375*ratiow,700*ratioh,371*ratiow,698*ratioh,363*ratiow,699*ratioh,355*ratiow,699*ratioh,351*ratiow,697*ratioh,347*ratiow,691*ratioh,341*ratiow,686*ratioh,334*ratiow,685*ratioh,330*ratiow,686*ratioh,326*ratiow,688*ratioh,322*ratiow,693*ratioh,317*ratiow,700*ratioh,315*ratiow,706*ratioh,314*ratiow,712*ratioh,313*ratiow,715*ratioh,307*ratiow,713*ratioh,302*ratiow,711*ratioh,294*ratiow,710*ratioh,290*ratiow,710*ratioh,296*ratiow,705*ratioh,303*ratiow,698*ratioh,308*ratiow,692*ratioh,311*ratiow,687*ratioh,313*ratiow,680*ratioh,313*ratiow,673*ratioh,313*ratiow,666*ratioh,312*ratiow,659*ratioh,310*ratiow,652*ratioh,309*ratiow,646*ratioh,307*ratiow,644*ratioh,302*ratiow,643*ratioh,300*ratiow,641*ratioh,343*ratiow,626*ratioh,345*ratiow,634*ratioh,348*ratiow,640*ratioh,354*ratiow,648*ratioh,363*ratiow,653*ratioh,371*ratiow,656*ratioh,379*ratiow,658*ratioh,389*ratiow,658*ratioh,398*ratiow,655*ratioh,405*ratiow,652*ratioh,422*ratiow,644*ratioh,428*ratiow,639*ratioh,433*ratiow,633*ratioh,438*ratiow,628*ratioh,443*ratiow,620*ratioh,447*ratiow,612*ratioh,456*ratiow,588*ratioh,458*ratiow,579*ratioh,460*ratiow,569*ratioh,462*ratiow,555*ratioh,463*ratiow,544*ratioh,464*ratiow,534*ratioh,465*ratiow,524*ratioh,465*ratiow,499*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(463*ratiow,495*ratioh,463*ratiow,478*ratioh,462*ratiow,452*ratioh,461*ratiow,437*ratioh,459*ratiow,413*ratioh,457*ratiow,396*ratioh,454*ratiow,383*ratioh,451*ratiow,374*ratioh,448*ratiow,365*ratioh,444*ratiow,356*ratioh,440*ratiow,349*ratioh,435*ratiow,343*ratioh,426*ratiow,332*ratioh,404*ratiow,302*ratioh,393*ratiow,286*ratioh,387*ratiow,282*ratioh,381*ratiow,277*ratioh,374*ratiow,273*ratioh,369*ratiow,270*ratioh,359*ratiow,267*ratioh,336*ratiow,267*ratioh,319*ratiow,271*ratioh,293*ratiow,281*ratioh,274*ratiow,292*ratioh,255*ratiow,306*ratioh,244*ratiow,322*ratioh,238*ratiow,334*ratioh,235*ratiow,345*ratioh,233*ratiow,356*ratioh,231*ratiow,368*ratioh,229*ratiow,384*ratioh,229*ratiow,407*ratioh,230*ratiow,425*ratioh,232*ratiow,439*ratioh,235*ratiow,451*ratioh,238*ratiow,463*ratioh,245*ratiow,482*ratioh,252*ratiow,499*ratioh,264*ratiow,527*ratioh,268*ratiow,543*ratioh,270*ratiow,562*ratioh,272*ratiow,581*ratioh,274*ratiow,597*ratioh,274*ratiow,604*ratioh,292*ratiow,632*ratioh,299*ratiow,641*ratioh,302*ratiow,644*ratioh,307*ratiow,644*ratioh,343*ratiow,626*ratioh,343*ratiow,617*ratioh,346*ratiow,604*ratioh,357*ratiow,588*ratioh,366*ratiow,577*ratioh,375*ratiow,567*ratioh,386*ratiow,556*ratioh,397*ratiow,546*ratioh,421*ratiow,524*ratioh,438*ratiow,513*ratioh,451*ratiow,505*ratioh,463*ratiow,498*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(251*ratiow,762*ratioh,243*ratiow,759*ratioh,242*ratiow,755*ratioh,239*ratiow,752*ratioh,234*ratiow,747*ratioh,228*ratiow,743*ratioh,220*ratiow,738*ratioh,214*ratiow,732*ratioh,208*ratiow,726*ratioh,204*ratiow,719*ratioh,198*ratiow,712*ratioh,190*ratiow,705*ratioh,183*ratiow,701*ratioh,175*ratiow,700*ratioh,161*ratiow,701*ratioh,156*ratiow,702*ratioh,147*ratiow,707*ratioh,133*ratiow,698*ratioh,118*ratiow,686*ratioh,109*ratiow,676*ratioh,103*ratiow,664*ratioh,99*ratiow,651*ratioh,98*ratiow,640*ratioh,97*ratiow,634*ratioh,109*ratiow,627*ratioh,120*ratiow,623*ratioh,131*ratiow,619*ratioh,139*ratiow,617*ratioh,140*ratiow,619*ratioh,136*ratiow,622*ratioh,132*ratiow,627*ratioh,129*ratiow,634*ratioh,126*ratiow,643*ratioh,125*ratiow,653*ratioh,126*ratiow,662*ratioh,129*ratiow,668*ratioh,132*ratiow,676*ratioh,137*ratiow,681*ratioh,143*ratiow,682*ratioh,150*ratiow,681*ratioh,159*ratiow,677*ratioh,169*ratiow,675*ratioh,177*ratiow,672*ratioh,186*ratiow,671*ratioh,194*ratiow,670*ratioh,201*ratiow,671*ratioh,207*ratiow,676*ratioh,212*ratiow,682*ratioh,215*ratiow,690*ratioh,216*ratiow,699*ratioh,218*ratiow,704*ratioh,222*ratiow,709*ratioh,227*ratiow,714*ratioh,234*ratiow,718*ratioh,241*ratiow,722*ratioh,246*ratiow,727*ratioh,250*ratiow,732*ratioh,252*ratiow,738*ratioh,252*ratiow,746*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(262*ratiow,747*ratioh,260*ratiow,755*ratioh,258*ratiow,765*ratioh,252*ratiow,762*ratioh,252*ratiow,737*ratioh,249*ratiow,730*ratioh,243*ratiow,724*ratioh,237*ratiow,720*ratioh,223*ratiow,711*ratioh,219*ratiow,706*ratioh,217*ratiow,699*ratioh,215*ratiow,691*ratioh,212*ratiow,684*ratioh,210*ratiow,679*ratioh,204*ratiow,674*ratioh,199*ratiow,671*ratioh,193*ratiow,670*ratioh,181*ratiow,671*ratioh,170*ratiow,674*ratioh,147*ratiow,681*ratioh,142*ratiow,682*ratioh,135*ratiow,679*ratioh,129*ratiow,671*ratioh,127*ratiow,662*ratioh,125*ratiow,653*ratioh,125*ratiow,643*ratioh,127*ratiow,636*ratioh,131*ratiow,629*ratioh,135*ratiow,623*ratioh,141*ratiow,618*ratioh,143*ratiow,620*ratioh,143*ratiow,623*ratioh,142*ratiow,628*ratioh,139*ratiow,632*ratioh,136*ratiow,638*ratioh,136*ratiow,647*ratioh,137*ratiow,654*ratioh,140*ratiow,661*ratioh,145*ratiow,665*ratioh,159*ratiow,664*ratioh,171*ratiow,660*ratioh,179*ratiow,658*ratioh,187*ratiow,658*ratioh,195*ratiow,659*ratioh,212*ratiow,661*ratioh,220*ratiow,663*ratioh,225*ratiow,667*ratioh,228*ratiow,673*ratioh,230*ratiow,679*ratioh,231*ratiow,687*ratioh,232*ratiow,694*ratioh,233*ratiow,703*ratioh,238*ratiow,709*ratioh,243*ratiow,714*ratioh,250*ratiow,717*ratioh,256*ratiow,721*ratioh,260*ratiow,727*ratioh,261*ratiow,733*ratioh,262*ratiow,739*ratioh,262*ratiow,747*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(263*ratiow,744*ratioh,268*ratiow,737*ratioh,274*ratiow,726*ratioh,280*ratiow,719*ratioh,286*ratiow,714*ratioh,291*ratiow,709*ratioh,286*ratiow,709*ratioh,280*ratiow,707*ratioh,275*ratiow,700*ratioh,271*ratiow,694*ratioh,266*ratiow,686*ratioh,260*ratiow,678*ratioh,254*ratiow,670*ratioh,250*ratiow,662*ratioh,243*ratiow,650*ratioh,237*ratiow,644*ratioh,231*ratiow,640*ratioh,225*ratiow,637*ratioh,217*ratiow,634*ratioh,212*ratiow,631*ratioh,209*ratiow,624*ratioh,212*ratiow,609*ratioh,216*ratiow,600*ratioh,217*ratiow,596*ratioh,212*ratiow,599*ratioh,201*ratiow,604*ratioh,189*ratiow,609*ratioh,178*ratiow,612*ratioh,161*ratiow,614*ratioh,146*ratiow,615*ratioh,141*ratiow,617*ratioh,140*ratiow,619*ratioh,143*ratiow,622*ratioh,142*ratiow,626*ratioh,139*ratiow,632*ratioh,137*ratiow,637*ratioh,136*ratiow,647*ratioh,137*ratiow,656*ratioh,141*ratiow,663*ratioh,149*ratiow,665*ratioh,160*ratiow,664*ratioh,167*ratiow,661*ratioh,175*ratiow,659*ratioh,182*ratiow,658*ratioh,192*ratiow,658*ratioh,217*ratiow,662*ratioh,224*ratiow,666*ratioh,227*ratiow,672*ratioh,230*ratiow,680*ratioh,232*ratiow,695*ratioh,233*ratiow,702*ratioh,237*ratiow,708*ratioh,242*ratiow,713*ratioh,249*ratiow,717*ratioh,255*ratiow,720*ratioh,259*ratiow,725*ratioh,261*ratiow,733*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(138*ratiow,193*ratioh,69*ratiow,91*ratioh,41*ratiow,46*ratioh,29*ratiow,27*ratioh,21*ratiow,36*ratioh,15*ratiow,45*ratioh,9*ratiow,54*ratioh,4*ratiow,66*ratioh,1*ratiow,75*ratioh,2*ratiow,166*ratioh,86*ratiow,194*ratioh,126*ratiow,206*ratioh,129*ratiow,201*ratioh,133*ratiow,199*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(125*ratiow,206*ratioh,63*ratiow,186*ratioh,17*ratiow,172*ratioh,1*ratiow,166*ratioh,1*ratiow,305*ratioh,4*ratiow,311*ratioh,8*ratiow,316*ratioh,10*ratiow,318*ratioh,5*ratiow,321*ratioh,7*ratiow,326*ratioh,5*ratiow,330*ratioh,4*ratiow,334*ratioh,20*ratiow,331*ratioh,42*ratiow,323*ratioh,53*ratiow,314*ratioh,67*ratiow,303*ratioh,78*ratiow,292*ratioh,89*ratiow,281*ratioh,98*ratiow,268*ratioh,106*ratiow,251*ratioh,112*ratiow,234*ratioh,117*ratiow,220*ratioh,120*ratiow,212*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(88*ratiow,498*ratioh,98*ratiow,503*ratioh,109*ratiow,510*ratioh,123*ratiow,519*ratioh,145*ratiow,537*ratioh,166*ratiow,557*ratioh,185*ratiow,576*ratioh,200*ratiow,595*ratioh,206*ratiow,608*ratioh,209*ratiow,620*ratioh,207*ratiow,632*ratioh,202*ratiow,643*ratioh,193*ratiow,651*ratioh,181*ratiow,656*ratioh,166*ratiow,659*ratioh,151*ratiow,655*ratioh,134*ratiow,646*ratioh,125*ratiow,640*ratioh,114*ratiow,630*ratioh,106*ratiow,615*ratioh,99*ratiow,601*ratioh,96*ratiow,590*ratioh,91*ratiow,571*ratioh,89*ratiow,553*ratioh,86*ratiow,534*ratioh,85*ratiow,516*ratioh,86*ratiow,502*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(79*ratiow,499*ratioh,75*ratiow,501*ratioh,69*ratiow,507*ratioh,61*ratiow,517*ratioh,55*ratiow,527*ratioh,51*ratiow,537*ratioh,45*ratiow,549*ratioh,43*ratiow,561*ratioh,45*ratiow,573*ratioh,47*ratiow,587*ratioh,49*ratiow,611*ratioh,51*ratiow,626*ratioh,53*ratiow,637*ratioh,52*ratiow,644*ratioh,49*ratiow,648*ratioh,52*ratiow,655*ratioh,61*ratiow,668*ratioh,76*ratiow,681*ratioh,83*ratiow,685*ratioh,93*ratiow,689*ratioh,102*ratiow,694*ratioh,108*ratiow,702*ratioh,113*ratiow,707*ratioh,120*ratiow,711*ratioh,133*ratiow,713*ratioh,156*ratiow,713*ratioh,162*ratiow,714*ratioh,167*ratiow,714*ratioh,172*ratiow,712*ratioh,173*ratiow,707*ratioh,173*ratiow,704*ratioh,176*ratiow,700*ratioh,180*ratiow,698*ratioh,188*ratiow,699*ratioh,196*ratiow,699*ratioh,200*ratiow,697*ratioh,204*ratiow,691*ratioh,210*ratiow,686*ratioh,217*ratiow,685*ratioh,221*ratiow,686*ratioh,225*ratiow,688*ratioh,229*ratiow,693*ratioh,234*ratiow,700*ratioh,236*ratiow,706*ratioh,237*ratiow,712*ratioh,238*ratiow,715*ratioh,244*ratiow,713*ratioh,249*ratiow,711*ratioh,257*ratiow,710*ratioh,261*ratiow,710*ratioh,255*ratiow,705*ratioh,248*ratiow,698*ratioh,243*ratiow,692*ratioh,240*ratiow,687*ratioh,238*ratiow,680*ratioh,238*ratiow,673*ratioh,238*ratiow,666*ratioh,239*ratiow,659*ratioh,241*ratiow,652*ratioh,242*ratiow,646*ratioh,244*ratiow,644*ratioh,249*ratiow,643*ratioh,251*ratiow,641*ratioh,208*ratiow,626*ratioh,206*ratiow,634*ratioh,203*ratiow,640*ratioh,197*ratiow,648*ratioh,188*ratiow,653*ratioh,180*ratiow,656*ratioh,172*ratiow,658*ratioh,162*ratiow,658*ratioh,153*ratiow,655*ratioh,146*ratiow,652*ratioh,129*ratiow,644*ratioh,123*ratiow,639*ratioh,118*ratiow,633*ratioh,113*ratiow,628*ratioh,108*ratiow,620*ratioh,104*ratiow,612*ratioh,95*ratiow,588*ratioh,93*ratiow,579*ratioh,91*ratiow,569*ratioh,89*ratiow,555*ratioh,88*ratiow,544*ratioh,87*ratiow,534*ratioh,86*ratiow,524*ratioh,86*ratiow,499*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(88*ratiow,495*ratioh,88*ratiow,478*ratioh,89*ratiow,452*ratioh,90*ratiow,437*ratioh,92*ratiow,413*ratioh,94*ratiow,396*ratioh,97*ratiow,383*ratioh,100*ratiow,374*ratioh,103*ratiow,365*ratioh,107*ratiow,356*ratioh,111*ratiow,349*ratioh,116*ratiow,343*ratioh,125*ratiow,332*ratioh,147*ratiow,302*ratioh,158*ratiow,286*ratioh,164*ratiow,282*ratioh,170*ratiow,277*ratioh,177*ratiow,273*ratioh,182*ratiow,270*ratioh,192*ratiow,267*ratioh,215*ratiow,267*ratioh,232*ratiow,271*ratioh,258*ratiow,281*ratioh,277*ratiow,292*ratioh,296*ratiow,306*ratioh,307*ratiow,322*ratioh,313*ratiow,334*ratioh,316*ratiow,345*ratioh,318*ratiow,356*ratioh,320*ratiow,368*ratioh,322*ratiow,384*ratioh,322*ratiow,407*ratioh,321*ratiow,425*ratioh,319*ratiow,439*ratioh,316*ratiow,451*ratioh,313*ratiow,463*ratioh,306*ratiow,482*ratioh,299*ratiow,499*ratioh,287*ratiow,527*ratioh,283*ratiow,543*ratioh,281*ratiow,562*ratioh,279*ratiow,581*ratioh,277*ratiow,597*ratioh,277*ratiow,604*ratioh,259*ratiow,632*ratioh,252*ratiow,641*ratioh,249*ratiow,644*ratioh,244*ratiow,644*ratioh,208*ratiow,626*ratioh,208*ratiow,617*ratioh,205*ratiow,604*ratioh,194*ratiow,588*ratioh,185*ratiow,577*ratioh,176*ratiow,567*ratioh,165*ratiow,556*ratioh,154*ratiow,546*ratioh,130*ratiow,524*ratioh,113*ratiow,513*ratioh,100*ratiow,505*ratioh,88*ratiow,498*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(300*ratiow,762*ratioh,308*ratiow,759*ratioh,309*ratiow,755*ratioh,312*ratiow,752*ratioh,317*ratiow,747*ratioh,323*ratiow,743*ratioh,331*ratiow,738*ratioh,337*ratiow,732*ratioh,343*ratiow,726*ratioh,347*ratiow,719*ratioh,353*ratiow,712*ratioh,361*ratiow,705*ratioh,368*ratiow,701*ratioh,376*ratiow,700*ratioh,390*ratiow,701*ratioh,395*ratiow,702*ratioh,404*ratiow,707*ratioh,418*ratiow,698*ratioh,433*ratiow,686*ratioh,442*ratiow,676*ratioh,448*ratiow,664*ratioh,452*ratiow,651*ratioh,453*ratiow,640*ratioh,454*ratiow,634*ratioh,442*ratiow,627*ratioh,431*ratiow,623*ratioh,420*ratiow,619*ratioh,412*ratiow,617*ratioh,411*ratiow,619*ratioh,415*ratiow,622*ratioh,419*ratiow,627*ratioh,422*ratiow,634*ratioh,425*ratiow,643*ratioh,426*ratiow,653*ratioh,425*ratiow,662*ratioh,422*ratiow,668*ratioh,419*ratiow,676*ratioh,414*ratiow,681*ratioh,408*ratiow,682*ratioh,401*ratiow,681*ratioh,392*ratiow,677*ratioh,382*ratiow,675*ratioh,374*ratiow,672*ratioh,365*ratiow,671*ratioh,357*ratiow,670*ratioh,350*ratiow,671*ratioh,344*ratiow,676*ratioh,339*ratiow,682*ratioh,336*ratiow,690*ratioh,335*ratiow,699*ratioh,333*ratiow,704*ratioh,329*ratiow,709*ratioh,324*ratiow,714*ratioh,317*ratiow,718*ratioh,310*ratiow,722*ratioh,305*ratiow,727*ratioh,301*ratiow,732*ratioh,299*ratiow,738*ratioh,299*ratiow,746*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(289*ratiow,747*ratioh,291*ratiow,755*ratioh,293*ratiow,765*ratioh,299*ratiow,762*ratioh,299*ratiow,737*ratioh,302*ratiow,730*ratioh,308*ratiow,724*ratioh,314*ratiow,720*ratioh,328*ratiow,711*ratioh,332*ratiow,706*ratioh,334*ratiow,699*ratioh,336*ratiow,691*ratioh,339*ratiow,684*ratioh,341*ratiow,679*ratioh,347*ratiow,674*ratioh,352*ratiow,671*ratioh,358*ratiow,670*ratioh,370*ratiow,671*ratioh,381*ratiow,674*ratioh,404*ratiow,681*ratioh,409*ratiow,682*ratioh,416*ratiow,679*ratioh,422*ratiow,671*ratioh,424*ratiow,662*ratioh,426*ratiow,653*ratioh,426*ratiow,643*ratioh,424*ratiow,636*ratioh,420*ratiow,629*ratioh,416*ratiow,623*ratioh,410*ratiow,618*ratioh,408*ratiow,620*ratioh,408*ratiow,623*ratioh,409*ratiow,628*ratioh,412*ratiow,632*ratioh,415*ratiow,638*ratioh,415*ratiow,647*ratioh,414*ratiow,654*ratioh,411*ratiow,661*ratioh,406*ratiow,665*ratioh,392*ratiow,664*ratioh,380*ratiow,660*ratioh,372*ratiow,658*ratioh,364*ratiow,658*ratioh,356*ratiow,659*ratioh,339*ratiow,661*ratioh,331*ratiow,663*ratioh,326*ratiow,667*ratioh,323*ratiow,673*ratioh,321*ratiow,679*ratioh,320*ratiow,687*ratioh,319*ratiow,694*ratioh,318*ratiow,703*ratioh,313*ratiow,709*ratioh,308*ratiow,714*ratioh,301*ratiow,717*ratioh,295*ratiow,721*ratioh,291*ratiow,727*ratioh,290*ratiow,733*ratioh,289*ratiow,739*ratioh,289*ratiow,747*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(288*ratiow,744*ratioh,283*ratiow,737*ratioh,277*ratiow,726*ratioh,271*ratiow,719*ratioh,265*ratiow,714*ratioh,260*ratiow,709*ratioh,265*ratiow,709*ratioh,271*ratiow,707*ratioh,276*ratiow,700*ratioh,280*ratiow,694*ratioh,285*ratiow,686*ratioh,291*ratiow,678*ratioh,297*ratiow,670*ratioh,301*ratiow,662*ratioh,308*ratiow,650*ratioh,314*ratiow,644*ratioh,320*ratiow,640*ratioh,326*ratiow,637*ratioh,334*ratiow,634*ratioh,339*ratiow,631*ratioh,342*ratiow,624*ratioh,339*ratiow,609*ratioh,335*ratiow,600*ratioh,334*ratiow,596*ratioh,339*ratiow,599*ratioh,350*ratiow,604*ratioh,362*ratiow,609*ratioh,373*ratiow,612*ratioh,390*ratiow,614*ratioh,405*ratiow,615*ratioh,410*ratiow,617*ratioh,411*ratiow,619*ratioh,408*ratiow,622*ratioh,409*ratiow,626*ratioh,412*ratiow,632*ratioh,414*ratiow,637*ratioh,415*ratiow,647*ratioh,414*ratiow,656*ratioh,410*ratiow,663*ratioh,402*ratiow,665*ratioh,391*ratiow,664*ratioh,384*ratiow,661*ratioh,376*ratiow,659*ratioh,369*ratiow,658*ratioh,359*ratiow,658*ratioh,334*ratiow,662*ratioh,327*ratiow,666*ratioh,324*ratiow,672*ratioh,321*ratiow,680*ratioh,319*ratiow,695*ratioh,318*ratiow,702*ratioh,314*ratiow,708*ratioh,309*ratiow,713*ratioh,302*ratiow,717*ratioh,296*ratiow,720*ratioh,292*ratiow,725*ratioh,290*ratiow,733*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile17(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 568;
var baseHeight = 801;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, AcbC, AcbSh, CPu, Pir1, Pir2, Pir3, aca";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(424*ratiow,202*ratioh,440*ratiow,174*ratioh,471*ratiow,121*ratioh,493*ratiow,83*ratioh,517*ratiow,42*ratioh,526*ratiow,25*ratioh,536*ratiow,33*ratioh,545*ratiow,45*ratioh,551*ratiow,53*ratioh,558*ratiow,68*ratioh,563*ratiow,85*ratioh,565*ratiow,98*ratioh,567*ratiow,114*ratioh,567*ratiow,164*ratioh,517*ratiow,182*ratioh,452*ratiow,204*ratioh,433*ratiow,210*ratioh,428*ratiow,205*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(433*ratiow,210*ratioh,465*ratiow,200*ratioh,516*ratiow,182*ratioh,561*ratiow,166*ratioh,567*ratiow,164*ratioh,567*ratiow,294*ratioh,564*ratiow,303*ratioh,561*ratiow,308*ratioh,558*ratiow,310*ratioh,562*ratiow,313*ratioh,564*ratiow,317*ratioh,563*ratiow,321*ratioh,563*ratiow,326*ratioh,563*ratiow,328*ratioh,544*ratiow,326*ratioh,521*ratiow,321*ratioh,516*ratiow,319*ratioh,506*ratiow,309*ratioh,494*ratiow,298*ratioh,480*ratiow,287*ratioh,466*ratiow,271*ratioh,452*ratiow,248*ratioh,439*ratiow,224*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(484*ratiow,511*ratioh,470*ratiow,524*ratioh,439*ratiow,549*ratioh,405*ratiow,575*ratioh,384*ratiow,593*ratioh,370*ratiow,607*ratioh,361*ratiow,622*ratioh,358*ratiow,636*ratioh,360*ratiow,651*ratioh,370*ratiow,663*ratioh,384*ratiow,670*ratioh,397*ratiow,673*ratioh,413*ratiow,672*ratioh,430*ratiow,664*ratioh,451*ratiow,650*ratioh,470*ratiow,631*ratioh,480*ratiow,613*ratioh,485*ratiow,588*ratioh,486*ratiow,559*ratioh,484*ratiow,536*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(319*ratiow,658*ratioh,359*ratiow,646*ratioh,364*ratiow,657*ratioh,376*ratiow,667*ratioh,396*ratiow,673*ratioh,411*ratiow,672*ratioh,424*ratiow,668*ratioh,449*ratiow,651*ratioh,464*ratiow,638*ratioh,477*ratiow,618*ratioh,484*ratiow,597*ratioh,486*ratiow,566*ratioh,483*ratiow,539*ratioh,484*ratiow,511*ratioh,488*ratiow,508*ratioh,496*ratiow,508*ratioh,504*ratiow,515*ratioh,513*ratiow,528*ratioh,520*ratiow,546*ratioh,528*ratiow,569*ratioh,532*ratiow,589*ratioh,534*ratiow,618*ratioh,533*ratiow,629*ratioh,526*ratiow,642*ratioh,517*ratiow,664*ratioh,510*ratiow,682*ratioh,489*ratiow,705*ratioh,473*ratiow,723*ratioh,455*ratiow,732*ratioh,439*ratiow,731*ratioh,424*ratiow,724*ratioh,413*ratiow,720*ratioh,376*ratiow,718*ratioh,344*ratiow,713*ratioh,333*ratiow,710*ratioh,335*ratiow,704*ratioh,334*ratiow,692*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(319*ratiow,657*ratioh,359*ratiow,645*ratioh,358*ratiow,640*ratioh,359*ratiow,631*ratioh,361*ratiow,623*ratioh,364*ratiow,617*ratioh,378*ratiow,599*ratioh,408*ratiow,572*ratioh,431*ratiow,555*ratioh,468*ratiow,526*ratioh,479*ratiow,515*ratioh,478*ratiow,491*ratioh,477*ratiow,471*ratioh,473*ratiow,428*ratioh,467*ratiow,388*ratioh,460*ratiow,366*ratioh,450*ratiow,349*ratioh,445*ratiow,339*ratioh,421*ratiow,312*ratioh,402*ratiow,295*ratioh,389*ratiow,286*ratioh,362*ratiow,276*ratioh,338*ratiow,275*ratioh,318*ratiow,278*ratioh,299*ratiow,286*ratioh,282*ratiow,296*ratioh,266*ratiow,309*ratioh,252*ratiow,322*ratioh,238*ratiow,343*ratioh,227*ratiow,365*ratioh,223*ratiow,401*ratioh,227*ratiow,451*ratioh,232*ratiow,469*ratioh,243*ratiow,496*ratioh,255*ratiow,528*ratioh,266*ratiow,554*ratioh,271*ratiow,579*ratioh,275*ratiow,599*ratioh,283*ratiow,615*ratioh,285*ratiow,621*ratioh,293*ratiow,625*ratioh,306*ratiow,639*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(248*ratiow,765*ratioh,232*ratiow,753*ratioh,214*ratiow,735*ratioh,205*ratiow,728*ratioh,198*ratiow,725*ratioh,179*ratiow,725*ratioh,166*ratiow,727*ratioh,154*ratiow,732*ratioh,141*ratiow,722*ratioh,124*ratiow,706*ratioh,115*ratiow,695*ratioh,108*ratiow,683*ratioh,102*ratiow,656*ratioh,94*ratiow,639*ratioh,110*ratiow,637*ratioh,125*ratiow,637*ratioh,135*ratiow,639*ratioh,141*ratiow,642*ratioh,138*ratiow,648*ratioh,134*ratiow,661*ratioh,133*ratiow,677*ratioh,138*ratiow,691*ratioh,150*ratiow,700*ratioh,159*ratiow,701*ratioh,172*ratiow,698*ratioh,191*ratiow,692*ratioh,202*ratiow,689*ratioh,209*ratiow,689*ratioh,217*ratiow,691*ratioh,226*ratiow,700*ratioh,230*ratiow,708*ratioh,235*ratiow,723*ratioh,239*ratiow,734*ratioh,245*ratiow,740*ratioh,254*ratiow,743*ratioh,261*ratiow,744*ratioh,250*ratiow,758*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(261*ratiow,743*ratioh,251*ratiow,742*ratioh,242*ratiow,738*ratioh,235*ratiow,726*ratioh,231*ratiow,709*ratioh,224*ratiow,697*ratioh,216*ratiow,691*ratioh,208*ratiow,689*ratioh,199*ratiow,689*ratioh,184*ratiow,694*ratioh,165*ratiow,700*ratioh,156*ratiow,701*ratioh,145*ratiow,697*ratioh,137*ratiow,689*ratioh,133*ratiow,677*ratioh,134*ratiow,659*ratioh,137*ratiow,646*ratioh,141*ratiow,642*ratioh,147*ratiow,643*ratioh,146*ratiow,658*ratioh,145*ratiow,674*ratioh,150*ratiow,684*ratioh,161*ratiow,689*ratioh,172*ratiow,688*ratioh,190*ratiow,683*ratioh,205*ratiow,680*ratioh,222*ratiow,681*ratioh,234*ratiow,687*ratioh,244*ratiow,699*ratioh,252*ratiow,711*ratioh,261*ratiow,725*ratioh,266*ratiow,731*ratioh,270*ratiow,736*ratioh,261*ratiow,743*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(270*ratiow,736*ratioh,263*ratiow,728*ratioh,255*ratiow,715*ratioh,246*ratiow,702*ratioh,238*ratiow,690*ratioh,230*ratiow,684*ratioh,217*ratiow,680*ratioh,202*ratiow,680*ratioh,183*ratiow,684*ratioh,168*ratiow,689*ratioh,160*ratiow,688*ratioh,151*ratiow,684*ratioh,145*ratiow,678*ratioh,145*ratiow,661*ratioh,146*ratiow,647*ratioh,145*ratiow,643*ratioh,168*ratiow,639*ratioh,191*ratiow,633*ratioh,203*ratiow,628*ratioh,202*ratiow,640*ratioh,208*ratiow,653*ratioh,215*ratiow,657*ratioh,229*ratiow,659*ratioh,239*ratiow,663*ratioh,249*ratiow,670*ratioh,258*ratiow,680*ratioh,266*ratiow,691*ratioh,271*ratiow,703*ratioh,275*ratiow,712*ratioh,281*ratiow,718*ratioh,293*ratiow,723*ratioh,284*ratiow,727*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(406*ratiow,648*ratioh,400*ratiow,647*ratioh,393*ratiow,643*ratioh,387*ratiow,637*ratioh,386*ratiow,628*ratioh,387*ratiow,621*ratioh,392*ratiow,613*ratioh,401*ratiow,607*ratioh,410*ratiow,605*ratioh,418*ratiow,606*ratioh,425*ratiow,610*ratioh,427*ratiow,616*ratioh,425*ratiow,625*ratioh,416*ratiow,642*ratioh,409*ratiow,648*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(144*ratiow,202*ratioh,128*ratiow,174*ratioh,97*ratiow,121*ratioh,75*ratiow,83*ratioh,51*ratiow,42*ratioh,42*ratiow,25*ratioh,32*ratiow,33*ratioh,23*ratiow,45*ratioh,17*ratiow,53*ratioh,10*ratiow,68*ratioh,5*ratiow,85*ratioh,3*ratiow,98*ratioh,1*ratiow,114*ratioh,1*ratiow,164*ratioh,51*ratiow,182*ratioh,116*ratiow,204*ratioh,135*ratiow,210*ratioh,140*ratiow,205*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(135*ratiow,210*ratioh,103*ratiow,200*ratioh,52*ratiow,182*ratioh,7*ratiow,166*ratioh,1*ratiow,164*ratioh,1*ratiow,294*ratioh,4*ratiow,303*ratioh,7*ratiow,308*ratioh,10*ratiow,310*ratioh,6*ratiow,313*ratioh,4*ratiow,317*ratioh,5*ratiow,321*ratioh,5*ratiow,326*ratioh,5*ratiow,328*ratioh,24*ratiow,326*ratioh,47*ratiow,321*ratioh,52*ratiow,319*ratioh,62*ratiow,309*ratioh,74*ratiow,298*ratioh,88*ratiow,287*ratioh,102*ratiow,271*ratioh,116*ratiow,248*ratioh,129*ratiow,224*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(84*ratiow,511*ratioh,98*ratiow,524*ratioh,129*ratiow,549*ratioh,163*ratiow,575*ratioh,184*ratiow,593*ratioh,198*ratiow,607*ratioh,207*ratiow,622*ratioh,210*ratiow,636*ratioh,208*ratiow,651*ratioh,198*ratiow,663*ratioh,184*ratiow,670*ratioh,171*ratiow,673*ratioh,155*ratiow,672*ratioh,138*ratiow,664*ratioh,117*ratiow,650*ratioh,98*ratiow,631*ratioh,88*ratiow,613*ratioh,83*ratiow,588*ratioh,82*ratiow,559*ratioh,84*ratiow,536*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(249*ratiow,658*ratioh,209*ratiow,646*ratioh,204*ratiow,657*ratioh,192*ratiow,667*ratioh,172*ratiow,673*ratioh,157*ratiow,672*ratioh,144*ratiow,668*ratioh,119*ratiow,651*ratioh,104*ratiow,638*ratioh,91*ratiow,618*ratioh,84*ratiow,597*ratioh,82*ratiow,566*ratioh,85*ratiow,539*ratioh,84*ratiow,511*ratioh,80*ratiow,508*ratioh,72*ratiow,508*ratioh,64*ratiow,515*ratioh,55*ratiow,528*ratioh,48*ratiow,546*ratioh,40*ratiow,569*ratioh,36*ratiow,589*ratioh,34*ratiow,618*ratioh,35*ratiow,629*ratioh,42*ratiow,642*ratioh,51*ratiow,664*ratioh,58*ratiow,682*ratioh,79*ratiow,705*ratioh,95*ratiow,723*ratioh,113*ratiow,732*ratioh,129*ratiow,731*ratioh,144*ratiow,724*ratioh,155*ratiow,720*ratioh,192*ratiow,718*ratioh,224*ratiow,713*ratioh,235*ratiow,710*ratioh,233*ratiow,704*ratioh,234*ratiow,692*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(249*ratiow,657*ratioh,209*ratiow,645*ratioh,210*ratiow,640*ratioh,209*ratiow,631*ratioh,207*ratiow,623*ratioh,204*ratiow,617*ratioh,190*ratiow,599*ratioh,160*ratiow,572*ratioh,137*ratiow,555*ratioh,100*ratiow,526*ratioh,89*ratiow,515*ratioh,90*ratiow,491*ratioh,91*ratiow,471*ratioh,95*ratiow,428*ratioh,101*ratiow,388*ratioh,108*ratiow,366*ratioh,118*ratiow,349*ratioh,123*ratiow,339*ratioh,147*ratiow,312*ratioh,166*ratiow,295*ratioh,179*ratiow,286*ratioh,206*ratiow,276*ratioh,230*ratiow,275*ratioh,250*ratiow,278*ratioh,269*ratiow,286*ratioh,286*ratiow,296*ratioh,302*ratiow,309*ratioh,316*ratiow,322*ratioh,330*ratiow,343*ratioh,341*ratiow,365*ratioh,345*ratiow,401*ratioh,341*ratiow,451*ratioh,336*ratiow,469*ratioh,325*ratiow,496*ratioh,313*ratiow,528*ratioh,302*ratiow,554*ratioh,297*ratiow,579*ratioh,293*ratiow,599*ratioh,285*ratiow,615*ratioh,283*ratiow,621*ratioh,275*ratiow,625*ratioh,262*ratiow,639*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(320*ratiow,765*ratioh,336*ratiow,753*ratioh,354*ratiow,735*ratioh,363*ratiow,728*ratioh,370*ratiow,725*ratioh,389*ratiow,725*ratioh,402*ratiow,727*ratioh,414*ratiow,732*ratioh,427*ratiow,722*ratioh,444*ratiow,706*ratioh,453*ratiow,695*ratioh,460*ratiow,683*ratioh,466*ratiow,656*ratioh,474*ratiow,639*ratioh,458*ratiow,637*ratioh,443*ratiow,637*ratioh,433*ratiow,639*ratioh,427*ratiow,642*ratioh,430*ratiow,648*ratioh,434*ratiow,661*ratioh,435*ratiow,677*ratioh,430*ratiow,691*ratioh,418*ratiow,700*ratioh,409*ratiow,701*ratioh,396*ratiow,698*ratioh,377*ratiow,692*ratioh,366*ratiow,689*ratioh,359*ratiow,689*ratioh,351*ratiow,691*ratioh,342*ratiow,700*ratioh,338*ratiow,708*ratioh,333*ratiow,723*ratioh,329*ratiow,734*ratioh,323*ratiow,740*ratioh,314*ratiow,743*ratioh,307*ratiow,744*ratioh,318*ratiow,758*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(307*ratiow,743*ratioh,317*ratiow,742*ratioh,326*ratiow,738*ratioh,333*ratiow,726*ratioh,337*ratiow,709*ratioh,344*ratiow,697*ratioh,352*ratiow,691*ratioh,360*ratiow,689*ratioh,369*ratiow,689*ratioh,384*ratiow,694*ratioh,403*ratiow,700*ratioh,412*ratiow,701*ratioh,423*ratiow,697*ratioh,431*ratiow,689*ratioh,435*ratiow,677*ratioh,434*ratiow,659*ratioh,431*ratiow,646*ratioh,427*ratiow,642*ratioh,421*ratiow,643*ratioh,422*ratiow,658*ratioh,423*ratiow,674*ratioh,418*ratiow,684*ratioh,407*ratiow,689*ratioh,396*ratiow,688*ratioh,378*ratiow,683*ratioh,363*ratiow,680*ratioh,346*ratiow,681*ratioh,334*ratiow,687*ratioh,324*ratiow,699*ratioh,316*ratiow,711*ratioh,307*ratiow,725*ratioh,302*ratiow,731*ratioh,298*ratiow,736*ratioh,307*ratiow,743*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(298*ratiow,736*ratioh,305*ratiow,728*ratioh,313*ratiow,715*ratioh,322*ratiow,702*ratioh,330*ratiow,690*ratioh,338*ratiow,684*ratioh,351*ratiow,680*ratioh,366*ratiow,680*ratioh,385*ratiow,684*ratioh,400*ratiow,689*ratioh,408*ratiow,688*ratioh,417*ratiow,684*ratioh,423*ratiow,678*ratioh,423*ratiow,661*ratioh,422*ratiow,647*ratioh,423*ratiow,643*ratioh,400*ratiow,639*ratioh,377*ratiow,633*ratioh,365*ratiow,628*ratioh,366*ratiow,640*ratioh,360*ratiow,653*ratioh,353*ratiow,657*ratioh,339*ratiow,659*ratioh,329*ratiow,663*ratioh,319*ratiow,670*ratioh,310*ratiow,680*ratioh,302*ratiow,691*ratioh,297*ratiow,703*ratioh,293*ratiow,712*ratioh,287*ratiow,718*ratioh,275*ratiow,723*ratioh,284*ratiow,727*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(162*ratiow,648*ratioh,168*ratiow,647*ratioh,175*ratiow,643*ratioh,181*ratiow,637*ratioh,182*ratiow,628*ratioh,181*ratiow,621*ratioh,176*ratiow,613*ratioh,167*ratiow,607*ratioh,158*ratiow,605*ratioh,150*ratiow,606*ratioh,143*ratiow,610*ratioh,141*ratiow,616*ratioh,143*ratiow,625*ratioh,152*ratiow,642*ratioh,159*ratiow,648*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile18(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 558;
var baseHeight = 795;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, AcbC, AcbSh, CPu, Pir1, Pir2, Pir3, aca";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(411*ratiow,196*ratioh,435*ratiow,151*ratioh,466*ratiow,96*ratioh,492*ratiow,46*ratioh,507*ratiow,19*ratioh,515*ratiow,24*ratioh,525*ratiow,34*ratioh,537*ratiow,51*ratioh,546*ratiow,69*ratioh,553*ratiow,89*ratioh,557*ratiow,108*ratioh,557*ratiow,170*ratioh,533*ratiow,179*ratioh,481*ratiow,195*ratioh,440*ratiow,208*ratioh,430*ratiow,211*ratioh,426*ratiow,205*ratioh,421*ratiow,200*ratioh,415*ratiow,196*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(429*ratiow,211*ratioh,455*ratiow,203*ratioh,494*ratiow,191*ratioh,538*ratiow,177*ratioh,557*ratiow,170*ratioh,557*ratiow,301*ratioh,555*ratiow,306*ratioh,550*ratiow,309*ratioh,546*ratiow,311*ratioh,553*ratiow,325*ratioh,544*ratiow,325*ratioh,527*ratiow,322*ratioh,504*ratiow,316*ratioh,486*ratiow,305*ratioh,474*ratiow,294*ratioh,463*ratiow,283*ratioh,453*ratiow,266*ratioh,444*ratiow,249*ratioh,438*ratiow,231*ratioh,433*ratiow,216*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(456*ratiow,506*ratioh,458*ratiow,524*ratioh,463*ratiow,516*ratioh,465*ratiow,520*ratioh,465*ratiow,528*ratioh,466*ratiow,546*ratioh,466*ratiow,572*ratioh,461*ratiow,598*ratioh,451*ratiow,625*ratioh,437*ratiow,646*ratioh,423*ratiow,656*ratioh,401*ratiow,668*ratioh,379*ratiow,675*ratioh,360*ratiow,673*ratioh,348*ratiow,668*ratioh,339*ratiow,656*ratioh,336*ratiow,643*ratioh,337*ratiow,629*ratioh,344*ratiow,611*ratioh,359*ratiow,591*ratioh,387*ratiow,565*ratioh,409*ratiow,545*ratioh,445*ratiow,516*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(305*ratiow,651*ratioh,337*ratiow,647*ratioh,344*ratiow,663*ratioh,351*ratiow,669*ratioh,360*ratiow,673*ratioh,377*ratiow,675*ratioh,390*ratiow,672*ratioh,416*ratiow,661*ratioh,434*ratiow,649*ratioh,447*ratiow,631*ratioh,459*ratiow,605*ratioh,465*ratiow,581*ratioh,467*ratiow,545*ratioh,464*ratiow,517*ratioh,463*ratiow,514*ratioh,467*ratiow,505*ratioh,471*ratiow,503*ratioh,475*ratiow,505*ratioh,486*ratiow,514*ratioh,497*ratiow,529*ratioh,506*ratiow,545*ratioh,514*ratiow,563*ratioh,509*ratiow,565*ratioh,511*ratiow,579*ratioh,512*ratiow,603*ratioh,510*ratiow,625*ratioh,512*ratiow,632*ratioh,504*ratiow,638*ratioh,498*ratiow,646*ratioh,498*ratiow,666*ratioh,471*ratiow,700*ratioh,458*ratiow,713*ratioh,446*ratiow,722*ratioh,433*ratiow,727*ratioh,433*ratiow,722*ratioh,427*ratiow,716*ratioh,423*ratiow,714*ratioh,415*ratiow,715*ratioh,400*ratiow,716*ratioh,385*ratiow,709*ratioh,359*ratiow,709*ratioh,352*ratiow,704*ratioh,346*ratiow,701*ratioh,332*ratiow,701*ratioh,326*ratiow,698*ratioh,323*ratiow,693*ratioh,320*ratiow,691*ratioh,315*ratiow,677*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(455*ratiow,506*ratioh,457*ratiow,472*ratioh,458*ratiow,451*ratioh,456*ratiow,419*ratioh,453*ratiow,391*ratioh,450*ratiow,362*ratioh,443*ratiow,344*ratioh,439*ratiow,336*ratioh,422*ratiow,314*ratioh,410*ratiow,306*ratioh,399*ratiow,295*ratioh,393*ratiow,286*ratioh,391*ratiow,281*ratioh,374*ratiow,270*ratioh,355*ratiow,264*ratioh,339*ratiow,263*ratioh,323*ratiow,264*ratioh,300*ratiow,270*ratioh,266*ratiow,289*ratioh,251*ratiow,300*ratioh,232*ratiow,317*ratioh,221*ratiow,332*ratioh,213*ratiow,351*ratioh,208*ratiow,375*ratioh,206*ratiow,402*ratioh,207*ratiow,431*ratioh,213*ratiow,456*ratioh,225*ratiow,487*ratioh,238*ratiow,514*ratioh,244*ratiow,534*ratioh,249*ratiow,557*ratioh,258*ratiow,588*ratioh,267*ratiow,614*ratioh,269*ratiow,617*ratioh,275*ratiow,619*ratioh,285*ratiow,626*ratioh,295*ratiow,635*ratioh,300*ratiow,642*ratioh,305*ratiow,645*ratioh,326*ratiow,640*ratioh,329*ratiow,637*ratioh,335*ratiow,640*ratioh,338*ratiow,627*ratioh,342*ratiow,614*ratioh,357*ratiow,593*ratioh,378*ratiow,573*ratioh,416*ratiow,539*ratioh,450*ratiow,511*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(238*ratiow,733*ratioh,231*ratiow,747*ratioh,228*ratiow,755*ratioh,223*ratiow,751*ratioh,206*ratiow,733*ratioh,194*ratiow,719*ratioh,186*ratiow,712*ratioh,174*ratiow,710*ratioh,162*ratiow,711*ratioh,155*ratiow,713*ratioh,154*ratiow,716*ratioh,156*ratiow,720*ratioh,135*ratiow,708*ratioh,100*ratiow,680*ratioh,87*ratiow,664*ratioh,83*ratiow,653*ratioh,82*ratiow,644*ratioh,82*ratiow,627*ratioh,104*ratiow,624*ratioh,103*ratiow,635*ratioh,111*ratiow,659*ratioh,120*ratiow,673*ratioh,132*ratiow,683*ratioh,150*ratiow,689*ratioh,168*ratiow,686*ratioh,185*ratiow,682*ratioh,200*ratiow,683*ratioh,209*ratiow,691*ratioh,214*ratiow,705*ratioh,219*ratiow,719*ratioh,224*ratiow,727*ratioh,231*ratiow,733*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(248*ratiow,721*ratioh,241*ratiow,730*ratioh,238*ratiow,734*ratioh,230*ratiow,732*ratioh,222*ratiow,725*ratioh,215*ratiow,708*ratioh,210*ratiow,694*ratioh,205*ratiow,687*ratioh,199*ratiow,684*ratioh,191*ratiow,682*ratioh,176*ratiow,684*ratioh,152*ratiow,689*ratioh,140*ratiow,687*ratioh,126*ratiow,678*ratioh,114*ratiow,665*ratioh,108*ratiow,650*ratioh,104*ratiow,635*ratioh,103*ratiow,625*ratioh,107*ratiow,622*ratioh,113*ratiow,628*ratioh,120*ratiow,640*ratioh,128*ratiow,657*ratioh,135*ratiow,665*ratioh,148*ratiow,670*ratioh,164*ratiow,670*ratioh,185*ratiow,664*ratioh,195*ratiow,664*ratioh,205*ratiow,668*ratioh,217*ratiow,681*ratioh,234*ratiow,706*ratioh,241*ratiow,717*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(248*ratiow,721*ratioh,240*ratiow,716*ratioh,227*ratiow,696*ratioh,217*ratiow,680*ratioh,204*ratiow,667*ratioh,194*ratiow,663*ratioh,177*ratiow,666*ratioh,159*ratiow,670*ratioh,144*ratiow,670*ratioh,132*ratiow,663*ratioh,124*ratiow,649*ratioh,116*ratiow,632*ratioh,109*ratiow,625*ratioh,106*ratiow,623*ratioh,132*ratiow,614*ratioh,149*ratiow,604*ratioh,174*ratiow,586*ratioh,193*ratiow,572*ratioh,197*ratiow,568*ratioh,194*ratiow,578*ratioh,190*ratiow,597*ratioh,193*ratiow,618*ratioh,200*ratiow,633*ratioh,209*ratiow,643*ratioh,224*ratiow,653*ratioh,238*ratiow,666*ratioh,252*ratiow,681*ratioh,262*ratiow,697*ratioh,267*ratiow,709*ratioh,255*ratiow,716*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(406*ratiow,610*ratioh,405*ratiow,601*ratioh,402*ratiow,596*ratioh,394*ratiow,594*ratioh,387*ratiow,595*ratioh,377*ratiow,601*ratioh,370*ratiow,610*ratioh,368*ratiow,618*ratioh,368*ratiow,623*ratioh,371*ratiow,629*ratioh,378*ratiow,635*ratioh,384*ratiow,637*ratioh,388*ratiow,637*ratioh,394*ratiow,635*ratioh,402*ratiow,627*ratioh,405*ratiow,619*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(147*ratiow,196*ratioh,123*ratiow,151*ratioh,92*ratiow,96*ratioh,66*ratiow,46*ratioh,51*ratiow,19*ratioh,43*ratiow,24*ratioh,33*ratiow,34*ratioh,21*ratiow,51*ratioh,12*ratiow,69*ratioh,5*ratiow,89*ratioh,1*ratiow,108*ratioh,1*ratiow,170*ratioh,25*ratiow,179*ratioh,77*ratiow,195*ratioh,118*ratiow,208*ratioh,128*ratiow,211*ratioh,132*ratiow,205*ratioh,137*ratiow,200*ratioh,143*ratiow,196*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(129*ratiow,211*ratioh,103*ratiow,203*ratioh,64*ratiow,191*ratioh,20*ratiow,177*ratioh,1*ratiow,170*ratioh,1*ratiow,301*ratioh,3*ratiow,306*ratioh,8*ratiow,309*ratioh,12*ratiow,311*ratioh,5*ratiow,325*ratioh,14*ratiow,325*ratioh,31*ratiow,322*ratioh,54*ratiow,316*ratioh,72*ratiow,305*ratioh,84*ratiow,294*ratioh,95*ratiow,283*ratioh,105*ratiow,266*ratioh,114*ratiow,249*ratioh,120*ratiow,231*ratioh,125*ratiow,216*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(102*ratiow,506*ratioh,100*ratiow,524*ratioh,95*ratiow,516*ratioh,93*ratiow,520*ratioh,93*ratiow,528*ratioh,92*ratiow,546*ratioh,92*ratiow,572*ratioh,97*ratiow,598*ratioh,107*ratiow,625*ratioh,121*ratiow,646*ratioh,135*ratiow,656*ratioh,157*ratiow,668*ratioh,179*ratiow,675*ratioh,198*ratiow,673*ratioh,210*ratiow,668*ratioh,219*ratiow,656*ratioh,222*ratiow,643*ratioh,221*ratiow,629*ratioh,214*ratiow,611*ratioh,199*ratiow,591*ratioh,171*ratiow,565*ratioh,149*ratiow,545*ratioh,113*ratiow,516*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(253*ratiow,651*ratioh,221*ratiow,647*ratioh,214*ratiow,663*ratioh,207*ratiow,669*ratioh,198*ratiow,673*ratioh,181*ratiow,675*ratioh,168*ratiow,672*ratioh,142*ratiow,661*ratioh,124*ratiow,649*ratioh,111*ratiow,631*ratioh,99*ratiow,605*ratioh,93*ratiow,581*ratioh,91*ratiow,545*ratioh,94*ratiow,517*ratioh,95*ratiow,514*ratioh,91*ratiow,505*ratioh,87*ratiow,503*ratioh,83*ratiow,505*ratioh,72*ratiow,514*ratioh,61*ratiow,529*ratioh,52*ratiow,545*ratioh,44*ratiow,563*ratioh,49*ratiow,565*ratioh,47*ratiow,579*ratioh,46*ratiow,603*ratioh,48*ratiow,625*ratioh,46*ratiow,632*ratioh,54*ratiow,638*ratioh,60*ratiow,646*ratioh,60*ratiow,666*ratioh,87*ratiow,700*ratioh,100*ratiow,713*ratioh,112*ratiow,722*ratioh,125*ratiow,727*ratioh,125*ratiow,722*ratioh,131*ratiow,716*ratioh,135*ratiow,714*ratioh,143*ratiow,715*ratioh,158*ratiow,716*ratioh,173*ratiow,709*ratioh,199*ratiow,709*ratioh,206*ratiow,704*ratioh,212*ratiow,701*ratioh,226*ratiow,701*ratioh,232*ratiow,698*ratioh,235*ratiow,693*ratioh,238*ratiow,691*ratioh,243*ratiow,677*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(103*ratiow,506*ratioh,101*ratiow,472*ratioh,100*ratiow,451*ratioh,102*ratiow,419*ratioh,105*ratiow,391*ratioh,108*ratiow,362*ratioh,115*ratiow,344*ratioh,119*ratiow,336*ratioh,136*ratiow,314*ratioh,148*ratiow,306*ratioh,159*ratiow,295*ratioh,165*ratiow,286*ratioh,167*ratiow,281*ratioh,184*ratiow,270*ratioh,203*ratiow,264*ratioh,219*ratiow,263*ratioh,235*ratiow,264*ratioh,258*ratiow,270*ratioh,292*ratiow,289*ratioh,307*ratiow,300*ratioh,326*ratiow,317*ratioh,337*ratiow,332*ratioh,345*ratiow,351*ratioh,350*ratiow,375*ratioh,352*ratiow,402*ratioh,351*ratiow,431*ratioh,345*ratiow,456*ratioh,333*ratiow,487*ratioh,320*ratiow,514*ratioh,314*ratiow,534*ratioh,309*ratiow,557*ratioh,300*ratiow,588*ratioh,291*ratiow,614*ratioh,289*ratiow,617*ratioh,283*ratiow,619*ratioh,273*ratiow,626*ratioh,263*ratiow,635*ratioh,258*ratiow,642*ratioh,253*ratiow,645*ratioh,232*ratiow,640*ratioh,229*ratiow,637*ratioh,223*ratiow,640*ratioh,220*ratiow,627*ratioh,216*ratiow,614*ratioh,201*ratiow,593*ratioh,180*ratiow,573*ratioh,142*ratiow,539*ratioh,108*ratiow,511*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(320*ratiow,733*ratioh,327*ratiow,747*ratioh,330*ratiow,755*ratioh,335*ratiow,751*ratioh,352*ratiow,733*ratioh,364*ratiow,719*ratioh,372*ratiow,712*ratioh,384*ratiow,710*ratioh,396*ratiow,711*ratioh,403*ratiow,713*ratioh,404*ratiow,716*ratioh,402*ratiow,720*ratioh,423*ratiow,708*ratioh,458*ratiow,680*ratioh,471*ratiow,664*ratioh,475*ratiow,653*ratioh,476*ratiow,644*ratioh,476*ratiow,627*ratioh,454*ratiow,624*ratioh,455*ratiow,635*ratioh,447*ratiow,659*ratioh,438*ratiow,673*ratioh,426*ratiow,683*ratioh,408*ratiow,689*ratioh,390*ratiow,686*ratioh,373*ratiow,682*ratioh,358*ratiow,683*ratioh,349*ratiow,691*ratioh,344*ratiow,705*ratioh,339*ratiow,719*ratioh,334*ratiow,727*ratioh,327*ratiow,733*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(310*ratiow,721*ratioh,317*ratiow,730*ratioh,320*ratiow,734*ratioh,328*ratiow,732*ratioh,336*ratiow,725*ratioh,343*ratiow,708*ratioh,348*ratiow,694*ratioh,353*ratiow,687*ratioh,359*ratiow,684*ratioh,367*ratiow,682*ratioh,382*ratiow,684*ratioh,406*ratiow,689*ratioh,418*ratiow,687*ratioh,432*ratiow,678*ratioh,444*ratiow,665*ratioh,450*ratiow,650*ratioh,454*ratiow,635*ratioh,455*ratiow,625*ratioh,451*ratiow,622*ratioh,445*ratiow,628*ratioh,438*ratiow,640*ratioh,430*ratiow,657*ratioh,423*ratiow,665*ratioh,410*ratiow,670*ratioh,394*ratiow,670*ratioh,373*ratiow,664*ratioh,363*ratiow,664*ratioh,353*ratiow,668*ratioh,341*ratiow,681*ratioh,324*ratiow,706*ratioh,317*ratiow,717*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(310*ratiow,721*ratioh,318*ratiow,716*ratioh,331*ratiow,696*ratioh,341*ratiow,680*ratioh,354*ratiow,667*ratioh,364*ratiow,663*ratioh,381*ratiow,666*ratioh,399*ratiow,670*ratioh,414*ratiow,670*ratioh,426*ratiow,663*ratioh,434*ratiow,649*ratioh,442*ratiow,632*ratioh,449*ratiow,625*ratioh,452*ratiow,623*ratioh,426*ratiow,614*ratioh,409*ratiow,604*ratioh,384*ratiow,586*ratioh,365*ratiow,572*ratioh,361*ratiow,568*ratioh,364*ratiow,578*ratioh,368*ratiow,597*ratioh,365*ratiow,618*ratioh,358*ratiow,633*ratioh,349*ratiow,643*ratioh,334*ratiow,653*ratioh,320*ratiow,666*ratioh,306*ratiow,681*ratioh,296*ratiow,697*ratioh,291*ratiow,709*ratioh,303*ratiow,716*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(152*ratiow,610*ratioh,153*ratiow,601*ratioh,156*ratiow,596*ratioh,164*ratiow,594*ratioh,171*ratiow,595*ratioh,181*ratiow,601*ratioh,188*ratiow,610*ratioh,190*ratiow,618*ratioh,190*ratiow,623*ratioh,187*ratiow,629*ratioh,180*ratiow,635*ratioh,174*ratiow,637*ratioh,170*ratiow,637*ratioh,164*ratiow,635*ratioh,156*ratiow,627*ratioh,153*ratiow,619*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile19(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 583;
var baseHeight = 789;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, AcbC, AcbSh, CPu, Pir1, Pir2, Pir3, aca";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(445*ratiow,195*ratioh,455*ratiow,173*ratioh,477*ratiow,122*ratioh,496*ratiow,78*ratioh,513*ratiow,38*ratioh,519*ratiow,21*ratioh,533*ratiow,29*ratioh,550*ratiow,43*ratioh,565*ratiow,60*ratioh,576*ratiow,79*ratioh,582*ratiow,96*ratioh,581*ratiow,146*ratioh,550*ratiow,161*ratioh,472*ratiow,198*ratioh,465*ratiow,201*ratioh,458*ratiow,197*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(465*ratiow,200*ratioh,503*ratiow,183*ratioh,555*ratiow,158*ratioh,582*ratiow,145*ratioh,582*ratiow,299*ratioh,580*ratiow,303*ratioh,577*ratiow,307*ratioh,576*ratiow,314*ratioh,579*ratiow,318*ratioh,555*ratiow,318*ratioh,539*ratiow,312*ratioh,523*ratiow,301*ratioh,510*ratiow,290*ratioh,498*ratiow,276*ratioh,491*ratiow,264*ratioh,482*ratiow,242*ratioh,475*ratiow,219*ratioh,470*ratiow,206*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(482*ratiow,512*ratioh,458*ratiow,536*ratioh,425*ratiow,560*ratioh,385*ratiow,581*ratioh,367*ratiow,594*ratioh,357*ratiow,607*ratioh,356*ratiow,618*ratioh,360*ratiow,633*ratioh,370*ratiow,649*ratioh,382*ratiow,659*ratioh,394*ratiow,662*ratioh,408*ratiow,662*ratioh,424*ratiow,658*ratioh,443*ratiow,650*ratioh,456*ratiow,641*ratioh,467*ratiow,628*ratioh,476*ratiow,607*ratioh,481*ratiow,581*ratioh,483*ratiow,561*ratioh,483*ratiow,538*ratioh,479*ratiow,544*ratioh,477*ratiow,545*ratioh,476*ratiow,544*ratioh,476*ratiow,539*ratioh,479*ratiow,531*ratioh,481*ratiow,521*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(483*ratiow,537*ratioh,483*ratiow,566*ratioh,480*ratiow,589*ratioh,474*ratiow,614*ratioh,464*ratiow,632*ratioh,446*ratiow,649*ratioh,423*ratiow,659*ratioh,398*ratiow,662*ratioh,385*ratiow,661*ratioh,372*ratiow,652*ratioh,366*ratiow,643*ratioh,363*ratiow,639*ratioh,360*ratiow,644*ratioh,357*ratiow,644*ratioh,354*ratiow,642*ratioh,325*ratiow,654*ratioh,332*ratiow,664*ratioh,338*ratiow,680*ratioh,341*ratiow,691*ratioh,342*ratiow,702*ratioh,344*ratiow,705*ratioh,353*ratiow,703*ratioh,376*ratiow,707*ratioh,395*ratiow,710*ratioh,411*ratiow,709*ratioh,425*ratiow,707*ratioh,432*ratiow,709*ratioh,437*ratiow,712*ratioh,441*ratiow,718*ratioh,448*ratiow,718*ratioh,459*ratiow,711*ratioh,461*ratiow,709*ratioh,474*ratiow,702*ratioh,482*ratiow,698*ratioh,485*ratiow,696*ratioh,494*ratiow,686*ratioh,508*ratiow,672*ratioh,523*ratiow,660*ratioh,528*ratiow,655*ratioh,532*ratiow,649*ratioh,538*ratiow,636*ratioh,541*ratiow,623*ratioh,538*ratiow,612*ratioh,537*ratiow,592*ratioh,537*ratiow,574*ratioh,538*ratiow,566*ratioh,533*ratiow,548*ratioh,520*ratiow,523*ratioh,508*ratiow,506*ratioh,502*ratiow,502*ratioh,497*ratiow,500*ratioh,493*ratiow,502*ratioh,490*ratiow,507*ratioh,486*ratiow,526*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(299*ratiow,645*ratioh,361*ratiow,634*ratioh,357*ratiow,622*ratioh,356*ratiow,609*ratioh,363*ratiow,598*ratioh,373*ratiow,589*ratioh,387*ratiow,580*ratioh,406*ratiow,570*ratioh,428*ratiow,557*ratioh,450*ratiow,542*ratioh,467*ratiow,528*ratioh,478*ratiow,517*ratioh,483*ratiow,512*ratioh,484*ratiow,494*ratioh,483*ratiow,476*ratioh,479*ratiow,442*ratioh,475*ratiow,401*ratioh,473*ratiow,368*ratioh,470*ratiow,341*ratioh,465*ratiow,327*ratioh,460*ratiow,317*ratioh,444*ratiow,295*ratioh,431*ratiow,282*ratioh,414*ratiow,271*ratioh,396*ratiow,263*ratioh,369*ratiow,262*ratioh,344*ratiow,266*ratioh,317*ratiow,275*ratioh,296*ratiow,284*ratioh,285*ratiow,292*ratioh,273*ratiow,299*ratioh,253*ratiow,319*ratioh,239*ratiow,343*ratioh,232*ratiow,359*ratioh,226*ratiow,381*ratioh,222*ratiow,407*ratioh,225*ratiow,447*ratioh,232*ratiow,472*ratioh,250*ratiow,512*ratioh,257*ratiow,528*ratioh,265*ratiow,550*ratioh,270*ratiow,576*ratioh,278*ratiow,603*ratioh,291*ratiow,630*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(270*ratiow,726*ratioh,258*ratiow,750*ratioh,246*ratiow,742*ratioh,236*ratiow,734*ratioh,231*ratiow,725*ratioh,228*ratiow,717*ratioh,222*ratiow,710*ratioh,213*ratiow,706*ratioh,191*ratiow,706*ratioh,179*ratiow,709*ratioh,175*ratiow,713*ratioh,154*ratiow,697*ratioh,134*ratiow,680*ratioh,124*ratiow,668*ratioh,117*ratiow,655*ratioh,111*ratiow,638*ratioh,107*ratiow,622*ratioh,129*ratiow,626*ratioh,146*ratiow,627*ratioh,142*ratiow,632*ratioh,145*ratiow,648*ratioh,155*ratiow,665*ratioh,168*ratiow,678*ratioh,178*ratiow,683*ratioh,187*ratiow,685*ratioh,196*ratiow,682*ratioh,211*ratiow,676*ratioh,226*ratiow,674*ratioh,235*ratiow,674*ratioh,242*ratiow,677*ratioh,247*ratiow,690*ratioh,253*ratiow,704*ratioh,255*ratiow,713*ratioh,258*ratiow,722*ratioh,265*ratiow,725*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(270*ratiow,726*ratioh,261*ratiow,724*ratioh,257*ratiow,720*ratioh,254*ratiow,706*ratioh,248*ratiow,692*ratioh,242*ratiow,680*ratioh,238*ratiow,675*ratioh,227*ratiow,673*ratioh,213*ratiow,676*ratioh,199*ratiow,681*ratioh,186*ratiow,685*ratioh,178*ratiow,683*ratioh,167*ratiow,677*ratioh,155*ratiow,665*ratioh,146*ratiow,650*ratioh,142*ratiow,639*ratioh,143*ratiow,631*ratioh,145*ratiow,627*ratioh,149*ratiow,626*ratioh,153*ratiow,628*ratioh,157*ratiow,640*ratioh,166*ratiow,655*ratioh,177*ratiow,668*ratioh,188*ratiow,672*ratioh,198*ratiow,671*ratioh,215*ratiow,667*ratioh,225*ratiow,665*ratioh,239*ratiow,666*ratioh,247*ratiow,671*ratioh,255*ratiow,677*ratioh,259*ratiow,686*ratioh,263*ratiow,694*ratioh,265*ratiow,705*ratioh,268*ratiow,710*ratioh,280*ratiow,715*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(280*ratiow,715*ratioh,270*ratiow,711*ratioh,264*ratiow,704*ratioh,263*ratiow,693*ratioh,256*ratiow,680*ratioh,247*ratiow,669*ratioh,237*ratiow,665*ratioh,222*ratiow,665*ratioh,195*ratiow,672*ratioh,185*ratiow,672*ratioh,177*ratiow,668*ratioh,166*ratiow,657*ratioh,157*ratiow,640*ratioh,154*ratiow,632*ratioh,150*ratiow,626*ratioh,169*ratiow,624*ratioh,185*ratiow,619*ratioh,207*ratiow,609*ratioh,223*ratiow,599*ratioh,232*ratiow,594*ratioh,222*ratiow,609*ratioh,217*ratiow,620*ratioh,214*ratiow,628*ratioh,220*ratiow,641*ratioh,226*ratiow,644*ratioh,234*ratiow,647*ratioh,242*ratiow,647*ratioh,255*ratiow,645*ratioh,260*ratiow,645*ratioh,272*ratiow,655*ratioh,281*ratiow,670*ratioh,288*ratiow,694*ratioh,294*ratiow,704*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(428*ratiow,590*ratioh,419*ratiow,592*ratioh,407*ratiow,599*ratioh,401*ratiow,609*ratioh,400*ratiow,617*ratioh,405*ratiow,627*ratioh,411*ratiow,632*ratioh,415*ratiow,632*ratioh,420*ratiow,630*ratioh,430*ratiow,622*ratioh,436*ratiow,610*ratioh,437*ratiow,604*ratioh,437*ratiow,596*ratioh,431*ratiow,590*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(138*ratiow,195*ratioh,128*ratiow,173*ratioh,106*ratiow,122*ratioh,87*ratiow,78*ratioh,70*ratiow,38*ratioh,64*ratiow,21*ratioh,50*ratiow,29*ratioh,33*ratiow,43*ratioh,18*ratiow,60*ratioh,7*ratiow,79*ratioh,1*ratiow,96*ratioh,2*ratiow,146*ratioh,33*ratiow,161*ratioh,111*ratiow,198*ratioh,118*ratiow,201*ratioh,125*ratiow,197*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(118*ratiow,200*ratioh,80*ratiow,183*ratioh,28*ratiow,158*ratioh,1*ratiow,145*ratioh,1*ratiow,299*ratioh,3*ratiow,303*ratioh,6*ratiow,307*ratioh,7*ratiow,314*ratioh,4*ratiow,318*ratioh,28*ratiow,318*ratioh,44*ratiow,312*ratioh,60*ratiow,301*ratioh,73*ratiow,290*ratioh,85*ratiow,276*ratioh,92*ratiow,264*ratioh,101*ratiow,242*ratioh,108*ratiow,219*ratioh,113*ratiow,206*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(101*ratiow,512*ratioh,125*ratiow,536*ratioh,158*ratiow,560*ratioh,198*ratiow,581*ratioh,216*ratiow,594*ratioh,226*ratiow,607*ratioh,227*ratiow,618*ratioh,223*ratiow,633*ratioh,213*ratiow,649*ratioh,201*ratiow,659*ratioh,189*ratiow,662*ratioh,175*ratiow,662*ratioh,159*ratiow,658*ratioh,140*ratiow,650*ratioh,127*ratiow,641*ratioh,116*ratiow,628*ratioh,107*ratiow,607*ratioh,102*ratiow,581*ratioh,100*ratiow,561*ratioh,100*ratiow,538*ratioh,104*ratiow,544*ratioh,106*ratiow,545*ratioh,107*ratiow,544*ratioh,107*ratiow,539*ratioh,104*ratiow,531*ratioh,102*ratiow,521*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(100*ratiow,537*ratioh,100*ratiow,566*ratioh,103*ratiow,589*ratioh,109*ratiow,614*ratioh,119*ratiow,632*ratioh,137*ratiow,649*ratioh,160*ratiow,659*ratioh,185*ratiow,662*ratioh,198*ratiow,661*ratioh,211*ratiow,652*ratioh,217*ratiow,643*ratioh,220*ratiow,639*ratioh,223*ratiow,644*ratioh,226*ratiow,644*ratioh,229*ratiow,642*ratioh,258*ratiow,654*ratioh,251*ratiow,664*ratioh,245*ratiow,680*ratioh,242*ratiow,691*ratioh,241*ratiow,702*ratioh,239*ratiow,705*ratioh,230*ratiow,703*ratioh,207*ratiow,707*ratioh,188*ratiow,710*ratioh,172*ratiow,709*ratioh,158*ratiow,707*ratioh,151*ratiow,709*ratioh,146*ratiow,712*ratioh,142*ratiow,718*ratioh,135*ratiow,718*ratioh,124*ratiow,711*ratioh,122*ratiow,709*ratioh,109*ratiow,702*ratioh,101*ratiow,698*ratioh,98*ratiow,696*ratioh,89*ratiow,686*ratioh,75*ratiow,672*ratioh,60*ratiow,660*ratioh,55*ratiow,655*ratioh,51*ratiow,649*ratioh,45*ratiow,636*ratioh,42*ratiow,623*ratioh,45*ratiow,612*ratioh,46*ratiow,592*ratioh,46*ratiow,574*ratioh,45*ratiow,566*ratioh,50*ratiow,548*ratioh,63*ratiow,523*ratioh,75*ratiow,506*ratioh,81*ratiow,502*ratioh,86*ratiow,500*ratioh,90*ratiow,502*ratioh,93*ratiow,507*ratioh,97*ratiow,526*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(284*ratiow,645*ratioh,222*ratiow,634*ratioh,226*ratiow,622*ratioh,227*ratiow,609*ratioh,220*ratiow,598*ratioh,210*ratiow,589*ratioh,196*ratiow,580*ratioh,177*ratiow,570*ratioh,155*ratiow,557*ratioh,133*ratiow,542*ratioh,116*ratiow,528*ratioh,105*ratiow,517*ratioh,100*ratiow,512*ratioh,99*ratiow,494*ratioh,100*ratiow,476*ratioh,104*ratiow,442*ratioh,108*ratiow,401*ratioh,110*ratiow,368*ratioh,113*ratiow,341*ratioh,118*ratiow,327*ratioh,123*ratiow,317*ratioh,139*ratiow,295*ratioh,152*ratiow,282*ratioh,169*ratiow,271*ratioh,187*ratiow,263*ratioh,214*ratiow,262*ratioh,239*ratiow,266*ratioh,266*ratiow,275*ratioh,287*ratiow,284*ratioh,298*ratiow,292*ratioh,310*ratiow,299*ratioh,330*ratiow,319*ratioh,344*ratiow,343*ratioh,351*ratiow,359*ratioh,357*ratiow,381*ratioh,361*ratiow,407*ratioh,358*ratiow,447*ratioh,351*ratiow,472*ratioh,333*ratiow,512*ratioh,326*ratiow,528*ratioh,318*ratiow,550*ratioh,313*ratiow,576*ratioh,305*ratiow,603*ratioh,292*ratiow,630*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(313*ratiow,726*ratioh,325*ratiow,750*ratioh,337*ratiow,742*ratioh,347*ratiow,734*ratioh,352*ratiow,725*ratioh,355*ratiow,717*ratioh,361*ratiow,710*ratioh,370*ratiow,706*ratioh,392*ratiow,706*ratioh,404*ratiow,709*ratioh,408*ratiow,713*ratioh,429*ratiow,697*ratioh,449*ratiow,680*ratioh,459*ratiow,668*ratioh,466*ratiow,655*ratioh,472*ratiow,638*ratioh,476*ratiow,622*ratioh,454*ratiow,626*ratioh,437*ratiow,627*ratioh,441*ratiow,632*ratioh,438*ratiow,648*ratioh,428*ratiow,665*ratioh,415*ratiow,678*ratioh,405*ratiow,683*ratioh,396*ratiow,685*ratioh,387*ratiow,682*ratioh,372*ratiow,676*ratioh,357*ratiow,674*ratioh,348*ratiow,674*ratioh,341*ratiow,677*ratioh,336*ratiow,690*ratioh,330*ratiow,704*ratioh,328*ratiow,713*ratioh,325*ratiow,722*ratioh,318*ratiow,725*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(313*ratiow,726*ratioh,322*ratiow,724*ratioh,326*ratiow,720*ratioh,329*ratiow,706*ratioh,335*ratiow,692*ratioh,341*ratiow,680*ratioh,345*ratiow,675*ratioh,356*ratiow,673*ratioh,370*ratiow,676*ratioh,384*ratiow,681*ratioh,397*ratiow,685*ratioh,405*ratiow,683*ratioh,416*ratiow,677*ratioh,428*ratiow,665*ratioh,437*ratiow,650*ratioh,441*ratiow,639*ratioh,440*ratiow,631*ratioh,438*ratiow,627*ratioh,434*ratiow,626*ratioh,430*ratiow,628*ratioh,426*ratiow,640*ratioh,417*ratiow,655*ratioh,406*ratiow,668*ratioh,395*ratiow,672*ratioh,385*ratiow,671*ratioh,368*ratiow,667*ratioh,358*ratiow,665*ratioh,344*ratiow,666*ratioh,336*ratiow,671*ratioh,328*ratiow,677*ratioh,324*ratiow,686*ratioh,320*ratiow,694*ratioh,318*ratiow,705*ratioh,315*ratiow,710*ratioh,303*ratiow,715*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(303*ratiow,715*ratioh,313*ratiow,711*ratioh,319*ratiow,704*ratioh,320*ratiow,693*ratioh,327*ratiow,680*ratioh,336*ratiow,669*ratioh,346*ratiow,665*ratioh,361*ratiow,665*ratioh,388*ratiow,672*ratioh,398*ratiow,672*ratioh,406*ratiow,668*ratioh,417*ratiow,657*ratioh,426*ratiow,640*ratioh,429*ratiow,632*ratioh,433*ratiow,626*ratioh,414*ratiow,624*ratioh,398*ratiow,619*ratioh,376*ratiow,609*ratioh,360*ratiow,599*ratioh,351*ratiow,594*ratioh,361*ratiow,609*ratioh,366*ratiow,620*ratioh,369*ratiow,628*ratioh,363*ratiow,641*ratioh,357*ratiow,644*ratioh,349*ratiow,647*ratioh,341*ratiow,647*ratioh,328*ratiow,645*ratioh,323*ratiow,645*ratioh,311*ratiow,655*ratioh,302*ratiow,670*ratioh,295*ratiow,694*ratioh,289*ratiow,704*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(155*ratiow,590*ratioh,164*ratiow,592*ratioh,176*ratiow,599*ratioh,182*ratiow,609*ratioh,183*ratiow,617*ratioh,178*ratiow,627*ratioh,172*ratiow,632*ratioh,168*ratiow,632*ratioh,163*ratiow,630*ratioh,153*ratiow,622*ratioh,147*ratiow,610*ratioh,146*ratiow,604*ratioh,146*ratiow,596*ratioh,152*ratiow,590*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile20(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 585;
var baseHeight = 787;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, AcbC, AcbSh, CPu, Pir1, Pir2, Pir3, aca";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(441*ratiow,191*ratioh,454*ratiow,164*ratioh,473*ratiow,126*ratioh,490*ratiow,91*ratioh,507*ratiow,58*ratioh,524*ratiow,24*ratioh,527*ratiow,17*ratioh,536*ratiow,20*ratioh,549*ratiow,29*ratioh,561*ratiow,40*ratioh,571*ratiow,55*ratioh,577*ratiow,71*ratioh,582*ratiow,90*ratioh,583*ratiow,137*ratioh,558*ratiow,148*ratioh,471*ratiow,189*ratioh,453*ratiow,197*ratioh,448*ratiow,193*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(453*ratiow,197*ratioh,499*ratiow,176*ratioh,545*ratiow,154*ratioh,579*ratiow,139*ratioh,584*ratiow,137*ratioh,584*ratiow,287*ratioh,582*ratiow,293*ratioh,578*ratiow,297*ratioh,579*ratiow,302*ratioh,581*ratiow,307*ratioh,555*ratiow,304*ratioh,531*ratiow,298*ratioh,508*ratiow,284*ratioh,494*ratiow,269*ratioh,487*ratiow,261*ratioh,475*ratiow,238*ratioh,457*ratiow,203*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(482*ratiow,517*ratioh,465*ratiow,530*ratioh,441*ratiow,546*ratioh,403*ratiow,570*ratioh,377*ratiow,584*ratioh,365*ratiow,591*ratioh,356*ratiow,601*ratioh,353*ratiow,617*ratioh,355*ratiow,633*ratioh,357*ratiow,638*ratioh,361*ratiow,640*ratioh,361*ratiow,644*ratioh,368*ratiow,651*ratioh,381*ratiow,659*ratioh,392*ratiow,661*ratioh,404*ratiow,661*ratioh,423*ratiow,657*ratioh,443*ratiow,650*ratioh,461*ratiow,638*ratioh,475*ratiow,623*ratioh,484*ratiow,604*ratioh,490*ratiow,578*ratioh,491*ratiow,556*ratioh,488*ratiow,540*ratioh,485*ratiow,534*ratioh,481*ratiow,544*ratioh,480*ratiow,541*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(484*ratiow,534*ratioh,487*ratiow,541*ratioh,490*ratiow,551*ratioh,491*ratiow,572*ratioh,487*ratiow,597*ratioh,479*ratiow,616*ratioh,467*ratiow,633*ratioh,445*ratiow,649*ratioh,417*ratiow,659*ratioh,392*ratiow,661*ratioh,379*ratiow,658*ratioh,365*ratiow,650*ratioh,361*ratiow,645*ratioh,355*ratiow,646*ratioh,354*ratiow,644*ratioh,310*ratiow,654*ratioh,316*ratiow,667*ratioh,316*ratiow,679*ratioh,315*ratiow,687*ratioh,314*ratiow,690*ratioh,322*ratiow,695*ratioh,326*ratiow,703*ratioh,326*ratiow,711*ratioh,322*ratiow,716*ratioh,317*ratiow,719*ratioh,329*ratiow,720*ratioh,344*ratiow,722*ratioh,347*ratiow,714*ratioh,354*ratiow,704*ratioh,360*ratiow,701*ratioh,383*ratiow,704*ratioh,399*ratiow,708*ratioh,411*ratiow,714*ratioh,417*ratiow,716*ratioh,430*ratiow,716*ratioh,446*ratiow,711*ratioh,456*ratiow,710*ratioh,464*ratiow,712*ratioh,468*ratiow,714*ratioh,467*ratiow,708*ratioh,476*ratiow,699*ratioh,494*ratiow,687*ratioh,513*ratiow,671*ratioh,527*ratiow,653*ratioh,536*ratiow,640*ratioh,541*ratiow,632*ratioh,538*ratiow,627*ratioh,536*ratiow,610*ratioh,536*ratiow,585*ratioh,537*ratiow,573*ratioh,540*ratiow,566*ratioh,535*ratiow,547*ratioh,526*ratiow,527*ratioh,511*ratiow,506*ratioh,499*ratiow,494*ratioh,493*ratiow,489*ratioh,491*ratiow,504*ratioh,487*ratiow,523*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(305*ratiow,647*ratioh,356*ratiow,635*ratioh,354*ratiow,621*ratioh,354*ratiow,606*ratioh,358*ratiow,598*ratioh,369*ratiow,589*ratioh,392*ratiow,576*ratioh,424*ratiow,557*ratioh,455*ratiow,537*ratioh,478*ratiow,520*ratioh,483*ratiow,516*ratioh,485*ratiow,496*ratioh,483*ratiow,458*ratioh,478*ratiow,422*ratioh,476*ratiow,388*ratioh,474*ratiow,360*ratioh,468*ratiow,333*ratioh,459*ratiow,311*ratioh,443*ratiow,291*ratioh,424*ratiow,274*ratioh,403*ratiow,262*ratioh,383*ratiow,256*ratioh,360*ratiow,256*ratioh,335*ratiow,260*ratioh,314*ratiow,265*ratioh,293*ratiow,273*ratioh,269*ratiow,288*ratioh,249*ratiow,307*ratioh,240*ratiow,319*ratioh,229*ratiow,338*ratioh,218*ratiow,366*ratioh,213*ratiow,399*ratioh,214*ratiow,425*ratioh,221*ratiow,458*ratioh,232*ratiow,499*ratioh,238*ratiow,517*ratioh,243*ratiow,529*ratioh,247*ratiow,547*ratioh,249*ratiow,566*ratioh,254*ratiow,586*ratioh,264*ratiow,611*ratioh,273*ratiow,622*ratioh,290*ratiow,639*ratioh,299*ratiow,643*ratioh,301*ratiow,642*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(247*ratiow,752*ratioh,234*ratiow,737*ratioh,221*ratiow,721*ratioh,212*ratiow,714*ratioh,198*ratiow,712*ratioh,182*ratiow,714*ratioh,172*ratiow,719*ratioh,146*ratiow,704*ratioh,124*ratiow,684*ratioh,111*ratiow,661*ratioh,107*ratiow,642*ratioh,107*ratiow,638*ratioh,135*ratiow,630*ratioh,133*ratiow,634*ratioh,135*ratiow,648*ratioh,141*ratiow,669*ratioh,150*ratiow,682*ratioh,162*ratiow,691*ratioh,169*ratiow,692*ratioh,187*ratiow,690*ratioh,208*ratiow,686*ratioh,219*ratiow,685*ratioh,228*ratiow,689*ratioh,236*ratiow,699*ratioh,242*ratiow,715*ratioh,247*ratiow,726*ratioh,252*ratiow,731*ratioh,262*ratiow,732*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(263*ratiow,732*ratioh,252*ratiow,731*ratioh,245*ratiow,725*ratioh,240*ratiow,709*ratioh,236*ratiow,698*ratioh,229*ratiow,689*ratioh,218*ratiow,685*ratioh,193*ratiow,688*ratioh,172*ratiow,692*ratioh,163*ratiow,692*ratioh,151*ratiow,684*ratioh,140*ratiow,668*ratioh,134*ratiow,646*ratioh,132*ratiow,634*ratioh,134*ratiow,630*ratioh,139*ratiow,629*ratioh,144*ratiow,631*ratioh,147*ratiow,637*ratioh,156*ratiow,657*ratioh,164*ratiow,669*ratioh,178*ratiow,672*ratioh,191*ratiow,671*ratioh,210*ratiow,667*ratioh,224*ratiow,668*ratioh,234*ratiow,670*ratioh,246*ratiow,677*ratioh,252*ratiow,686*ratioh,256*ratiow,696*ratioh,259*ratiow,712*ratioh,260*ratiow,719*ratioh,263*ratiow,723*ratioh,272*ratiow,723*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(270*ratiow,723*ratioh,261*ratiow,721*ratioh,259*ratiow,711*ratioh,257*ratiow,697*ratioh,251*ratiow,683*ratioh,245*ratiow,676*ratioh,234*ratiow,670*ratioh,219*ratiow,667*ratioh,202*ratiow,668*ratioh,185*ratiow,672*ratioh,169*ratiow,671*ratioh,160*ratiow,665*ratioh,152*ratiow,648*ratioh,148*ratiow,637*ratioh,146*ratiow,633*ratioh,140*ratiow,628*ratioh,164*ratiow,620*ratioh,191*ratiow,607*ratioh,211*ratiow,593*ratioh,223*ratiow,583*ratioh,225*ratiow,581*ratioh,223*ratiow,588*ratioh,211*ratiow,607*ratioh,206*ratiow,620*ratioh,205*ratiow,636*ratioh,212*ratiow,644*ratioh,233*ratiow,644*ratioh,241*ratiow,645*ratioh,253*ratiow,651*ratioh,263*ratiow,661*ratioh,277*ratiow,677*ratioh,283*ratiow,690*ratioh,286*ratiow,700*ratioh,287*ratiow,707*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(430*ratiow,583*ratioh,416*ratiow,589*ratioh,408*ratiow,598*ratioh,406*ratiow,605*ratioh,406*ratiow,620*ratioh,407*ratiow,626*ratioh,410*ratiow,630*ratioh,411*ratiow,631*ratioh,422*ratiow,625*ratioh,435*ratiow,617*ratioh,443*ratiow,604*ratioh,444*ratiow,595*ratioh,442*ratiow,589*ratioh,437*ratiow,585*ratioh,430*ratiow,583*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(144*ratiow,191*ratioh,131*ratiow,164*ratioh,112*ratiow,126*ratioh,95*ratiow,91*ratioh,78*ratiow,58*ratioh,61*ratiow,24*ratioh,58*ratiow,17*ratioh,49*ratiow,20*ratioh,36*ratiow,29*ratioh,24*ratiow,40*ratioh,14*ratiow,55*ratioh,8*ratiow,71*ratioh,3*ratiow,90*ratioh,2*ratiow,137*ratioh,27*ratiow,148*ratioh,114*ratiow,189*ratioh,132*ratiow,197*ratioh,137*ratiow,193*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(132*ratiow,197*ratioh,86*ratiow,176*ratioh,40*ratiow,154*ratioh,6*ratiow,139*ratioh,1*ratiow,137*ratioh,1*ratiow,287*ratioh,3*ratiow,293*ratioh,7*ratiow,297*ratioh,6*ratiow,302*ratioh,4*ratiow,307*ratioh,30*ratiow,304*ratioh,54*ratiow,298*ratioh,77*ratiow,284*ratioh,91*ratiow,269*ratioh,98*ratiow,261*ratioh,110*ratiow,238*ratioh,128*ratiow,203*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(103*ratiow,517*ratioh,120*ratiow,530*ratioh,144*ratiow,546*ratioh,182*ratiow,570*ratioh,208*ratiow,584*ratioh,220*ratiow,591*ratioh,229*ratiow,601*ratioh,232*ratiow,617*ratioh,230*ratiow,633*ratioh,228*ratiow,638*ratioh,224*ratiow,640*ratioh,224*ratiow,644*ratioh,217*ratiow,651*ratioh,204*ratiow,659*ratioh,193*ratiow,661*ratioh,181*ratiow,661*ratioh,162*ratiow,657*ratioh,142*ratiow,650*ratioh,124*ratiow,638*ratioh,110*ratiow,623*ratioh,101*ratiow,604*ratioh,95*ratiow,578*ratioh,94*ratiow,556*ratioh,97*ratiow,540*ratioh,100*ratiow,534*ratioh,104*ratiow,544*ratioh,105*ratiow,541*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(101*ratiow,534*ratioh,98*ratiow,541*ratioh,95*ratiow,551*ratioh,94*ratiow,572*ratioh,98*ratiow,597*ratioh,106*ratiow,616*ratioh,118*ratiow,633*ratioh,140*ratiow,649*ratioh,168*ratiow,659*ratioh,193*ratiow,661*ratioh,206*ratiow,658*ratioh,220*ratiow,650*ratioh,224*ratiow,645*ratioh,230*ratiow,646*ratioh,231*ratiow,644*ratioh,275*ratiow,654*ratioh,269*ratiow,667*ratioh,269*ratiow,679*ratioh,270*ratiow,687*ratioh,271*ratiow,690*ratioh,263*ratiow,695*ratioh,259*ratiow,703*ratioh,259*ratiow,711*ratioh,263*ratiow,716*ratioh,268*ratiow,719*ratioh,256*ratiow,720*ratioh,241*ratiow,722*ratioh,238*ratiow,714*ratioh,231*ratiow,704*ratioh,225*ratiow,701*ratioh,202*ratiow,704*ratioh,186*ratiow,708*ratioh,174*ratiow,714*ratioh,168*ratiow,716*ratioh,155*ratiow,716*ratioh,139*ratiow,711*ratioh,129*ratiow,710*ratioh,121*ratiow,712*ratioh,117*ratiow,714*ratioh,118*ratiow,708*ratioh,109*ratiow,699*ratioh,91*ratiow,687*ratioh,72*ratiow,671*ratioh,58*ratiow,653*ratioh,49*ratiow,640*ratioh,44*ratiow,632*ratioh,47*ratiow,627*ratioh,49*ratiow,610*ratioh,49*ratiow,585*ratioh,48*ratiow,573*ratioh,45*ratiow,566*ratioh,50*ratiow,547*ratioh,59*ratiow,527*ratioh,74*ratiow,506*ratioh,86*ratiow,494*ratioh,92*ratiow,489*ratioh,94*ratiow,504*ratioh,98*ratiow,523*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(280*ratiow,647*ratioh,229*ratiow,635*ratioh,231*ratiow,621*ratioh,231*ratiow,606*ratioh,227*ratiow,598*ratioh,216*ratiow,589*ratioh,193*ratiow,576*ratioh,161*ratiow,557*ratioh,130*ratiow,537*ratioh,107*ratiow,520*ratioh,102*ratiow,516*ratioh,100*ratiow,496*ratioh,102*ratiow,458*ratioh,107*ratiow,422*ratioh,109*ratiow,388*ratioh,111*ratiow,360*ratioh,117*ratiow,333*ratioh,126*ratiow,311*ratioh,142*ratiow,291*ratioh,161*ratiow,274*ratioh,182*ratiow,262*ratioh,202*ratiow,256*ratioh,225*ratiow,256*ratioh,250*ratiow,260*ratioh,271*ratiow,265*ratioh,292*ratiow,273*ratioh,316*ratiow,288*ratioh,336*ratiow,307*ratioh,345*ratiow,319*ratioh,356*ratiow,338*ratioh,367*ratiow,366*ratioh,372*ratiow,399*ratioh,371*ratiow,425*ratioh,364*ratiow,458*ratioh,353*ratiow,499*ratioh,347*ratiow,517*ratioh,342*ratiow,529*ratioh,338*ratiow,547*ratioh,336*ratiow,566*ratioh,331*ratiow,586*ratioh,321*ratiow,611*ratioh,312*ratiow,622*ratioh,295*ratiow,639*ratioh,286*ratiow,643*ratioh,284*ratiow,642*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(338*ratiow,752*ratioh,351*ratiow,737*ratioh,364*ratiow,721*ratioh,373*ratiow,714*ratioh,387*ratiow,712*ratioh,403*ratiow,714*ratioh,413*ratiow,719*ratioh,439*ratiow,704*ratioh,461*ratiow,684*ratioh,474*ratiow,661*ratioh,478*ratiow,642*ratioh,478*ratiow,638*ratioh,450*ratiow,630*ratioh,452*ratiow,634*ratioh,450*ratiow,648*ratioh,444*ratiow,669*ratioh,435*ratiow,682*ratioh,423*ratiow,691*ratioh,416*ratiow,692*ratioh,398*ratiow,690*ratioh,377*ratiow,686*ratioh,366*ratiow,685*ratioh,357*ratiow,689*ratioh,349*ratiow,699*ratioh,343*ratiow,715*ratioh,338*ratiow,726*ratioh,333*ratiow,731*ratioh,323*ratiow,732*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(322*ratiow,732*ratioh,333*ratiow,731*ratioh,340*ratiow,725*ratioh,345*ratiow,709*ratioh,349*ratiow,698*ratioh,356*ratiow,689*ratioh,367*ratiow,685*ratioh,392*ratiow,688*ratioh,413*ratiow,692*ratioh,422*ratiow,692*ratioh,434*ratiow,684*ratioh,445*ratiow,668*ratioh,451*ratiow,646*ratioh,453*ratiow,634*ratioh,451*ratiow,630*ratioh,446*ratiow,629*ratioh,441*ratiow,631*ratioh,438*ratiow,637*ratioh,429*ratiow,657*ratioh,421*ratiow,669*ratioh,407*ratiow,672*ratioh,394*ratiow,671*ratioh,375*ratiow,667*ratioh,361*ratiow,668*ratioh,351*ratiow,670*ratioh,339*ratiow,677*ratioh,333*ratiow,686*ratioh,329*ratiow,696*ratioh,326*ratiow,712*ratioh,325*ratiow,719*ratioh,322*ratiow,723*ratioh,313*ratiow,723*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(315*ratiow,723*ratioh,324*ratiow,721*ratioh,326*ratiow,711*ratioh,328*ratiow,697*ratioh,334*ratiow,683*ratioh,340*ratiow,676*ratioh,351*ratiow,670*ratioh,366*ratiow,667*ratioh,383*ratiow,668*ratioh,400*ratiow,672*ratioh,416*ratiow,671*ratioh,425*ratiow,665*ratioh,433*ratiow,648*ratioh,437*ratiow,637*ratioh,439*ratiow,633*ratioh,445*ratiow,628*ratioh,421*ratiow,620*ratioh,394*ratiow,607*ratioh,374*ratiow,593*ratioh,362*ratiow,583*ratioh,360*ratiow,581*ratioh,362*ratiow,588*ratioh,374*ratiow,607*ratioh,379*ratiow,620*ratioh,380*ratiow,636*ratioh,373*ratiow,644*ratioh,352*ratiow,644*ratioh,344*ratiow,645*ratioh,332*ratiow,651*ratioh,322*ratiow,661*ratioh,308*ratiow,677*ratioh,302*ratiow,690*ratioh,299*ratiow,700*ratioh,298*ratiow,707*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(155*ratiow,583*ratioh,169*ratiow,589*ratioh,177*ratiow,598*ratioh,179*ratiow,605*ratioh,179*ratiow,620*ratioh,178*ratiow,626*ratioh,175*ratiow,630*ratioh,174*ratiow,631*ratioh,163*ratiow,625*ratioh,150*ratiow,617*ratioh,142*ratiow,604*ratioh,141*ratiow,595*ratioh,143*ratiow,589*ratioh,148*ratiow,585*ratioh,155*ratiow,583*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile21(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 594;
var baseHeight = 804;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, AcbC, AcbSh, CPu, Pir1, Pir2, Pir3, aca";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(446*ratiow,196*ratioh,471*ratiow,144*ratioh,496*ratiow,91*ratioh,518*ratiow,43*ratioh,527*ratiow,25*ratioh,537*ratiow,32*ratioh,548*ratiow,40*ratioh,559*ratiow,51*ratioh,568*ratiow,60*ratioh,577*ratiow,71*ratioh,585*ratiow,86*ratioh,591*ratiow,104*ratioh,593*ratiow,118*ratioh,593*ratiow,134*ratioh,555*ratiow,155*ratioh,506*ratiow,180*ratioh,468*ratiow,198*ratioh,453*ratiow,205*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(453*ratiow,204*ratioh,472*ratiow,197*ratioh,528*ratiow,169*ratioh,574*ratiow,145*ratioh,593*ratiow,135*ratioh,593*ratiow,291*ratioh,583*ratiow,291*ratioh,576*ratiow,298*ratioh,569*ratiow,300*ratioh,567*ratiow,305*ratioh,554*ratiow,302*ratioh,537*ratiow,299*ratioh,520*ratiow,291*ratioh,506*ratiow,278*ratioh,493*ratiow,266*ratioh,478*ratiow,247*ratioh,466*ratiow,226*ratioh,460*ratiow,216*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(488*ratiow,514*ratioh,482*ratiow,523*ratioh,460*ratiow,541*ratioh,428*ratiow,564*ratioh,396*ratiow,583*ratioh,384*ratiow,591*ratioh,375*ratiow,601*ratioh,367*ratiow,616*ratioh,362*ratiow,632*ratioh,363*ratiow,650*ratioh,369*ratiow,664*ratioh,380*ratiow,676*ratioh,389*ratiow,681*ratioh,407*ratiow,680*ratioh,425*ratiow,677*ratioh,445*ratiow,667*ratioh,467*ratiow,648*ratioh,481*ratiow,633*ratioh,493*ratiow,617*ratioh,497*ratiow,604*ratioh,500*ratiow,581*ratioh,497*ratiow,552*ratioh,494*ratiow,536*ratioh,493*ratiow,531*ratioh,489*ratiow,551*ratioh,488*ratiow,546*ratioh,487*ratiow,535*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(492*ratiow,530*ratioh,496*ratiow,503*ratioh,505*ratiow,503*ratioh,513*ratiow,508*ratioh,521*ratiow,516*ratioh,526*ratiow,524*ratioh,536*ratiow,539*ratioh,543*ratiow,553*ratioh,541*ratiow,566*ratioh,541*ratiow,596*ratioh,541*ratiow,617*ratioh,546*ratiow,635*ratioh,540*ratiow,653*ratioh,531*ratiow,667*ratioh,509*ratiow,689*ratioh,489*ratiow,707*ratioh,466*ratiow,722*ratioh,445*ratiow,730*ratioh,432*ratiow,729*ratioh,412*ratiow,722*ratioh,390*ratiow,716*ratioh,369*ratiow,714*ratioh,351*ratiow,713*ratioh,340*ratiow,703*ratioh,331*ratiow,693*ratioh,326*ratiow,690*ratioh,318*ratiow,691*ratioh,313*ratiow,697*ratioh,311*ratiow,683*ratioh,305*ratiow,669*ratioh,299*ratiow,657*ratioh,364*ratiow,653*ratioh,370*ratiow,665*ratioh,378*ratiow,675*ratioh,387*ratiow,680*ratioh,404*ratiow,681*ratioh,419*ratiow,678*ratioh,442*ratiow,668*ratioh,466*ratiow,650*ratioh,484*ratiow,630*ratioh,495*ratiow,612*ratioh,500*ratiow,585*ratioh,497*ratiow,552*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(293*ratiow,648*ratioh,363*ratiow,641*ratioh,365*ratiow,626*ratioh,369*ratiow,612*ratioh,378*ratiow,596*ratioh,393*ratiow,585*ratioh,418*ratiow,570*ratioh,437*ratiow,558*ratioh,460*ratiow,542*ratioh,474*ratiow,530*ratioh,488*ratiow,515*ratioh,490*ratiow,480*ratioh,486*ratiow,445*ratioh,481*ratiow,416*ratioh,471*ratiow,347*ratioh,462*ratiow,322*ratioh,453*ratiow,307*ratioh,440*ratiow,291*ratioh,419*ratiow,273*ratioh,399*ratiow,261*ratioh,377*ratiow,253*ratioh,342*ratiow,253*ratioh,325*ratiow,255*ratioh,302*ratiow,264*ratioh,277*ratiow,279*ratioh,253*ratiow,299*ratioh,235*ratiow,321*ratioh,221*ratiow,345*ratioh,211*ratiow,372*ratioh,206*ratiow,395*ratioh,205*ratiow,423*ratioh,207*ratiow,465*ratioh,215*ratiow,505*ratioh,228*ratiow,535*ratioh,236*ratiow,560*ratioh,248*ratiow,598*ratioh,254*ratiow,612*ratioh,266*ratiow,630*ratioh,275*ratiow,641*ratioh,274*ratiow,634*ratioh,278*ratiow,634*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(252*ratiow,743*ratioh,245*ratiow,751*ratioh,243*ratiow,760*ratioh,236*ratiow,759*ratioh,222*ratiow,746*ratioh,211*ratiow,729*ratioh,204*ratiow,723*ratioh,191*ratiow,720*ratioh,177*ratiow,723*ratioh,164*ratiow,732*ratioh,143*ratiow,721*ratioh,123*ratiow,705*ratioh,107*ratiow,686*ratioh,99*ratiow,666*ratioh,96*ratiow,651*ratioh,122*ratiow,642*ratioh,122*ratiow,650*ratioh,126*ratiow,669*ratioh,136*ratiow,688*ratioh,146*ratiow,698*ratioh,154*ratiow,702*ratioh,162*ratiow,701*ratioh,171*ratiow,698*ratioh,183*ratiow,692*ratioh,197*ratiow,688*ratioh,210*ratiow,687*ratioh,225*ratiow,693*ratioh,233*ratiow,701*ratioh,237*ratiow,711*ratioh,238*ratiow,726*ratioh,243*ratiow,736*ratioh,247*ratiow,741*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(252*ratiow,743*ratioh,246*ratiow,741*ratioh,239*ratiow,730*ratioh,237*ratiow,714*ratioh,235*ratiow,704*ratioh,229*ratiow,696*ratioh,220*ratiow,690*ratioh,209*ratiow,687*ratioh,194*ratiow,688*ratioh,177*ratiow,695*ratioh,161*ratiow,702*ratioh,147*ratiow,699*ratioh,134*ratiow,687*ratioh,126*ratiow,667*ratioh,122*ratiow,651*ratioh,122*ratiow,641*ratioh,132*ratiow,637*ratioh,135*ratiow,638*ratioh,138*ratiow,644*ratioh,144*ratiow,661*ratioh,150*ratiow,675*ratioh,158*ratiow,680*ratioh,167*ratiow,679*ratioh,189*ratiow,674*ratioh,205*ratiow,671*ratioh,218*ratiow,671*ratioh,231*ratiow,676*ratioh,240*ratiow,683*ratioh,247*ratiow,691*ratioh,252*ratiow,704*ratioh,258*ratiow,722*ratioh,262*ratiow,730*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(262*ratiow,730*ratioh,258*ratiow,723*ratioh,254*ratiow,709*ratioh,249*ratiow,696*ratioh,243*ratiow,686*ratioh,235*ratiow,678*ratioh,223*ratiow,672*ratioh,209*ratiow,670*ratioh,168*ratiow,678*ratioh,157*ratiow,679*ratioh,149*ratiow,675*ratioh,140*ratiow,650*ratioh,137*ratiow,641*ratioh,133*ratiow,637*ratioh,152*ratiow,626*ratioh,166*ratiow,619*ratioh,194*ratiow,599*ratioh,205*ratiow,590*ratioh,199*ratiow,605*ratioh,194*ratiow,622*ratioh,195*ratiow,638*ratioh,202*ratiow,645*ratioh,218*ratiow,647*ratioh,236*ratiow,645*ratioh,247*ratiow,649*ratioh,258*ratiow,656*ratioh,266*ratiow,664*ratioh,271*ratiow,675*ratioh,277*ratiow,699*ratioh,284*ratiow,709*ratioh,288*ratiow,712*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(421*ratiow,633*ratioh,429*ratiow,631*ratioh,441*ratiow,622*ratioh,448*ratiow,612*ratioh,450*ratiow,603*ratioh,450*ratiow,596*ratioh,447*ratiow,591*ratioh,443*ratiow,589*ratioh,435*ratiow,590*ratioh,424*ratiow,596*ratioh,418*ratiow,604*ratioh,414*ratiow,614*ratioh,414*ratiow,626*ratioh,416*ratiow,631*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(148*ratiow,196*ratioh,123*ratiow,144*ratioh,98*ratiow,91*ratioh,76*ratiow,43*ratioh,67*ratiow,25*ratioh,57*ratiow,32*ratioh,46*ratiow,40*ratioh,35*ratiow,51*ratioh,26*ratiow,60*ratioh,17*ratiow,71*ratioh,9*ratiow,86*ratioh,3*ratiow,104*ratioh,1*ratiow,118*ratioh,1*ratiow,134*ratioh,39*ratiow,155*ratioh,88*ratiow,180*ratioh,126*ratiow,198*ratioh,141*ratiow,205*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(141*ratiow,204*ratioh,122*ratiow,197*ratioh,66*ratiow,169*ratioh,20*ratiow,145*ratioh,1*ratiow,135*ratioh,1*ratiow,291*ratioh,11*ratiow,291*ratioh,18*ratiow,298*ratioh,25*ratiow,300*ratioh,27*ratiow,305*ratioh,40*ratiow,302*ratioh,57*ratiow,299*ratioh,74*ratiow,291*ratioh,88*ratiow,278*ratioh,101*ratiow,266*ratioh,116*ratiow,247*ratioh,128*ratiow,226*ratioh,134*ratiow,216*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(106*ratiow,514*ratioh,112*ratiow,523*ratioh,134*ratiow,541*ratioh,166*ratiow,564*ratioh,198*ratiow,583*ratioh,210*ratiow,591*ratioh,219*ratiow,601*ratioh,227*ratiow,616*ratioh,232*ratiow,632*ratioh,231*ratiow,650*ratioh,225*ratiow,664*ratioh,214*ratiow,676*ratioh,205*ratiow,681*ratioh,187*ratiow,680*ratioh,169*ratiow,677*ratioh,149*ratiow,667*ratioh,127*ratiow,648*ratioh,113*ratiow,633*ratioh,101*ratiow,617*ratioh,97*ratiow,604*ratioh,94*ratiow,581*ratioh,97*ratiow,552*ratioh,100*ratiow,536*ratioh,101*ratiow,531*ratioh,105*ratiow,551*ratioh,106*ratiow,546*ratioh,107*ratiow,535*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(102*ratiow,530*ratioh,98*ratiow,503*ratioh,89*ratiow,503*ratioh,81*ratiow,508*ratioh,73*ratiow,516*ratioh,68*ratiow,524*ratioh,58*ratiow,539*ratioh,51*ratiow,553*ratioh,53*ratiow,566*ratioh,53*ratiow,596*ratioh,53*ratiow,617*ratioh,48*ratiow,635*ratioh,54*ratiow,653*ratioh,63*ratiow,667*ratioh,85*ratiow,689*ratioh,105*ratiow,707*ratioh,128*ratiow,722*ratioh,149*ratiow,730*ratioh,162*ratiow,729*ratioh,182*ratiow,722*ratioh,204*ratiow,716*ratioh,225*ratiow,714*ratioh,243*ratiow,713*ratioh,254*ratiow,703*ratioh,263*ratiow,693*ratioh,268*ratiow,690*ratioh,276*ratiow,691*ratioh,281*ratiow,697*ratioh,283*ratiow,683*ratioh,289*ratiow,669*ratioh,295*ratiow,657*ratioh,230*ratiow,653*ratioh,224*ratiow,665*ratioh,216*ratiow,675*ratioh,207*ratiow,680*ratioh,190*ratiow,681*ratioh,175*ratiow,678*ratioh,152*ratiow,668*ratioh,128*ratiow,650*ratioh,110*ratiow,630*ratioh,99*ratiow,612*ratioh,94*ratiow,585*ratioh,97*ratiow,552*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(301*ratiow,648*ratioh,231*ratiow,641*ratioh,229*ratiow,626*ratioh,225*ratiow,612*ratioh,216*ratiow,596*ratioh,201*ratiow,585*ratioh,176*ratiow,570*ratioh,157*ratiow,558*ratioh,134*ratiow,542*ratioh,120*ratiow,530*ratioh,106*ratiow,515*ratioh,104*ratiow,480*ratioh,108*ratiow,445*ratioh,113*ratiow,416*ratioh,123*ratiow,347*ratioh,132*ratiow,322*ratioh,141*ratiow,307*ratioh,154*ratiow,291*ratioh,175*ratiow,273*ratioh,195*ratiow,261*ratioh,217*ratiow,253*ratioh,252*ratiow,253*ratioh,269*ratiow,255*ratioh,292*ratiow,264*ratioh,317*ratiow,279*ratioh,341*ratiow,299*ratioh,359*ratiow,321*ratioh,373*ratiow,345*ratioh,383*ratiow,372*ratioh,388*ratiow,395*ratioh,389*ratiow,423*ratioh,387*ratiow,465*ratioh,379*ratiow,505*ratioh,366*ratiow,535*ratioh,358*ratiow,560*ratioh,346*ratiow,598*ratioh,340*ratiow,612*ratioh,328*ratiow,630*ratioh,319*ratiow,641*ratioh,320*ratiow,634*ratioh,316*ratiow,634*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(342*ratiow,743*ratioh,349*ratiow,751*ratioh,351*ratiow,760*ratioh,358*ratiow,759*ratioh,372*ratiow,746*ratioh,383*ratiow,729*ratioh,390*ratiow,723*ratioh,403*ratiow,720*ratioh,417*ratiow,723*ratioh,430*ratiow,732*ratioh,451*ratiow,721*ratioh,471*ratiow,705*ratioh,487*ratiow,686*ratioh,495*ratiow,666*ratioh,498*ratiow,651*ratioh,472*ratiow,642*ratioh,472*ratiow,650*ratioh,468*ratiow,669*ratioh,458*ratiow,688*ratioh,448*ratiow,698*ratioh,440*ratiow,702*ratioh,432*ratiow,701*ratioh,423*ratiow,698*ratioh,411*ratiow,692*ratioh,397*ratiow,688*ratioh,384*ratiow,687*ratioh,369*ratiow,693*ratioh,361*ratiow,701*ratioh,357*ratiow,711*ratioh,356*ratiow,726*ratioh,351*ratiow,736*ratioh,347*ratiow,741*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(342*ratiow,743*ratioh,348*ratiow,741*ratioh,355*ratiow,730*ratioh,357*ratiow,714*ratioh,359*ratiow,704*ratioh,365*ratiow,696*ratioh,374*ratiow,690*ratioh,385*ratiow,687*ratioh,400*ratiow,688*ratioh,417*ratiow,695*ratioh,433*ratiow,702*ratioh,447*ratiow,699*ratioh,460*ratiow,687*ratioh,468*ratiow,667*ratioh,472*ratiow,651*ratioh,472*ratiow,641*ratioh,462*ratiow,637*ratioh,459*ratiow,638*ratioh,456*ratiow,644*ratioh,450*ratiow,661*ratioh,444*ratiow,675*ratioh,436*ratiow,680*ratioh,427*ratiow,679*ratioh,405*ratiow,674*ratioh,389*ratiow,671*ratioh,376*ratiow,671*ratioh,363*ratiow,676*ratioh,354*ratiow,683*ratioh,347*ratiow,691*ratioh,342*ratiow,704*ratioh,336*ratiow,722*ratioh,332*ratiow,730*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(332*ratiow,730*ratioh,336*ratiow,723*ratioh,340*ratiow,709*ratioh,345*ratiow,696*ratioh,351*ratiow,686*ratioh,359*ratiow,678*ratioh,371*ratiow,672*ratioh,385*ratiow,670*ratioh,426*ratiow,678*ratioh,437*ratiow,679*ratioh,445*ratiow,675*ratioh,454*ratiow,650*ratioh,457*ratiow,641*ratioh,461*ratiow,637*ratioh,442*ratiow,626*ratioh,428*ratiow,619*ratioh,400*ratiow,599*ratioh,389*ratiow,590*ratioh,395*ratiow,605*ratioh,400*ratiow,622*ratioh,399*ratiow,638*ratioh,392*ratiow,645*ratioh,376*ratiow,647*ratioh,358*ratiow,645*ratioh,347*ratiow,649*ratioh,336*ratiow,656*ratioh,328*ratiow,664*ratioh,323*ratiow,675*ratioh,317*ratiow,699*ratioh,310*ratiow,709*ratioh,306*ratiow,712*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(173*ratiow,633*ratioh,165*ratiow,631*ratioh,153*ratiow,622*ratioh,146*ratiow,612*ratioh,144*ratiow,603*ratioh,144*ratiow,596*ratioh,147*ratiow,591*ratioh,151*ratiow,589*ratioh,159*ratiow,590*ratioh,170*ratiow,596*ratioh,176*ratiow,604*ratioh,180*ratiow,614*ratioh,180*ratiow,626*ratioh,178*ratiow,631*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile22(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 600;
var baseHeight = 818;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, AcbC, AcbSh, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(448*ratiow,184*ratioh,503*ratiow,57*ratioh,522*ratiow,15*ratioh,543*ratiow,26*ratioh,555*ratiow,33*ratioh,565*ratiow,42*ratioh,574*ratiow,51*ratioh,582*ratiow,62*ratioh,588*ratiow,73*ratioh,593*ratiow,91*ratioh,596*ratiow,108*ratioh,597*ratiow,119*ratioh,588*ratiow,125*ratioh,575*ratiow,132*ratioh,534*ratiow,156*ratioh,487*ratiow,183*ratioh,465*ratiow,196*ratioh,463*ratiow,194*ratioh,460*ratiow,191*ratioh,457*ratiow,189*ratioh,455*ratiow,187*ratioh,451*ratiow,186*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(465*ratiow,195*ratioh,503*ratiow,174*ratioh,535*ratiow,155*ratioh,568*ratiow,136*ratioh,592*ratiow,122*ratioh,597*ratiow,119*ratioh,599*ratiow,143*ratioh,599*ratiow,284*ratioh,587*ratiow,289*ratioh,588*ratiow,301*ratioh,572*ratiow,299*ratioh,553*ratiow,295*ratioh,534*ratiow,289*ratioh,517*ratiow,278*ratioh,504*ratiow,263*ratioh,494*ratiow,251*ratioh,487*ratiow,241*ratioh,481*ratiow,227*ratioh,474*ratiow,213*ratioh,469*ratiow,202*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(488*ratiow,523*ratioh,474*ratiow,537*ratioh,455*ratiow,554*ratioh,432*ratiow,572*ratioh,405*ratiow,592*ratioh,385*ratiow,606*ratioh,375*ratiow,614*ratioh,368*ratiow,623*ratioh,364*ratiow,630*ratioh,362*ratiow,640*ratioh,363*ratiow,650*ratioh,369*ratiow,659*ratioh,375*ratiow,665*ratioh,380*ratiow,670*ratioh,386*ratiow,675*ratioh,393*ratiow,678*ratioh,399*ratiow,680*ratioh,407*ratiow,681*ratioh,414*ratiow,681*ratioh,421*ratiow,680*ratioh,429*ratiow,678*ratioh,439*ratiow,676*ratioh,448*ratiow,672*ratioh,457*ratiow,668*ratioh,467*ratiow,662*ratioh,474*ratiow,656*ratioh,481*ratiow,649*ratioh,486*ratiow,642*ratioh,492*ratiow,633*ratioh,496*ratiow,624*ratioh,498*ratiow,613*ratioh,500*ratiow,597*ratioh,500*ratiow,584*ratioh,498*ratiow,574*ratioh,496*ratiow,566*ratioh,493*ratiow,560*ratioh,489*ratiow,554*ratioh,487*ratiow,559*ratioh,486*ratiow,558*ratioh,486*ratiow,541*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(493*ratiow,505*ratioh,505*ratiow,506*ratioh,512*ratiow,509*ratioh,518*ratiow,513*ratioh,525*ratiow,526*ratioh,533*ratiow,537*ratioh,542*ratiow,546*ratioh,547*ratiow,555*ratioh,550*ratiow,563*ratioh,546*ratiow,578*ratioh,544*ratiow,587*ratioh,543*ratiow,601*ratioh,541*ratiow,609*ratioh,539*ratiow,616*ratioh,538*ratiow,624*ratioh,539*ratiow,637*ratioh,539*ratiow,640*ratioh,536*ratiow,645*ratioh,535*ratiow,651*ratioh,534*ratiow,666*ratioh,530*ratiow,679*ratioh,522*ratiow,694*ratioh,513*ratiow,705*ratioh,502*ratiow,713*ratioh,494*ratiow,718*ratioh,477*ratiow,730*ratioh,470*ratiow,728*ratioh,451*ratiow,732*ratioh,435*ratiow,733*ratioh,413*ratiow,728*ratioh,402*ratiow,725*ratioh,383*ratiow,719*ratioh,375*ratiow,719*ratioh,372*ratiow,724*ratioh,371*ratiow,733*ratioh,368*ratiow,739*ratioh,362*ratiow,742*ratioh,355*ratiow,743*ratioh,347*ratiow,741*ratioh,339*ratiow,738*ratioh,334*ratiow,734*ratioh,330*ratiow,728*ratioh,327*ratiow,721*ratioh,324*ratiow,714*ratioh,320*ratiow,711*ratioh,315*ratiow,711*ratioh,311*ratiow,712*ratioh,309*ratiow,713*ratioh,310*ratiow,708*ratioh,310*ratiow,699*ratioh,309*ratiow,687*ratioh,306*ratiow,676*ratioh,303*ratiow,668*ratioh,300*ratiow,661*ratioh,294*ratiow,654*ratioh,290*ratiow,651*ratioh,287*ratiow,651*ratioh,284*ratiow,653*ratioh,288*ratiow,660*ratioh,294*ratiow,672*ratioh,302*ratiow,686*ratioh,303*ratiow,692*ratioh,303*ratiow,702*ratioh,303*ratiow,715*ratioh,297*ratiow,718*ratioh,298*ratiow,704*ratioh,296*ratiow,694*ratioh,291*ratiow,684*ratioh,282*ratiow,672*ratioh,274*ratiow,660*ratioh,264*ratiow,647*ratioh,263*ratiow,646*ratioh,362*ratiow,640*ratioh,365*ratiow,652*ratioh,370*ratiow,659*ratioh,375*ratiow,666*ratioh,383*ratiow,672*ratioh,392*ratiow,677*ratioh,399*ratiow,680*ratioh,406*ratiow,681*ratioh,415*ratiow,681*ratioh,429*ratiow,679*ratioh,441*ratiow,675*ratioh,456*ratiow,668*ratioh,468*ratiow,661*ratioh,479*ratiow,651*ratioh,488*ratiow,640*ratioh,494*ratiow,626*ratioh,499*ratiow,611*ratioh,500*ratiow,599*ratioh,500*ratiow,584*ratioh,497*ratiow,570*ratioh,493*ratiow,559*ratioh,489*ratiow,554*ratioh,491*ratiow,537*ratioh,492*ratiow,519*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(484*ratiow,389*ratioh,483*ratiow,365*ratioh,476*ratiow,330*ratioh,467*ratiow,310*ratioh,459*ratiow,298*ratioh,444*ratiow,282*ratioh,433*ratiow,270*ratioh,423*ratiow,262*ratioh,413*ratiow,254*ratioh,404*ratiow,249*ratioh,399*ratiow,247*ratioh,380*ratiow,246*ratioh,353*ratiow,248*ratioh,319*ratiow,258*ratioh,303*ratiow,266*ratioh,267*ratiow,289*ratioh,253*ratiow,302*ratioh,240*ratiow,316*ratioh,229*ratiow,333*ratioh,219*ratiow,352*ratioh,213*ratiow,370*ratioh,207*ratiow,398*ratioh,205*ratiow,414*ratioh,205*ratiow,438*ratioh,207*ratiow,463*ratioh,210*ratiow,484*ratioh,215*ratiow,503*ratioh,219*ratiow,518*ratioh,226*ratiow,536*ratioh,234*ratiow,552*ratioh,240*ratiow,564*ratioh,242*ratiow,573*ratioh,244*ratiow,584*ratioh,245*ratiow,596*ratioh,251*ratiow,618*ratioh,256*ratiow,632*ratioh,263*ratiow,646*ratioh,273*ratiow,659*ratioh,285*ratiow,650*ratioh,362*ratiow,637*ratioh,365*ratiow,628*ratioh,373*ratiow,616*ratioh,385*ratiow,606*ratioh,397*ratiow,598*ratioh,417*ratiow,583*ratioh,431*ratiow,573*ratioh,444*ratiow,563*ratioh,455*ratiow,553*ratioh,477*ratiow,535*ratioh,487*ratiow,524*ratioh,489*ratiow,521*ratioh,492*ratiow,459*ratioh,487*ratiow,408*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(254*ratiow,785*ratioh,266*ratiow,757*ratioh,263*ratiow,756*ratioh,256*ratiow,756*ratioh,251*ratiow,751*ratioh,246*ratiow,743*ratioh,240*ratiow,735*ratioh,233*ratiow,726*ratioh,228*ratiow,720*ratioh,222*ratiow,718*ratioh,214*ratiow,719*ratioh,201*ratiow,724*ratioh,193*ratiow,727*ratioh,188*ratiow,728*ratioh,179*ratiow,726*ratioh,171*ratiow,724*ratioh,161*ratiow,719*ratioh,153*ratiow,714*ratioh,146*ratiow,706*ratioh,139*ratiow,695*ratioh,132*ratiow,679*ratioh,128*ratiow,669*ratioh,128*ratiow,661*ratioh,107*ratiow,673*ratioh,113*ratiow,685*ratioh,119*ratiow,696*ratioh,130*ratiow,710*ratioh,141*ratiow,721*ratioh,153*ratiow,732*ratioh,167*ratiow,743*ratioh,180*ratiow,753*ratioh,188*ratiow,749*ratioh,203*ratiow,746*ratioh,219*ratiow,747*ratioh,231*ratiow,753*ratioh,236*ratiow,761*ratioh,242*ratiow,771*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(273*ratiow,744*ratioh,266*ratiow,756*ratioh,256*ratiow,756*ratioh,250*ratiow,750*ratioh,242*ratiow,738*ratioh,237*ratiow,731*ratioh,232*ratiow,724*ratioh,227*ratiow,719*ratioh,221*ratiow,718*ratioh,214*ratiow,718*ratioh,199*ratiow,725*ratioh,192*ratiow,727*ratioh,187*ratiow,727*ratioh,180*ratiow,727*ratioh,171*ratiow,724*ratioh,162*ratiow,720*ratioh,153*ratiow,713*ratioh,146*ratiow,706*ratioh,140*ratiow,695*ratioh,134*ratiow,683*ratioh,128*ratiow,668*ratioh,128*ratiow,661*ratioh,133*ratiow,658*ratioh,136*ratiow,661*ratioh,144*ratiow,671*ratioh,151*ratiow,686*ratioh,157*ratiow,699*ratioh,162*ratiow,705*ratioh,169*ratiow,709*ratioh,176*ratiow,711*ratioh,183*ratiow,712*ratioh,195*ratiow,710*ratioh,206*ratiow,707*ratioh,217*ratiow,704*ratioh,225*ratiow,705*ratioh,233*ratiow,709*ratioh,240*ratiow,714*ratioh,245*ratiow,720*ratioh,248*ratiow,725*ratioh,251*ratiow,732*ratioh,253*ratiow,739*ratioh,259*ratiow,742*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(290*ratiow,730*ratioh,282*ratiow,735*ratioh,275*ratiow,741*ratioh,273*ratiow,744*ratioh,264*ratiow,743*ratioh,257*ratiow,741*ratioh,252*ratiow,736*ratioh,250*ratiow,729*ratioh,247*ratiow,722*ratioh,242*ratiow,716*ratioh,233*ratiow,709*ratioh,226*ratiow,705*ratioh,216*ratiow,704*ratioh,200*ratiow,708*ratioh,192*ratiow,711*ratioh,181*ratiow,712*ratioh,171*ratiow,710*ratioh,162*ratiow,706*ratioh,156*ratiow,697*ratioh,151*ratiow,686*ratioh,146*ratiow,676*ratioh,141*ratiow,667*ratioh,135*ratiow,660*ratioh,132*ratiow,659*ratioh,156*ratiow,644*ratioh,172*ratiow,634*ratioh,215*ratiow,607*ratioh,217*ratiow,607*ratioh,215*ratiow,611*ratioh,210*ratiow,617*ratioh,205*ratiow,625*ratioh,202*ratiow,630*ratioh,199*ratiow,637*ratioh,197*ratiow,644*ratioh,197*ratiow,652*ratioh,198*ratiow,658*ratioh,205*ratiow,662*ratioh,226*ratiow,665*ratioh,240*ratiow,665*ratioh,243*ratiow,668*ratioh,248*ratiow,673*ratioh,259*ratiow,684*ratioh,266*ratiow,694*ratioh,272*ratiow,703*ratioh,277*ratiow,712*ratioh,282*ratiow,720*ratioh,286*ratiow,724*ratioh,291*ratiow,725*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(454*ratiow,587*ratioh,459*ratiow,588*ratioh,462*ratiow,592*ratioh,462*ratiow,598*ratioh,461*ratiow,604*ratioh,458*ratiow,611*ratioh,453*ratiow,620*ratioh,446*ratiow,627*ratioh,437*ratiow,634*ratioh,430*ratiow,638*ratioh,427*ratiow,638*ratioh,425*ratiow,636*ratioh,425*ratiow,624*ratioh,428*ratiow,614*ratioh,432*ratiow,605*ratioh,439*ratiow,597*ratioh,446*ratiow,591*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(152*ratiow,184*ratioh,97*ratiow,57*ratioh,78*ratiow,15*ratioh,57*ratiow,26*ratioh,45*ratiow,33*ratioh,35*ratiow,42*ratioh,26*ratiow,51*ratioh,18*ratiow,62*ratioh,12*ratiow,73*ratioh,7*ratiow,91*ratioh,4*ratiow,108*ratioh,3*ratiow,119*ratioh,12*ratiow,125*ratioh,25*ratiow,132*ratioh,66*ratiow,156*ratioh,113*ratiow,183*ratioh,135*ratiow,196*ratioh,137*ratiow,194*ratioh,140*ratiow,191*ratioh,143*ratiow,189*ratioh,145*ratiow,187*ratioh,149*ratiow,186*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(135*ratiow,195*ratioh,97*ratiow,174*ratioh,65*ratiow,155*ratioh,32*ratiow,136*ratioh,8*ratiow,122*ratioh,3*ratiow,119*ratioh,1*ratiow,143*ratioh,1*ratiow,284*ratioh,13*ratiow,289*ratioh,12*ratiow,301*ratioh,28*ratiow,299*ratioh,47*ratiow,295*ratioh,66*ratiow,289*ratioh,83*ratiow,278*ratioh,96*ratiow,263*ratioh,106*ratiow,251*ratioh,113*ratiow,241*ratioh,119*ratiow,227*ratioh,126*ratiow,213*ratioh,131*ratiow,202*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(112*ratiow,523*ratioh,126*ratiow,537*ratioh,145*ratiow,554*ratioh,168*ratiow,572*ratioh,195*ratiow,592*ratioh,215*ratiow,606*ratioh,225*ratiow,614*ratioh,232*ratiow,623*ratioh,236*ratiow,630*ratioh,238*ratiow,640*ratioh,237*ratiow,650*ratioh,231*ratiow,659*ratioh,225*ratiow,665*ratioh,220*ratiow,670*ratioh,214*ratiow,675*ratioh,207*ratiow,678*ratioh,201*ratiow,680*ratioh,193*ratiow,681*ratioh,186*ratiow,681*ratioh,179*ratiow,680*ratioh,171*ratiow,678*ratioh,161*ratiow,676*ratioh,152*ratiow,672*ratioh,143*ratiow,668*ratioh,133*ratiow,662*ratioh,126*ratiow,656*ratioh,119*ratiow,649*ratioh,114*ratiow,642*ratioh,108*ratiow,633*ratioh,104*ratiow,624*ratioh,102*ratiow,613*ratioh,100*ratiow,597*ratioh,100*ratiow,584*ratioh,102*ratiow,574*ratioh,104*ratiow,566*ratioh,107*ratiow,560*ratioh,111*ratiow,554*ratioh,113*ratiow,559*ratioh,114*ratiow,558*ratioh,114*ratiow,541*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(107*ratiow,505*ratioh,95*ratiow,506*ratioh,88*ratiow,509*ratioh,82*ratiow,513*ratioh,75*ratiow,526*ratioh,67*ratiow,537*ratioh,58*ratiow,546*ratioh,53*ratiow,555*ratioh,50*ratiow,563*ratioh,54*ratiow,578*ratioh,56*ratiow,587*ratioh,57*ratiow,601*ratioh,59*ratiow,609*ratioh,61*ratiow,616*ratioh,62*ratiow,624*ratioh,61*ratiow,637*ratioh,61*ratiow,640*ratioh,64*ratiow,645*ratioh,65*ratiow,651*ratioh,66*ratiow,666*ratioh,70*ratiow,679*ratioh,78*ratiow,694*ratioh,87*ratiow,705*ratioh,98*ratiow,713*ratioh,106*ratiow,718*ratioh,123*ratiow,730*ratioh,130*ratiow,728*ratioh,149*ratiow,732*ratioh,165*ratiow,733*ratioh,187*ratiow,728*ratioh,198*ratiow,725*ratioh,217*ratiow,719*ratioh,225*ratiow,719*ratioh,228*ratiow,724*ratioh,229*ratiow,733*ratioh,232*ratiow,739*ratioh,238*ratiow,742*ratioh,245*ratiow,743*ratioh,253*ratiow,741*ratioh,261*ratiow,738*ratioh,266*ratiow,734*ratioh,270*ratiow,728*ratioh,273*ratiow,721*ratioh,276*ratiow,714*ratioh,280*ratiow,711*ratioh,285*ratiow,711*ratioh,289*ratiow,712*ratioh,291*ratiow,713*ratioh,290*ratiow,708*ratioh,290*ratiow,699*ratioh,291*ratiow,687*ratioh,294*ratiow,676*ratioh,297*ratiow,668*ratioh,300*ratiow,661*ratioh,306*ratiow,654*ratioh,310*ratiow,651*ratioh,313*ratiow,651*ratioh,316*ratiow,653*ratioh,312*ratiow,660*ratioh,306*ratiow,672*ratioh,298*ratiow,686*ratioh,297*ratiow,692*ratioh,297*ratiow,702*ratioh,297*ratiow,715*ratioh,303*ratiow,718*ratioh,302*ratiow,704*ratioh,304*ratiow,694*ratioh,309*ratiow,684*ratioh,318*ratiow,672*ratioh,326*ratiow,660*ratioh,336*ratiow,647*ratioh,337*ratiow,646*ratioh,238*ratiow,640*ratioh,235*ratiow,652*ratioh,230*ratiow,659*ratioh,225*ratiow,666*ratioh,217*ratiow,672*ratioh,208*ratiow,677*ratioh,201*ratiow,680*ratioh,194*ratiow,681*ratioh,185*ratiow,681*ratioh,171*ratiow,679*ratioh,159*ratiow,675*ratioh,144*ratiow,668*ratioh,132*ratiow,661*ratioh,121*ratiow,651*ratioh,112*ratiow,640*ratioh,106*ratiow,626*ratioh,101*ratiow,611*ratioh,100*ratiow,599*ratioh,100*ratiow,584*ratioh,103*ratiow,570*ratioh,107*ratiow,559*ratioh,111*ratiow,554*ratioh,109*ratiow,537*ratioh,108*ratiow,519*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(116*ratiow,389*ratioh,117*ratiow,365*ratioh,124*ratiow,330*ratioh,133*ratiow,310*ratioh,141*ratiow,298*ratioh,156*ratiow,282*ratioh,167*ratiow,270*ratioh,177*ratiow,262*ratioh,187*ratiow,254*ratioh,196*ratiow,249*ratioh,201*ratiow,247*ratioh,220*ratiow,246*ratioh,247*ratiow,248*ratioh,281*ratiow,258*ratioh,297*ratiow,266*ratioh,333*ratiow,289*ratioh,347*ratiow,302*ratioh,360*ratiow,316*ratioh,371*ratiow,333*ratioh,381*ratiow,352*ratioh,387*ratiow,370*ratioh,393*ratiow,398*ratioh,395*ratiow,414*ratioh,395*ratiow,438*ratioh,393*ratiow,463*ratioh,390*ratiow,484*ratioh,385*ratiow,503*ratioh,381*ratiow,518*ratioh,374*ratiow,536*ratioh,366*ratiow,552*ratioh,360*ratiow,564*ratioh,358*ratiow,573*ratioh,356*ratiow,584*ratioh,355*ratiow,596*ratioh,349*ratiow,618*ratioh,344*ratiow,632*ratioh,337*ratiow,646*ratioh,327*ratiow,659*ratioh,315*ratiow,650*ratioh,238*ratiow,637*ratioh,235*ratiow,628*ratioh,227*ratiow,616*ratioh,215*ratiow,606*ratioh,203*ratiow,598*ratioh,183*ratiow,583*ratioh,169*ratiow,573*ratioh,156*ratiow,563*ratioh,145*ratiow,553*ratioh,123*ratiow,535*ratioh,113*ratiow,524*ratioh,111*ratiow,521*ratioh,108*ratiow,459*ratioh,113*ratiow,408*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(346*ratiow,785*ratioh,334*ratiow,757*ratioh,337*ratiow,756*ratioh,344*ratiow,756*ratioh,349*ratiow,751*ratioh,354*ratiow,743*ratioh,360*ratiow,735*ratioh,367*ratiow,726*ratioh,372*ratiow,720*ratioh,378*ratiow,718*ratioh,386*ratiow,719*ratioh,399*ratiow,724*ratioh,407*ratiow,727*ratioh,412*ratiow,728*ratioh,421*ratiow,726*ratioh,429*ratiow,724*ratioh,439*ratiow,719*ratioh,447*ratiow,714*ratioh,454*ratiow,706*ratioh,461*ratiow,695*ratioh,468*ratiow,679*ratioh,472*ratiow,669*ratioh,472*ratiow,661*ratioh,493*ratiow,673*ratioh,487*ratiow,685*ratioh,481*ratiow,696*ratioh,470*ratiow,710*ratioh,459*ratiow,721*ratioh,447*ratiow,732*ratioh,433*ratiow,743*ratioh,420*ratiow,753*ratioh,412*ratiow,749*ratioh,397*ratiow,746*ratioh,381*ratiow,747*ratioh,369*ratiow,753*ratioh,364*ratiow,761*ratioh,358*ratiow,771*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(327*ratiow,744*ratioh,334*ratiow,756*ratioh,344*ratiow,756*ratioh,350*ratiow,750*ratioh,358*ratiow,738*ratioh,363*ratiow,731*ratioh,368*ratiow,724*ratioh,373*ratiow,719*ratioh,379*ratiow,718*ratioh,386*ratiow,718*ratioh,401*ratiow,725*ratioh,408*ratiow,727*ratioh,413*ratiow,727*ratioh,420*ratiow,727*ratioh,429*ratiow,724*ratioh,438*ratiow,720*ratioh,447*ratiow,713*ratioh,454*ratiow,706*ratioh,460*ratiow,695*ratioh,466*ratiow,683*ratioh,472*ratiow,668*ratioh,472*ratiow,661*ratioh,467*ratiow,658*ratioh,464*ratiow,661*ratioh,456*ratiow,671*ratioh,449*ratiow,686*ratioh,443*ratiow,699*ratioh,438*ratiow,705*ratioh,431*ratiow,709*ratioh,424*ratiow,711*ratioh,417*ratiow,712*ratioh,405*ratiow,710*ratioh,394*ratiow,707*ratioh,383*ratiow,704*ratioh,375*ratiow,705*ratioh,367*ratiow,709*ratioh,360*ratiow,714*ratioh,355*ratiow,720*ratioh,352*ratiow,725*ratioh,349*ratiow,732*ratioh,347*ratiow,739*ratioh,341*ratiow,742*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(310*ratiow,730*ratioh,318*ratiow,735*ratioh,325*ratiow,741*ratioh,327*ratiow,744*ratioh,336*ratiow,743*ratioh,343*ratiow,741*ratioh,348*ratiow,736*ratioh,350*ratiow,729*ratioh,353*ratiow,722*ratioh,358*ratiow,716*ratioh,367*ratiow,709*ratioh,374*ratiow,705*ratioh,384*ratiow,704*ratioh,400*ratiow,708*ratioh,408*ratiow,711*ratioh,419*ratiow,712*ratioh,429*ratiow,710*ratioh,438*ratiow,706*ratioh,444*ratiow,697*ratioh,449*ratiow,686*ratioh,454*ratiow,676*ratioh,459*ratiow,667*ratioh,465*ratiow,660*ratioh,468*ratiow,659*ratioh,444*ratiow,644*ratioh,428*ratiow,634*ratioh,385*ratiow,607*ratioh,383*ratiow,607*ratioh,385*ratiow,611*ratioh,390*ratiow,617*ratioh,395*ratiow,625*ratioh,398*ratiow,630*ratioh,401*ratiow,637*ratioh,403*ratiow,644*ratioh,403*ratiow,652*ratioh,402*ratiow,658*ratioh,395*ratiow,662*ratioh,374*ratiow,665*ratioh,360*ratiow,665*ratioh,357*ratiow,668*ratioh,352*ratiow,673*ratioh,341*ratiow,684*ratioh,334*ratiow,694*ratioh,328*ratiow,703*ratioh,323*ratiow,712*ratioh,318*ratiow,720*ratioh,314*ratiow,724*ratioh,309*ratiow,725*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(146*ratiow,587*ratioh,141*ratiow,588*ratioh,138*ratiow,592*ratioh,138*ratiow,598*ratioh,139*ratiow,604*ratioh,142*ratiow,611*ratioh,147*ratiow,620*ratioh,154*ratiow,627*ratioh,163*ratiow,634*ratioh,170*ratiow,638*ratioh,173*ratiow,638*ratioh,175*ratiow,636*ratioh,175*ratiow,624*ratioh,172*ratiow,614*ratioh,168*ratiow,605*ratioh,161*ratiow,597*ratioh,154*ratiow,591*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}


function processFile23(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 595;
var baseHeight = 810;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, AcbC, AcbSh, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(449*ratiow,181*ratioh,471*ratiow,133*ratioh,490*ratiow,88*ratioh,503*ratiow,54*ratioh,516*ratiow,24*ratioh,520*ratiow,12*ratioh,529*ratiow,16*ratioh,542*ratiow,22*ratioh,556*ratiow,32*ratioh,570*ratiow,43*ratioh,581*ratiow,60*ratioh,589*ratiow,80*ratioh,593*ratiow,100*ratioh,594*ratiow,118*ratioh,541*ratiow,147*ratioh,502*ratiow,169*ratioh,463*ratiow,190*ratioh,461*ratiow,187*ratioh,458*ratiow,185*ratioh,454*ratiow,183*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(464*ratiow,190*ratioh,509*ratiow,165*ratioh,560*ratiow,137*ratioh,585*ratiow,122*ratioh,594*ratiow,117*ratioh,594*ratiow,283*ratioh,590*ratiow,286*ratioh,590*ratiow,290*ratioh,594*ratiow,292*ratioh,593*ratiow,297*ratioh,572*ratiow,294*ratioh,547*ratiow,290*ratioh,525*ratiow,282*ratioh,518*ratiow,277*ratioh,504*ratiow,261*ratioh,492*ratiow,247*ratioh,481*ratiow,226*ratioh,473*ratiow,208*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(484*ratiow,508*ratioh,477*ratiow,520*ratioh,464*ratiow,535*ratioh,452*ratiow,547*ratioh,433*ratiow,557*ratioh,408*ratiow,570*ratioh,391*ratiow,581*ratioh,380*ratiow,590*ratioh,372*ratiow,599*ratioh,368*ratiow,606*ratioh,365*ratiow,616*ratioh,363*ratiow,628*ratioh,363*ratiow,639*ratioh,367*ratiow,650*ratioh,372*ratiow,657*ratioh,378*ratiow,661*ratioh,389*ratiow,663*ratioh,402*ratiow,664*ratioh,430*ratiow,660*ratioh,449*ratiow,654*ratioh,462*ratiow,648*ratioh,475*ratiow,636*ratioh,482*ratiow,623*ratioh,486*ratiow,610*ratioh,490*ratiow,594*ratioh,491*ratiow,574*ratioh,490*ratiow,561*ratioh,488*ratiow,551*ratioh,486*ratiow,549*ratioh,484*ratiow,559*ratioh,482*ratiow,563*ratioh,481*ratiow,560*ratioh,480*ratiow,554*ratioh,481*ratiow,546*ratioh,482*ratiow,531*ratioh,484*ratiow,518*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(486*ratiow,548*ratioh,489*ratiow,557*ratioh,490*ratiow,568*ratioh,490*ratiow,592*ratioh,488*ratiow,604*ratioh,484*ratiow,618*ratioh,476*ratiow,635*ratioh,466*ratiow,644*ratioh,454*ratiow,652*ratioh,433*ratiow,659*ratioh,413*ratiow,663*ratioh,390*ratiow,663*ratioh,381*ratiow,662*ratioh,375*ratiow,659*ratioh,368*ratiow,652*ratioh,364*ratiow,640*ratioh,363*ratiow,625*ratioh,364*ratiow,618*ratioh,260*ratiow,641*ratioh,277*ratiow,645*ratioh,286*ratiow,650*ratioh,297*ratiow,658*ratioh,303*ratiow,665*ratioh,307*ratiow,671*ratioh,309*ratiow,678*ratioh,310*ratiow,685*ratioh,311*ratiow,693*ratioh,311*ratiow,699*ratioh,308*ratiow,704*ratioh,311*ratiow,705*ratioh,319*ratiow,707*ratioh,325*ratiow,712*ratioh,332*ratiow,717*ratioh,346*ratiow,719*ratioh,363*ratiow,719*ratioh,384*ratiow,719*ratioh,389*ratiow,723*ratioh,394*ratiow,729*ratioh,400*ratiow,730*ratioh,408*ratiow,726*ratioh,414*ratiow,723*ratioh,420*ratiow,723*ratioh,427*ratiow,727*ratioh,433*ratiow,733*ratioh,438*ratiow,736*ratioh,445*ratiow,732*ratioh,455*ratiow,722*ratioh,466*ratiow,717*ratioh,476*ratiow,716*ratioh,481*ratiow,719*ratioh,495*ratiow,709*ratioh,506*ratiow,698*ratioh,519*ratiow,680*ratioh,526*ratiow,668*ratioh,532*ratiow,655*ratioh,537*ratiow,642*ratioh,536*ratiow,640*ratioh,532*ratiow,638*ratioh,533*ratiow,629*ratioh,535*ratiow,609*ratioh,536*ratiow,591*ratioh,536*ratiow,574*ratioh,535*ratiow,556*ratioh,531*ratiow,541*ratioh,525*ratiow,531*ratioh,518*ratiow,520*ratioh,510*ratiow,511*ratioh,503*ratiow,506*ratioh,497*ratiow,503*ratioh,493*ratiow,503*ratioh,491*ratiow,522*ratioh,488*ratiow,538*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(485*ratiow,506*ratioh,485*ratiow,493*ratioh,484*ratiow,461*ratioh,482*ratiow,429*ratioh,479*ratiow,414*ratioh,481*ratiow,365*ratioh,477*ratiow,338*ratioh,471*ratiow,317*ratioh,464*ratiow,302*ratioh,454*ratiow,287*ratioh,446*ratiow,279*ratioh,443*ratiow,272*ratioh,436*ratiow,265*ratioh,430*ratiow,261*ratioh,426*ratiow,263*ratioh,422*ratiow,269*ratioh,419*ratiow,267*ratioh,416*ratiow,260*ratioh,408*ratiow,252*ratioh,397*ratiow,245*ratioh,368*ratiow,245*ratioh,334*ratiow,252*ratioh,313*ratiow,261*ratioh,293*ratiow,270*ratioh,272*ratiow,285*ratioh,259*ratiow,297*ratioh,248*ratiow,310*ratioh,239*ratiow,322*ratioh,231*ratiow,333*ratioh,221*ratiow,353*ratioh,214*ratiow,368*ratioh,209*ratiow,387*ratioh,205*ratiow,408*ratioh,203*ratiow,425*ratioh,203*ratiow,464*ratioh,206*ratiow,484*ratioh,210*ratiow,504*ratioh,214*ratiow,526*ratioh,219*ratiow,551*ratioh,223*ratiow,565*ratioh,231*ratiow,594*ratioh,240*ratiow,614*ratioh,246*ratiow,625*ratioh,261*ratiow,642*ratioh,364*ratiow,616*ratioh,370*ratiow,601*ratioh,383*ratiow,587*ratioh,396*ratiow,578*ratioh,408*ratiow,570*ratioh,422*ratiow,563*ratioh,439*ratiow,554*ratioh,451*ratiow,547*ratioh,464*ratiow,536*ratioh,473*ratiow,524*ratioh,481*ratiow,513*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(240*ratiow,768*ratioh,233*ratiow,765*ratioh,222*ratiow,760*ratioh,217*ratiow,759*ratioh,215*ratiow,748*ratioh,206*ratiow,736*ratioh,199*ratiow,730*ratioh,189*ratiow,727*ratioh,177*ratiow,727*ratioh,163*ratiow,730*ratioh,154*ratiow,735*ratioh,141*ratiow,727*ratioh,128*ratiow,718*ratioh,114*ratiow,706*ratioh,105*ratiow,693*ratioh,97*ratiow,676*ratioh,92*ratiow,658*ratioh,116*ratiow,650*ratioh,116*ratiow,659*ratioh,121*ratiow,674*ratioh,126*ratiow,687*ratioh,135*ratiow,698*ratioh,148*ratiow,707*ratioh,158*ratiow,708*ratioh,169*ratiow,704*ratioh,183*ratiow,696*ratioh,195*ratiow,692*ratioh,209*ratiow,692*ratioh,219*ratiow,698*ratioh,227*ratiow,707*ratioh,231*ratiow,714*ratioh,233*ratiow,728*ratioh,237*ratiow,741*ratioh,243*ratiow,747*ratioh,248*ratiow,749*ratioh,244*ratiow,753*ratioh,241*ratiow,759*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(258*ratiow,732*ratioh,254*ratiow,740*ratioh,249*ratiow,747*ratioh,244*ratiow,747*ratioh,241*ratiow,746*ratioh,236*ratiow,739*ratioh,234*ratiow,731*ratioh,231*ratiow,719*ratioh,229*ratiow,711*ratioh,225*ratiow,705*ratioh,220*ratiow,699*ratioh,213*ratiow,694*ratioh,206*ratiow,691*ratioh,196*ratiow,692*ratioh,186*ratiow,695*ratioh,172*ratiow,702*ratioh,162*ratiow,708*ratioh,154*ratiow,708*ratioh,143*ratiow,704*ratioh,133*ratiow,696*ratioh,125*ratiow,684*ratioh,119*ratiow,670*ratioh,116*ratiow,656*ratioh,117*ratiow,649*ratioh,123*ratiow,648*ratioh,130*ratiow,654*ratioh,135*ratiow,663*ratioh,140*ratiow,674*ratioh,146*ratiow,682*ratioh,150*ratiow,688*ratioh,156*ratiow,690*ratioh,165*ratiow,687*ratioh,173*ratiow,683*ratioh,188*ratiow,677*ratioh,199*ratiow,674*ratioh,210*ratiow,674*ratioh,218*ratiow,676*ratioh,227*ratiow,681*ratioh,236*ratiow,689*ratioh,241*ratiow,696*ratioh,243*ratiow,704*ratioh,246*ratiow,716*ratioh,250*ratiow,723*ratioh,254*ratiow,729*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(275*ratiow,715*ratioh,267*ratiow,723*ratioh,257*ratiow,733*ratioh,253*ratiow,727*ratioh,249*ratiow,721*ratioh,245*ratiow,714*ratioh,244*ratiow,706*ratioh,241*ratiow,699*ratioh,239*ratiow,692*ratioh,234*ratiow,687*ratioh,228*ratiow,682*ratioh,222*ratiow,677*ratioh,215*ratiow,675*ratioh,208*ratiow,673*ratioh,195*ratiow,675*ratioh,185*ratiow,678*ratioh,171*ratiow,684*ratioh,161*ratiow,689*ratioh,153*ratiow,689*ratioh,147*ratiow,684*ratioh,136*ratiow,666*ratioh,132*ratiow,658*ratioh,129*ratiow,652*ratioh,122*ratiow,648*ratioh,133*ratiow,643*ratioh,152*ratiow,633*ratioh,164*ratiow,626*ratioh,170*ratiow,622*ratioh,176*ratiow,617*ratioh,175*ratiow,622*ratioh,172*ratiow,629*ratioh,172*ratiow,636*ratioh,175*ratiow,641*ratioh,184*ratiow,643*ratioh,191*ratiow,644*ratioh,206*ratiow,644*ratioh,220*ratiow,641*ratioh,228*ratiow,645*ratioh,237*ratiow,650*ratioh,244*ratiow,657*ratioh,250*ratiow,666*ratioh,255*ratiow,674*ratioh,260*ratiow,688*ratioh,265*ratiow,700*ratioh,269*ratiow,707*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(146*ratiow,181*ratioh,124*ratiow,133*ratioh,105*ratiow,88*ratioh,92*ratiow,54*ratioh,79*ratiow,24*ratioh,75*ratiow,12*ratioh,66*ratiow,16*ratioh,53*ratiow,22*ratioh,39*ratiow,32*ratioh,25*ratiow,43*ratioh,14*ratiow,60*ratioh,6*ratiow,80*ratioh,2*ratiow,100*ratioh,1*ratiow,118*ratioh,54*ratiow,147*ratioh,93*ratiow,169*ratioh,132*ratiow,190*ratioh,134*ratiow,187*ratioh,137*ratiow,185*ratioh,141*ratiow,183*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(131*ratiow,190*ratioh,86*ratiow,165*ratioh,35*ratiow,137*ratioh,10*ratiow,122*ratioh,1*ratiow,117*ratioh,1*ratiow,283*ratioh,5*ratiow,286*ratioh,5*ratiow,290*ratioh,1*ratiow,292*ratioh,2*ratiow,297*ratioh,23*ratiow,294*ratioh,48*ratiow,290*ratioh,70*ratiow,282*ratioh,77*ratiow,277*ratioh,91*ratiow,261*ratioh,103*ratiow,247*ratioh,114*ratiow,226*ratioh,122*ratiow,208*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(111*ratiow,508*ratioh,118*ratiow,520*ratioh,131*ratiow,535*ratioh,143*ratiow,547*ratioh,162*ratiow,557*ratioh,187*ratiow,570*ratioh,204*ratiow,581*ratioh,215*ratiow,590*ratioh,223*ratiow,599*ratioh,227*ratiow,606*ratioh,230*ratiow,616*ratioh,232*ratiow,628*ratioh,232*ratiow,639*ratioh,228*ratiow,650*ratioh,223*ratiow,657*ratioh,217*ratiow,661*ratioh,206*ratiow,663*ratioh,193*ratiow,664*ratioh,165*ratiow,660*ratioh,146*ratiow,654*ratioh,133*ratiow,648*ratioh,120*ratiow,636*ratioh,113*ratiow,623*ratioh,109*ratiow,610*ratioh,105*ratiow,594*ratioh,104*ratiow,574*ratioh,105*ratiow,561*ratioh,107*ratiow,551*ratioh,109*ratiow,549*ratioh,111*ratiow,559*ratioh,113*ratiow,563*ratioh,114*ratiow,560*ratioh,115*ratiow,554*ratioh,114*ratiow,546*ratioh,113*ratiow,531*ratioh,111*ratiow,518*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(109*ratiow,548*ratioh,106*ratiow,557*ratioh,105*ratiow,568*ratioh,105*ratiow,592*ratioh,107*ratiow,604*ratioh,111*ratiow,618*ratioh,119*ratiow,635*ratioh,129*ratiow,644*ratioh,141*ratiow,652*ratioh,162*ratiow,659*ratioh,182*ratiow,663*ratioh,205*ratiow,663*ratioh,214*ratiow,662*ratioh,220*ratiow,659*ratioh,227*ratiow,652*ratioh,231*ratiow,640*ratioh,232*ratiow,625*ratioh,231*ratiow,618*ratioh,335*ratiow,641*ratioh,318*ratiow,645*ratioh,309*ratiow,650*ratioh,298*ratiow,658*ratioh,292*ratiow,665*ratioh,288*ratiow,671*ratioh,286*ratiow,678*ratioh,285*ratiow,685*ratioh,284*ratiow,693*ratioh,284*ratiow,699*ratioh,287*ratiow,704*ratioh,284*ratiow,705*ratioh,276*ratiow,707*ratioh,270*ratiow,712*ratioh,263*ratiow,717*ratioh,249*ratiow,719*ratioh,232*ratiow,719*ratioh,211*ratiow,719*ratioh,206*ratiow,723*ratioh,201*ratiow,729*ratioh,195*ratiow,730*ratioh,187*ratiow,726*ratioh,181*ratiow,723*ratioh,175*ratiow,723*ratioh,168*ratiow,727*ratioh,162*ratiow,733*ratioh,157*ratiow,736*ratioh,150*ratiow,732*ratioh,140*ratiow,722*ratioh,129*ratiow,717*ratioh,119*ratiow,716*ratioh,114*ratiow,719*ratioh,100*ratiow,709*ratioh,89*ratiow,698*ratioh,76*ratiow,680*ratioh,69*ratiow,668*ratioh,63*ratiow,655*ratioh,58*ratiow,642*ratioh,59*ratiow,640*ratioh,63*ratiow,638*ratioh,62*ratiow,629*ratioh,60*ratiow,609*ratioh,59*ratiow,591*ratioh,59*ratiow,574*ratioh,60*ratiow,556*ratioh,64*ratiow,541*ratioh,70*ratiow,531*ratioh,77*ratiow,520*ratioh,85*ratiow,511*ratioh,92*ratiow,506*ratioh,98*ratiow,503*ratioh,102*ratiow,503*ratioh,104*ratiow,522*ratioh,107*ratiow,538*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(110*ratiow,506*ratioh,110*ratiow,493*ratioh,111*ratiow,461*ratioh,113*ratiow,429*ratioh,116*ratiow,414*ratioh,114*ratiow,365*ratioh,118*ratiow,338*ratioh,124*ratiow,317*ratioh,131*ratiow,302*ratioh,141*ratiow,287*ratioh,149*ratiow,279*ratioh,152*ratiow,272*ratioh,159*ratiow,265*ratioh,165*ratiow,261*ratioh,169*ratiow,263*ratioh,173*ratiow,269*ratioh,176*ratiow,267*ratioh,179*ratiow,260*ratioh,187*ratiow,252*ratioh,198*ratiow,245*ratioh,227*ratiow,245*ratioh,261*ratiow,252*ratioh,282*ratiow,261*ratioh,302*ratiow,270*ratioh,323*ratiow,285*ratioh,336*ratiow,297*ratioh,347*ratiow,310*ratioh,356*ratiow,322*ratioh,364*ratiow,333*ratioh,374*ratiow,353*ratioh,381*ratiow,368*ratioh,386*ratiow,387*ratioh,390*ratiow,408*ratioh,392*ratiow,425*ratioh,392*ratiow,464*ratioh,389*ratiow,484*ratioh,385*ratiow,504*ratioh,381*ratiow,526*ratioh,376*ratiow,551*ratioh,372*ratiow,565*ratioh,364*ratiow,594*ratioh,355*ratiow,614*ratioh,349*ratiow,625*ratioh,334*ratiow,642*ratioh,231*ratiow,616*ratioh,225*ratiow,601*ratioh,212*ratiow,587*ratioh,199*ratiow,578*ratioh,187*ratiow,570*ratioh,173*ratiow,563*ratioh,156*ratiow,554*ratioh,144*ratiow,547*ratioh,131*ratiow,536*ratioh,122*ratiow,524*ratioh,114*ratiow,513*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(355*ratiow,768*ratioh,362*ratiow,765*ratioh,373*ratiow,760*ratioh,378*ratiow,759*ratioh,380*ratiow,748*ratioh,389*ratiow,736*ratioh,396*ratiow,730*ratioh,406*ratiow,727*ratioh,418*ratiow,727*ratioh,432*ratiow,730*ratioh,441*ratiow,735*ratioh,454*ratiow,727*ratioh,467*ratiow,718*ratioh,481*ratiow,706*ratioh,490*ratiow,693*ratioh,498*ratiow,676*ratioh,503*ratiow,658*ratioh,479*ratiow,650*ratioh,479*ratiow,659*ratioh,474*ratiow,674*ratioh,469*ratiow,687*ratioh,460*ratiow,698*ratioh,447*ratiow,707*ratioh,437*ratiow,708*ratioh,426*ratiow,704*ratioh,412*ratiow,696*ratioh,400*ratiow,692*ratioh,386*ratiow,692*ratioh,376*ratiow,698*ratioh,368*ratiow,707*ratioh,364*ratiow,714*ratioh,362*ratiow,728*ratioh,358*ratiow,741*ratioh,352*ratiow,747*ratioh,347*ratiow,749*ratioh,351*ratiow,753*ratioh,354*ratiow,759*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(337*ratiow,732*ratioh,341*ratiow,740*ratioh,346*ratiow,747*ratioh,351*ratiow,747*ratioh,354*ratiow,746*ratioh,359*ratiow,739*ratioh,361*ratiow,731*ratioh,364*ratiow,719*ratioh,366*ratiow,711*ratioh,370*ratiow,705*ratioh,375*ratiow,699*ratioh,382*ratiow,694*ratioh,389*ratiow,691*ratioh,399*ratiow,692*ratioh,409*ratiow,695*ratioh,423*ratiow,702*ratioh,433*ratiow,708*ratioh,441*ratiow,708*ratioh,452*ratiow,704*ratioh,462*ratiow,696*ratioh,470*ratiow,684*ratioh,476*ratiow,670*ratioh,479*ratiow,656*ratioh,478*ratiow,649*ratioh,472*ratiow,648*ratioh,465*ratiow,654*ratioh,460*ratiow,663*ratioh,455*ratiow,674*ratioh,449*ratiow,682*ratioh,445*ratiow,688*ratioh,439*ratiow,690*ratioh,430*ratiow,687*ratioh,422*ratiow,683*ratioh,407*ratiow,677*ratioh,396*ratiow,674*ratioh,385*ratiow,674*ratioh,377*ratiow,676*ratioh,368*ratiow,681*ratioh,359*ratiow,689*ratioh,354*ratiow,696*ratioh,352*ratiow,704*ratioh,349*ratiow,716*ratioh,345*ratiow,723*ratioh,341*ratiow,729*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(320*ratiow,715*ratioh,328*ratiow,723*ratioh,338*ratiow,733*ratioh,342*ratiow,727*ratioh,346*ratiow,721*ratioh,350*ratiow,714*ratioh,351*ratiow,706*ratioh,354*ratiow,699*ratioh,356*ratiow,692*ratioh,361*ratiow,687*ratioh,367*ratiow,682*ratioh,373*ratiow,677*ratioh,380*ratiow,675*ratioh,387*ratiow,673*ratioh,400*ratiow,675*ratioh,410*ratiow,678*ratioh,424*ratiow,684*ratioh,434*ratiow,689*ratioh,442*ratiow,689*ratioh,448*ratiow,684*ratioh,459*ratiow,666*ratioh,463*ratiow,658*ratioh,466*ratiow,652*ratioh,473*ratiow,648*ratioh,462*ratiow,643*ratioh,443*ratiow,633*ratioh,431*ratiow,626*ratioh,425*ratiow,622*ratioh,419*ratiow,617*ratioh,420*ratiow,622*ratioh,423*ratiow,629*ratioh,423*ratiow,636*ratioh,420*ratiow,641*ratioh,411*ratiow,643*ratioh,404*ratiow,644*ratioh,389*ratiow,644*ratioh,375*ratiow,641*ratioh,367*ratiow,645*ratioh,358*ratiow,650*ratioh,351*ratiow,657*ratioh,345*ratiow,666*ratioh,340*ratiow,674*ratioh,335*ratiow,688*ratioh,330*ratiow,700*ratioh,326*ratiow,707*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}


function processFile24(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 594;
var baseHeight = 809;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, AcbC, AcbSh, CPu, Pir1, Pir2, Pir3, aca";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(466*ratiow,181*ratioh,477*ratiow,155*ratioh,488*ratiow,123*ratioh,500*ratiow,91*ratioh,510*ratiow,62*ratioh,522*ratiow,28*ratioh,525*ratiow,21*ratioh,538*ratiow,27*ratioh,552*ratiow,35*ratioh,565*ratiow,44*ratioh,575*ratiow,52*ratioh,585*ratiow,64*ratioh,591*ratiow,76*ratioh,593*ratiow,81*ratioh,593*ratiow,123*ratioh,578*ratiow,132*ratioh,556*ratiow,143*ratioh,530*ratiow,158*ratioh,502*ratiow,172*ratioh,472*ratiow,188*ratioh,470*ratiow,186*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(473*ratiow,188*ratioh,501*ratiow,173*ratioh,537*ratiow,154*ratioh,562*ratiow,140*ratioh,585*ratiow,128*ratioh,593*ratiow,124*ratioh,593*ratiow,282*ratioh,590*ratiow,286*ratioh,589*ratiow,291*ratioh,593*ratiow,294*ratioh,593*ratiow,299*ratioh,582*ratiow,295*ratioh,571*ratiow,297*ratioh,558*ratiow,295*ratioh,538*ratiow,288*ratioh,520*ratiow,278*ratioh,513*ratiow,268*ratioh,503*ratiow,256*ratioh,498*ratiow,249*ratioh,493*ratiow,234*ratioh,487*ratiow,216*ratioh,482*ratiow,204*ratioh,477*ratiow,194*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(480*ratiow,499*ratioh,478*ratiow,507*ratioh,471*ratiow,518*ratioh,458*ratiow,532*ratioh,445*ratiow,543*ratioh,422*ratiow,560*ratioh,404*ratiow,572*ratioh,393*ratiow,581*ratioh,384*ratiow,593*ratioh,374*ratiow,608*ratioh,367*ratiow,623*ratioh,363*ratiow,638*ratioh,362*ratiow,646*ratioh,367*ratiow,654*ratioh,375*ratiow,660*ratioh,389*ratiow,663*ratioh,407*ratiow,664*ratioh,422*ratiow,662*ratioh,435*ratiow,657*ratioh,448*ratiow,650*ratioh,459*ratiow,641*ratioh,470*ratiow,629*ratioh,478*ratiow,617*ratioh,483*ratiow,603*ratioh,486*ratiow,590*ratioh,486*ratiow,559*ratioh,484*ratiow,548*ratioh,482*ratiow,545*ratioh,480*ratiow,555*ratioh,477*ratiow,564*ratioh,475*ratiow,564*ratioh,475*ratiow,553*ratioh,478*ratiow,537*ratioh,480*ratiow,521*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(483*ratiow,536*ratioh,483*ratiow,546*ratioh,485*ratiow,554*ratioh,486*ratiow,562*ratioh,485*ratiow,591*ratioh,482*ratiow,605*ratioh,477*ratiow,618*ratioh,472*ratiow,626*ratioh,467*ratiow,633*ratioh,457*ratiow,643*ratioh,445*ratiow,653*ratioh,433*ratiow,658*ratioh,420*ratiow,663*ratioh,402*ratiow,664*ratioh,389*ratiow,663*ratioh,377*ratiow,660*ratioh,367*ratiow,655*ratioh,363*ratiow,649*ratioh,361*ratiow,642*ratioh,264*ratiow,652*ratioh,269*ratiow,660*ratioh,277*ratiow,671*ratioh,282*ratiow,679*ratioh,283*ratiow,692*ratioh,280*ratiow,699*ratioh,273*ratiow,709*ratioh,269*ratiow,714*ratioh,278*ratiow,721*ratioh,284*ratiow,714*ratioh,294*ratiow,705*ratioh,303*ratiow,700*ratioh,312*ratiow,699*ratioh,319*ratiow,700*ratioh,333*ratiow,705*ratioh,343*ratiow,709*ratioh,353*ratiow,712*ratioh,359*ratiow,715*ratioh,363*ratiow,722*ratioh,366*ratiow,728*ratioh,370*ratiow,733*ratioh,378*ratiow,734*ratioh,384*ratiow,731*ratioh,387*ratiow,723*ratioh,388*ratiow,716*ratioh,391*ratiow,709*ratioh,397*ratiow,706*ratioh,404*ratiow,706*ratioh,413*ratiow,709*ratioh,419*ratiow,712*ratioh,426*ratiow,716*ratioh,431*ratiow,718*ratioh,438*ratiow,715*ratioh,446*ratiow,711*ratioh,451*ratiow,709*ratioh,459*ratiow,706*ratioh,465*ratiow,704*ratioh,473*ratiow,702*ratioh,477*ratiow,697*ratioh,478*ratiow,689*ratioh,479*ratiow,683*ratioh,483*ratiow,678*ratioh,491*ratiow,675*ratioh,499*ratiow,673*ratioh,503*ratiow,675*ratioh,507*ratiow,672*ratioh,515*ratiow,661*ratioh,526*ratiow,642*ratioh,532*ratiow,628*ratioh,535*ratiow,620*ratioh,537*ratiow,614*ratioh,541*ratiow,600*ratioh,540*ratiow,594*ratioh,534*ratiow,587*ratioh,530*ratiow,580*ratioh,527*ratiow,572*ratioh,525*ratiow,562*ratioh,522*ratiow,550*ratioh,521*ratiow,539*ratioh,519*ratiow,535*ratioh,501*ratiow,513*ratioh,492*ratiow,502*ratioh,486*ratiow,496*ratioh,485*ratiow,517*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(363*ratiow,638*ratioh,370*ratiow,618*ratioh,378*ratiow,600*ratioh,387*ratiow,588*ratioh,395*ratiow,580*ratioh,409*ratiow,569*ratioh,427*ratiow,556*ratioh,441*ratiow,546*ratioh,457*ratiow,534*ratioh,468*ratiow,522*ratioh,477*ratiow,509*ratioh,481*ratiow,496*ratioh,480*ratiow,467*ratioh,480*ratiow,446*ratioh,478*ratiow,417*ratioh,477*ratiow,402*ratioh,478*ratiow,352*ratioh,478*ratiow,327*ratioh,476*ratiow,313*ratioh,470*ratiow,297*ratioh,461*ratiow,282*ratioh,447*ratiow,266*ratioh,442*ratiow,261*ratioh,431*ratiow,254*ratioh,428*ratiow,250*ratioh,428*ratiow,248*ratioh,413*ratiow,241*ratioh,395*ratiow,236*ratioh,370*ratiow,237*ratioh,336*ratiow,241*ratioh,314*ratiow,247*ratioh,289*ratiow,256*ratioh,273*ratiow,266*ratioh,258*ratiow,278*ratioh,240*ratiow,296*ratioh,223*ratiow,321*ratioh,214*ratiow,339*ratioh,205*ratiow,361*ratioh,201*ratiow,382*ratioh,199*ratiow,403*ratioh,199*ratiow,437*ratioh,200*ratiow,452*ratioh,202*ratiow,467*ratioh,205*ratiow,481*ratioh,213*ratiow,527*ratioh,222*ratiow,570*ratioh,226*ratiow,587*ratioh,237*ratiow,615*ratioh,245*ratiow,627*ratioh,256*ratiow,642*ratioh,265*ratiow,654*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(242*ratiow,751*ratioh,240*ratiow,759*ratioh,238*ratiow,764*ratioh,225*ratiow,758*ratioh,214*ratiow,754*ratioh,211*ratiow,745*ratioh,205*ratiow,736*ratioh,196*ratiow,729*ratioh,188*ratiow,725*ratioh,178*ratiow,724*ratioh,161*ratiow,728*ratioh,153*ratiow,732*ratioh,143*ratiow,727*ratioh,127*ratiow,716*ratioh,117*ratiow,707*ratioh,105*ratiow,694*ratioh,96*ratiow,677*ratioh,92*ratiow,661*ratioh,91*ratiow,656*ratioh,106*ratiow,652*ratioh,112*ratiow,651*ratioh,112*ratiow,658*ratioh,116*ratiow,669*ratioh,122*ratiow,680*ratioh,135*ratiow,697*ratioh,146*ratiow,704*ratioh,155*ratiow,705*ratioh,163*ratiow,702*ratioh,188*ratiow,691*ratioh,196*ratiow,688*ratioh,203*ratiow,687*ratioh,211*ratiow,689*ratioh,218*ratiow,695*ratioh,223*ratiow,705*ratioh,231*ratiow,729*ratioh,237*ratiow,741*ratioh,245*ratiow,746*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(251*ratiow,735*ratioh,246*ratiow,744*ratioh,244*ratiow,746*ratioh,241*ratiow,744*ratioh,236*ratiow,738*ratioh,232*ratiow,733*ratioh,229*ratiow,723*ratioh,226*ratiow,712*ratioh,220*ratiow,698*ratioh,215*ratiow,692*ratioh,208*ratiow,688*ratioh,201*ratiow,687*ratioh,194*ratiow,689*ratioh,181*ratiow,694*ratioh,166*ratiow,701*ratioh,154*ratiow,705*ratioh,144*ratiow,704*ratioh,138*ratiow,699*ratioh,127*ratiow,689*ratioh,121*ratiow,678*ratioh,116*ratiow,669*ratioh,113*ratiow,661*ratioh,111*ratiow,654*ratioh,112*ratiow,650*ratioh,115*ratiow,649*ratioh,118*ratiow,650*ratioh,123*ratiow,656*ratioh,128*ratiow,663*ratioh,133*ratiow,670*ratioh,140*ratiow,676*ratioh,146*ratiow,681*ratioh,154*ratiow,685*ratioh,163*ratiow,684*ratioh,171*ratiow,681*ratioh,184*ratiow,674*ratioh,190*ratiow,673*ratioh,198*ratiow,672*ratioh,205*ratiow,672*ratioh,219*ratiow,675*ratioh,226*ratiow,680*ratioh,232*ratiow,685*ratioh,236*ratiow,691*ratioh,239*ratiow,698*ratioh,241*ratiow,705*ratioh,243*ratiow,713*ratioh,245*ratiow,720*ratioh,247*ratiow,727*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(270*ratiow,713*ratioh,251*ratiow,735*ratioh,248*ratiow,732*ratioh,245*ratiow,720*ratioh,242*ratiow,709*ratioh,238*ratiow,694*ratioh,233*ratiow,687*ratioh,228*ratiow,681*ratioh,219*ratiow,675*ratioh,209*ratiow,672*ratioh,194*ratiow,672*ratioh,185*ratiow,674*ratioh,172*ratiow,680*ratioh,159*ratiow,685*ratioh,150*ratiow,684*ratioh,140*ratiow,676*ratioh,129*ratiow,665*ratioh,122*ratiow,655*ratioh,116*ratiow,649*ratioh,130*ratiow,642*ratioh,144*ratiow,635*ratioh,162*ratiow,622*ratioh,170*ratiow,616*ratioh,175*ratiow,612*ratioh,174*ratiow,617*ratioh,172*ratiow,629*ratioh,174*ratiow,637*ratioh,180*ratiow,641*ratioh,187*ratiow,643*ratioh,213*ratiow,641*ratioh,221*ratiow,645*ratioh,234*ratiow,653*ratioh,240*ratiow,660*ratioh,244*ratiow,666*ratioh,248*ratiow,672*ratioh,251*ratiow,679*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(437*ratiow,620*ratioh,446*ratiow,614*ratioh,455*ratiow,601*ratioh,459*ratiow,590*ratioh,458*ratiow,582*ratioh,453*ratiow,579*ratioh,447*ratiow,579*ratioh,439*ratiow,582*ratioh,431*ratiow,590*ratioh,424*ratiow,599*ratioh,421*ratiow,609*ratioh,419*ratiow,615*ratioh,420*ratiow,622*ratioh,423*ratiow,624*ratioh,430*ratiow,624*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(128*ratiow,181*ratioh,117*ratiow,155*ratioh,106*ratiow,123*ratioh,94*ratiow,91*ratioh,84*ratiow,62*ratioh,72*ratiow,28*ratioh,69*ratiow,21*ratioh,56*ratiow,27*ratioh,42*ratiow,35*ratioh,29*ratiow,44*ratioh,19*ratiow,52*ratioh,9*ratiow,64*ratioh,3*ratiow,76*ratioh,1*ratiow,81*ratioh,1*ratiow,123*ratioh,16*ratiow,132*ratioh,38*ratiow,143*ratioh,64*ratiow,158*ratioh,92*ratiow,172*ratioh,122*ratiow,188*ratioh,124*ratiow,186*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(121*ratiow,188*ratioh,93*ratiow,173*ratioh,57*ratiow,154*ratioh,32*ratiow,140*ratioh,9*ratiow,128*ratioh,1*ratiow,124*ratioh,1*ratiow,282*ratioh,4*ratiow,286*ratioh,5*ratiow,291*ratioh,1*ratiow,294*ratioh,1*ratiow,299*ratioh,12*ratiow,295*ratioh,23*ratiow,297*ratioh,36*ratiow,295*ratioh,56*ratiow,288*ratioh,74*ratiow,278*ratioh,81*ratiow,268*ratioh,91*ratiow,256*ratioh,96*ratiow,249*ratioh,101*ratiow,234*ratioh,107*ratiow,216*ratioh,112*ratiow,204*ratioh,117*ratiow,194*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(114*ratiow,499*ratioh,116*ratiow,507*ratioh,123*ratiow,518*ratioh,136*ratiow,532*ratioh,149*ratiow,543*ratioh,172*ratiow,560*ratioh,190*ratiow,572*ratioh,201*ratiow,581*ratioh,210*ratiow,593*ratioh,220*ratiow,608*ratioh,227*ratiow,623*ratioh,231*ratiow,638*ratioh,232*ratiow,646*ratioh,227*ratiow,654*ratioh,219*ratiow,660*ratioh,205*ratiow,663*ratioh,187*ratiow,664*ratioh,172*ratiow,662*ratioh,159*ratiow,657*ratioh,146*ratiow,650*ratioh,135*ratiow,641*ratioh,124*ratiow,629*ratioh,116*ratiow,617*ratioh,111*ratiow,603*ratioh,108*ratiow,590*ratioh,108*ratiow,559*ratioh,110*ratiow,548*ratioh,112*ratiow,545*ratioh,114*ratiow,555*ratioh,117*ratiow,564*ratioh,119*ratiow,564*ratioh,119*ratiow,553*ratioh,116*ratiow,537*ratioh,114*ratiow,521*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(111*ratiow,536*ratioh,111*ratiow,546*ratioh,109*ratiow,554*ratioh,108*ratiow,562*ratioh,109*ratiow,591*ratioh,112*ratiow,605*ratioh,117*ratiow,618*ratioh,122*ratiow,626*ratioh,127*ratiow,633*ratioh,137*ratiow,643*ratioh,149*ratiow,653*ratioh,161*ratiow,658*ratioh,174*ratiow,663*ratioh,192*ratiow,664*ratioh,205*ratiow,663*ratioh,217*ratiow,660*ratioh,227*ratiow,655*ratioh,231*ratiow,649*ratioh,233*ratiow,642*ratioh,330*ratiow,652*ratioh,325*ratiow,660*ratioh,317*ratiow,671*ratioh,312*ratiow,679*ratioh,311*ratiow,692*ratioh,314*ratiow,699*ratioh,321*ratiow,709*ratioh,325*ratiow,714*ratioh,316*ratiow,721*ratioh,310*ratiow,714*ratioh,300*ratiow,705*ratioh,291*ratiow,700*ratioh,282*ratiow,699*ratioh,275*ratiow,700*ratioh,261*ratiow,705*ratioh,251*ratiow,709*ratioh,241*ratiow,712*ratioh,235*ratiow,715*ratioh,231*ratiow,722*ratioh,228*ratiow,728*ratioh,224*ratiow,733*ratioh,216*ratiow,734*ratioh,210*ratiow,731*ratioh,207*ratiow,723*ratioh,206*ratiow,716*ratioh,203*ratiow,709*ratioh,197*ratiow,706*ratioh,190*ratiow,706*ratioh,181*ratiow,709*ratioh,175*ratiow,712*ratioh,168*ratiow,716*ratioh,163*ratiow,718*ratioh,156*ratiow,715*ratioh,148*ratiow,711*ratioh,143*ratiow,709*ratioh,135*ratiow,706*ratioh,129*ratiow,704*ratioh,121*ratiow,702*ratioh,117*ratiow,697*ratioh,116*ratiow,689*ratioh,115*ratiow,683*ratioh,111*ratiow,678*ratioh,103*ratiow,675*ratioh,95*ratiow,673*ratioh,91*ratiow,675*ratioh,87*ratiow,672*ratioh,79*ratiow,661*ratioh,68*ratiow,642*ratioh,62*ratiow,628*ratioh,59*ratiow,620*ratioh,57*ratiow,614*ratioh,53*ratiow,600*ratioh,54*ratiow,594*ratioh,60*ratiow,587*ratioh,64*ratiow,580*ratioh,67*ratiow,572*ratioh,69*ratiow,562*ratioh,72*ratiow,550*ratioh,73*ratiow,539*ratioh,75*ratiow,535*ratioh,93*ratiow,513*ratioh,102*ratiow,502*ratioh,108*ratiow,496*ratioh,109*ratiow,517*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(231*ratiow,638*ratioh,224*ratiow,618*ratioh,216*ratiow,600*ratioh,207*ratiow,588*ratioh,199*ratiow,580*ratioh,185*ratiow,569*ratioh,167*ratiow,556*ratioh,153*ratiow,546*ratioh,137*ratiow,534*ratioh,126*ratiow,522*ratioh,117*ratiow,509*ratioh,113*ratiow,496*ratioh,114*ratiow,467*ratioh,114*ratiow,446*ratioh,116*ratiow,417*ratioh,117*ratiow,402*ratioh,116*ratiow,352*ratioh,116*ratiow,327*ratioh,118*ratiow,313*ratioh,124*ratiow,297*ratioh,133*ratiow,282*ratioh,147*ratiow,266*ratioh,152*ratiow,261*ratioh,163*ratiow,254*ratioh,166*ratiow,250*ratioh,166*ratiow,248*ratioh,181*ratiow,241*ratioh,199*ratiow,236*ratioh,224*ratiow,237*ratioh,258*ratiow,241*ratioh,280*ratiow,247*ratioh,305*ratiow,256*ratioh,321*ratiow,266*ratioh,336*ratiow,278*ratioh,354*ratiow,296*ratioh,371*ratiow,321*ratioh,380*ratiow,339*ratioh,389*ratiow,361*ratioh,393*ratiow,382*ratioh,395*ratiow,403*ratioh,395*ratiow,437*ratioh,394*ratiow,452*ratioh,392*ratiow,467*ratioh,389*ratiow,481*ratioh,381*ratiow,527*ratioh,372*ratiow,570*ratioh,368*ratiow,587*ratioh,357*ratiow,615*ratioh,349*ratiow,627*ratioh,338*ratiow,642*ratioh,329*ratiow,654*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(352*ratiow,751*ratioh,354*ratiow,759*ratioh,356*ratiow,764*ratioh,369*ratiow,758*ratioh,380*ratiow,754*ratioh,383*ratiow,745*ratioh,389*ratiow,736*ratioh,398*ratiow,729*ratioh,406*ratiow,725*ratioh,416*ratiow,724*ratioh,433*ratiow,728*ratioh,441*ratiow,732*ratioh,451*ratiow,727*ratioh,467*ratiow,716*ratioh,477*ratiow,707*ratioh,489*ratiow,694*ratioh,498*ratiow,677*ratioh,502*ratiow,661*ratioh,503*ratiow,656*ratioh,488*ratiow,652*ratioh,482*ratiow,651*ratioh,482*ratiow,658*ratioh,478*ratiow,669*ratioh,472*ratiow,680*ratioh,459*ratiow,697*ratioh,448*ratiow,704*ratioh,439*ratiow,705*ratioh,431*ratiow,702*ratioh,406*ratiow,691*ratioh,398*ratiow,688*ratioh,391*ratiow,687*ratioh,383*ratiow,689*ratioh,376*ratiow,695*ratioh,371*ratiow,705*ratioh,363*ratiow,729*ratioh,357*ratiow,741*ratioh,349*ratiow,746*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(343*ratiow,735*ratioh,348*ratiow,744*ratioh,350*ratiow,746*ratioh,353*ratiow,744*ratioh,358*ratiow,738*ratioh,362*ratiow,733*ratioh,365*ratiow,723*ratioh,368*ratiow,712*ratioh,374*ratiow,698*ratioh,379*ratiow,692*ratioh,386*ratiow,688*ratioh,393*ratiow,687*ratioh,400*ratiow,689*ratioh,413*ratiow,694*ratioh,428*ratiow,701*ratioh,440*ratiow,705*ratioh,450*ratiow,704*ratioh,456*ratiow,699*ratioh,467*ratiow,689*ratioh,473*ratiow,678*ratioh,478*ratiow,669*ratioh,481*ratiow,661*ratioh,483*ratiow,654*ratioh,482*ratiow,650*ratioh,479*ratiow,649*ratioh,476*ratiow,650*ratioh,471*ratiow,656*ratioh,466*ratiow,663*ratioh,461*ratiow,670*ratioh,454*ratiow,676*ratioh,448*ratiow,681*ratioh,440*ratiow,685*ratioh,431*ratiow,684*ratioh,423*ratiow,681*ratioh,410*ratiow,674*ratioh,404*ratiow,673*ratioh,396*ratiow,672*ratioh,389*ratiow,672*ratioh,375*ratiow,675*ratioh,368*ratiow,680*ratioh,362*ratiow,685*ratioh,358*ratiow,691*ratioh,355*ratiow,698*ratioh,353*ratiow,705*ratioh,351*ratiow,713*ratioh,349*ratiow,720*ratioh,347*ratiow,727*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(324*ratiow,713*ratioh,343*ratiow,735*ratioh,346*ratiow,732*ratioh,349*ratiow,720*ratioh,352*ratiow,709*ratioh,356*ratiow,694*ratioh,361*ratiow,687*ratioh,366*ratiow,681*ratioh,375*ratiow,675*ratioh,385*ratiow,672*ratioh,400*ratiow,672*ratioh,409*ratiow,674*ratioh,422*ratiow,680*ratioh,435*ratiow,685*ratioh,444*ratiow,684*ratioh,454*ratiow,676*ratioh,465*ratiow,665*ratioh,472*ratiow,655*ratioh,478*ratiow,649*ratioh,464*ratiow,642*ratioh,450*ratiow,635*ratioh,432*ratiow,622*ratioh,424*ratiow,616*ratioh,419*ratiow,612*ratioh,420*ratiow,617*ratioh,422*ratiow,629*ratioh,420*ratiow,637*ratioh,414*ratiow,641*ratioh,407*ratiow,643*ratioh,381*ratiow,641*ratioh,373*ratiow,645*ratioh,360*ratiow,653*ratioh,354*ratiow,660*ratioh,350*ratiow,666*ratioh,346*ratiow,672*ratioh,343*ratiow,679*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(157*ratiow,620*ratioh,148*ratiow,614*ratioh,139*ratiow,601*ratioh,135*ratiow,590*ratioh,136*ratiow,582*ratioh,141*ratiow,579*ratioh,147*ratiow,579*ratioh,155*ratiow,582*ratioh,163*ratiow,590*ratioh,170*ratiow,599*ratioh,173*ratiow,609*ratioh,175*ratiow,615*ratioh,174*ratiow,622*ratioh,171*ratiow,624*ratioh,164*ratiow,624*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile25(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 604;
var baseHeight = 818;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, AcbC, AcbSh, CPu, Pir1, Pir2, Pir3, aca";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(470*ratiow,196*ratioh,497*ratiow,140*ratioh,530*ratiow,71*ratioh,548*ratiow,33*ratioh,560*ratiow,41*ratioh,573*ratiow,53*ratioh,586*ratiow,70*ratioh,598*ratiow,90*ratioh,603*ratiow,105*ratioh,603*ratiow,131*ratioh,575*ratiow,145*ratioh,529*ratiow,169*ratioh,488*ratiow,189*ratioh,473*ratiow,198*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(472*ratiow,198*ratioh,514*ratiow,177*ratioh,563*ratiow,151*ratioh,603*ratiow,131*ratioh,603*ratiow,286*ratioh,598*ratiow,292*ratioh,590*ratiow,293*ratioh,581*ratiow,295*ratioh,579*ratiow,303*ratioh,566*ratiow,301*ratioh,555*ratiow,299*ratioh,543*ratiow,293*ratioh,533*ratiow,287*ratioh,522*ratiow,277*ratioh,513*ratiow,268*ratioh,504*ratiow,257*ratioh,498*ratiow,248*ratioh,491*ratiow,232*ratioh,486*ratiow,222*ratioh,481*ratiow,209*ratioh,476*ratiow,201*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(483*ratiow,519*ratioh,478*ratiow,527*ratioh,474*ratiow,535*ratioh,470*ratiow,544*ratioh,464*ratiow,552*ratioh,452*ratiow,563*ratioh,434*ratiow,577*ratioh,415*ratiow,591*ratioh,404*ratiow,600*ratioh,393*ratiow,612*ratioh,387*ratiow,621*ratioh,384*ratiow,631*ratioh,384*ratiow,641*ratioh,387*ratiow,647*ratioh,397*ratiow,653*ratioh,410*ratiow,654*ratioh,426*ratiow,652*ratioh,441*ratiow,647*ratioh,454*ratiow,640*ratioh,467*ratiow,632*ratioh,479*ratiow,622*ratioh,488*ratiow,610*ratioh,491*ratiow,600*ratioh,492*ratiow,583*ratioh,491*ratiow,567*ratioh,488*ratiow,550*ratioh,487*ratiow,559*ratioh,484*ratiow,568*ratioh,483*ratiow,572*ratioh,481*ratiow,574*ratioh,480*ratiow,573*ratioh,478*ratiow,572*ratioh,478*ratiow,566*ratioh,479*ratiow,553*ratioh,482*ratiow,540*ratioh,483*ratiow,531*ratioh,484*ratiow,526*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(492*ratiow,518*ratioh,491*ratiow,529*ratioh,490*ratiow,541*ratioh,488*ratiow,553*ratioh,490*ratiow,561*ratioh,491*ratiow,578*ratioh,492*ratiow,593*ratioh,489*ratiow,607*ratioh,484*ratiow,618*ratioh,471*ratiow,628*ratioh,464*ratiow,634*ratioh,450*ratiow,642*ratioh,433*ratiow,651*ratioh,413*ratiow,654*ratioh,400*ratiow,653*ratioh,392*ratiow,651*ratioh,386*ratiow,646*ratioh,384*ratiow,635*ratioh,384*ratiow,629*ratioh,256*ratiow,658*ratioh,262*ratiow,666*ratioh,268*ratiow,674*ratioh,275*ratiow,687*ratioh,281*ratiow,698*ratioh,283*ratiow,706*ratioh,282*ratiow,710*ratioh,270*ratiow,723*ratioh,277*ratiow,727*ratioh,289*ratiow,731*ratioh,288*ratiow,723*ratioh,291*ratiow,714*ratioh,295*ratiow,712*ratioh,292*ratiow,711*ratioh,290*ratiow,701*ratioh,288*ratiow,694*ratioh,285*ratiow,688*ratioh,281*ratiow,681*ratioh,277*ratiow,675*ratioh,273*ratiow,669*ratioh,270*ratiow,663*ratioh,269*ratiow,657*ratioh,271*ratiow,655*ratioh,276*ratiow,658*ratioh,282*ratiow,662*ratioh,289*ratiow,671*ratioh,294*ratiow,681*ratioh,298*ratiow,691*ratioh,301*ratiow,699*ratioh,302*ratiow,703*ratioh,303*ratiow,709*ratioh,304*ratiow,710*ratioh,310*ratiow,711*ratioh,327*ratiow,713*ratioh,340*ratiow,715*ratioh,348*ratiow,720*ratioh,357*ratiow,728*ratioh,362*ratiow,728*ratioh,369*ratiow,718*ratioh,376*ratiow,717*ratioh,382*ratiow,719*ratioh,388*ratiow,725*ratioh,393*ratiow,733*ratioh,398*ratiow,742*ratioh,408*ratiow,744*ratioh,415*ratiow,740*ratioh,420*ratiow,727*ratioh,424*ratiow,720*ratioh,430*ratiow,716*ratioh,442*ratiow,709*ratioh,457*ratiow,702*ratioh,470*ratiow,695*ratioh,481*ratiow,689*ratioh,492*ratiow,679*ratioh,500*ratiow,673*ratioh,504*ratiow,668*ratioh,512*ratiow,668*ratioh,516*ratiow,672*ratioh,515*ratiow,677*ratioh,513*ratiow,689*ratioh,518*ratiow,681*ratioh,525*ratiow,668*ratioh,530*ratiow,654*ratioh,535*ratiow,640*ratioh,539*ratiow,626*ratioh,543*ratiow,608*ratioh,545*ratiow,593*ratioh,546*ratiow,577*ratioh,542*ratiow,565*ratioh,537*ratiow,556*ratioh,531*ratiow,548*ratioh,523*ratiow,540*ratioh,515*ratiow,532*ratioh,506*ratiow,526*ratioh,499*ratiow,521*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(258*ratiow,659*ratioh,385*ratiow,627*ratioh,388*ratiow,619*ratioh,395*ratiow,610*ratioh,407*ratiow,598*ratioh,422*ratiow,586*ratioh,436*ratiow,575*ratioh,448*ratiow,566*ratioh,459*ratiow,556*ratioh,469*ratiow,546*ratioh,475*ratiow,534*ratioh,479*ratiow,526*ratioh,483*ratiow,518*ratioh,484*ratiow,515*ratioh,483*ratiow,485*ratioh,481*ratiow,447*ratioh,478*ratiow,385*ratioh,477*ratiow,348*ratioh,476*ratiow,331*ratioh,472*ratiow,320*ratioh,465*ratiow,305*ratioh,460*ratiow,294*ratioh,454*ratiow,286*ratioh,447*ratiow,278*ratioh,440*ratiow,268*ratioh,433*ratiow,262*ratioh,419*ratiow,255*ratioh,405*ratiow,251*ratioh,387*ratiow,248*ratioh,362*ratiow,248*ratioh,343*ratiow,250*ratioh,319*ratiow,254*ratioh,295*ratiow,263*ratioh,274*ratiow,273*ratioh,258*ratiow,284*ratioh,251*ratiow,288*ratioh,236*ratiow,301*ratioh,220*ratiow,318*ratioh,203*ratiow,342*ratioh,196*ratiow,360*ratioh,191*ratiow,376*ratioh,187*ratiow,392*ratioh,184*ratiow,412*ratioh,183*ratiow,430*ratioh,184*ratiow,460*ratioh,186*ratiow,478*ratioh,192*ratiow,510*ratioh,198*ratiow,533*ratioh,206*ratiow,558*ratioh,210*ratiow,575*ratioh,214*ratiow,592*ratioh,222*ratiow,613*ratioh,233*ratiow,630*ratioh,244*ratiow,644*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(250*ratiow,754*ratioh,247*ratiow,762*ratioh,243*ratiow,775*ratioh,235*ratiow,772*ratioh,225*ratiow,769*ratioh,220*ratiow,767*ratioh,217*ratiow,761*ratioh,211*ratiow,751*ratioh,205*ratiow,743*ratioh,198*ratiow,737*ratioh,188*ratiow,734*ratioh,179*ratiow,732*ratioh,165*ratiow,733*ratioh,158*ratiow,740*ratioh,152*ratiow,734*ratioh,142*ratiow,729*ratioh,116*ratiow,714*ratioh,101*ratiow,695*ratioh,93*ratiow,683*ratioh,85*ratiow,672*ratioh,100*ratiow,663*ratioh,110*ratiow,657*ratioh,110*ratiow,661*ratioh,112*ratiow,668*ratioh,116*ratiow,676*ratioh,123*ratiow,685*ratioh,132*ratiow,696*ratioh,141*ratiow,704*ratioh,150*ratiow,705*ratioh,163*ratiow,703*ratioh,177*ratiow,698*ratioh,188*ratiow,695*ratioh,198*ratiow,695*ratioh,205*ratiow,697*ratioh,212*ratiow,702*ratioh,218*ratiow,709*ratioh,222*ratiow,719*ratioh,226*ratiow,728*ratioh,229*ratiow,735*ratioh,232*ratiow,743*ratioh,234*ratiow,751*ratioh,238*ratiow,757*ratioh,242*ratiow,758*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(261*ratiow,736*ratioh,255*ratiow,746*ratioh,252*ratiow,752*ratioh,248*ratiow,755*ratioh,242*ratiow,758*ratioh,238*ratiow,757*ratioh,235*ratiow,752*ratioh,232*ratiow,745*ratioh,230*ratiow,737*ratioh,227*ratiow,729*ratioh,224*ratiow,723*ratioh,221*ratiow,714*ratioh,216*ratiow,706*ratioh,208*ratiow,699*ratioh,201*ratiow,696*ratioh,196*ratiow,695*ratioh,187*ratiow,695*ratioh,176*ratiow,698*ratioh,162*ratiow,703*ratioh,153*ratiow,705*ratioh,146*ratiow,705*ratioh,137*ratiow,701*ratioh,129*ratiow,692*ratioh,122*ratiow,683*ratioh,115*ratiow,674*ratioh,111*ratiow,666*ratioh,110*ratiow,662*ratioh,110*ratiow,656*ratioh,113*ratiow,655*ratioh,118*ratiow,656*ratioh,122*ratiow,660*ratioh,128*ratiow,666*ratioh,134*ratiow,672*ratioh,140*ratiow,680*ratioh,146*ratiow,684*ratioh,152*ratiow,687*ratioh,162*ratiow,687*ratioh,176*ratiow,684*ratioh,183*ratiow,681*ratioh,197*ratiow,680*ratioh,206*ratiow,681*ratioh,213*ratiow,683*ratioh,219*ratiow,687*ratioh,225*ratiow,692*ratioh,231*ratiow,699*ratioh,237*ratiow,710*ratioh,241*ratiow,720*ratioh,244*ratiow,730*ratioh,249*ratiow,733*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(270*ratiow,723*ratioh,261*ratiow,736*ratioh,255*ratiow,734*ratioh,248*ratiow,732*ratioh,243*ratiow,729*ratioh,241*ratiow,721*ratioh,238*ratiow,712*ratioh,234*ratiow,704*ratioh,228*ratiow,696*ratioh,222*ratiow,689*ratioh,215*ratiow,684*ratioh,207*ratiow,681*ratioh,195*ratiow,680*ratioh,182*ratiow,682*ratioh,165*ratiow,687*ratioh,152*ratiow,687*ratioh,143*ratiow,683*ratioh,136*ratiow,675*ratioh,126*ratiow,664*ratioh,118*ratiow,656*ratioh,112*ratiow,655*ratioh,132*ratiow,641*ratioh,144*ratiow,631*ratioh,163*ratiow,615*ratioh,170*ratiow,609*ratioh,169*ratiow,614*ratioh,167*ratiow,624*ratioh,165*ratiow,633*ratioh,167*ratiow,644*ratioh,172*ratiow,649*ratioh,180*ratiow,652*ratioh,195*ratiow,651*ratioh,208*ratiow,650*ratioh,216*ratiow,651*ratioh,224*ratiow,655*ratioh,232*ratiow,663*ratioh,242*ratiow,674*ratioh,250*ratiow,684*ratioh,254*ratiow,692*ratioh,256*ratiow,699*ratioh,257*ratiow,708*ratioh,260*ratiow,715*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(466*ratiow,580*ratioh,459*ratiow,582*ratioh,451*ratiow,588*ratioh,443*ratiow,596*ratioh,437*ratiow,606*ratioh,434*ratiow,618*ratioh,432*ratiow,627*ratioh,433*ratiow,631*ratioh,436*ratiow,631*ratioh,446*ratiow,627*ratioh,454*ratiow,621*ratioh,462*ratiow,614*ratioh,468*ratiow,606*ratioh,472*ratiow,598*ratioh,474*ratiow,593*ratioh,474*ratiow,585*ratioh,471*ratiow,582*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(134*ratiow,196*ratioh,107*ratiow,140*ratioh,74*ratiow,71*ratioh,56*ratiow,33*ratioh,44*ratiow,41*ratioh,31*ratiow,53*ratioh,18*ratiow,70*ratioh,6*ratiow,90*ratioh,1*ratiow,105*ratioh,1*ratiow,131*ratioh,29*ratiow,145*ratioh,75*ratiow,169*ratioh,116*ratiow,189*ratioh,131*ratiow,198*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(132*ratiow,198*ratioh,90*ratiow,177*ratioh,41*ratiow,151*ratioh,1*ratiow,131*ratioh,1*ratiow,286*ratioh,6*ratiow,292*ratioh,14*ratiow,293*ratioh,23*ratiow,295*ratioh,25*ratiow,303*ratioh,38*ratiow,301*ratioh,49*ratiow,299*ratioh,61*ratiow,293*ratioh,71*ratiow,287*ratioh,82*ratiow,277*ratioh,91*ratiow,268*ratioh,100*ratiow,257*ratioh,106*ratiow,248*ratioh,113*ratiow,232*ratioh,118*ratiow,222*ratioh,123*ratiow,209*ratioh,128*ratiow,201*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(121*ratiow,519*ratioh,126*ratiow,527*ratioh,130*ratiow,535*ratioh,134*ratiow,544*ratioh,140*ratiow,552*ratioh,152*ratiow,563*ratioh,170*ratiow,577*ratioh,189*ratiow,591*ratioh,200*ratiow,600*ratioh,211*ratiow,612*ratioh,217*ratiow,621*ratioh,220*ratiow,631*ratioh,220*ratiow,641*ratioh,217*ratiow,647*ratioh,207*ratiow,653*ratioh,194*ratiow,654*ratioh,178*ratiow,652*ratioh,163*ratiow,647*ratioh,150*ratiow,640*ratioh,137*ratiow,632*ratioh,125*ratiow,622*ratioh,116*ratiow,610*ratioh,113*ratiow,600*ratioh,112*ratiow,583*ratioh,113*ratiow,567*ratioh,116*ratiow,550*ratioh,117*ratiow,559*ratioh,120*ratiow,568*ratioh,121*ratiow,572*ratioh,123*ratiow,574*ratioh,124*ratiow,573*ratioh,126*ratiow,572*ratioh,126*ratiow,566*ratioh,125*ratiow,553*ratioh,122*ratiow,540*ratioh,121*ratiow,531*ratioh,120*ratiow,526*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(112*ratiow,518*ratioh,113*ratiow,529*ratioh,114*ratiow,541*ratioh,116*ratiow,553*ratioh,114*ratiow,561*ratioh,113*ratiow,578*ratioh,112*ratiow,593*ratioh,115*ratiow,607*ratioh,120*ratiow,618*ratioh,133*ratiow,628*ratioh,140*ratiow,634*ratioh,154*ratiow,642*ratioh,171*ratiow,651*ratioh,191*ratiow,654*ratioh,204*ratiow,653*ratioh,212*ratiow,651*ratioh,218*ratiow,646*ratioh,220*ratiow,635*ratioh,220*ratiow,629*ratioh,348*ratiow,658*ratioh,342*ratiow,666*ratioh,336*ratiow,674*ratioh,329*ratiow,687*ratioh,323*ratiow,698*ratioh,321*ratiow,706*ratioh,322*ratiow,710*ratioh,334*ratiow,723*ratioh,327*ratiow,727*ratioh,315*ratiow,731*ratioh,316*ratiow,723*ratioh,313*ratiow,714*ratioh,309*ratiow,712*ratioh,312*ratiow,711*ratioh,314*ratiow,701*ratioh,316*ratiow,694*ratioh,319*ratiow,688*ratioh,323*ratiow,681*ratioh,327*ratiow,675*ratioh,331*ratiow,669*ratioh,334*ratiow,663*ratioh,335*ratiow,657*ratioh,333*ratiow,655*ratioh,328*ratiow,658*ratioh,322*ratiow,662*ratioh,315*ratiow,671*ratioh,310*ratiow,681*ratioh,306*ratiow,691*ratioh,303*ratiow,699*ratioh,302*ratiow,703*ratioh,301*ratiow,709*ratioh,300*ratiow,710*ratioh,294*ratiow,711*ratioh,277*ratiow,713*ratioh,264*ratiow,715*ratioh,256*ratiow,720*ratioh,247*ratiow,728*ratioh,242*ratiow,728*ratioh,235*ratiow,718*ratioh,228*ratiow,717*ratioh,222*ratiow,719*ratioh,216*ratiow,725*ratioh,211*ratiow,733*ratioh,206*ratiow,742*ratioh,196*ratiow,744*ratioh,189*ratiow,740*ratioh,184*ratiow,727*ratioh,180*ratiow,720*ratioh,174*ratiow,716*ratioh,162*ratiow,709*ratioh,147*ratiow,702*ratioh,134*ratiow,695*ratioh,123*ratiow,689*ratioh,112*ratiow,679*ratioh,104*ratiow,673*ratioh,100*ratiow,668*ratioh,92*ratiow,668*ratioh,88*ratiow,672*ratioh,89*ratiow,677*ratioh,91*ratiow,689*ratioh,86*ratiow,681*ratioh,79*ratiow,668*ratioh,74*ratiow,654*ratioh,69*ratiow,640*ratioh,65*ratiow,626*ratioh,61*ratiow,608*ratioh,59*ratiow,593*ratioh,58*ratiow,577*ratioh,62*ratiow,565*ratioh,67*ratiow,556*ratioh,73*ratiow,548*ratioh,81*ratiow,540*ratioh,89*ratiow,532*ratioh,98*ratiow,526*ratioh,105*ratiow,521*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(346*ratiow,659*ratioh,219*ratiow,627*ratioh,216*ratiow,619*ratioh,209*ratiow,610*ratioh,197*ratiow,598*ratioh,182*ratiow,586*ratioh,168*ratiow,575*ratioh,156*ratiow,566*ratioh,145*ratiow,556*ratioh,135*ratiow,546*ratioh,129*ratiow,534*ratioh,125*ratiow,526*ratioh,121*ratiow,518*ratioh,120*ratiow,515*ratioh,121*ratiow,485*ratioh,123*ratiow,447*ratioh,126*ratiow,385*ratioh,127*ratiow,348*ratioh,128*ratiow,331*ratioh,132*ratiow,320*ratioh,139*ratiow,305*ratioh,144*ratiow,294*ratioh,150*ratiow,286*ratioh,157*ratiow,278*ratioh,164*ratiow,268*ratioh,171*ratiow,262*ratioh,185*ratiow,255*ratioh,199*ratiow,251*ratioh,217*ratiow,248*ratioh,242*ratiow,248*ratioh,261*ratiow,250*ratioh,285*ratiow,254*ratioh,309*ratiow,263*ratioh,330*ratiow,273*ratioh,346*ratiow,284*ratioh,353*ratiow,288*ratioh,368*ratiow,301*ratioh,384*ratiow,318*ratioh,401*ratiow,342*ratioh,408*ratiow,360*ratioh,413*ratiow,376*ratioh,417*ratiow,392*ratioh,420*ratiow,412*ratioh,421*ratiow,430*ratioh,420*ratiow,460*ratioh,418*ratiow,478*ratioh,412*ratiow,510*ratioh,406*ratiow,533*ratioh,398*ratiow,558*ratioh,394*ratiow,575*ratioh,390*ratiow,592*ratioh,382*ratiow,613*ratioh,371*ratiow,630*ratioh,360*ratiow,644*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(354*ratiow,754*ratioh,357*ratiow,762*ratioh,361*ratiow,775*ratioh,369*ratiow,772*ratioh,379*ratiow,769*ratioh,384*ratiow,767*ratioh,387*ratiow,761*ratioh,393*ratiow,751*ratioh,399*ratiow,743*ratioh,406*ratiow,737*ratioh,416*ratiow,734*ratioh,425*ratiow,732*ratioh,439*ratiow,733*ratioh,446*ratiow,740*ratioh,452*ratiow,734*ratioh,462*ratiow,729*ratioh,488*ratiow,714*ratioh,503*ratiow,695*ratioh,511*ratiow,683*ratioh,519*ratiow,672*ratioh,504*ratiow,663*ratioh,494*ratiow,657*ratioh,494*ratiow,661*ratioh,492*ratiow,668*ratioh,488*ratiow,676*ratioh,481*ratiow,685*ratioh,472*ratiow,696*ratioh,463*ratiow,704*ratioh,454*ratiow,705*ratioh,441*ratiow,703*ratioh,427*ratiow,698*ratioh,416*ratiow,695*ratioh,406*ratiow,695*ratioh,399*ratiow,697*ratioh,392*ratiow,702*ratioh,386*ratiow,709*ratioh,382*ratiow,719*ratioh,378*ratiow,728*ratioh,375*ratiow,735*ratioh,372*ratiow,743*ratioh,370*ratiow,751*ratioh,366*ratiow,757*ratioh,362*ratiow,758*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(343*ratiow,736*ratioh,349*ratiow,746*ratioh,352*ratiow,752*ratioh,356*ratiow,755*ratioh,362*ratiow,758*ratioh,366*ratiow,757*ratioh,369*ratiow,752*ratioh,372*ratiow,745*ratioh,374*ratiow,737*ratioh,377*ratiow,729*ratioh,380*ratiow,723*ratioh,383*ratiow,714*ratioh,388*ratiow,706*ratioh,396*ratiow,699*ratioh,403*ratiow,696*ratioh,408*ratiow,695*ratioh,417*ratiow,695*ratioh,428*ratiow,698*ratioh,442*ratiow,703*ratioh,451*ratiow,705*ratioh,458*ratiow,705*ratioh,467*ratiow,701*ratioh,475*ratiow,692*ratioh,482*ratiow,683*ratioh,489*ratiow,674*ratioh,493*ratiow,666*ratioh,494*ratiow,662*ratioh,494*ratiow,656*ratioh,491*ratiow,655*ratioh,486*ratiow,656*ratioh,482*ratiow,660*ratioh,476*ratiow,666*ratioh,470*ratiow,672*ratioh,464*ratiow,680*ratioh,458*ratiow,684*ratioh,452*ratiow,687*ratioh,442*ratiow,687*ratioh,428*ratiow,684*ratioh,421*ratiow,681*ratioh,407*ratiow,680*ratioh,398*ratiow,681*ratioh,391*ratiow,683*ratioh,385*ratiow,687*ratioh,379*ratiow,692*ratioh,373*ratiow,699*ratioh,367*ratiow,710*ratioh,363*ratiow,720*ratioh,360*ratiow,730*ratioh,355*ratiow,733*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(334*ratiow,723*ratioh,343*ratiow,736*ratioh,349*ratiow,734*ratioh,356*ratiow,732*ratioh,361*ratiow,729*ratioh,363*ratiow,721*ratioh,366*ratiow,712*ratioh,370*ratiow,704*ratioh,376*ratiow,696*ratioh,382*ratiow,689*ratioh,389*ratiow,684*ratioh,397*ratiow,681*ratioh,409*ratiow,680*ratioh,422*ratiow,682*ratioh,439*ratiow,687*ratioh,452*ratiow,687*ratioh,461*ratiow,683*ratioh,468*ratiow,675*ratioh,478*ratiow,664*ratioh,486*ratiow,656*ratioh,492*ratiow,655*ratioh,472*ratiow,641*ratioh,460*ratiow,631*ratioh,441*ratiow,615*ratioh,434*ratiow,609*ratioh,435*ratiow,614*ratioh,437*ratiow,624*ratioh,439*ratiow,633*ratioh,437*ratiow,644*ratioh,432*ratiow,649*ratioh,424*ratiow,652*ratioh,409*ratiow,651*ratioh,396*ratiow,650*ratioh,388*ratiow,651*ratioh,380*ratiow,655*ratioh,372*ratiow,663*ratioh,362*ratiow,674*ratioh,354*ratiow,684*ratioh,350*ratiow,692*ratioh,348*ratiow,699*ratioh,347*ratiow,708*ratioh,344*ratiow,715*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(138*ratiow,580*ratioh,145*ratiow,582*ratioh,153*ratiow,588*ratioh,161*ratiow,596*ratioh,167*ratiow,606*ratioh,170*ratiow,618*ratioh,172*ratiow,627*ratioh,171*ratiow,631*ratioh,168*ratiow,631*ratioh,158*ratiow,627*ratioh,150*ratiow,621*ratioh,142*ratiow,614*ratioh,136*ratiow,606*ratioh,132*ratiow,598*ratioh,130*ratiow,593*ratioh,130*ratiow,585*ratioh,133*ratiow,582*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile26(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 604;
var baseHeight = 824;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, AcbC, AcbSh, CPu, Pir1, Pir2, Pir3, aca";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(476*ratiow,180*ratioh,494*ratiow,131*ratioh,510*ratiow,86*ratioh,524*ratiow,46*ratioh,534*ratiow,16*ratioh,546*ratiow,22*ratioh,556*ratiow,28*ratioh,569*ratiow,40*ratioh,582*ratiow,57*ratioh,590*ratiow,72*ratioh,597*ratiow,89*ratioh,603*ratiow,108*ratioh,603*ratiow,123*ratioh,582*ratiow,134*ratioh,553*ratiow,149*ratioh,519*ratiow,165*ratioh,493*ratiow,179*ratioh,481*ratiow,185*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(482*ratiow,185*ratioh,532*ratiow,160*ratioh,587*ratiow,132*ratioh,603*ratiow,123*ratioh,602*ratiow,265*ratioh,600*ratiow,276*ratioh,598*ratiow,281*ratioh,591*ratiow,283*ratioh,598*ratiow,285*ratioh,601*ratiow,289*ratioh,600*ratiow,297*ratioh,573*ratiow,290*ratioh,548*ratiow,282*ratioh,535*ratiow,276*ratioh,522*ratiow,263*ratioh,514*ratiow,253*ratioh,508*ratiow,245*ratioh,497*ratiow,222*ratioh,489*ratiow,200*ratioh,485*ratiow,190*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(484*ratiow,534*ratioh,473*ratiow,548*ratioh,453*ratiow,570*ratioh,431*ratiow,587*ratioh,409*ratiow,602*ratioh,398*ratiow,612*ratioh,393*ratiow,619*ratioh,391*ratiow,629*ratioh,393*ratiow,640*ratioh,400*ratiow,647*ratioh,409*ratiow,650*ratioh,427*ratiow,650*ratioh,443*ratiow,647*ratioh,461*ratiow,640*ratioh,477*ratiow,628*ratioh,483*ratiow,622*ratioh,472*ratiow,619*ratioh,463*ratiow,624*ratioh,452*ratiow,629*ratioh,446*ratiow,627*ratioh,444*ratiow,622*ratioh,448*ratiow,605*ratioh,455*ratiow,591*ratioh,467*ratiow,580*ratioh,474*ratiow,577*ratioh,479*ratiow,576*ratioh,480*ratiow,569*ratioh,483*ratiow,554*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(485*ratiow,567*ratioh,488*ratiow,573*ratioh,491*ratiow,593*ratioh,495*ratiow,610*ratioh,496*ratiow,618*ratioh,494*ratiow,622*ratioh,485*ratiow,622*ratioh,480*ratiow,625*ratioh,465*ratiow,637*ratioh,442*ratiow,647*ratioh,423*ratiow,650*ratioh,410*ratiow,649*ratioh,405*ratiow,649*ratioh,399*ratiow,646*ratioh,388*ratiow,654*ratioh,316*ratiow,673*ratioh,293*ratiow,680*ratioh,300*ratiow,695*ratioh,303*ratiow,701*ratioh,302*ratiow,704*ratioh,294*ratiow,702*ratioh,281*ratiow,687*ratioh,269*ratiow,672*ratioh,272*ratiow,684*ratioh,280*ratiow,702*ratioh,283*ratiow,714*ratioh,280*ratiow,725*ratioh,273*ratiow,733*ratioh,282*ratiow,738*ratioh,292*ratiow,745*ratioh,303*ratiow,753*ratioh,297*ratiow,742*ratioh,295*ratiow,735*ratioh,298*ratiow,729*ratioh,302*ratiow,724*ratioh,307*ratiow,722*ratioh,310*ratiow,723*ratioh,311*ratiow,728*ratioh,311*ratiow,735*ratioh,313*ratiow,740*ratioh,318*ratiow,739*ratioh,321*ratiow,731*ratioh,323*ratiow,723*ratioh,324*ratiow,718*ratioh,335*ratiow,714*ratioh,347*ratiow,715*ratioh,353*ratiow,718*ratioh,358*ratiow,729*ratioh,361*ratiow,735*ratioh,365*ratiow,735*ratioh,366*ratiow,733*ratioh,368*ratiow,728*ratioh,377*ratiow,726*ratioh,382*ratiow,727*ratioh,386*ratiow,729*ratioh,393*ratiow,737*ratioh,396*ratiow,740*ratioh,400*ratiow,739*ratioh,398*ratiow,727*ratioh,399*ratiow,718*ratioh,399*ratiow,714*ratioh,404*ratiow,709*ratioh,411*ratiow,711*ratioh,417*ratiow,718*ratioh,422*ratiow,725*ratioh,428*ratiow,725*ratioh,434*ratiow,724*ratioh,447*ratiow,716*ratioh,459*ratiow,706*ratioh,469*ratiow,689*ratioh,478*ratiow,672*ratioh,493*ratiow,655*ratioh,508*ratiow,641*ratioh,522*ratiow,630*ratioh,535*ratiow,621*ratioh,540*ratiow,615*ratioh,540*ratiow,570*ratioh,537*ratiow,563*ratioh,528*ratiow,551*ratioh,514*ratiow,541*ratioh,501*ratiow,534*ratioh,490*ratiow,531*ratioh,487*ratiow,548*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(287*ratiow,673*ratioh,385*ratiow,647*ratioh,394*ratiow,642*ratioh,391*ratiow,631*ratioh,393*ratiow,617*ratioh,409*ratiow,602*ratioh,433*ratiow,585*ratioh,450*ratiow,571*ratioh,472*ratiow,551*ratioh,485*ratiow,532*ratioh,487*ratiow,513*ratioh,484*ratiow,491*ratioh,483*ratiow,475*ratioh,482*ratiow,443*ratioh,483*ratiow,424*ratioh,479*ratiow,404*ratioh,477*ratiow,373*ratioh,479*ratiow,343*ratioh,477*ratiow,321*ratioh,469*ratiow,290*ratioh,467*ratiow,279*ratioh,457*ratiow,265*ratioh,446*ratiow,251*ratioh,438*ratiow,245*ratioh,426*ratiow,242*ratioh,421*ratiow,240*ratioh,420*ratiow,237*ratioh,410*ratiow,235*ratioh,388*ratiow,234*ratioh,376*ratiow,235*ratioh,357*ratiow,237*ratioh,321*ratiow,245*ratioh,299*ratiow,254*ratioh,278*ratiow,266*ratioh,257*ratiow,285*ratioh,228*ratiow,324*ratioh,215*ratiow,349*ratioh,203*ratiow,386*ratioh,197*ratiow,421*ratioh,194*ratiow,458*ratioh,195*ratiow,492*ratioh,202*ratiow,520*ratioh,208*ratiow,543*ratioh,213*ratiow,573*ratioh,220*ratiow,601*ratioh,226*ratiow,616*ratioh,238*ratiow,633*ratioh,253*ratiow,655*ratioh,261*ratiow,658*ratioh,274*ratiow,663*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(248*ratiow,768*ratioh,241*ratiow,785*ratioh,242*ratiow,790*ratioh,231*ratiow,785*ratioh,227*ratiow,772*ratioh,217*ratiow,756*ratioh,206*ratiow,747*ratioh,193*ratiow,743*ratioh,181*ratiow,746*ratioh,174*ratiow,751*ratioh,151*ratiow,737*ratioh,128*ratiow,717*ratioh,102*ratiow,690*ratioh,81*ratiow,664*ratioh,82*ratiow,662*ratioh,115*ratiow,652*ratioh,127*ratiow,648*ratioh,125*ratiow,655*ratioh,131*ratiow,675*ratioh,140*ratiow,692*ratioh,155*ratiow,707*ratioh,167*ratiow,715*ratioh,176*ratiow,718*ratioh,191*ratiow,718*ratioh,211*ratiow,714*ratioh,223*ratiow,716*ratioh,230*ratiow,723*ratioh,237*ratiow,741*ratioh,239*ratiow,763*ratioh,241*ratiow,768*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(248*ratiow,767*ratioh,242*ratiow,767*ratioh,238*ratiow,753*ratioh,236*ratiow,737*ratioh,231*ratiow,724*ratioh,224*ratiow,716*ratioh,215*ratiow,714*ratioh,200*ratiow,715*ratioh,175*ratiow,718*ratioh,163*ratiow,714*ratioh,154*ratiow,705*ratioh,141*ratiow,692*ratioh,131*ratiow,675*ratioh,126*ratiow,657*ratioh,125*ratiow,650*ratioh,126*ratiow,646*ratioh,132*ratiow,645*ratioh,137*ratiow,650*ratioh,141*ratiow,667*ratioh,151*ratiow,684*ratioh,161*ratiow,696*ratioh,172*ratiow,701*ratioh,183*ratiow,701*ratioh,201*ratiow,693*ratioh,218*ratiow,690*ratioh,228*ratiow,692*ratioh,237*ratiow,701*ratioh,250*ratiow,722*ratioh,254*ratiow,736*ratioh,255*ratiow,750*ratioh,256*ratiow,756*ratioh,248*ratiow,767*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(257*ratiow,753*ratioh,255*ratiow,749*ratioh,253*ratiow,730*ratioh,248*ratiow,719*ratioh,239*ratiow,704*ratioh,231*ratiow,694*ratioh,222*ratiow,691*ratioh,210*ratiow,690*ratioh,189*ratiow,699*ratioh,173*ratiow,701*ratioh,163*ratiow,698*ratioh,145*ratiow,676*ratioh,138*ratiow,656*ratioh,135*ratiow,648*ratioh,132*ratiow,645*ratioh,162*ratiow,630*ratioh,186*ratiow,614*ratioh,183*ratiow,623*ratioh,178*ratiow,642*ratioh,178*ratiow,653*ratioh,186*ratiow,659*ratioh,193*ratiow,661*ratioh,201*ratiow,661*ratioh,212*ratiow,659*ratioh,222*ratiow,662*ratioh,235*ratiow,669*ratioh,243*ratiow,675*ratioh,253*ratiow,689*ratioh,262*ratiow,707*ratioh,267*ratiow,725*ratioh,269*ratiow,731*ratioh,273*ratiow,734*ratioh,258*ratiow,754*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(475*ratiow,576*ratioh,468*ratiow,579*ratioh,459*ratiow,586*ratioh,451*ratiow,598*ratioh,447*ratiow,608*ratioh,444*ratiow,621*ratioh,445*ratiow,627*ratioh,449*ratiow,628*ratioh,455*ratiow,628*ratioh,467*ratiow,621*ratioh,477*ratiow,610*ratioh,482*ratiow,596*ratioh,484*ratiow,585*ratioh,482*ratiow,578*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(128*ratiow,180*ratioh,110*ratiow,131*ratioh,94*ratiow,86*ratioh,80*ratiow,46*ratioh,70*ratiow,16*ratioh,58*ratiow,22*ratioh,48*ratiow,28*ratioh,35*ratiow,40*ratioh,22*ratiow,57*ratioh,14*ratiow,72*ratioh,7*ratiow,89*ratioh,1*ratiow,108*ratioh,1*ratiow,123*ratioh,22*ratiow,134*ratioh,51*ratiow,149*ratioh,85*ratiow,165*ratioh,111*ratiow,179*ratioh,123*ratiow,185*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(122*ratiow,185*ratioh,72*ratiow,160*ratioh,17*ratiow,132*ratioh,1*ratiow,123*ratioh,2*ratiow,265*ratioh,4*ratiow,276*ratioh,6*ratiow,281*ratioh,13*ratiow,283*ratioh,6*ratiow,285*ratioh,3*ratiow,289*ratioh,4*ratiow,297*ratioh,31*ratiow,290*ratioh,56*ratiow,282*ratioh,69*ratiow,276*ratioh,82*ratiow,263*ratioh,90*ratiow,253*ratioh,96*ratiow,245*ratioh,107*ratiow,222*ratioh,115*ratiow,200*ratioh,119*ratiow,190*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(120*ratiow,534*ratioh,131*ratiow,548*ratioh,151*ratiow,570*ratioh,173*ratiow,587*ratioh,195*ratiow,602*ratioh,206*ratiow,612*ratioh,211*ratiow,619*ratioh,213*ratiow,629*ratioh,211*ratiow,640*ratioh,204*ratiow,647*ratioh,195*ratiow,650*ratioh,177*ratiow,650*ratioh,161*ratiow,647*ratioh,143*ratiow,640*ratioh,127*ratiow,628*ratioh,121*ratiow,622*ratioh,132*ratiow,619*ratioh,141*ratiow,624*ratioh,152*ratiow,629*ratioh,158*ratiow,627*ratioh,160*ratiow,622*ratioh,156*ratiow,605*ratioh,149*ratiow,591*ratioh,137*ratiow,580*ratioh,130*ratiow,577*ratioh,125*ratiow,576*ratioh,124*ratiow,569*ratioh,121*ratiow,554*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(119*ratiow,567*ratioh,116*ratiow,573*ratioh,113*ratiow,593*ratioh,109*ratiow,610*ratioh,108*ratiow,618*ratioh,110*ratiow,622*ratioh,119*ratiow,622*ratioh,124*ratiow,625*ratioh,139*ratiow,637*ratioh,162*ratiow,647*ratioh,181*ratiow,650*ratioh,194*ratiow,649*ratioh,199*ratiow,649*ratioh,205*ratiow,646*ratioh,216*ratiow,654*ratioh,288*ratiow,673*ratioh,311*ratiow,680*ratioh,304*ratiow,695*ratioh,301*ratiow,701*ratioh,302*ratiow,704*ratioh,310*ratiow,702*ratioh,323*ratiow,687*ratioh,335*ratiow,672*ratioh,332*ratiow,684*ratioh,324*ratiow,702*ratioh,321*ratiow,714*ratioh,324*ratiow,725*ratioh,331*ratiow,733*ratioh,322*ratiow,738*ratioh,312*ratiow,745*ratioh,301*ratiow,753*ratioh,307*ratiow,742*ratioh,309*ratiow,735*ratioh,306*ratiow,729*ratioh,302*ratiow,724*ratioh,297*ratiow,722*ratioh,294*ratiow,723*ratioh,293*ratiow,728*ratioh,293*ratiow,735*ratioh,291*ratiow,740*ratioh,286*ratiow,739*ratioh,283*ratiow,731*ratioh,281*ratiow,723*ratioh,280*ratiow,718*ratioh,269*ratiow,714*ratioh,257*ratiow,715*ratioh,251*ratiow,718*ratioh,246*ratiow,729*ratioh,243*ratiow,735*ratioh,239*ratiow,735*ratioh,238*ratiow,733*ratioh,236*ratiow,728*ratioh,227*ratiow,726*ratioh,222*ratiow,727*ratioh,218*ratiow,729*ratioh,211*ratiow,737*ratioh,208*ratiow,740*ratioh,204*ratiow,739*ratioh,206*ratiow,727*ratioh,205*ratiow,718*ratioh,205*ratiow,714*ratioh,200*ratiow,709*ratioh,193*ratiow,711*ratioh,187*ratiow,718*ratioh,182*ratiow,725*ratioh,176*ratiow,725*ratioh,170*ratiow,724*ratioh,157*ratiow,716*ratioh,145*ratiow,706*ratioh,135*ratiow,689*ratioh,126*ratiow,672*ratioh,111*ratiow,655*ratioh,96*ratiow,641*ratioh,82*ratiow,630*ratioh,69*ratiow,621*ratioh,64*ratiow,615*ratioh,64*ratiow,570*ratioh,67*ratiow,563*ratioh,76*ratiow,551*ratioh,90*ratiow,541*ratioh,103*ratiow,534*ratioh,114*ratiow,531*ratioh,117*ratiow,548*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(317*ratiow,673*ratioh,219*ratiow,647*ratioh,210*ratiow,642*ratioh,213*ratiow,631*ratioh,211*ratiow,617*ratioh,195*ratiow,602*ratioh,171*ratiow,585*ratioh,154*ratiow,571*ratioh,132*ratiow,551*ratioh,119*ratiow,532*ratioh,117*ratiow,513*ratioh,120*ratiow,491*ratioh,121*ratiow,475*ratioh,122*ratiow,443*ratioh,121*ratiow,424*ratioh,125*ratiow,404*ratioh,127*ratiow,373*ratioh,125*ratiow,343*ratioh,127*ratiow,321*ratioh,135*ratiow,290*ratioh,137*ratiow,279*ratioh,147*ratiow,265*ratioh,158*ratiow,251*ratioh,166*ratiow,245*ratioh,178*ratiow,242*ratioh,183*ratiow,240*ratioh,184*ratiow,237*ratioh,194*ratiow,235*ratioh,216*ratiow,234*ratioh,228*ratiow,235*ratioh,247*ratiow,237*ratioh,283*ratiow,245*ratioh,305*ratiow,254*ratioh,326*ratiow,266*ratioh,347*ratiow,285*ratioh,376*ratiow,324*ratioh,389*ratiow,349*ratioh,401*ratiow,386*ratioh,407*ratiow,421*ratioh,410*ratiow,458*ratioh,409*ratiow,492*ratioh,402*ratiow,520*ratioh,396*ratiow,543*ratioh,391*ratiow,573*ratioh,384*ratiow,601*ratioh,378*ratiow,616*ratioh,366*ratiow,633*ratioh,351*ratiow,655*ratioh,343*ratiow,658*ratioh,330*ratiow,663*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(356*ratiow,768*ratioh,363*ratiow,785*ratioh,362*ratiow,790*ratioh,373*ratiow,785*ratioh,377*ratiow,772*ratioh,387*ratiow,756*ratioh,398*ratiow,747*ratioh,411*ratiow,743*ratioh,423*ratiow,746*ratioh,430*ratiow,751*ratioh,453*ratiow,737*ratioh,476*ratiow,717*ratioh,502*ratiow,690*ratioh,523*ratiow,664*ratioh,522*ratiow,662*ratioh,489*ratiow,652*ratioh,477*ratiow,648*ratioh,479*ratiow,655*ratioh,473*ratiow,675*ratioh,464*ratiow,692*ratioh,449*ratiow,707*ratioh,437*ratiow,715*ratioh,428*ratiow,718*ratioh,413*ratiow,718*ratioh,393*ratiow,714*ratioh,381*ratiow,716*ratioh,374*ratiow,723*ratioh,367*ratiow,741*ratioh,365*ratiow,763*ratioh,363*ratiow,768*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(356*ratiow,767*ratioh,362*ratiow,767*ratioh,366*ratiow,753*ratioh,368*ratiow,737*ratioh,373*ratiow,724*ratioh,380*ratiow,716*ratioh,389*ratiow,714*ratioh,404*ratiow,715*ratioh,429*ratiow,718*ratioh,441*ratiow,714*ratioh,450*ratiow,705*ratioh,463*ratiow,692*ratioh,473*ratiow,675*ratioh,478*ratiow,657*ratioh,479*ratiow,650*ratioh,478*ratiow,646*ratioh,472*ratiow,645*ratioh,467*ratiow,650*ratioh,463*ratiow,667*ratioh,453*ratiow,684*ratioh,443*ratiow,696*ratioh,432*ratiow,701*ratioh,421*ratiow,701*ratioh,403*ratiow,693*ratioh,386*ratiow,690*ratioh,376*ratiow,692*ratioh,367*ratiow,701*ratioh,354*ratiow,722*ratioh,350*ratiow,736*ratioh,349*ratiow,750*ratioh,348*ratiow,756*ratioh,356*ratiow,767*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(347*ratiow,753*ratioh,349*ratiow,749*ratioh,351*ratiow,730*ratioh,356*ratiow,719*ratioh,365*ratiow,704*ratioh,373*ratiow,694*ratioh,382*ratiow,691*ratioh,394*ratiow,690*ratioh,415*ratiow,699*ratioh,431*ratiow,701*ratioh,441*ratiow,698*ratioh,459*ratiow,676*ratioh,466*ratiow,656*ratioh,469*ratiow,648*ratioh,472*ratiow,645*ratioh,442*ratiow,630*ratioh,418*ratiow,614*ratioh,421*ratiow,623*ratioh,426*ratiow,642*ratioh,426*ratiow,653*ratioh,418*ratiow,659*ratioh,411*ratiow,661*ratioh,403*ratiow,661*ratioh,392*ratiow,659*ratioh,382*ratiow,662*ratioh,369*ratiow,669*ratioh,361*ratiow,675*ratioh,351*ratiow,689*ratioh,342*ratiow,707*ratioh,337*ratiow,725*ratioh,335*ratiow,731*ratioh,331*ratiow,734*ratioh,346*ratiow,754*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(129*ratiow,576*ratioh,136*ratiow,579*ratioh,145*ratiow,586*ratioh,153*ratiow,598*ratioh,157*ratiow,608*ratioh,160*ratiow,621*ratioh,159*ratiow,627*ratioh,155*ratiow,628*ratioh,149*ratiow,628*ratioh,137*ratiow,621*ratioh,127*ratiow,610*ratioh,122*ratiow,596*ratioh,120*ratiow,585*ratioh,122*ratiow,578*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile27(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 618;
var baseHeight = 826;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, AcbC, AcbSh, CPu, Pir1, Pir2, Pir3, aca";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(478*ratiow,204*ratioh,500*ratiow,155*ratioh,536*ratiow,70*ratioh,555*ratiow,24*ratioh,568*ratiow,31*ratioh,581*ratiow,39*ratioh,597*ratiow,53*ratioh,608*ratiow,70*ratioh,616*ratiow,90*ratioh,617*ratiow,109*ratioh,617*ratiow,127*ratioh,572*ratiow,157*ratioh,511*ratiow,197*ratioh,488*ratiow,210*ratioh,483*ratiow,207*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(488*ratiow,211*ratioh,617*ratiow,127*ratioh,616*ratiow,279*ratioh,610*ratiow,286*ratioh,607*ratiow,287*ratioh,610*ratiow,290*ratioh,615*ratiow,295*ratioh,617*ratiow,298*ratioh,616*ratiow,300*ratioh,592*ratiow,299*ratioh,564*ratiow,293*ratioh,546*ratiow,287*ratioh,537*ratiow,281*ratioh,525*ratiow,267*ratioh,517*ratiow,256*ratioh,509*ratiow,240*ratioh,501*ratiow,226*ratioh,495*ratiow,217*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(485*ratiow,543*ratioh,477*ratiow,556*ratioh,465*ratiow,568*ratioh,454*ratiow,578*ratioh,443*ratiow,586*ratioh,426*ratiow,598*ratioh,413*ratiow,610*ratioh,409*ratiow,617*ratioh,406*ratiow,627*ratioh,407*ratiow,639*ratioh,411*ratiow,647*ratioh,414*ratiow,651*ratioh,421*ratiow,654*ratioh,432*ratiow,652*ratioh,459*ratiow,643*ratioh,484*ratiow,635*ratioh,481*ratiow,632*ratioh,480*ratiow,622*ratioh,472*ratiow,625*ratioh,461*ratiow,629*ratioh,456*ratiow,627*ratioh,455*ratiow,620*ratioh,458*ratiow,607*ratioh,465*ratiow,591*ratioh,478*ratiow,580*ratioh,479*ratiow,572*ratioh,483*ratiow,559*ratioh,483*ratiow,556*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(491*ratiow,555*ratioh,496*ratiow,559*ratioh,505*ratiow,569*ratioh,511*ratiow,581*ratioh,512*ratiow,598*ratioh,510*ratiow,613*ratioh,504*ratiow,622*ratioh,491*ratiow,631*ratioh,483*ratiow,635*ratioh,488*ratiow,639*ratioh,496*ratiow,639*ratioh,513*ratiow,632*ratioh,520*ratiow,625*ratioh,528*ratiow,604*ratioh,536*ratiow,582*ratioh,539*ratiow,569*ratioh,539*ratiow,558*ratioh,522*ratiow,540*ratioh,508*ratiow,526*ratioh,496*ratiow,517*ratioh,493*ratiow,516*ratioh,493*ratiow,543*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(289*ratiow,730*ratioh,296*ratiow,736*ratioh,302*ratiow,735*ratioh,305*ratiow,727*ratioh,306*ratiow,722*ratioh,311*ratiow,720*ratioh,323*ratiow,723*ratioh,337*ratiow,730*ratioh,343*ratiow,745*ratioh,346*ratiow,747*ratioh,349*ratiow,746*ratioh,347*ratiow,722*ratioh,349*ratiow,718*ratioh,352*ratiow,717*ratioh,357*ratiow,717*ratioh,362*ratiow,726*ratioh,370*ratiow,737*ratioh,375*ratiow,740*ratioh,380*ratiow,737*ratioh,381*ratiow,726*ratioh,384*ratiow,722*ratioh,390*ratiow,726*ratioh,397*ratiow,734*ratioh,402*ratiow,739*ratioh,410*ratiow,734*ratioh,421*ratiow,724*ratioh,435*ratiow,719*ratioh,450*ratiow,704*ratioh,463*ratiow,689*ratioh,471*ratiow,668*ratioh,481*ratiow,650*ratioh,492*ratiow,638*ratioh,485*ratiow,635*ratioh,476*ratiow,636*ratioh,433*ratiow,652*ratioh,420*ratiow,653*ratioh,411*ratiow,648*ratioh,407*ratiow,639*ratioh,406*ratiow,626*ratioh,411*ratiow,611*ratioh,431*ratiow,595*ratioh,456*ratiow,577*ratioh,469*ratiow,564*ratioh,483*ratiow,547*ratioh,486*ratiow,541*ratioh,489*ratiow,515*ratioh,488*ratiow,491*ratioh,485*ratiow,453*ratioh,484*ratiow,429*ratioh,484*ratiow,394*ratioh,481*ratiow,377*ratioh,485*ratiow,368*ratioh,486*ratiow,356*ratioh,480*ratiow,327*ratioh,473*ratiow,305*ratioh,465*ratiow,289*ratioh,457*ratiow,275*ratioh,450*ratiow,267*ratioh,436*ratiow,259*ratioh,421*ratiow,253*ratioh,392*ratiow,251*ratioh,369*ratiow,252*ratioh,339*ratiow,258*ratioh,307*ratiow,271*ratioh,284*ratiow,284*ratioh,256*ratiow,307*ratioh,239*ratiow,325*ratioh,224*ratiow,347*ratioh,209*ratiow,378*ratioh,199*ratiow,412*ratioh,192*ratiow,450*ratioh,190*ratiow,486*ratioh,192*ratiow,512*ratioh,200*ratiow,541*ratioh,211*ratiow,575*ratioh,219*ratiow,604*ratioh,228*ratiow,626*ratioh,241*ratiow,647*ratioh,262*ratiow,672*ratioh,276*ratiow,688*ratioh,282*ratiow,697*ratioh,288*ratiow,712*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(260*ratiow,794*ratioh,248*ratiow,788*ratioh,239*ratiow,787*ratioh,231*ratiow,772*ratioh,220*ratiow,756*ratioh,209*ratiow,750*ratioh,198*ratiow,749*ratioh,189*ratiow,751*ratioh,182*ratiow,756*ratioh,180*ratiow,758*ratioh,153*ratiow,738*ratioh,112*ratiow,704*ratioh,94*ratiow,688*ratioh,82*ratiow,670*ratioh,79*ratiow,662*ratioh,112*ratiow,649*ratioh,112*ratiow,654*ratioh,117*ratiow,662*ratioh,129*ratiow,677*ratioh,146*ratiow,699*ratioh,159*ratiow,713*ratioh,174*ratiow,718*ratioh,194*ratiow,719*ratioh,219*ratiow,719*ratioh,232*ratiow,724*ratioh,238*ratiow,729*ratioh,243*ratiow,737*ratioh,245*ratiow,746*ratioh,249*ratiow,760*ratioh,252*ratiow,768*ratioh,257*ratiow,773*ratioh,264*ratiow,773*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(263*ratiow,772*ratioh,254*ratiow,771*ratioh,248*ratiow,760*ratioh,244*ratiow,742*ratioh,241*ratiow,733*ratioh,231*ratiow,723*ratioh,219*ratiow,719*ratioh,198*ratiow,719*ratioh,174*ratiow,718*ratioh,161*ratiow,713*ratioh,149*ratiow,702*ratioh,126*ratiow,674*ratioh,115*ratiow,659*ratioh,112*ratiow,655*ratioh,111*ratiow,649*ratioh,122*ratiow,645*ratioh,131*ratiow,652*ratioh,141*ratiow,664*ratioh,153*ratiow,681*ratioh,164*ratiow,693*ratioh,175*ratiow,698*ratioh,209*ratiow,698*ratioh,231*ratiow,701*ratioh,249*ratiow,710*ratioh,260*ratiow,723*ratioh,264*ratiow,735*ratioh,267*ratiow,752*ratioh,271*ratiow,759*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(271*ratiow,758*ratioh,267*ratiow,752*ratioh,263*ratiow,731*ratioh,257*ratiow,720*ratioh,251*ratiow,712*ratioh,242*ratiow,705*ratioh,221*ratiow,699*ratioh,174*ratiow,697*ratioh,161*ratiow,691*ratioh,145*ratiow,670*ratioh,133*ratiow,656*ratioh,127*ratiow,650*ratioh,122*ratiow,646*ratioh,149*ratiow,631*ratioh,181*ratiow,612*ratioh,188*ratiow,606*ratioh,184*ratiow,616*ratioh,180*ratiow,631*ratioh,179*ratiow,646*ratioh,189*ratiow,658*ratioh,211*ratiow,664*ratioh,228*ratiow,666*ratioh,247*ratiow,684*ratioh,260*ratiow,698*ratioh,268*ratiow,711*ratioh,273*ratiow,726*ratioh,277*ratiow,732*ratioh,285*ratiow,739*ratioh,271*ratiow,758*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(481*ratiow,578*ratioh,470*ratiow,586*ratioh,462*ratiow,596*ratioh,457*ratiow,610*ratioh,455*ratiow,625*ratioh,456*ratiow,628*ratioh,462*ratiow,628*ratioh,473*ratiow,625*ratioh,481*ratiow,621*ratioh,489*ratiow,613*ratioh,493*ratiow,603*ratioh,493*ratiow,588*ratioh,491*ratiow,582*ratioh,487*ratiow,578*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(140*ratiow,204*ratioh,118*ratiow,155*ratioh,82*ratiow,70*ratioh,63*ratiow,24*ratioh,50*ratiow,31*ratioh,37*ratiow,39*ratioh,21*ratiow,53*ratioh,10*ratiow,70*ratioh,2*ratiow,90*ratioh,1*ratiow,109*ratioh,1*ratiow,127*ratioh,46*ratiow,157*ratioh,107*ratiow,197*ratioh,130*ratiow,210*ratioh,135*ratiow,207*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(130*ratiow,211*ratioh,1*ratiow,127*ratioh,2*ratiow,279*ratioh,8*ratiow,286*ratioh,11*ratiow,287*ratioh,8*ratiow,290*ratioh,3*ratiow,295*ratioh,1*ratiow,298*ratioh,2*ratiow,300*ratioh,26*ratiow,299*ratioh,54*ratiow,293*ratioh,72*ratiow,287*ratioh,81*ratiow,281*ratioh,93*ratiow,267*ratioh,101*ratiow,256*ratioh,109*ratiow,240*ratioh,117*ratiow,226*ratioh,123*ratiow,217*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(133*ratiow,543*ratioh,141*ratiow,556*ratioh,153*ratiow,568*ratioh,164*ratiow,578*ratioh,175*ratiow,586*ratioh,192*ratiow,598*ratioh,205*ratiow,610*ratioh,209*ratiow,617*ratioh,212*ratiow,627*ratioh,211*ratiow,639*ratioh,207*ratiow,647*ratioh,204*ratiow,651*ratioh,197*ratiow,654*ratioh,186*ratiow,652*ratioh,159*ratiow,643*ratioh,134*ratiow,635*ratioh,137*ratiow,632*ratioh,138*ratiow,622*ratioh,146*ratiow,625*ratioh,157*ratiow,629*ratioh,162*ratiow,627*ratioh,163*ratiow,620*ratioh,160*ratiow,607*ratioh,153*ratiow,591*ratioh,140*ratiow,580*ratioh,139*ratiow,572*ratioh,135*ratiow,559*ratioh,135*ratiow,556*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(127*ratiow,555*ratioh,122*ratiow,559*ratioh,113*ratiow,569*ratioh,107*ratiow,581*ratioh,106*ratiow,598*ratioh,108*ratiow,613*ratioh,114*ratiow,622*ratioh,127*ratiow,631*ratioh,135*ratiow,635*ratioh,130*ratiow,639*ratioh,122*ratiow,639*ratioh,105*ratiow,632*ratioh,98*ratiow,625*ratioh,90*ratiow,604*ratioh,82*ratiow,582*ratioh,79*ratiow,569*ratioh,79*ratiow,558*ratioh,96*ratiow,540*ratioh,110*ratiow,526*ratioh,122*ratiow,517*ratioh,125*ratiow,516*ratioh,125*ratiow,543*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(329*ratiow,730*ratioh,322*ratiow,736*ratioh,316*ratiow,735*ratioh,313*ratiow,727*ratioh,312*ratiow,722*ratioh,307*ratiow,720*ratioh,295*ratiow,723*ratioh,281*ratiow,730*ratioh,275*ratiow,745*ratioh,272*ratiow,747*ratioh,269*ratiow,746*ratioh,271*ratiow,722*ratioh,269*ratiow,718*ratioh,266*ratiow,717*ratioh,261*ratiow,717*ratioh,256*ratiow,726*ratioh,248*ratiow,737*ratioh,243*ratiow,740*ratioh,238*ratiow,737*ratioh,237*ratiow,726*ratioh,234*ratiow,722*ratioh,228*ratiow,726*ratioh,221*ratiow,734*ratioh,216*ratiow,739*ratioh,208*ratiow,734*ratioh,197*ratiow,724*ratioh,183*ratiow,719*ratioh,168*ratiow,704*ratioh,155*ratiow,689*ratioh,147*ratiow,668*ratioh,137*ratiow,650*ratioh,126*ratiow,638*ratioh,133*ratiow,635*ratioh,142*ratiow,636*ratioh,185*ratiow,652*ratioh,198*ratiow,653*ratioh,207*ratiow,648*ratioh,211*ratiow,639*ratioh,212*ratiow,626*ratioh,207*ratiow,611*ratioh,187*ratiow,595*ratioh,162*ratiow,577*ratioh,149*ratiow,564*ratioh,135*ratiow,547*ratioh,132*ratiow,541*ratioh,129*ratiow,515*ratioh,130*ratiow,491*ratioh,133*ratiow,453*ratioh,134*ratiow,429*ratioh,134*ratiow,394*ratioh,137*ratiow,377*ratioh,133*ratiow,368*ratioh,132*ratiow,356*ratioh,138*ratiow,327*ratioh,145*ratiow,305*ratioh,153*ratiow,289*ratioh,161*ratiow,275*ratioh,168*ratiow,267*ratioh,182*ratiow,259*ratioh,197*ratiow,253*ratioh,226*ratiow,251*ratioh,249*ratiow,252*ratioh,279*ratiow,258*ratioh,311*ratiow,271*ratioh,334*ratiow,284*ratioh,362*ratiow,307*ratioh,379*ratiow,325*ratioh,394*ratiow,347*ratioh,409*ratiow,378*ratioh,419*ratiow,412*ratioh,426*ratiow,450*ratioh,428*ratiow,486*ratioh,426*ratiow,512*ratioh,418*ratiow,541*ratioh,407*ratiow,575*ratioh,399*ratiow,604*ratioh,390*ratiow,626*ratioh,377*ratiow,647*ratioh,356*ratiow,672*ratioh,342*ratiow,688*ratioh,336*ratiow,697*ratioh,330*ratiow,712*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(358*ratiow,794*ratioh,370*ratiow,788*ratioh,379*ratiow,787*ratioh,387*ratiow,772*ratioh,398*ratiow,756*ratioh,409*ratiow,750*ratioh,420*ratiow,749*ratioh,429*ratiow,751*ratioh,436*ratiow,756*ratioh,438*ratiow,758*ratioh,465*ratiow,738*ratioh,506*ratiow,704*ratioh,524*ratiow,688*ratioh,536*ratiow,670*ratioh,539*ratiow,662*ratioh,506*ratiow,649*ratioh,506*ratiow,654*ratioh,501*ratiow,662*ratioh,489*ratiow,677*ratioh,472*ratiow,699*ratioh,459*ratiow,713*ratioh,444*ratiow,718*ratioh,424*ratiow,719*ratioh,399*ratiow,719*ratioh,386*ratiow,724*ratioh,380*ratiow,729*ratioh,375*ratiow,737*ratioh,373*ratiow,746*ratioh,369*ratiow,760*ratioh,366*ratiow,768*ratioh,361*ratiow,773*ratioh,354*ratiow,773*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(355*ratiow,772*ratioh,364*ratiow,771*ratioh,370*ratiow,760*ratioh,374*ratiow,742*ratioh,377*ratiow,733*ratioh,387*ratiow,723*ratioh,399*ratiow,719*ratioh,420*ratiow,719*ratioh,444*ratiow,718*ratioh,457*ratiow,713*ratioh,469*ratiow,702*ratioh,492*ratiow,674*ratioh,503*ratiow,659*ratioh,506*ratiow,655*ratioh,507*ratiow,649*ratioh,496*ratiow,645*ratioh,487*ratiow,652*ratioh,477*ratiow,664*ratioh,465*ratiow,681*ratioh,454*ratiow,693*ratioh,443*ratiow,698*ratioh,409*ratiow,698*ratioh,387*ratiow,701*ratioh,369*ratiow,710*ratioh,358*ratiow,723*ratioh,354*ratiow,735*ratioh,351*ratiow,752*ratioh,347*ratiow,759*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(347*ratiow,758*ratioh,351*ratiow,752*ratioh,355*ratiow,731*ratioh,361*ratiow,720*ratioh,367*ratiow,712*ratioh,376*ratiow,705*ratioh,397*ratiow,699*ratioh,444*ratiow,697*ratioh,457*ratiow,691*ratioh,473*ratiow,670*ratioh,485*ratiow,656*ratioh,491*ratiow,650*ratioh,496*ratiow,646*ratioh,469*ratiow,631*ratioh,437*ratiow,612*ratioh,430*ratiow,606*ratioh,434*ratiow,616*ratioh,438*ratiow,631*ratioh,439*ratiow,646*ratioh,429*ratiow,658*ratioh,407*ratiow,664*ratioh,390*ratiow,666*ratioh,371*ratiow,684*ratioh,358*ratiow,698*ratioh,350*ratiow,711*ratioh,345*ratiow,726*ratioh,341*ratiow,732*ratioh,333*ratiow,739*ratioh,347*ratiow,758*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(137*ratiow,578*ratioh,148*ratiow,586*ratioh,156*ratiow,596*ratioh,161*ratiow,610*ratioh,163*ratiow,625*ratioh,162*ratiow,628*ratioh,156*ratiow,628*ratioh,145*ratiow,625*ratioh,137*ratiow,621*ratioh,129*ratiow,613*ratioh,125*ratiow,603*ratioh,125*ratiow,588*ratioh,127*ratiow,582*ratioh,131*ratiow,578*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}


function processFile28(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 618;
var baseHeight = 831;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, AcbC, AcbSh, CPu, Pir1, Pir2, Pir3, aca";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(481*ratiow,198*ratioh,481*ratiow,199*ratioh,497*ratiow,165*ratioh,517*ratiow,124*ratioh,533*ratiow,93*ratioh,547*ratiow,64*ratioh,559*ratiow,40*ratioh,564*ratiow,30*ratioh,568*ratiow,34*ratioh,576*ratiow,42*ratioh,585*ratiow,49*ratioh,593*ratiow,58*ratioh,602*ratiow,70*ratioh,611*ratiow,86*ratioh,616*ratiow,99*ratioh,616*ratiow,107*ratioh,616*ratiow,128*ratioh,600*ratiow,138*ratioh,576*ratiow,154*ratioh,552*ratiow,170*ratioh,511*ratiow,197*ratioh,495*ratiow,208*ratioh,492*ratiow,206*ratioh,490*ratiow,203*ratioh,486*ratiow,200*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(495*ratiow,208*ratioh,591*ratiow,144*ratioh,617*ratiow,127*ratioh,617*ratiow,286*ratioh,614*ratiow,291*ratioh,609*ratiow,294*ratioh,615*ratiow,299*ratioh,617*ratiow,305*ratioh,592*ratiow,304*ratioh,572*ratiow,300*ratioh,556*ratiow,295*ratioh,545*ratiow,287*ratioh,534*ratiow,273*ratioh,520*ratiow,253*ratioh,508*ratiow,232*ratioh,500*ratiow,217*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(487*ratiow,549*ratioh,481*ratiow,559*ratioh,472*ratiow,568*ratioh,455*ratiow,584*ratioh,439*ratiow,598*ratioh,427*ratiow,613*ratioh,419*ratiow,625*ratioh,416*ratiow,635*ratioh,419*ratiow,649*ratioh,428*ratiow,655*ratioh,435*ratiow,657*ratioh,449*ratiow,658*ratioh,466*ratiow,653*ratioh,479*ratiow,647*ratioh,488*ratiow,645*ratioh,495*ratiow,643*ratioh,488*ratiow,640*ratioh,486*ratiow,628*ratioh,480*ratiow,630*ratioh,473*ratiow,630*ratioh,465*ratiow,627*ratioh,461*ratiow,623*ratioh,462*ratiow,613*ratioh,468*ratiow,596*ratioh,477*ratiow,583*ratioh,489*ratiow,578*ratioh,494*ratiow,578*ratioh,489*ratiow,571*ratioh,486*ratiow,564*ratioh,489*ratiow,551*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(493*ratiow,520*ratioh,492*ratiow,526*ratioh,490*ratiow,534*ratioh,488*ratiow,538*ratioh,488*ratiow,550*ratioh,490*ratiow,553*ratioh,495*ratiow,554*ratioh,500*ratiow,556*ratioh,506*ratiow,564*ratioh,511*ratiow,571*ratioh,515*ratiow,579*ratioh,519*ratiow,589*ratioh,521*ratiow,597*ratioh,522*ratiow,610*ratioh,520*ratiow,621*ratioh,517*ratiow,630*ratioh,510*ratiow,637*ratioh,505*ratiow,640*ratioh,514*ratiow,639*ratioh,527*ratiow,630*ratioh,535*ratiow,619*ratioh,540*ratiow,607*ratioh,541*ratiow,592*ratioh,541*ratiow,575*ratioh,536*ratiow,563*ratioh,533*ratiow,557*ratioh,527*ratiow,550*ratioh,523*ratiow,545*ratioh,518*ratiow,538*ratioh,512*ratiow,533*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(417*ratiow,633*ratioh,247*ratiow,662*ratioh,236*ratiow,649*ratioh,224*ratiow,629*ratioh,215*ratiow,611*ratioh,212*ratiow,603*ratioh,203*ratiow,576*ratioh,193*ratiow,535*ratioh,187*ratiow,516*ratioh,184*ratiow,488*ratioh,184*ratiow,461*ratioh,188*ratiow,426*ratioh,193*ratiow,406*ratioh,198*ratiow,390*ratioh,206*ratiow,370*ratioh,212*ratiow,360*ratioh,223*ratiow,341*ratioh,238*ratiow,322*ratioh,244*ratiow,316*ratioh,254*ratiow,306*ratioh,272*ratiow,294*ratioh,289*ratiow,284*ratioh,305*ratiow,277*ratioh,328*ratiow,268*ratioh,352*ratiow,261*ratioh,371*ratiow,257*ratioh,391*ratiow,255*ratioh,408*ratiow,256*ratioh,425*ratiow,258*ratioh,438*ratiow,263*ratioh,449*ratiow,268*ratioh,459*ratiow,278*ratioh,471*ratiow,295*ratioh,477*ratiow,311*ratioh,481*ratiow,323*ratioh,483*ratiow,338*ratioh,483*ratiow,382*ratioh,485*ratiow,428*ratioh,486*ratiow,459*ratioh,488*ratiow,476*ratioh,490*ratiow,492*ratioh,491*ratiow,507*ratioh,493*ratiow,517*ratioh,493*ratiow,525*ratioh,489*ratiow,534*ratioh,488*ratiow,550*ratioh,482*ratiow,558*ratioh,470*ratiow,571*ratioh,456*ratiow,583*ratioh,444*ratiow,594*ratioh,430*ratiow,609*ratioh,422*ratiow,622*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(271*ratiow,776*ratioh,267*ratiow,788*ratioh,267*ratiow,805*ratioh,261*ratiow,800*ratioh,249*ratiow,797*ratioh,247*ratiow,787*ratioh,241*ratiow,777*ratioh,233*ratiow,765*ratioh,222*ratiow,756*ratioh,208*ratiow,749*ratioh,197*ratiow,747*ratioh,188*ratiow,747*ratioh,183*ratiow,749*ratioh,178*ratiow,754*ratioh,167*ratiow,747*ratioh,145*ratiow,731*ratioh,126*ratiow,717*ratioh,110*ratiow,699*ratioh,101*ratiow,688*ratioh,81*ratiow,658*ratioh,85*ratiow,655*ratioh,102*ratiow,646*ratioh,108*ratiow,642*ratioh,108*ratiow,648*ratioh,110*ratiow,655*ratioh,115*ratiow,663*ratioh,124*ratiow,673*ratioh,134*ratiow,685*ratioh,144*ratiow,693*ratioh,149*ratiow,697*ratioh,158*ratiow,701*ratioh,168*ratiow,710*ratioh,176*ratiow,719*ratioh,186*ratiow,724*ratioh,192*ratiow,725*ratioh,206*ratiow,726*ratioh,222*ratiow,728*ratioh,236*ratiow,734*ratioh,245*ratiow,745*ratioh,249*ratiow,754*ratioh,252*ratiow,767*ratioh,255*ratiow,778*ratioh,256*ratiow,785*ratioh,260*ratiow,783*ratioh,267*ratiow,778*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(275*ratiow,765*ratioh,271*ratiow,775*ratioh,265*ratiow,779*ratioh,258*ratiow,785*ratioh,255*ratiow,781*ratioh,252*ratiow,765*ratioh,247*ratiow,751*ratioh,244*ratiow,743*ratioh,239*ratiow,737*ratioh,233*ratiow,732*ratioh,223*ratiow,728*ratioh,212*ratiow,726*ratioh,197*ratiow,726*ratioh,184*ratiow,724*ratioh,174*ratiow,717*ratioh,166*ratiow,708*ratioh,159*ratiow,702*ratioh,149*ratiow,696*ratioh,140*ratiow,690*ratioh,129*ratiow,679*ratioh,118*ratiow,666*ratioh,111*ratiow,657*ratioh,109*ratiow,653*ratioh,108*ratiow,643*ratioh,112*ratiow,640*ratioh,117*ratiow,640*ratioh,125*ratiow,647*ratioh,134*ratiow,657*ratioh,143*ratiow,667*ratioh,155*ratiow,675*ratioh,167*ratiow,684*ratioh,180*ratiow,696*ratioh,191*ratiow,701*ratioh,201*ratiow,702*ratioh,215*ratiow,703*ratioh,228*ratiow,706*ratioh,242*ratiow,714*ratioh,251*ratiow,724*ratioh,255*ratiow,731*ratioh,261*ratiow,743*ratioh,263*ratiow,751*ratioh,265*ratiow,764*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(286*ratiow,746*ratioh,275*ratiow,766*ratioh,266*ratiow,765*ratioh,264*ratiow,762*ratioh,263*ratiow,750*ratioh,261*ratiow,741*ratioh,257*ratiow,733*ratioh,249*ratiow,721*ratioh,244*ratiow,715*ratioh,232*ratiow,707*ratioh,217*ratiow,703*ratioh,205*ratiow,702*ratioh,192*ratiow,702*ratioh,180*ratiow,696*ratioh,170*ratiow,687*ratioh,153*ratiow,673*ratioh,140*ratiow,664*ratioh,131*ratiow,654*ratioh,123*ratiow,644*ratioh,115*ratiow,639*ratioh,126*ratiow,632*ratioh,144*ratiow,622*ratioh,162*ratiow,611*ratioh,170*ratiow,606*ratioh,176*ratiow,609*ratioh,187*ratiow,610*ratioh,194*ratiow,609*ratioh,191*ratiow,613*ratioh,186*ratiow,620*ratioh,181*ratiow,631*ratioh,177*ratiow,642*ratioh,175*ratiow,652*ratioh,179*ratiow,661*ratioh,188*ratiow,669*ratioh,197*ratiow,673*ratioh,210*ratiow,677*ratioh,219*ratiow,678*ratioh,227*ratiow,682*ratioh,238*ratiow,689*ratioh,246*ratiow,695*ratioh,255*ratiow,703*ratioh,265*ratiow,714*ratioh,270*ratiow,722*ratioh,276*ratiow,733*ratioh,283*ratiow,744*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(493*ratiow,577*ratioh,483*ratiow,580*ratioh,472*ratiow,590*ratioh,464*ratiow,606*ratioh,461*ratiow,619*ratioh,464*ratiow,626*ratioh,470*ratiow,629*ratioh,477*ratiow,630*ratioh,482*ratiow,629*ratioh,492*ratiow,624*ratioh,499*ratiow,613*ratioh,502*ratiow,605*ratioh,502*ratiow,592*ratioh,498*ratiow,582*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(137*ratiow,198*ratioh,137*ratiow,199*ratioh,121*ratiow,165*ratioh,101*ratiow,124*ratioh,85*ratiow,93*ratioh,71*ratiow,64*ratioh,59*ratiow,40*ratioh,54*ratiow,30*ratioh,50*ratiow,34*ratioh,42*ratiow,42*ratioh,33*ratiow,49*ratioh,25*ratiow,58*ratioh,16*ratiow,70*ratioh,7*ratiow,86*ratioh,2*ratiow,99*ratioh,2*ratiow,107*ratioh,2*ratiow,128*ratioh,18*ratiow,138*ratioh,42*ratiow,154*ratioh,66*ratiow,170*ratioh,107*ratiow,197*ratioh,123*ratiow,208*ratioh,126*ratiow,206*ratioh,128*ratiow,203*ratioh,132*ratiow,200*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(123*ratiow,208*ratioh,27*ratiow,144*ratioh,1*ratiow,127*ratioh,1*ratiow,286*ratioh,4*ratiow,291*ratioh,9*ratiow,294*ratioh,3*ratiow,299*ratioh,1*ratiow,305*ratioh,26*ratiow,304*ratioh,46*ratiow,300*ratioh,62*ratiow,295*ratioh,73*ratiow,287*ratioh,84*ratiow,273*ratioh,98*ratiow,253*ratioh,110*ratiow,232*ratioh,118*ratiow,217*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(131*ratiow,549*ratioh,137*ratiow,559*ratioh,146*ratiow,568*ratioh,163*ratiow,584*ratioh,179*ratiow,598*ratioh,191*ratiow,613*ratioh,199*ratiow,625*ratioh,202*ratiow,635*ratioh,199*ratiow,649*ratioh,190*ratiow,655*ratioh,183*ratiow,657*ratioh,169*ratiow,658*ratioh,152*ratiow,653*ratioh,139*ratiow,647*ratioh,130*ratiow,645*ratioh,123*ratiow,643*ratioh,130*ratiow,640*ratioh,132*ratiow,628*ratioh,138*ratiow,630*ratioh,145*ratiow,630*ratioh,153*ratiow,627*ratioh,157*ratiow,623*ratioh,156*ratiow,613*ratioh,150*ratiow,596*ratioh,141*ratiow,583*ratioh,129*ratiow,578*ratioh,124*ratiow,578*ratioh,129*ratiow,571*ratioh,132*ratiow,564*ratioh,129*ratiow,551*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(125*ratiow,520*ratioh,126*ratiow,526*ratioh,128*ratiow,534*ratioh,130*ratiow,538*ratioh,130*ratiow,550*ratioh,128*ratiow,553*ratioh,123*ratiow,554*ratioh,118*ratiow,556*ratioh,112*ratiow,564*ratioh,107*ratiow,571*ratioh,103*ratiow,579*ratioh,99*ratiow,589*ratioh,97*ratiow,597*ratioh,96*ratiow,610*ratioh,98*ratiow,621*ratioh,101*ratiow,630*ratioh,108*ratiow,637*ratioh,113*ratiow,640*ratioh,104*ratiow,639*ratioh,91*ratiow,630*ratioh,83*ratiow,619*ratioh,78*ratiow,607*ratioh,77*ratiow,592*ratioh,77*ratiow,575*ratioh,82*ratiow,563*ratioh,85*ratiow,557*ratioh,91*ratiow,550*ratioh,95*ratiow,545*ratioh,100*ratiow,538*ratioh,106*ratiow,533*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(201*ratiow,633*ratioh,371*ratiow,662*ratioh,382*ratiow,649*ratioh,394*ratiow,629*ratioh,403*ratiow,611*ratioh,406*ratiow,603*ratioh,415*ratiow,576*ratioh,425*ratiow,535*ratioh,431*ratiow,516*ratioh,434*ratiow,488*ratioh,434*ratiow,461*ratioh,430*ratiow,426*ratioh,425*ratiow,406*ratioh,420*ratiow,390*ratioh,412*ratiow,370*ratioh,406*ratiow,360*ratioh,395*ratiow,341*ratioh,380*ratiow,322*ratioh,374*ratiow,316*ratioh,364*ratiow,306*ratioh,346*ratiow,294*ratioh,329*ratiow,284*ratioh,313*ratiow,277*ratioh,290*ratiow,268*ratioh,266*ratiow,261*ratioh,247*ratiow,257*ratioh,227*ratiow,255*ratioh,210*ratiow,256*ratioh,193*ratiow,258*ratioh,180*ratiow,263*ratioh,169*ratiow,268*ratioh,159*ratiow,278*ratioh,147*ratiow,295*ratioh,141*ratiow,311*ratioh,137*ratiow,323*ratioh,135*ratiow,338*ratioh,135*ratiow,382*ratioh,133*ratiow,428*ratioh,132*ratiow,459*ratioh,130*ratiow,476*ratioh,128*ratiow,492*ratioh,127*ratiow,507*ratioh,125*ratiow,517*ratioh,125*ratiow,525*ratioh,129*ratiow,534*ratioh,130*ratiow,550*ratioh,136*ratiow,558*ratioh,148*ratiow,571*ratioh,162*ratiow,583*ratioh,174*ratiow,594*ratioh,188*ratiow,609*ratioh,196*ratiow,622*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(347*ratiow,776*ratioh,351*ratiow,788*ratioh,351*ratiow,805*ratioh,357*ratiow,800*ratioh,369*ratiow,797*ratioh,371*ratiow,787*ratioh,377*ratiow,777*ratioh,385*ratiow,765*ratioh,396*ratiow,756*ratioh,410*ratiow,749*ratioh,421*ratiow,747*ratioh,430*ratiow,747*ratioh,435*ratiow,749*ratioh,440*ratiow,754*ratioh,451*ratiow,747*ratioh,473*ratiow,731*ratioh,492*ratiow,717*ratioh,508*ratiow,699*ratioh,517*ratiow,688*ratioh,537*ratiow,658*ratioh,533*ratiow,655*ratioh,516*ratiow,646*ratioh,510*ratiow,642*ratioh,510*ratiow,648*ratioh,508*ratiow,655*ratioh,503*ratiow,663*ratioh,494*ratiow,673*ratioh,484*ratiow,685*ratioh,474*ratiow,693*ratioh,469*ratiow,697*ratioh,460*ratiow,701*ratioh,450*ratiow,710*ratioh,442*ratiow,719*ratioh,432*ratiow,724*ratioh,426*ratiow,725*ratioh,412*ratiow,726*ratioh,396*ratiow,728*ratioh,382*ratiow,734*ratioh,373*ratiow,745*ratioh,369*ratiow,754*ratioh,366*ratiow,767*ratioh,363*ratiow,778*ratioh,362*ratiow,785*ratioh,358*ratiow,783*ratioh,351*ratiow,778*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(343*ratiow,765*ratioh,347*ratiow,775*ratioh,353*ratiow,779*ratioh,360*ratiow,785*ratioh,363*ratiow,781*ratioh,366*ratiow,765*ratioh,371*ratiow,751*ratioh,374*ratiow,743*ratioh,379*ratiow,737*ratioh,385*ratiow,732*ratioh,395*ratiow,728*ratioh,406*ratiow,726*ratioh,421*ratiow,726*ratioh,434*ratiow,724*ratioh,444*ratiow,717*ratioh,452*ratiow,708*ratioh,459*ratiow,702*ratioh,469*ratiow,696*ratioh,478*ratiow,690*ratioh,489*ratiow,679*ratioh,500*ratiow,666*ratioh,507*ratiow,657*ratioh,509*ratiow,653*ratioh,510*ratiow,643*ratioh,506*ratiow,640*ratioh,501*ratiow,640*ratioh,493*ratiow,647*ratioh,484*ratiow,657*ratioh,475*ratiow,667*ratioh,463*ratiow,675*ratioh,451*ratiow,684*ratioh,438*ratiow,696*ratioh,427*ratiow,701*ratioh,417*ratiow,702*ratioh,403*ratiow,703*ratioh,390*ratiow,706*ratioh,376*ratiow,714*ratioh,367*ratiow,724*ratioh,363*ratiow,731*ratioh,357*ratiow,743*ratioh,355*ratiow,751*ratioh,353*ratiow,764*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(332*ratiow,746*ratioh,343*ratiow,766*ratioh,352*ratiow,765*ratioh,354*ratiow,762*ratioh,355*ratiow,750*ratioh,357*ratiow,741*ratioh,361*ratiow,733*ratioh,369*ratiow,721*ratioh,374*ratiow,715*ratioh,386*ratiow,707*ratioh,401*ratiow,703*ratioh,413*ratiow,702*ratioh,426*ratiow,702*ratioh,438*ratiow,696*ratioh,448*ratiow,687*ratioh,465*ratiow,673*ratioh,478*ratiow,664*ratioh,487*ratiow,654*ratioh,495*ratiow,644*ratioh,503*ratiow,639*ratioh,492*ratiow,632*ratioh,474*ratiow,622*ratioh,456*ratiow,611*ratioh,448*ratiow,606*ratioh,442*ratiow,609*ratioh,431*ratiow,610*ratioh,424*ratiow,609*ratioh,427*ratiow,613*ratioh,432*ratiow,620*ratioh,437*ratiow,631*ratioh,441*ratiow,642*ratioh,443*ratiow,652*ratioh,439*ratiow,661*ratioh,430*ratiow,669*ratioh,421*ratiow,673*ratioh,408*ratiow,677*ratioh,399*ratiow,678*ratioh,391*ratiow,682*ratioh,380*ratiow,689*ratioh,372*ratiow,695*ratioh,363*ratiow,703*ratioh,353*ratiow,714*ratioh,348*ratiow,722*ratioh,342*ratiow,733*ratioh,335*ratiow,744*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(125*ratiow,577*ratioh,135*ratiow,580*ratioh,146*ratiow,590*ratioh,154*ratiow,606*ratioh,157*ratiow,619*ratioh,154*ratiow,626*ratioh,148*ratiow,629*ratioh,141*ratiow,630*ratioh,136*ratiow,629*ratioh,126*ratiow,624*ratioh,119*ratiow,613*ratioh,116*ratiow,605*ratioh,116*ratiow,592*ratioh,120*ratiow,582*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}


function processFile29(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 621;
var baseHeight = 832;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, AcbC, AcbSh, CPu, Pir1, Pir2, Pir3, aca";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(486*ratiow,195*ratioh,590*ratiow,44*ratioh,600*ratiow,56*ratioh,609*ratiow,68*ratioh,615*ratiow,80*ratioh,620*ratiow,97*ratioh,620*ratiow,135*ratioh,534*ratiow,185*ratioh,498*ratiow,206*ratioh,495*ratiow,203*ratioh,492*ratiow,200*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(498*ratiow,206*ratioh,560*ratiow,170*ratioh,608*ratiow,142*ratioh,620*ratiow,135*ratioh,620*ratiow,277*ratioh,619*ratiow,280*ratioh,615*ratiow,284*ratioh,613*ratiow,286*ratioh,618*ratiow,290*ratioh,620*ratiow,294*ratioh,620*ratiow,299*ratioh,611*ratiow,299*ratioh,597*ratiow,296*ratioh,578*ratiow,291*ratioh,554*ratiow,282*ratioh,543*ratiow,275*ratioh,533*ratiow,264*ratioh,522*ratiow,250*ratioh,513*ratiow,232*ratioh,506*ratiow,219*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(483*ratiow,536*ratioh,478*ratiow,548*ratioh,469*ratiow,567*ratioh,460*ratiow,584*ratioh,453*ratiow,598*ratioh,451*ratiow,611*ratioh,453*ratiow,626*ratioh,456*ratiow,635*ratioh,467*ratiow,643*ratioh,471*ratiow,642*ratioh,469*ratiow,638*ratioh,467*ratiow,628*ratioh,470*ratiow,620*ratioh,468*ratiow,617*ratioh,467*ratiow,610*ratioh,473*ratiow,595*ratioh,479*ratiow,582*ratioh,485*ratiow,578*ratioh,491*ratiow,576*ratioh,491*ratiow,565*ratioh,489*ratiow,553*ratioh,486*ratiow,544*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(488*ratiow,498*ratioh,489*ratiow,525*ratioh,488*ratiow,534*ratioh,495*ratiow,539*ratioh,502*ratiow,547*ratioh,510*ratiow,556*ratioh,517*ratiow,568*ratioh,522*ratiow,579*ratioh,524*ratiow,588*ratioh,525*ratiow,599*ratioh,523*ratiow,611*ratioh,517*ratiow,621*ratioh,512*ratiow,628*ratioh,518*ratiow,626*ratioh,527*ratiow,619*ratioh,532*ratiow,609*ratioh,535*ratiow,596*ratioh,535*ratiow,579*ratioh,531*ratiow,562*ratioh,524*ratiow,547*ratioh,514*ratiow,531*ratioh,506*ratiow,519*ratioh,497*ratiow,508*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(247*ratiow,668*ratioh,390*ratiow,649*ratioh,423*ratiow,627*ratioh,451*ratiow,607*ratioh,454*ratiow,594*ratioh,461*ratiow,581*ratioh,471*ratiow,562*ratioh,479*ratiow,546*ratioh,483*ratiow,534*ratioh,485*ratiow,518*ratioh,485*ratiow,476*ratioh,484*ratiow,452*ratioh,483*ratiow,427*ratioh,482*ratiow,397*ratioh,483*ratiow,363*ratioh,484*ratiow,349*ratioh,483*ratiow,337*ratioh,480*ratiow,323*ratioh,476*ratiow,308*ratioh,467*ratiow,286*ratioh,457*ratiow,270*ratioh,454*ratiow,265*ratioh,446*ratiow,259*ratioh,438*ratiow,256*ratioh,426*ratiow,255*ratioh,411*ratiow,251*ratioh,380*ratiow,251*ratioh,357*ratiow,254*ratioh,328*ratiow,262*ratioh,298*ratiow,275*ratioh,275*ratiow,288*ratioh,249*ratiow,307*ratioh,226*ratiow,332*ratioh,204*ratiow,371*ratioh,192*ratiow,409*ratioh,186*ratiow,442*ratioh,183*ratiow,478*ratioh,183*ratiow,503*ratioh,187*ratiow,529*ratioh,192*ratiow,550*ratioh,199*ratiow,573*ratioh,208*ratiow,597*ratioh,218*ratiow,621*ratioh,228*ratiow,647*ratioh,238*ratiow,660*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(271*ratiow,792*ratioh,269*ratiow,806*ratioh,255*ratiow,802*ratioh,243*ratiow,798*ratioh,241*ratiow,791*ratioh,230*ratiow,781*ratioh,217*ratiow,770*ratioh,203*ratiow,764*ratioh,193*ratiow,764*ratioh,184*ratiow,769*ratioh,172*ratiow,767*ratioh,158*ratiow,763*ratioh,139*ratiow,753*ratioh,119*ratiow,739*ratioh,105*ratiow,726*ratioh,96*ratiow,715*ratioh,87*ratiow,696*ratioh,76*ratiow,669*ratioh,99*ratiow,661*ratioh,113*ratiow,655*ratioh,111*ratiow,659*ratioh,108*ratiow,669*ratioh,112*ratiow,683*ratioh,117*ratiow,692*ratioh,120*ratiow,698*ratioh,132*ratiow,706*ratioh,144*ratiow,715*ratioh,155*ratiow,723*ratioh,160*ratiow,729*ratioh,170*ratiow,737*ratioh,179*ratiow,740*ratioh,193*ratiow,739*ratioh,206*ratiow,734*ratioh,214*ratiow,734*ratioh,222*ratiow,736*ratioh,235*ratiow,743*ratioh,243*ratiow,753*ratioh,248*ratiow,762*ratioh,251*ratiow,774*ratioh,252*ratiow,783*ratioh,255*ratiow,789*ratioh,260*ratiow,792*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(275*ratiow,778*ratioh,272*ratiow,785*ratioh,270*ratiow,792*ratioh,261*ratiow,792*ratioh,254*ratiow,788*ratioh,251*ratiow,781*ratioh,251*ratiow,773*ratioh,248*ratiow,764*ratioh,244*ratiow,754*ratioh,238*ratiow,746*ratioh,232*ratiow,741*ratioh,225*ratiow,737*ratioh,219*ratiow,735*ratioh,213*ratiow,734*ratioh,206*ratiow,734*ratioh,197*ratiow,738*ratioh,186*ratiow,740*ratioh,177*ratiow,740*ratioh,168*ratiow,736*ratioh,161*ratiow,729*ratioh,152*ratiow,720*ratioh,134*ratiow,709*ratioh,122*ratiow,699*ratioh,112*ratiow,685*ratioh,109*ratiow,670*ratioh,110*ratiow,659*ratioh,114*ratiow,655*ratioh,121*ratiow,653*ratioh,124*ratiow,653*ratioh,128*ratiow,657*ratioh,128*ratiow,666*ratioh,128*ratiow,674*ratioh,130*ratiow,679*ratioh,136*ratiow,684*ratioh,142*ratiow,687*ratioh,150*ratiow,690*ratioh,162*ratiow,699*ratioh,167*ratiow,705*ratioh,172*ratiow,710*ratioh,177*ratiow,713*ratioh,185*ratiow,715*ratioh,192*ratiow,716*ratioh,214*ratiow,716*ratioh,229*ratiow,718*ratioh,237*ratiow,721*ratioh,243*ratiow,724*ratioh,249*ratiow,729*ratioh,254*ratiow,735*ratioh,258*ratiow,741*ratioh,261*ratiow,747*ratioh,264*ratiow,755*ratioh,266*ratiow,769*ratioh,269*ratiow,774*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(295*ratiow,756*ratioh,283*ratiow,766*ratioh,275*ratiow,778*ratioh,268*ratiow,774*ratioh,265*ratiow,760*ratioh,260*ratiow,745*ratioh,251*ratiow,732*ratioh,247*ratiow,726*ratioh,241*ratiow,722*ratioh,233*ratiow,719*ratioh,228*ratiow,718*ratioh,221*ratiow,717*ratioh,205*ratiow,716*ratioh,183*ratiow,715*ratioh,170*ratiow,709*ratioh,160*ratiow,697*ratioh,153*ratiow,693*ratioh,145*ratiow,688*ratioh,135*ratiow,683*ratioh,129*ratiow,677*ratioh,127*ratiow,664*ratioh,127*ratiow,655*ratioh,121*ratiow,652*ratioh,160*ratiow,636*ratioh,175*ratiow,627*ratioh,173*ratiow,632*ratioh,173*ratiow,642*ratioh,176*ratiow,652*ratioh,181*ratiow,661*ratioh,192*ratiow,672*ratioh,205*ratiow,674*ratioh,219*ratiow,672*ratioh,227*ratiow,679*ratioh,240*ratiow,689*ratioh,250*ratiow,698*ratioh,259*ratiow,706*ratioh,266*ratiow,715*ratioh,274*ratiow,728*ratioh,282*ratiow,742*ratioh,285*ratiow,751*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(491*ratiow,576*ratioh,484*ratiow,578*ratioh,476*ratiow,587*ratioh,471*ratiow,599*ratioh,468*ratiow,610*ratioh,468*ratiow,618*ratioh,473*ratiow,621*ratioh,480*ratiow,622*ratioh,491*ratiow,620*ratioh,502*ratiow,612*ratioh,506*ratiow,601*ratioh,505*ratiow,590*ratioh,502*ratiow,583*ratioh,497*ratiow,578*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(135*ratiow,195*ratioh,31*ratiow,44*ratioh,21*ratiow,56*ratioh,12*ratiow,68*ratioh,6*ratiow,80*ratioh,1*ratiow,97*ratioh,1*ratiow,135*ratioh,87*ratiow,185*ratioh,123*ratiow,206*ratioh,126*ratiow,203*ratioh,129*ratiow,200*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(123*ratiow,206*ratioh,61*ratiow,170*ratioh,13*ratiow,142*ratioh,1*ratiow,135*ratioh,1*ratiow,277*ratioh,2*ratiow,280*ratioh,6*ratiow,284*ratioh,8*ratiow,286*ratioh,3*ratiow,290*ratioh,1*ratiow,294*ratioh,1*ratiow,299*ratioh,10*ratiow,299*ratioh,24*ratiow,296*ratioh,43*ratiow,291*ratioh,67*ratiow,282*ratioh,78*ratiow,275*ratioh,88*ratiow,264*ratioh,99*ratiow,250*ratioh,108*ratiow,232*ratioh,115*ratiow,219*ratioh);
data = analyze_pic(data);

//AcbC
selectWindow(name);
makePolygon(138*ratiow,536*ratioh,143*ratiow,548*ratioh,152*ratiow,567*ratioh,161*ratiow,584*ratioh,168*ratiow,598*ratioh,170*ratiow,611*ratioh,168*ratiow,626*ratioh,165*ratiow,635*ratioh,154*ratiow,643*ratioh,150*ratiow,642*ratioh,152*ratiow,638*ratioh,154*ratiow,628*ratioh,151*ratiow,620*ratioh,153*ratiow,617*ratioh,154*ratiow,610*ratioh,148*ratiow,595*ratioh,142*ratiow,582*ratioh,136*ratiow,578*ratioh,130*ratiow,576*ratioh,130*ratiow,565*ratioh,132*ratiow,553*ratioh,135*ratiow,544*ratioh);
data = analyze_pic(data);

//AcbSh
selectWindow(name);
makePolygon(133*ratiow,498*ratioh,132*ratiow,525*ratioh,133*ratiow,534*ratioh,126*ratiow,539*ratioh,119*ratiow,547*ratioh,111*ratiow,556*ratioh,104*ratiow,568*ratioh,99*ratiow,579*ratioh,97*ratiow,588*ratioh,96*ratiow,599*ratioh,98*ratiow,611*ratioh,104*ratiow,621*ratioh,109*ratiow,628*ratioh,103*ratiow,626*ratioh,94*ratiow,619*ratioh,89*ratiow,609*ratioh,86*ratiow,596*ratioh,86*ratiow,579*ratioh,90*ratiow,562*ratioh,97*ratiow,547*ratioh,107*ratiow,531*ratioh,115*ratiow,519*ratioh,124*ratiow,508*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(374*ratiow,668*ratioh,231*ratiow,649*ratioh,198*ratiow,627*ratioh,170*ratiow,607*ratioh,167*ratiow,594*ratioh,160*ratiow,581*ratioh,150*ratiow,562*ratioh,142*ratiow,546*ratioh,138*ratiow,534*ratioh,136*ratiow,518*ratioh,136*ratiow,476*ratioh,137*ratiow,452*ratioh,138*ratiow,427*ratioh,139*ratiow,397*ratioh,138*ratiow,363*ratioh,137*ratiow,349*ratioh,138*ratiow,337*ratioh,141*ratiow,323*ratioh,145*ratiow,308*ratioh,154*ratiow,286*ratioh,164*ratiow,270*ratioh,167*ratiow,265*ratioh,175*ratiow,259*ratioh,183*ratiow,256*ratioh,195*ratiow,255*ratioh,210*ratiow,251*ratioh,241*ratiow,251*ratioh,264*ratiow,254*ratioh,293*ratiow,262*ratioh,323*ratiow,275*ratioh,346*ratiow,288*ratioh,372*ratiow,307*ratioh,395*ratiow,332*ratioh,417*ratiow,371*ratioh,429*ratiow,409*ratioh,435*ratiow,442*ratioh,438*ratiow,478*ratioh,438*ratiow,503*ratioh,434*ratiow,529*ratioh,429*ratiow,550*ratioh,422*ratiow,573*ratioh,413*ratiow,597*ratioh,403*ratiow,621*ratioh,393*ratiow,647*ratioh,383*ratiow,660*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(350*ratiow,792*ratioh,352*ratiow,806*ratioh,366*ratiow,802*ratioh,378*ratiow,798*ratioh,380*ratiow,791*ratioh,391*ratiow,781*ratioh,404*ratiow,770*ratioh,418*ratiow,764*ratioh,428*ratiow,764*ratioh,437*ratiow,769*ratioh,449*ratiow,767*ratioh,463*ratiow,763*ratioh,482*ratiow,753*ratioh,502*ratiow,739*ratioh,516*ratiow,726*ratioh,525*ratiow,715*ratioh,534*ratiow,696*ratioh,545*ratiow,669*ratioh,522*ratiow,661*ratioh,508*ratiow,655*ratioh,510*ratiow,659*ratioh,513*ratiow,669*ratioh,509*ratiow,683*ratioh,504*ratiow,692*ratioh,501*ratiow,698*ratioh,489*ratiow,706*ratioh,477*ratiow,715*ratioh,466*ratiow,723*ratioh,461*ratiow,729*ratioh,451*ratiow,737*ratioh,442*ratiow,740*ratioh,428*ratiow,739*ratioh,415*ratiow,734*ratioh,407*ratiow,734*ratioh,399*ratiow,736*ratioh,386*ratiow,743*ratioh,378*ratiow,753*ratioh,373*ratiow,762*ratioh,370*ratiow,774*ratioh,369*ratiow,783*ratioh,366*ratiow,789*ratioh,361*ratiow,792*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(346*ratiow,778*ratioh,349*ratiow,785*ratioh,351*ratiow,792*ratioh,360*ratiow,792*ratioh,367*ratiow,788*ratioh,370*ratiow,781*ratioh,370*ratiow,773*ratioh,373*ratiow,764*ratioh,377*ratiow,754*ratioh,383*ratiow,746*ratioh,389*ratiow,741*ratioh,396*ratiow,737*ratioh,402*ratiow,735*ratioh,408*ratiow,734*ratioh,415*ratiow,734*ratioh,424*ratiow,738*ratioh,435*ratiow,740*ratioh,444*ratiow,740*ratioh,453*ratiow,736*ratioh,460*ratiow,729*ratioh,469*ratiow,720*ratioh,487*ratiow,709*ratioh,499*ratiow,699*ratioh,509*ratiow,685*ratioh,512*ratiow,670*ratioh,511*ratiow,659*ratioh,507*ratiow,655*ratioh,500*ratiow,653*ratioh,497*ratiow,653*ratioh,493*ratiow,657*ratioh,493*ratiow,666*ratioh,493*ratiow,674*ratioh,491*ratiow,679*ratioh,485*ratiow,684*ratioh,479*ratiow,687*ratioh,471*ratiow,690*ratioh,459*ratiow,699*ratioh,454*ratiow,705*ratioh,449*ratiow,710*ratioh,444*ratiow,713*ratioh,436*ratiow,715*ratioh,429*ratiow,716*ratioh,407*ratiow,716*ratioh,392*ratiow,718*ratioh,384*ratiow,721*ratioh,378*ratiow,724*ratioh,372*ratiow,729*ratioh,367*ratiow,735*ratioh,363*ratiow,741*ratioh,360*ratiow,747*ratioh,357*ratiow,755*ratioh,355*ratiow,769*ratioh,352*ratiow,774*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(326*ratiow,756*ratioh,338*ratiow,766*ratioh,346*ratiow,778*ratioh,353*ratiow,774*ratioh,356*ratiow,760*ratioh,361*ratiow,745*ratioh,370*ratiow,732*ratioh,374*ratiow,726*ratioh,380*ratiow,722*ratioh,388*ratiow,719*ratioh,393*ratiow,718*ratioh,400*ratiow,717*ratioh,416*ratiow,716*ratioh,438*ratiow,715*ratioh,451*ratiow,709*ratioh,461*ratiow,697*ratioh,468*ratiow,693*ratioh,476*ratiow,688*ratioh,486*ratiow,683*ratioh,492*ratiow,677*ratioh,494*ratiow,664*ratioh,494*ratiow,655*ratioh,500*ratiow,652*ratioh,461*ratiow,636*ratioh,446*ratiow,627*ratioh,448*ratiow,632*ratioh,448*ratiow,642*ratioh,445*ratiow,652*ratioh,440*ratiow,661*ratioh,429*ratiow,672*ratioh,416*ratiow,674*ratioh,402*ratiow,672*ratioh,394*ratiow,679*ratioh,381*ratiow,689*ratioh,371*ratiow,698*ratioh,362*ratiow,706*ratioh,355*ratiow,715*ratioh,347*ratiow,728*ratioh,339*ratiow,742*ratioh,336*ratiow,751*ratioh);
data = analyze_pic(data);

//aca
selectWindow(name);
makePolygon(130*ratiow,576*ratioh,137*ratiow,578*ratioh,145*ratiow,587*ratioh,150*ratiow,599*ratioh,153*ratiow,610*ratioh,153*ratiow,618*ratioh,148*ratiow,621*ratioh,141*ratiow,622*ratioh,130*ratiow,620*ratioh,119*ratiow,612*ratioh,115*ratiow,601*ratioh,116*ratiow,590*ratioh,119*ratiow,583*ratioh,124*ratiow,578*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile30(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 632;
var baseHeight = 831;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(497*ratiow,183*ratioh,597*ratiow,48*ratioh,603*ratiow,53*ratioh,613*ratiow,64*ratioh,620*ratiow,75*ratioh,626*ratiow,85*ratioh,629*ratiow,94*ratioh,631*ratiow,107*ratioh,631*ratiow,139*ratioh,599*ratiow,152*ratioh,540*ratiow,176*ratioh,504*ratiow,192*ratioh,501*ratiow,188*ratioh,495*ratiow,186*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(504*ratiow,191*ratioh,609*ratiow,148*ratioh,631*ratiow,138*ratioh,631*ratiow,292*ratioh,613*ratiow,291*ratioh,588*ratiow,287*ratioh,566*ratiow,279*ratioh,549*ratiow,269*ratioh,540*ratiow,256*ratioh,531*ratiow,242*ratioh,522*ratiow,222*ratioh,514*ratiow,203*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(271*ratiow,677*ratioh,270*ratiow,672*ratioh,271*ratiow,668*ratioh,276*ratiow,670*ratioh,289*ratiow,678*ratioh,303*ratiow,688*ratioh,310*ratiow,700*ratioh,421*ratiow,701*ratioh,433*ratiow,681*ratioh,439*ratiow,664*ratioh,427*ratiow,670*ratioh,412*ratiow,675*ratioh,395*ratiow,675*ratioh,381*ratiow,671*ratioh,373*ratiow,667*ratioh,381*ratiow,659*ratioh,416*ratiow,633*ratioh,439*ratiow,614*ratioh,455*ratiow,596*ratioh,469*ratiow,577*ratioh,483*ratiow,553*ratioh,491*ratiow,536*ratioh,496*ratiow,510*ratioh,496*ratiow,497*ratioh,491*ratiow,463*ratioh,489*ratiow,428*ratioh,491*ratiow,381*ratioh,490*ratiow,344*ratioh,487*ratiow,320*ratioh,480*ratiow,294*ratioh,471*ratiow,276*ratioh,463*ratiow,263*ratioh,451*ratiow,250*ratioh,445*ratiow,246*ratioh,417*ratiow,245*ratioh,398*ratiow,246*ratioh,376*ratiow,248*ratioh,350*ratiow,255*ratioh,322*ratiow,264*ratioh,301*ratiow,274*ratioh,282*ratiow,285*ratioh,265*ratiow,299*ratioh,250*ratiow,314*ratioh,234*ratiow,335*ratioh,221*ratiow,355*ratioh,211*ratiow,377*ratioh,200*ratiow,407*ratioh,193*ratiow,431*ratioh,188*ratiow,460*ratioh,187*ratiow,490*ratioh,189*ratiow,518*ratioh,193*ratiow,541*ratioh,197*ratiow,558*ratioh,204*ratiow,582*ratioh,212*ratiow,597*ratioh,218*ratiow,614*ratioh,230*ratiow,635*ratioh,240*ratiow,650*ratioh,250*ratiow,659*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(284*ratiow,812*ratioh,254*ratiow,801*ratioh,250*ratiow,791*ratioh,241*ratiow,778*ratioh,226*ratiow,766*ratioh,218*ratiow,762*ratioh,206*ratiow,760*ratioh,195*ratiow,761*ratioh,186*ratiow,769*ratioh,160*ratiow,755*ratioh,130*ratiow,735*ratioh,93*ratiow,700*ratioh,78*ratiow,676*ratioh,112*ratiow,658*ratioh,110*ratiow,667*ratioh,111*ratiow,686*ratioh,116*ratiow,701*ratioh,134*ratiow,719*ratioh,152*ratiow,729*ratioh,178*ratiow,735*ratioh,202*ratiow,736*ratioh,223*ratiow,739*ratioh,245*ratiow,748*ratioh,259*ratiow,757*ratioh,274*ratiow,777*ratioh,284*ratiow,787*ratioh,281*ratiow,800*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(285*ratiow,787*ratioh,274*ratiow,777*ratioh,264*ratiow,763*ratioh,254*ratiow,754*ratioh,244*ratiow,748*ratioh,227*ratiow,740*ratioh,202*ratiow,736*ratioh,184*ratiow,735*ratioh,158*ratiow,731*ratioh,137*ratiow,721*ratioh,121*ratiow,707*ratioh,113*ratiow,693*ratioh,110*ratiow,675*ratioh,111*ratiow,658*ratioh,117*ratiow,655*ratioh,124*ratiow,658*ratioh,128*ratiow,670*ratioh,130*ratiow,687*ratioh,138*ratiow,703*ratioh,151*ratiow,710*ratioh,172*ratiow,715*ratioh,202*ratiow,717*ratioh,228*ratiow,720*ratioh,251*ratiow,730*ratioh,265*ratiow,741*ratioh,277*ratiow,761*ratioh,285*ratiow,774*ratioh,289*ratiow,777*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(289*ratiow,776*ratioh,280*ratiow,767*ratioh,270*ratiow,750*ratioh,262*ratiow,738*ratioh,243*ratiow,726*ratioh,222*ratiow,719*ratioh,204*ratiow,717*ratioh,170*ratiow,716*ratioh,153*ratiow,710*ratioh,142*ratiow,705*ratioh,134*ratiow,697*ratioh,128*ratiow,674*ratioh,126*ratiow,662*ratioh,122*ratiow,657*ratioh,117*ratiow,655*ratioh,138*ratiow,643*ratioh,169*ratiow,624*ratioh,176*ratiow,620*ratioh,174*ratiow,631*ratioh,175*ratiow,643*ratioh,183*ratiow,657*ratioh,195*ratiow,667*ratioh,210*ratiow,674*ratioh,224*ratiow,673*ratioh,234*ratiow,680*ratioh,250*ratiow,690*ratioh,263*ratiow,701*ratioh,277*ratiow,717*ratioh,291*ratiow,742*ratioh,299*ratiow,753*ratioh,306*ratiow,758*ratioh,298*ratiow,761*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(135*ratiow,183*ratioh,35*ratiow,48*ratioh,29*ratiow,53*ratioh,19*ratiow,64*ratioh,12*ratiow,75*ratioh,6*ratiow,85*ratioh,3*ratiow,94*ratioh,1*ratiow,107*ratioh,1*ratiow,139*ratioh,33*ratiow,152*ratioh,92*ratiow,176*ratioh,128*ratiow,192*ratioh,131*ratiow,188*ratioh,137*ratiow,186*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(128*ratiow,191*ratioh,23*ratiow,148*ratioh,1*ratiow,138*ratioh,1*ratiow,292*ratioh,19*ratiow,291*ratioh,44*ratiow,287*ratioh,66*ratiow,279*ratioh,83*ratiow,269*ratioh,92*ratiow,256*ratioh,101*ratiow,242*ratioh,110*ratiow,222*ratioh,118*ratiow,203*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(361*ratiow,677*ratioh,362*ratiow,672*ratioh,361*ratiow,668*ratioh,356*ratiow,670*ratioh,343*ratiow,678*ratioh,329*ratiow,688*ratioh,322*ratiow,700*ratioh,211*ratiow,701*ratioh,199*ratiow,681*ratioh,193*ratiow,664*ratioh,205*ratiow,670*ratioh,220*ratiow,675*ratioh,237*ratiow,675*ratioh,251*ratiow,671*ratioh,259*ratiow,667*ratioh,251*ratiow,659*ratioh,216*ratiow,633*ratioh,193*ratiow,614*ratioh,177*ratiow,596*ratioh,163*ratiow,577*ratioh,149*ratiow,553*ratioh,141*ratiow,536*ratioh,136*ratiow,510*ratioh,136*ratiow,497*ratioh,141*ratiow,463*ratioh,143*ratiow,428*ratioh,141*ratiow,381*ratioh,142*ratiow,344*ratioh,145*ratiow,320*ratioh,152*ratiow,294*ratioh,161*ratiow,276*ratioh,169*ratiow,263*ratioh,181*ratiow,250*ratioh,187*ratiow,246*ratioh,215*ratiow,245*ratioh,234*ratiow,246*ratioh,256*ratiow,248*ratioh,282*ratiow,255*ratioh,310*ratiow,264*ratioh,331*ratiow,274*ratioh,350*ratiow,285*ratioh,367*ratiow,299*ratioh,382*ratiow,314*ratioh,398*ratiow,335*ratioh,411*ratiow,355*ratioh,421*ratiow,377*ratioh,432*ratiow,407*ratioh,439*ratiow,431*ratioh,444*ratiow,460*ratioh,445*ratiow,490*ratioh,443*ratiow,518*ratioh,439*ratiow,541*ratioh,435*ratiow,558*ratioh,428*ratiow,582*ratioh,420*ratiow,597*ratioh,414*ratiow,614*ratioh,402*ratiow,635*ratioh,392*ratiow,650*ratioh,382*ratiow,659*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(348*ratiow,812*ratioh,378*ratiow,801*ratioh,382*ratiow,791*ratioh,391*ratiow,778*ratioh,406*ratiow,766*ratioh,414*ratiow,762*ratioh,426*ratiow,760*ratioh,437*ratiow,761*ratioh,446*ratiow,769*ratioh,472*ratiow,755*ratioh,502*ratiow,735*ratioh,539*ratiow,700*ratioh,554*ratiow,676*ratioh,520*ratiow,658*ratioh,522*ratiow,667*ratioh,521*ratiow,686*ratioh,516*ratiow,701*ratioh,498*ratiow,719*ratioh,480*ratiow,729*ratioh,454*ratiow,735*ratioh,430*ratiow,736*ratioh,409*ratiow,739*ratioh,387*ratiow,748*ratioh,373*ratiow,757*ratioh,358*ratiow,777*ratioh,348*ratiow,787*ratioh,351*ratiow,800*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(347*ratiow,787*ratioh,358*ratiow,777*ratioh,368*ratiow,763*ratioh,378*ratiow,754*ratioh,388*ratiow,748*ratioh,405*ratiow,740*ratioh,430*ratiow,736*ratioh,448*ratiow,735*ratioh,474*ratiow,731*ratioh,495*ratiow,721*ratioh,511*ratiow,707*ratioh,519*ratiow,693*ratioh,522*ratiow,675*ratioh,521*ratiow,658*ratioh,515*ratiow,655*ratioh,508*ratiow,658*ratioh,504*ratiow,670*ratioh,502*ratiow,687*ratioh,494*ratiow,703*ratioh,481*ratiow,710*ratioh,460*ratiow,715*ratioh,430*ratiow,717*ratioh,404*ratiow,720*ratioh,381*ratiow,730*ratioh,367*ratiow,741*ratioh,355*ratiow,761*ratioh,347*ratiow,774*ratioh,343*ratiow,777*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(343*ratiow,776*ratioh,352*ratiow,767*ratioh,362*ratiow,750*ratioh,370*ratiow,738*ratioh,389*ratiow,726*ratioh,410*ratiow,719*ratioh,428*ratiow,717*ratioh,462*ratiow,716*ratioh,479*ratiow,710*ratioh,490*ratiow,705*ratioh,498*ratiow,697*ratioh,504*ratiow,674*ratioh,506*ratiow,662*ratioh,510*ratiow,657*ratioh,515*ratiow,655*ratioh,494*ratiow,643*ratioh,463*ratiow,624*ratioh,456*ratiow,620*ratioh,458*ratiow,631*ratioh,457*ratiow,643*ratioh,449*ratiow,657*ratioh,437*ratiow,667*ratioh,422*ratiow,674*ratioh,408*ratiow,673*ratioh,398*ratiow,680*ratioh,382*ratiow,690*ratioh,369*ratiow,701*ratioh,355*ratiow,717*ratioh,341*ratiow,742*ratioh,333*ratiow,753*ratioh,326*ratiow,758*ratioh,334*ratiow,761*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile31(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 644;
var baseHeight = 828;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(510*ratiow,189*ratioh,547*ratiow,148*ratioh,603*ratiow,82*ratioh,624*ratiow,57*ratioh,631*ratiow,66*ratioh,639*ratiow,78*ratioh,643*ratiow,93*ratioh,643*ratiow,147*ratioh,607*ratiow,162*ratioh,560*ratiow,183*ratioh,524*ratiow,199*ratioh,519*ratiow,195*ratioh,516*ratiow,192*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(524*ratiow,198*ratioh,588*ratiow,171*ratioh,643*ratiow,146*ratioh,643*ratiow,256*ratioh,642*ratiow,265*ratioh,635*ratiow,273*ratioh,631*ratiow,277*ratioh,638*ratiow,279*ratioh,643*ratiow,283*ratioh,642*ratiow,292*ratioh,630*ratiow,289*ratioh,613*ratiow,289*ratioh,596*ratiow,284*ratioh,578*ratiow,277*ratioh,564*ratiow,265*ratioh,553*ratiow,246*ratioh,541*ratiow,222*ratioh,533*ratiow,208*ratioh,528*ratiow,201*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(311*ratiow,699*ratioh,336*ratiow,699*ratioh,355*ratiow,681*ratioh,377*ratiow,663*ratioh,407*ratiow,639*ratioh,437*ratiow,616*ratioh,458*ratiow,595*ratioh,475*ratiow,573*ratioh,480*ratiow,564*ratioh,480*ratiow,556*ratioh,484*ratiow,550*ratioh,483*ratiow,535*ratioh,485*ratiow,524*ratioh,491*ratiow,509*ratioh,495*ratiow,502*ratioh,496*ratiow,455*ratioh,496*ratiow,398*ratioh,498*ratiow,369*ratioh,497*ratiow,338*ratioh,495*ratiow,326*ratioh,488*ratiow,302*ratioh,480*ratiow,283*ratioh,472*ratiow,268*ratioh,465*ratiow,259*ratioh,452*ratiow,253*ratioh,435*ratiow,249*ratioh,425*ratiow,247*ratioh,403*ratiow,247*ratioh,380*ratiow,249*ratioh,359*ratiow,252*ratioh,339*ratiow,257*ratioh,325*ratiow,262*ratioh,305*ratiow,272*ratioh,289*ratiow,282*ratioh,271*ratiow,295*ratioh,249*ratiow,317*ratioh,231*ratiow,343*ratioh,218*ratiow,368*ratioh,208*ratiow,395*ratioh,202*ratiow,416*ratioh,195*ratiow,448*ratioh,191*ratiow,473*ratioh,192*ratiow,515*ratioh,196*ratiow,542*ratioh,202*ratiow,563*ratioh,209*ratiow,584*ratioh,218*ratiow,605*ratioh,233*ratiow,632*ratioh,246*ratiow,650*ratioh,256*ratiow,660*ratioh,272*ratiow,673*ratioh,273*ratiow,667*ratioh,278*ratiow,666*ratioh,287*ratiow,671*ratioh,300*ratiow,684*ratioh,308*ratiow,693*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(285*ratiow,805*ratioh,271*ratiow,801*ratioh,258*ratiow,800*ratioh,254*ratiow,789*ratioh,245*ratiow,775*ratioh,235*ratiow,766*ratioh,222*ratiow,760*ratioh,210*ratiow,759*ratioh,198*ratiow,762*ratioh,186*ratiow,768*ratioh,177*ratiow,766*ratioh,147*ratiow,745*ratioh,117*ratiow,721*ratioh,97*ratiow,700*ratioh,79*ratiow,668*ratioh,113*ratiow,655*ratioh,112*ratiow,668*ratioh,116*ratiow,689*ratioh,121*ratiow,703*ratioh,131*ratiow,715*ratioh,140*ratiow,721*ratioh,160*ratiow,728*ratioh,174*ratiow,730*ratioh,209*ratiow,737*ratioh,228*ratiow,739*ratioh,245*ratiow,743*ratioh,252*ratiow,747*ratioh,261*ratiow,755*ratioh,270*ratiow,767*ratioh,277*ratiow,778*ratioh,280*ratiow,788*ratioh,287*ratiow,789*ratioh,291*ratiow,788*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(291*ratiow,788*ratioh,284*ratiow,790*ratioh,279*ratiow,786*ratioh,273*ratiow,772*ratioh,267*ratiow,763*ratioh,259*ratiow,753*ratioh,249*ratiow,745*ratioh,236*ratiow,740*ratioh,197*ratiow,735*ratioh,173*ratiow,730*ratioh,141*ratiow,722*ratioh,126*ratiow,710*ratioh,117*ratiow,693*ratioh,113*ratiow,675*ratioh,112*ratiow,658*ratioh,115*ratiow,654*ratioh,119*ratiow,653*ratioh,123*ratiow,657*ratioh,128*ratiow,670*ratioh,134*ratiow,687*ratioh,141*ratiow,700*ratioh,156*ratiow,707*ratioh,190*ratiow,713*ratioh,224*ratiow,716*ratioh,244*ratiow,720*ratioh,259*ratiow,729*ratioh,269*ratiow,739*ratioh,277*ratiow,755*ratioh,282*ratiow,767*ratioh,286*ratiow,772*ratioh,299*ratiow,772*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(299*ratiow,772*ratioh,286*ratiow,772*ratioh,281*ratiow,765*ratioh,275*ratiow,749*ratioh,268*ratiow,738*ratioh,258*ratiow,728*ratioh,243*ratiow,720*ratioh,223*ratiow,716*ratioh,196*ratiow,713*ratioh,161*ratiow,709*ratioh,143*ratiow,701*ratioh,136*ratiow,693*ratioh,127*ratiow,666*ratioh,123*ratiow,657*ratioh,119*ratiow,652*ratioh,145*ratiow,640*ratioh,171*ratiow,622*ratioh,175*ratiow,619*ratioh,174*ratiow,633*ratioh,182*ratiow,653*ratioh,199*ratiow,666*ratioh,218*ratiow,672*ratioh,228*ratiow,674*ratioh,244*ratiow,682*ratioh,257*ratiow,693*ratioh,267*ratiow,703*ratioh,277*ratiow,715*ratioh,286*ratiow,728*ratioh,293*ratiow,741*ratioh,297*ratiow,748*ratioh,301*ratiow,753*ratioh,310*ratiow,758*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(134*ratiow,189*ratioh,97*ratiow,148*ratioh,41*ratiow,82*ratioh,20*ratiow,57*ratioh,13*ratiow,66*ratioh,5*ratiow,78*ratioh,1*ratiow,93*ratioh,1*ratiow,147*ratioh,37*ratiow,162*ratioh,84*ratiow,183*ratioh,120*ratiow,199*ratioh,125*ratiow,195*ratioh,128*ratiow,192*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(120*ratiow,198*ratioh,56*ratiow,171*ratioh,1*ratiow,146*ratioh,1*ratiow,256*ratioh,2*ratiow,265*ratioh,9*ratiow,273*ratioh,13*ratiow,277*ratioh,6*ratiow,279*ratioh,1*ratiow,283*ratioh,2*ratiow,292*ratioh,14*ratiow,289*ratioh,31*ratiow,289*ratioh,48*ratiow,284*ratioh,66*ratiow,277*ratioh,80*ratiow,265*ratioh,91*ratiow,246*ratioh,103*ratiow,222*ratioh,111*ratiow,208*ratioh,116*ratiow,201*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(333*ratiow,699*ratioh,308*ratiow,699*ratioh,289*ratiow,681*ratioh,267*ratiow,663*ratioh,237*ratiow,639*ratioh,207*ratiow,616*ratioh,186*ratiow,595*ratioh,169*ratiow,573*ratioh,164*ratiow,564*ratioh,164*ratiow,556*ratioh,160*ratiow,550*ratioh,161*ratiow,535*ratioh,159*ratiow,524*ratioh,153*ratiow,509*ratioh,149*ratiow,502*ratioh,148*ratiow,455*ratioh,148*ratiow,398*ratioh,146*ratiow,369*ratioh,147*ratiow,338*ratioh,149*ratiow,326*ratioh,156*ratiow,302*ratioh,164*ratiow,283*ratioh,172*ratiow,268*ratioh,179*ratiow,259*ratioh,192*ratiow,253*ratioh,209*ratiow,249*ratioh,219*ratiow,247*ratioh,241*ratiow,247*ratioh,264*ratiow,249*ratioh,285*ratiow,252*ratioh,305*ratiow,257*ratioh,319*ratiow,262*ratioh,339*ratiow,272*ratioh,355*ratiow,282*ratioh,373*ratiow,295*ratioh,395*ratiow,317*ratioh,413*ratiow,343*ratioh,426*ratiow,368*ratioh,436*ratiow,395*ratioh,442*ratiow,416*ratioh,449*ratiow,448*ratioh,453*ratiow,473*ratioh,452*ratiow,515*ratioh,448*ratiow,542*ratioh,442*ratiow,563*ratioh,435*ratiow,584*ratioh,426*ratiow,605*ratioh,411*ratiow,632*ratioh,398*ratiow,650*ratioh,388*ratiow,660*ratioh,372*ratiow,673*ratioh,371*ratiow,667*ratioh,366*ratiow,666*ratioh,357*ratiow,671*ratioh,344*ratiow,684*ratioh,336*ratiow,693*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(359*ratiow,805*ratioh,373*ratiow,801*ratioh,386*ratiow,800*ratioh,390*ratiow,789*ratioh,399*ratiow,775*ratioh,409*ratiow,766*ratioh,422*ratiow,760*ratioh,434*ratiow,759*ratioh,446*ratiow,762*ratioh,458*ratiow,768*ratioh,467*ratiow,766*ratioh,497*ratiow,745*ratioh,527*ratiow,721*ratioh,547*ratiow,700*ratioh,565*ratiow,668*ratioh,531*ratiow,655*ratioh,532*ratiow,668*ratioh,528*ratiow,689*ratioh,523*ratiow,703*ratioh,513*ratiow,715*ratioh,504*ratiow,721*ratioh,484*ratiow,728*ratioh,470*ratiow,730*ratioh,435*ratiow,737*ratioh,416*ratiow,739*ratioh,399*ratiow,743*ratioh,392*ratiow,747*ratioh,383*ratiow,755*ratioh,374*ratiow,767*ratioh,367*ratiow,778*ratioh,364*ratiow,788*ratioh,357*ratiow,789*ratioh,353*ratiow,788*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(353*ratiow,788*ratioh,360*ratiow,790*ratioh,365*ratiow,786*ratioh,371*ratiow,772*ratioh,377*ratiow,763*ratioh,385*ratiow,753*ratioh,395*ratiow,745*ratioh,408*ratiow,740*ratioh,447*ratiow,735*ratioh,471*ratiow,730*ratioh,503*ratiow,722*ratioh,518*ratiow,710*ratioh,527*ratiow,693*ratioh,531*ratiow,675*ratioh,532*ratiow,658*ratioh,529*ratiow,654*ratioh,525*ratiow,653*ratioh,521*ratiow,657*ratioh,516*ratiow,670*ratioh,510*ratiow,687*ratioh,503*ratiow,700*ratioh,488*ratiow,707*ratioh,454*ratiow,713*ratioh,420*ratiow,716*ratioh,400*ratiow,720*ratioh,385*ratiow,729*ratioh,375*ratiow,739*ratioh,367*ratiow,755*ratioh,362*ratiow,767*ratioh,358*ratiow,772*ratioh,345*ratiow,772*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(345*ratiow,772*ratioh,358*ratiow,772*ratioh,363*ratiow,765*ratioh,369*ratiow,749*ratioh,376*ratiow,738*ratioh,386*ratiow,728*ratioh,401*ratiow,720*ratioh,421*ratiow,716*ratioh,448*ratiow,713*ratioh,483*ratiow,709*ratioh,501*ratiow,701*ratioh,508*ratiow,693*ratioh,517*ratiow,666*ratioh,521*ratiow,657*ratioh,525*ratiow,652*ratioh,499*ratiow,640*ratioh,473*ratiow,622*ratioh,469*ratiow,619*ratioh,470*ratiow,633*ratioh,462*ratiow,653*ratioh,445*ratiow,666*ratioh,426*ratiow,672*ratioh,416*ratiow,674*ratioh,400*ratiow,682*ratioh,387*ratiow,693*ratioh,377*ratiow,703*ratioh,367*ratiow,715*ratioh,358*ratiow,728*ratioh,351*ratiow,741*ratioh,347*ratiow,748*ratioh,343*ratiow,753*ratioh,334*ratiow,758*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile32(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 652;
var baseHeight = 838;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(517*ratiow,186*ratioh,518*ratiow,186*ratioh,583*ratiow,110*ratioh,619*ratiow,68*ratioh,629*ratiow,56*ratioh,635*ratiow,65*ratioh,644*ratiow,78*ratioh,649*ratiow,90*ratioh,650*ratiow,95*ratioh,651*ratiow,96*ratioh,651*ratiow,142*ratioh,615*ratiow,159*ratioh,556*ratiow,186*ratioh,533*ratiow,197*ratioh,530*ratiow,194*ratioh,526*ratiow,191*ratioh,520*ratiow,188*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(534*ratiow,196*ratioh,602*ratiow,165*ratioh,647*ratiow,144*ratioh,651*ratiow,142*ratioh,651*ratiow,261*ratioh,648*ratiow,263*ratioh,646*ratiow,269*ratioh,648*ratiow,274*ratioh,650*ratiow,274*ratioh,650*ratiow,278*ratioh,638*ratiow,278*ratioh,620*ratiow,276*ratioh,600*ratiow,272*ratioh,584*ratiow,266*ratioh,575*ratiow,254*ratioh,566*ratiow,245*ratioh,554*ratiow,229*ratioh,545*ratiow,214*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(259*ratiow,678*ratioh,333*ratiow,680*ratioh,360*ratiow,660*ratioh,389*ratiow,637*ratioh,412*ratiow,621*ratioh,448*ratiow,603*ratioh,468*ratiow,590*ratioh,476*ratiow,555*ratioh,479*ratiow,530*ratioh,486*ratiow,503*ratioh,495*ratiow,484*ratioh,500*ratiow,469*ratioh,501*ratiow,408*ratioh,498*ratiow,374*ratioh,495*ratiow,341*ratioh,490*ratiow,312*ratioh,483*ratiow,289*ratioh,475*ratiow,272*ratioh,464*ratiow,255*ratioh,457*ratiow,247*ratioh,436*ratiow,244*ratioh,417*ratiow,243*ratioh,390*ratiow,243*ratioh,371*ratiow,245*ratioh,348*ratiow,250*ratioh,320*ratiow,260*ratioh,292*ratiow,277*ratioh,269*ratiow,294*ratioh,249*ratiow,316*ratioh,235*ratiow,335*ratioh,217*ratiow,370*ratioh,203*ratiow,404*ratioh,194*ratiow,445*ratioh,190*ratiow,474*ratioh,187*ratiow,513*ratioh,190*ratiow,551*ratioh,194*ratiow,573*ratioh,204*ratiow,597*ratioh,213*ratiow,616*ratioh,220*ratiow,636*ratioh,237*ratiow,655*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(313*ratiow,802*ratioh,314*ratiow,818*ratioh,316*ratiow,828*ratioh,291*ratiow,824*ratioh,283*ratiow,822*ratioh,280*ratiow,814*ratioh,273*ratiow,805*ratioh,255*ratiow,799*ratioh,240*ratiow,796*ratioh,229*ratiow,798*ratioh,225*ratiow,800*ratioh,220*ratiow,804*ratioh,207*ratiow,798*ratioh,186*ratiow,790*ratioh,158*ratiow,774*ratioh,132*ratiow,756*ratioh,119*ratiow,743*ratioh,103*ratiow,726*ratioh,93*ratiow,712*ratioh,85*ratiow,700*ratioh,81*ratiow,692*ratioh,100*ratiow,685*ratioh,114*ratiow,678*ratioh,111*ratiow,687*ratioh,114*ratiow,694*ratioh,120*ratiow,706*ratioh,127*ratiow,719*ratioh,134*ratiow,731*ratioh,142*ratiow,741*ratioh,150*ratiow,749*ratioh,158*ratiow,757*ratioh,168*ratiow,763*ratioh,178*ratiow,766*ratioh,190*ratiow,767*ratioh,205*ratiow,765*ratioh,218*ratiow,764*ratioh,235*ratiow,763*ratioh,250*ratiow,765*ratioh,260*ratiow,770*ratioh,271*ratiow,778*ratioh,284*ratiow,789*ratioh,296*ratiow,797*ratioh,303*ratiow,803*ratioh,309*ratiow,804*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(313*ratiow,789*ratioh,313*ratiow,801*ratioh,309*ratiow,804*ratioh,301*ratiow,802*ratioh,290*ratiow,793*ratioh,279*ratiow,784*ratioh,269*ratiow,776*ratioh,258*ratiow,769*ratioh,251*ratiow,766*ratioh,245*ratiow,764*ratioh,236*ratiow,763*ratioh,218*ratiow,763*ratioh,204*ratiow,765*ratioh,188*ratiow,766*ratioh,179*ratiow,766*ratioh,167*ratiow,763*ratioh,154*ratiow,753*ratioh,140*ratiow,740*ratioh,130*ratiow,724*ratioh,120*ratiow,705*ratioh,113*ratiow,690*ratioh,111*ratiow,683*ratioh,114*ratiow,677*ratioh,117*ratiow,676*ratioh,121*ratiow,678*ratioh,124*ratiow,682*ratioh,129*ratiow,691*ratioh,135*ratiow,704*ratioh,142*ratiow,718*ratioh,151*ratiow,731*ratioh,161*ratiow,740*ratioh,173*ratiow,745*ratioh,187*ratiow,749*ratioh,206*ratiow,749*ratioh,218*ratiow,745*ratioh,233*ratiow,741*ratioh,246*ratiow,739*ratioh,260*ratiow,739*ratioh,269*ratiow,741*ratioh,279*ratiow,746*ratioh,287*ratiow,753*ratioh,292*ratiow,764*ratioh,297*ratiow,773*ratioh,301*ratiow,779*ratioh,306*ratiow,784*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(317*ratiow,768*ratioh,315*ratiow,781*ratioh,314*ratiow,791*ratioh,309*ratiow,787*ratioh,303*ratiow,781*ratioh,298*ratiow,775*ratioh,294*ratiow,766*ratioh,289*ratiow,757*ratioh,283*ratiow,749*ratioh,275*ratiow,743*ratioh,268*ratiow,740*ratioh,255*ratiow,739*ratioh,243*ratiow,740*ratioh,224*ratiow,743*ratioh,207*ratiow,749*ratioh,191*ratiow,749*ratioh,172*ratiow,746*ratioh,159*ratiow,737*ratioh,148*ratiow,727*ratioh,140*ratiow,713*ratioh,129*ratiow,692*ratioh,124*ratiow,682*ratioh,117*ratiow,676*ratioh,134*ratiow,662*ratioh,151*ratiow,647*ratioh,162*ratiow,636*ratioh,167*ratiow,632*ratioh,172*ratiow,639*ratioh,176*ratiow,642*ratioh,183*ratiow,643*ratioh,188*ratiow,643*ratioh,186*ratiow,648*ratioh,185*ratiow,659*ratioh,185*ratiow,674*ratioh,187*ratiow,683*ratioh,190*ratiow,689*ratioh,198*ratiow,693*ratioh,209*ratiow,697*ratioh,221*ratiow,699*ratioh,232*ratiow,699*ratioh,240*ratiow,698*ratioh,248*ratiow,702*ratioh,258*ratiow,710*ratioh,268*ratiow,717*ratioh,282*ratiow,725*ratioh,291*ratiow,730*ratioh,296*ratiow,736*ratioh,301*ratiow,743*ratioh,307*ratiow,754*ratioh,314*ratiow,766*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(135*ratiow,186*ratioh,134*ratiow,186*ratioh,69*ratiow,110*ratioh,33*ratiow,68*ratioh,23*ratiow,56*ratioh,17*ratiow,65*ratioh,8*ratiow,78*ratioh,3*ratiow,90*ratioh,2*ratiow,95*ratioh,1*ratiow,96*ratioh,1*ratiow,142*ratioh,37*ratiow,159*ratioh,96*ratiow,186*ratioh,119*ratiow,197*ratioh,122*ratiow,194*ratioh,126*ratiow,191*ratioh,132*ratiow,188*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(118*ratiow,196*ratioh,50*ratiow,165*ratioh,5*ratiow,144*ratioh,1*ratiow,142*ratioh,1*ratiow,261*ratioh,4*ratiow,263*ratioh,6*ratiow,269*ratioh,4*ratiow,274*ratioh,2*ratiow,274*ratioh,2*ratiow,278*ratioh,14*ratiow,278*ratioh,32*ratiow,276*ratioh,52*ratiow,272*ratioh,68*ratiow,266*ratioh,77*ratiow,254*ratioh,86*ratiow,245*ratioh,98*ratiow,229*ratioh,107*ratiow,214*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(393*ratiow,678*ratioh,319*ratiow,680*ratioh,292*ratiow,660*ratioh,263*ratiow,637*ratioh,240*ratiow,621*ratioh,204*ratiow,603*ratioh,184*ratiow,590*ratioh,176*ratiow,555*ratioh,173*ratiow,530*ratioh,166*ratiow,503*ratioh,157*ratiow,484*ratioh,152*ratiow,469*ratioh,151*ratiow,408*ratioh,154*ratiow,374*ratioh,157*ratiow,341*ratioh,162*ratiow,312*ratioh,169*ratiow,289*ratioh,177*ratiow,272*ratioh,188*ratiow,255*ratioh,195*ratiow,247*ratioh,216*ratiow,244*ratioh,235*ratiow,243*ratioh,262*ratiow,243*ratioh,281*ratiow,245*ratioh,304*ratiow,250*ratioh,332*ratiow,260*ratioh,360*ratiow,277*ratioh,383*ratiow,294*ratioh,403*ratiow,316*ratioh,417*ratiow,335*ratioh,435*ratiow,370*ratioh,449*ratiow,404*ratioh,458*ratiow,445*ratioh,462*ratiow,474*ratioh,465*ratiow,513*ratioh,462*ratiow,551*ratioh,458*ratiow,573*ratioh,448*ratiow,597*ratioh,439*ratiow,616*ratioh,432*ratiow,636*ratioh,415*ratiow,655*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(339*ratiow,802*ratioh,338*ratiow,818*ratioh,336*ratiow,828*ratioh,361*ratiow,824*ratioh,369*ratiow,822*ratioh,372*ratiow,814*ratioh,379*ratiow,805*ratioh,397*ratiow,799*ratioh,412*ratiow,796*ratioh,423*ratiow,798*ratioh,427*ratiow,800*ratioh,432*ratiow,804*ratioh,445*ratiow,798*ratioh,466*ratiow,790*ratioh,494*ratiow,774*ratioh,520*ratiow,756*ratioh,533*ratiow,743*ratioh,549*ratiow,726*ratioh,559*ratiow,712*ratioh,567*ratiow,700*ratioh,571*ratiow,692*ratioh,552*ratiow,685*ratioh,538*ratiow,678*ratioh,541*ratiow,687*ratioh,538*ratiow,694*ratioh,532*ratiow,706*ratioh,525*ratiow,719*ratioh,518*ratiow,731*ratioh,510*ratiow,741*ratioh,502*ratiow,749*ratioh,494*ratiow,757*ratioh,484*ratiow,763*ratioh,474*ratiow,766*ratioh,462*ratiow,767*ratioh,447*ratiow,765*ratioh,434*ratiow,764*ratioh,417*ratiow,763*ratioh,402*ratiow,765*ratioh,392*ratiow,770*ratioh,381*ratiow,778*ratioh,368*ratiow,789*ratioh,356*ratiow,797*ratioh,349*ratiow,803*ratioh,343*ratiow,804*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(339*ratiow,789*ratioh,339*ratiow,801*ratioh,343*ratiow,804*ratioh,351*ratiow,802*ratioh,362*ratiow,793*ratioh,373*ratiow,784*ratioh,383*ratiow,776*ratioh,394*ratiow,769*ratioh,401*ratiow,766*ratioh,407*ratiow,764*ratioh,416*ratiow,763*ratioh,434*ratiow,763*ratioh,448*ratiow,765*ratioh,464*ratiow,766*ratioh,473*ratiow,766*ratioh,485*ratiow,763*ratioh,498*ratiow,753*ratioh,512*ratiow,740*ratioh,522*ratiow,724*ratioh,532*ratiow,705*ratioh,539*ratiow,690*ratioh,541*ratiow,683*ratioh,538*ratiow,677*ratioh,535*ratiow,676*ratioh,531*ratiow,678*ratioh,528*ratiow,682*ratioh,523*ratiow,691*ratioh,517*ratiow,704*ratioh,510*ratiow,718*ratioh,501*ratiow,731*ratioh,491*ratiow,740*ratioh,479*ratiow,745*ratioh,465*ratiow,749*ratioh,446*ratiow,749*ratioh,434*ratiow,745*ratioh,419*ratiow,741*ratioh,406*ratiow,739*ratioh,392*ratiow,739*ratioh,383*ratiow,741*ratioh,373*ratiow,746*ratioh,365*ratiow,753*ratioh,360*ratiow,764*ratioh,355*ratiow,773*ratioh,351*ratiow,779*ratioh,346*ratiow,784*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(335*ratiow,768*ratioh,337*ratiow,781*ratioh,338*ratiow,791*ratioh,343*ratiow,787*ratioh,349*ratiow,781*ratioh,354*ratiow,775*ratioh,358*ratiow,766*ratioh,363*ratiow,757*ratioh,369*ratiow,749*ratioh,377*ratiow,743*ratioh,384*ratiow,740*ratioh,397*ratiow,739*ratioh,409*ratiow,740*ratioh,428*ratiow,743*ratioh,445*ratiow,749*ratioh,461*ratiow,749*ratioh,480*ratiow,746*ratioh,493*ratiow,737*ratioh,504*ratiow,727*ratioh,512*ratiow,713*ratioh,523*ratiow,692*ratioh,528*ratiow,682*ratioh,535*ratiow,676*ratioh,518*ratiow,662*ratioh,501*ratiow,647*ratioh,490*ratiow,636*ratioh,485*ratiow,632*ratioh,480*ratiow,639*ratioh,476*ratiow,642*ratioh,469*ratiow,643*ratioh,464*ratiow,643*ratioh,466*ratiow,648*ratioh,467*ratiow,659*ratioh,467*ratiow,674*ratioh,465*ratiow,683*ratioh,462*ratiow,689*ratioh,454*ratiow,693*ratioh,443*ratiow,697*ratioh,431*ratiow,699*ratioh,420*ratiow,699*ratioh,412*ratiow,698*ratioh,404*ratiow,702*ratioh,394*ratiow,710*ratioh,384*ratiow,717*ratioh,370*ratiow,725*ratioh,361*ratiow,730*ratioh,356*ratiow,736*ratioh,351*ratiow,743*ratioh,345*ratiow,754*ratioh,338*ratiow,766*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile33(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 657;
var baseHeight = 835;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(529*ratiow,186*ratioh,586*ratiow,116*ratioh,618*ratiow,78*ratioh,633*ratiow,59*ratioh,639*ratiow,67*ratioh,647*ratiow,81*ratioh,653*ratiow,95*ratioh,656*ratiow,116*ratioh,656*ratiow,153*ratioh,600*ratiow,169*ratioh,548*ratiow,184*ratioh,532*ratiow,189*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(531*ratiow,188*ratioh,612*ratiow,166*ratioh,656*ratiow,153*ratioh,656*ratiow,258*ratioh,653*ratiow,260*ratioh,653*ratiow,265*ratioh,648*ratiow,267*ratioh,641*ratiow,272*ratioh,636*ratiow,275*ratioh,615*ratiow,275*ratioh,604*ratiow,273*ratioh,590*ratiow,269*ratioh,580*ratiow,260*ratioh,566*ratiow,245*ratioh,556*ratiow,227*ratioh,548*ratiow,212*ratioh,541*ratiow,200*ratioh,537*ratiow,194*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(261*ratiow,682*ratioh,273*ratiow,690*ratioh,288*ratiow,690*ratioh,304*ratiow,696*ratioh,303*ratiow,690*ratioh,309*ratiow,679*ratioh,319*ratiow,673*ratioh,348*ratiow,668*ratioh,363*ratiow,662*ratioh,378*ratiow,649*ratioh,392*ratiow,637*ratioh,406*ratiow,629*ratioh,421*ratiow,622*ratioh,439*ratiow,616*ratioh,449*ratiow,613*ratioh,461*ratiow,606*ratioh,485*ratiow,594*ratioh,485*ratiow,588*ratioh,478*ratiow,592*ratioh,470*ratiow,595*ratioh,461*ratiow,595*ratioh,459*ratiow,590*ratioh,461*ratiow,574*ratioh,466*ratiow,556*ratioh,472*ratiow,531*ratioh,477*ratiow,513*ratioh,482*ratiow,503*ratioh,486*ratiow,499*ratioh,492*ratiow,498*ratioh,493*ratiow,492*ratioh,495*ratiow,487*ratioh,502*ratiow,483*ratioh,509*ratiow,482*ratioh,507*ratiow,475*ratioh,506*ratiow,446*ratioh,505*ratiow,421*ratioh,502*ratiow,402*ratioh,498*ratiow,379*ratioh,495*ratiow,355*ratioh,492*ratiow,335*ratioh,488*ratiow,318*ratioh,482*ratiow,301*ratioh,476*ratiow,289*ratioh,469*ratiow,276*ratioh,461*ratiow,265*ratioh,449*ratiow,256*ratioh,444*ratiow,251*ratioh,441*ratiow,248*ratioh,418*ratiow,245*ratioh,390*ratiow,243*ratioh,363*ratiow,246*ratioh,339*ratiow,254*ratioh,314*ratiow,269*ratioh,297*ratiow,286*ratioh,279*ratiow,304*ratioh,260*ratiow,326*ratioh,246*ratiow,348*ratioh,232*ratiow,371*ratioh,222*ratiow,393*ratioh,212*ratiow,417*ratioh,204*ratiow,446*ratioh,198*ratiow,467*ratioh,194*ratiow,485*ratioh,191*ratiow,502*ratioh,191*ratiow,520*ratioh,194*ratiow,561*ratioh,198*ratiow,581*ratioh,206*ratiow,604*ratioh,217*ratiow,626*ratioh,230*ratiow,648*ratioh,243*ratiow,664*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(326*ratiow,809*ratioh,325*ratiow,815*ratioh,329*ratiow,821*ratioh,325*ratiow,821*ratioh,314*ratiow,824*ratioh,302*ratiow,826*ratioh,296*ratiow,823*ratioh,287*ratiow,819*ratioh,278*ratiow,816*ratioh,266*ratiow,813*ratioh,255*ratiow,812*ratioh,249*ratiow,813*ratioh,240*ratiow,817*ratioh,228*ratiow,818*ratioh,219*ratiow,816*ratioh,200*ratiow,809*ratioh,179*ratiow,798*ratioh,160*ratiow,786*ratioh,138*ratiow,767*ratioh,118*ratiow,747*ratioh,93*ratiow,716*ratioh,81*ratiow,695*ratioh,77*ratiow,686*ratioh,100*ratiow,682*ratioh,107*ratiow,680*ratioh,106*ratiow,686*ratioh,109*ratiow,696*ratioh,117*ratiow,710*ratioh,127*ratiow,727*ratioh,140*ratiow,745*ratioh,151*ratiow,756*ratioh,162*ratiow,764*ratioh,182*ratiow,773*ratioh,198*ratiow,778*ratioh,215*ratiow,780*ratioh,235*ratiow,779*ratioh,253*ratiow,780*ratioh,271*ratiow,783*ratioh,290*ratiow,792*ratioh,304*ratiow,799*ratioh,317*ratiow,806*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(329*ratiow,793*ratioh,326*ratiow,809*ratioh,320*ratiow,807*ratioh,308*ratiow,801*ratioh,290*ratiow,792*ratioh,276*ratiow,785*ratioh,262*ratiow,781*ratioh,246*ratiow,779*ratioh,217*ratiow,780*ratioh,198*ratiow,778*ratioh,176*ratiow,771*ratioh,155*ratiow,759*ratioh,142*ratiow,748*ratioh,128*ratiow,729*ratioh,117*ratiow,711*ratioh,108*ratiow,693*ratioh,106*ratiow,686*ratioh,107*ratiow,680*ratioh,111*ratiow,678*ratioh,116*ratiow,681*ratioh,120*ratiow,687*ratioh,128*ratiow,700*ratioh,140*ratiow,717*ratioh,160*ratiow,740*ratioh,173*ratiow,748*ratioh,187*ratiow,754*ratioh,203*ratiow,757*ratioh,214*ratiow,757*ratioh,239*ratiow,755*ratioh,261*ratiow,756*ratioh,272*ratiow,758*ratioh,287*ratiow,764*ratioh,302*ratiow,775*ratioh,316*ratiow,785*ratioh,325*ratiow,792*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(334*ratiow,770*ratioh,329*ratiow,794*ratioh,314*ratiow,784*ratioh,300*ratiow,774*ratioh,289*ratiow,765*ratioh,279*ratiow,760*ratioh,269*ratiow,757*ratioh,257*ratiow,755*ratioh,228*ratiow,756*ratioh,210*ratiow,758*ratioh,185*ratiow,754*ratioh,163*ratiow,742*ratioh,153*ratiow,733*ratioh,138*ratiow,714*ratioh,127*ratiow,698*ratioh,119*ratiow,685*ratioh,114*ratiow,679*ratioh,111*ratiow,678*ratioh,132*ratiow,671*ratioh,152*ratiow,661*ratioh,170*ratiow,651*ratioh,178*ratiow,645*ratioh,183*ratiow,649*ratioh,188*ratiow,651*ratioh,193*ratiow,651*ratioh,191*ratiow,659*ratioh,187*ratiow,673*ratioh,186*ratiow,684*ratioh,187*ratiow,695*ratioh,193*ratiow,702*ratioh,201*ratiow,706*ratioh,208*ratiow,709*ratioh,222*ratiow,710*ratioh,237*ratiow,708*ratioh,246*ratiow,711*ratioh,264*ratiow,719*ratioh,284*ratiow,729*ratioh,298*ratiow,736*ratioh,311*ratiow,747*ratioh,319*ratiow,754*ratioh,328*ratiow,764*ratioh,334*ratiow,770*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(128*ratiow,186*ratioh,71*ratiow,116*ratioh,39*ratiow,78*ratioh,24*ratiow,59*ratioh,18*ratiow,67*ratioh,10*ratiow,81*ratioh,4*ratiow,95*ratioh,1*ratiow,116*ratioh,1*ratiow,153*ratioh,57*ratiow,169*ratioh,109*ratiow,184*ratioh,125*ratiow,189*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(126*ratiow,188*ratioh,45*ratiow,166*ratioh,1*ratiow,153*ratioh,1*ratiow,258*ratioh,4*ratiow,260*ratioh,4*ratiow,265*ratioh,9*ratiow,267*ratioh,16*ratiow,272*ratioh,21*ratiow,275*ratioh,42*ratiow,275*ratioh,53*ratiow,273*ratioh,67*ratiow,269*ratioh,77*ratiow,260*ratioh,91*ratiow,245*ratioh,101*ratiow,227*ratioh,109*ratiow,212*ratioh,116*ratiow,200*ratioh,120*ratiow,194*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(396*ratiow,682*ratioh,384*ratiow,690*ratioh,369*ratiow,690*ratioh,353*ratiow,696*ratioh,354*ratiow,690*ratioh,348*ratiow,679*ratioh,338*ratiow,673*ratioh,309*ratiow,668*ratioh,294*ratiow,662*ratioh,279*ratiow,649*ratioh,265*ratiow,637*ratioh,251*ratiow,629*ratioh,236*ratiow,622*ratioh,218*ratiow,616*ratioh,208*ratiow,613*ratioh,196*ratiow,606*ratioh,172*ratiow,594*ratioh,172*ratiow,588*ratioh,179*ratiow,592*ratioh,187*ratiow,595*ratioh,196*ratiow,595*ratioh,198*ratiow,590*ratioh,196*ratiow,574*ratioh,191*ratiow,556*ratioh,185*ratiow,531*ratioh,180*ratiow,513*ratioh,175*ratiow,503*ratioh,171*ratiow,499*ratioh,165*ratiow,498*ratioh,164*ratiow,492*ratioh,162*ratiow,487*ratioh,155*ratiow,483*ratioh,148*ratiow,482*ratioh,150*ratiow,475*ratioh,151*ratiow,446*ratioh,152*ratiow,421*ratioh,155*ratiow,402*ratioh,159*ratiow,379*ratioh,162*ratiow,355*ratioh,165*ratiow,335*ratioh,169*ratiow,318*ratioh,175*ratiow,301*ratioh,181*ratiow,289*ratioh,188*ratiow,276*ratioh,196*ratiow,265*ratioh,208*ratiow,256*ratioh,213*ratiow,251*ratioh,216*ratiow,248*ratioh,239*ratiow,245*ratioh,267*ratiow,243*ratioh,294*ratiow,246*ratioh,318*ratiow,254*ratioh,343*ratiow,269*ratioh,360*ratiow,286*ratioh,378*ratiow,304*ratioh,397*ratiow,326*ratioh,411*ratiow,348*ratioh,425*ratiow,371*ratioh,435*ratiow,393*ratioh,445*ratiow,417*ratioh,453*ratiow,446*ratioh,459*ratiow,467*ratioh,463*ratiow,485*ratioh,466*ratiow,502*ratioh,466*ratiow,520*ratioh,463*ratiow,561*ratioh,459*ratiow,581*ratioh,451*ratiow,604*ratioh,440*ratiow,626*ratioh,427*ratiow,648*ratioh,414*ratiow,664*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(331*ratiow,809*ratioh,332*ratiow,815*ratioh,328*ratiow,821*ratioh,332*ratiow,821*ratioh,343*ratiow,824*ratioh,355*ratiow,826*ratioh,361*ratiow,823*ratioh,370*ratiow,819*ratioh,379*ratiow,816*ratioh,391*ratiow,813*ratioh,402*ratiow,812*ratioh,408*ratiow,813*ratioh,417*ratiow,817*ratioh,429*ratiow,818*ratioh,438*ratiow,816*ratioh,457*ratiow,809*ratioh,478*ratiow,798*ratioh,497*ratiow,786*ratioh,519*ratiow,767*ratioh,539*ratiow,747*ratioh,564*ratiow,716*ratioh,576*ratiow,695*ratioh,580*ratiow,686*ratioh,557*ratiow,682*ratioh,550*ratiow,680*ratioh,551*ratiow,686*ratioh,548*ratiow,696*ratioh,540*ratiow,710*ratioh,530*ratiow,727*ratioh,517*ratiow,745*ratioh,506*ratiow,756*ratioh,495*ratiow,764*ratioh,475*ratiow,773*ratioh,459*ratiow,778*ratioh,442*ratiow,780*ratioh,422*ratiow,779*ratioh,404*ratiow,780*ratioh,386*ratiow,783*ratioh,367*ratiow,792*ratioh,353*ratiow,799*ratioh,340*ratiow,806*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(328*ratiow,793*ratioh,331*ratiow,809*ratioh,337*ratiow,807*ratioh,349*ratiow,801*ratioh,367*ratiow,792*ratioh,381*ratiow,785*ratioh,395*ratiow,781*ratioh,411*ratiow,779*ratioh,440*ratiow,780*ratioh,459*ratiow,778*ratioh,481*ratiow,771*ratioh,502*ratiow,759*ratioh,515*ratiow,748*ratioh,529*ratiow,729*ratioh,540*ratiow,711*ratioh,549*ratiow,693*ratioh,551*ratiow,686*ratioh,550*ratiow,680*ratioh,546*ratiow,678*ratioh,541*ratiow,681*ratioh,537*ratiow,687*ratioh,529*ratiow,700*ratioh,517*ratiow,717*ratioh,497*ratiow,740*ratioh,484*ratiow,748*ratioh,470*ratiow,754*ratioh,454*ratiow,757*ratioh,443*ratiow,757*ratioh,418*ratiow,755*ratioh,396*ratiow,756*ratioh,385*ratiow,758*ratioh,370*ratiow,764*ratioh,355*ratiow,775*ratioh,341*ratiow,785*ratioh,332*ratiow,792*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(323*ratiow,770*ratioh,328*ratiow,794*ratioh,343*ratiow,784*ratioh,357*ratiow,774*ratioh,368*ratiow,765*ratioh,378*ratiow,760*ratioh,388*ratiow,757*ratioh,400*ratiow,755*ratioh,429*ratiow,756*ratioh,447*ratiow,758*ratioh,472*ratiow,754*ratioh,494*ratiow,742*ratioh,504*ratiow,733*ratioh,519*ratiow,714*ratioh,530*ratiow,698*ratioh,538*ratiow,685*ratioh,543*ratiow,679*ratioh,546*ratiow,678*ratioh,525*ratiow,671*ratioh,505*ratiow,661*ratioh,487*ratiow,651*ratioh,479*ratiow,645*ratioh,474*ratiow,649*ratioh,469*ratiow,651*ratioh,464*ratiow,651*ratioh,466*ratiow,659*ratioh,470*ratiow,673*ratioh,471*ratiow,684*ratioh,470*ratiow,695*ratioh,464*ratiow,702*ratioh,456*ratiow,706*ratioh,449*ratiow,709*ratioh,435*ratiow,710*ratioh,420*ratiow,708*ratioh,411*ratiow,711*ratioh,393*ratiow,719*ratioh,373*ratiow,729*ratioh,359*ratiow,736*ratioh,346*ratiow,747*ratioh,338*ratiow,754*ratioh,329*ratiow,764*ratioh,323*ratiow,770*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile34(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 658;
var baseHeight = 850;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(531*ratiow,192*ratioh,616*ratiow,85*ratioh,638*ratiow,57*ratioh,648*ratiow,71*ratioh,656*ratiow,84*ratioh,657*ratiow,86*ratioh,657*ratiow,172*ratioh,610*ratiow,183*ratioh,563*ratiow,194*ratioh,540*ratiow,199*ratioh,537*ratiow,196*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(541*ratiow,199*ratioh,593*ratiow,187*ratioh,644*ratiow,175*ratioh,657*ratiow,172*ratioh,657*ratiow,262*ratioh,654*ratiow,264*ratioh,653*ratiow,268*ratioh,647*ratiow,270*ratioh,644*ratiow,275*ratioh,638*ratiow,279*ratioh,621*ratiow,279*ratioh,596*ratiow,273*ratioh,579*ratiow,265*ratioh,568*ratiow,248*ratioh,559*ratiow,231*ratioh,553*ratiow,218*ratioh,548*ratiow,208*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(288*ratiow,705*ratioh,292*ratiow,700*ratioh,308*ratiow,688*ratioh,322*ratiow,682*ratioh,345*ratiow,675*ratioh,371*ratiow,667*ratioh,399*ratiow,653*ratioh,421*ratiow,642*ratioh,437*ratiow,632*ratioh,458*ratiow,620*ratioh,464*ratiow,537*ratioh,467*ratiow,505*ratioh,473*ratiow,479*ratioh,477*ratiow,472*ratioh,482*ratiow,466*ratioh,488*ratiow,466*ratioh,492*ratiow,471*ratioh,494*ratiow,482*ratioh,495*ratiow,497*ratioh,498*ratiow,490*ratioh,505*ratiow,469*ratioh,501*ratiow,438*ratioh,493*ratiow,365*ratioh,488*ratiow,328*ratioh,478*ratiow,296*ratioh,473*ratiow,284*ratioh,470*ratiow,279*ratioh,464*ratiow,271*ratioh,456*ratiow,264*ratioh,450*ratiow,259*ratioh,445*ratiow,256*ratioh,440*ratiow,254*ratioh,401*ratiow,255*ratioh,383*ratiow,257*ratioh,357*ratiow,265*ratioh,330*ratiow,277*ratioh,304*ratiow,293*ratioh,291*ratiow,305*ratioh,271*ratiow,322*ratioh,256*ratiow,342*ratioh,249*ratiow,350*ratioh,242*ratiow,362*ratioh,234*ratiow,377*ratioh,226*ratiow,391*ratioh,220*ratiow,405*ratioh,213*ratiow,422*ratioh,206*ratiow,443*ratioh,199*ratiow,469*ratioh,194*ratiow,494*ratioh,193*ratiow,514*ratioh,195*ratiow,552*ratioh,201*ratiow,579*ratioh,208*ratiow,606*ratioh,217*ratiow,627*ratioh,230*ratiow,648*ratioh,243*ratiow,667*ratioh,275*ratiow,695*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(265*ratiow,785*ratioh,265*ratiow,816*ratioh,257*ratiow,817*ratioh,252*ratiow,818*ratioh,248*ratiow,820*ratioh,244*ratiow,823*ratioh,240*ratiow,828*ratioh,226*ratiow,825*ratioh,207*ratiow,817*ratioh,187*ratiow,808*ratioh,170*ratiow,800*ratioh,151*ratiow,787*ratioh,132*ratiow,772*ratioh,119*ratiow,756*ratioh,106*ratiow,740*ratioh,94*ratiow,720*ratioh,85*ratiow,702*ratioh,78*ratiow,689*ratioh,99*ratiow,685*ratioh,119*ratiow,679*ratioh,116*ratiow,684*ratioh,117*ratiow,695*ratioh,120*ratiow,708*ratioh,126*ratiow,726*ratioh,132*ratiow,737*ratioh,138*ratiow,746*ratioh,148*ratiow,757*ratioh,158*ratiow,763*ratioh,170*ratiow,770*ratioh,181*ratiow,776*ratioh,196*ratiow,782*ratioh,212*ratiow,786*ratioh,232*ratiow,784*ratioh,248*ratiow,783*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(268*ratiow,759*ratioh,266*ratiow,786*ratioh,257*ratiow,784*ratioh,246*ratiow,783*ratioh,229*ratiow,784*ratioh,211*ratiow,786*ratioh,190*ratiow,780*ratioh,170*ratiow,771*ratioh,152*ratiow,759*ratioh,137*ratiow,746*ratioh,128*ratiow,729*ratioh,121*ratiow,711*ratioh,117*ratiow,698*ratioh,116*ratiow,683*ratioh,118*ratiow,678*ratioh,126*ratiow,676*ratioh,129*ratiow,684*ratioh,133*ratiow,701*ratioh,138*ratiow,714*ratioh,148*ratiow,733*ratioh,158*ratiow,743*ratioh,172*ratiow,752*ratioh,188*ratiow,758*ratioh,207*ratiow,763*ratioh,227*ratiow,762*ratioh,252*ratiow,758*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(278*ratiow,731*ratioh,273*ratiow,737*ratioh,270*ratiow,749*ratioh,268*ratiow,759*ratioh,256*ratiow,758*ratioh,233*ratiow,761*ratioh,213*ratiow,763*ratioh,196*ratiow,761*ratioh,183*ratiow,757*ratioh,170*ratiow,751*ratioh,154*ratiow,740*ratioh,145*ratiow,728*ratioh,139*ratiow,717*ratioh,134*ratiow,704*ratioh,130*ratiow,689*ratioh,129*ratiow,682*ratioh,126*ratiow,677*ratioh,146*ratiow,670*ratioh,159*ratiow,663*ratioh,170*ratiow,654*ratioh,177*ratiow,648*ratioh,181*ratiow,654*ratioh,188*ratiow,656*ratioh,198*ratiow,654*ratioh,192*ratiow,662*ratioh,188*ratiow,674*ratioh,186*ratiow,683*ratioh,187*ratiow,695*ratioh,195*ratiow,704*ratioh,207*ratiow,709*ratioh,222*ratiow,713*ratioh,236*ratiow,714*ratioh,245*ratiow,713*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(127*ratiow,192*ratioh,42*ratiow,85*ratioh,20*ratiow,57*ratioh,10*ratiow,71*ratioh,2*ratiow,84*ratioh,1*ratiow,86*ratioh,1*ratiow,172*ratioh,48*ratiow,183*ratioh,95*ratiow,194*ratioh,118*ratiow,199*ratioh,121*ratiow,196*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(117*ratiow,199*ratioh,65*ratiow,187*ratioh,14*ratiow,175*ratioh,1*ratiow,172*ratioh,1*ratiow,262*ratioh,4*ratiow,264*ratioh,5*ratiow,268*ratioh,11*ratiow,270*ratioh,14*ratiow,275*ratioh,20*ratiow,279*ratioh,37*ratiow,279*ratioh,62*ratiow,273*ratioh,79*ratiow,265*ratioh,90*ratiow,248*ratioh,99*ratiow,231*ratioh,105*ratiow,218*ratioh,110*ratiow,208*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(370*ratiow,705*ratioh,366*ratiow,700*ratioh,350*ratiow,688*ratioh,336*ratiow,682*ratioh,313*ratiow,675*ratioh,287*ratiow,667*ratioh,259*ratiow,653*ratioh,237*ratiow,642*ratioh,221*ratiow,632*ratioh,200*ratiow,620*ratioh,194*ratiow,537*ratioh,191*ratiow,505*ratioh,185*ratiow,479*ratioh,181*ratiow,472*ratioh,176*ratiow,466*ratioh,170*ratiow,466*ratioh,166*ratiow,471*ratioh,164*ratiow,482*ratioh,163*ratiow,497*ratioh,160*ratiow,490*ratioh,153*ratiow,469*ratioh,157*ratiow,438*ratioh,165*ratiow,365*ratioh,170*ratiow,328*ratioh,180*ratiow,296*ratioh,185*ratiow,284*ratioh,188*ratiow,279*ratioh,194*ratiow,271*ratioh,202*ratiow,264*ratioh,208*ratiow,259*ratioh,213*ratiow,256*ratioh,218*ratiow,254*ratioh,257*ratiow,255*ratioh,275*ratiow,257*ratioh,301*ratiow,265*ratioh,328*ratiow,277*ratioh,354*ratiow,293*ratioh,367*ratiow,305*ratioh,387*ratiow,322*ratioh,402*ratiow,342*ratioh,409*ratiow,350*ratioh,416*ratiow,362*ratioh,424*ratiow,377*ratioh,432*ratiow,391*ratioh,438*ratiow,405*ratioh,445*ratiow,422*ratioh,452*ratiow,443*ratioh,459*ratiow,469*ratioh,464*ratiow,494*ratioh,465*ratiow,514*ratioh,463*ratiow,552*ratioh,457*ratiow,579*ratioh,450*ratiow,606*ratioh,441*ratiow,627*ratioh,428*ratiow,648*ratioh,415*ratiow,667*ratioh,383*ratiow,695*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(393*ratiow,785*ratioh,393*ratiow,816*ratioh,401*ratiow,817*ratioh,406*ratiow,818*ratioh,410*ratiow,820*ratioh,414*ratiow,823*ratioh,418*ratiow,828*ratioh,432*ratiow,825*ratioh,451*ratiow,817*ratioh,471*ratiow,808*ratioh,488*ratiow,800*ratioh,507*ratiow,787*ratioh,526*ratiow,772*ratioh,539*ratiow,756*ratioh,552*ratiow,740*ratioh,564*ratiow,720*ratioh,573*ratiow,702*ratioh,580*ratiow,689*ratioh,559*ratiow,685*ratioh,539*ratiow,679*ratioh,542*ratiow,684*ratioh,541*ratiow,695*ratioh,538*ratiow,708*ratioh,532*ratiow,726*ratioh,526*ratiow,737*ratioh,520*ratiow,746*ratioh,510*ratiow,757*ratioh,500*ratiow,763*ratioh,488*ratiow,770*ratioh,477*ratiow,776*ratioh,462*ratiow,782*ratioh,446*ratiow,786*ratioh,426*ratiow,784*ratioh,410*ratiow,783*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(390*ratiow,759*ratioh,392*ratiow,786*ratioh,401*ratiow,784*ratioh,412*ratiow,783*ratioh,429*ratiow,784*ratioh,447*ratiow,786*ratioh,468*ratiow,780*ratioh,488*ratiow,771*ratioh,506*ratiow,759*ratioh,521*ratiow,746*ratioh,530*ratiow,729*ratioh,537*ratiow,711*ratioh,541*ratiow,698*ratioh,542*ratiow,683*ratioh,540*ratiow,678*ratioh,532*ratiow,676*ratioh,529*ratiow,684*ratioh,525*ratiow,701*ratioh,520*ratiow,714*ratioh,510*ratiow,733*ratioh,500*ratiow,743*ratioh,486*ratiow,752*ratioh,470*ratiow,758*ratioh,451*ratiow,763*ratioh,431*ratiow,762*ratioh,406*ratiow,758*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(380*ratiow,731*ratioh,385*ratiow,737*ratioh,388*ratiow,749*ratioh,390*ratiow,759*ratioh,402*ratiow,758*ratioh,425*ratiow,761*ratioh,445*ratiow,763*ratioh,462*ratiow,761*ratioh,475*ratiow,757*ratioh,488*ratiow,751*ratioh,504*ratiow,740*ratioh,513*ratiow,728*ratioh,519*ratiow,717*ratioh,524*ratiow,704*ratioh,528*ratiow,689*ratioh,529*ratiow,682*ratioh,532*ratiow,677*ratioh,512*ratiow,670*ratioh,499*ratiow,663*ratioh,488*ratiow,654*ratioh,481*ratiow,648*ratioh,477*ratiow,654*ratioh,470*ratiow,656*ratioh,460*ratiow,654*ratioh,466*ratiow,662*ratioh,470*ratiow,674*ratioh,472*ratiow,683*ratioh,471*ratiow,695*ratioh,463*ratiow,704*ratioh,451*ratiow,709*ratioh,436*ratiow,713*ratioh,422*ratiow,714*ratioh,413*ratiow,713*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile35(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 650;
var baseHeight = 847;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(530*ratiow,195*ratioh,575*ratiow,116*ratioh,601*ratiow,69*ratioh,616*ratiow,42*ratioh,625*ratiow,50*ratioh,638*ratiow,64*ratioh,644*ratiow,81*ratioh,648*ratiow,108*ratioh,648*ratiow,162*ratioh,614*ratiow,177*ratioh,583*ratiow,191*ratioh,549*ratiow,206*ratioh,542*ratiow,210*ratioh,540*ratiow,205*ratioh,536*ratiow,201*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(543*ratiow,208*ratioh,592*ratiow,187*ratioh,630*ratiow,170*ratioh,649*ratiow,160*ratioh,649*ratiow,250*ratioh,646*ratiow,262*ratioh,640*ratiow,276*ratioh,636*ratiow,279*ratioh,642*ratiow,282*ratioh,644*ratiow,288*ratioh,630*ratiow,289*ratioh,608*ratiow,285*ratioh,589*ratiow,279*ratioh,578*ratiow,271*ratioh,566*ratiow,258*ratioh,561*ratiow,251*ratioh,556*ratiow,242*ratioh,551*ratiow,227*ratioh,547*ratiow,217*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(250*ratiow,693*ratioh,267*ratiow,694*ratioh,298*ratiow,688*ratioh,325*ratiow,679*ratioh,340*ratiow,672*ratioh,388*ratiow,645*ratioh,406*ratiow,634*ratioh,413*ratiow,601*ratioh,420*ratiow,570*ratioh,434*ratiow,529*ratioh,449*ratiow,500*ratioh,454*ratiow,492*ratioh,452*ratiow,466*ratioh,454*ratiow,447*ratioh,457*ratiow,441*ratioh,462*ratiow,438*ratioh,468*ratiow,438*ratioh,475*ratiow,442*ratioh,478*ratiow,448*ratioh,481*ratiow,456*ratioh,482*ratiow,470*ratioh,483*ratiow,486*ratioh,485*ratiow,482*ratioh,488*ratiow,474*ratioh,494*ratiow,469*ratioh,492*ratiow,461*ratioh,490*ratiow,451*ratioh,492*ratiow,407*ratioh,491*ratiow,373*ratioh,489*ratiow,339*ratioh,487*ratiow,326*ratioh,478*ratiow,305*ratioh,469*ratiow,283*ratioh,463*ratiow,271*ratioh,458*ratiow,262*ratioh,451*ratiow,254*ratioh,444*ratiow,248*ratioh,415*ratiow,248*ratioh,400*ratiow,250*ratioh,375*ratiow,254*ratioh,349*ratiow,263*ratioh,316*ratiow,279*ratioh,291*ratiow,296*ratioh,269*ratiow,314*ratioh,264*ratiow,319*ratioh,253*ratiow,330*ratioh,242*ratiow,344*ratioh,231*ratiow,360*ratioh,220*ratiow,377*ratioh,211*ratiow,398*ratioh,201*ratiow,421*ratioh,195*ratiow,439*ratioh,188*ratiow,460*ratioh,182*ratiow,488*ratioh,178*ratiow,507*ratioh,175*ratiow,528*ratioh,177*ratiow,558*ratioh,182*ratiow,575*ratioh,188*ratiow,592*ratioh,206*ratiow,631*ratioh,218*ratiow,654*ratioh,229*ratiow,673*ratioh,250*ratiow,693*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(249*ratiow,789*ratioh,251*ratiow,824*ratioh,228*ratiow,824*ratioh,211*ratiow,820*ratioh,193*ratiow,814*ratioh,183*ratiow,810*ratioh,169*ratiow,804*ratioh,141*ratiow,785*ratioh,126*ratiow,771*ratioh,111*ratiow,756*ratioh,93*ratiow,735*ratioh,79*ratiow,716*ratioh,70*ratiow,701*ratioh,62*ratiow,687*ratioh,57*ratiow,675*ratioh,54*ratiow,668*ratioh,64*ratiow,666*ratioh,84*ratiow,660*ratioh,82*ratiow,666*ratioh,85*ratiow,678*ratioh,94*ratiow,696*ratioh,102*ratiow,709*ratioh,115*ratiow,726*ratioh,130*ratiow,743*ratioh,145*ratiow,758*ratioh,161*ratiow,770*ratioh,178*ratiow,779*ratioh,191*ratiow,782*ratioh,214*ratiow,781*ratioh,221*ratiow,781*ratioh,236*ratiow,785*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(250*ratiow,772*ratioh,249*ratiow,790*ratioh,240*ratiow,787*ratioh,232*ratiow,783*ratioh,222*ratiow,781*ratioh,199*ratiow,781*ratioh,189*ratiow,781*ratioh,171*ratiow,776*ratioh,157*ratiow,767*ratioh,143*ratiow,755*ratioh,128*ratiow,742*ratioh,117*ratiow,728*ratioh,106*ratiow,715*ratioh,94*ratiow,697*ratioh,86*ratiow,682*ratioh,82*ratiow,669*ratioh,83*ratiow,661*ratioh,89*ratiow,659*ratioh,94*ratiow,664*ratioh,100*ratiow,678*ratioh,109*ratiow,695*ratioh,120*ratiow,710*ratioh,141*ratiow,733*ratioh,157*ratiow,747*ratioh,169*ratiow,756*ratioh,179*ratiow,760*ratioh,197*ratiow,765*ratioh,210*ratiow,768*ratioh,233*ratiow,768*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(276*ratiow,745*ratioh,268*ratiow,746*ratioh,261*ratiow,751*ratioh,255*ratiow,759*ratioh,250*ratiow,773*ratioh,243*ratiow,770*ratioh,236*ratiow,769*ratioh,223*ratiow,768*ratioh,209*ratiow,768*ratioh,179*ratiow,761*ratioh,164*ratiow,753*ratioh,148*ratiow,740*ratioh,122*ratiow,713*ratioh,111*ratiow,697*ratioh,103*ratiow,682*ratioh,95*ratiow,668*ratioh,92*ratiow,661*ratioh,89*ratiow,659*ratioh,105*ratiow,655*ratioh,124*ratiow,649*ratioh,145*ratiow,637*ratioh,152*ratiow,632*ratioh,155*ratiow,638*ratioh,163*ratiow,645*ratioh,167*ratiow,647*ratioh,162*ratiow,652*ratioh,160*ratiow,661*ratioh,163*ratiow,675*ratioh,170*ratiow,685*ratioh,178*ratiow,697*ratioh,191*ratiow,707*ratioh,202*ratiow,714*ratioh,217*ratiow,718*ratioh,226*ratiow,719*ratioh,236*ratiow,715*ratioh,240*ratiow,708*ratioh,243*ratiow,714*ratioh,251*ratiow,725*ratioh,264*ratiow,735*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(120*ratiow,195*ratioh,75*ratiow,116*ratioh,49*ratiow,69*ratioh,34*ratiow,42*ratioh,25*ratiow,50*ratioh,12*ratiow,64*ratioh,6*ratiow,81*ratioh,2*ratiow,108*ratioh,2*ratiow,162*ratioh,36*ratiow,177*ratioh,67*ratiow,191*ratioh,101*ratiow,206*ratioh,108*ratiow,210*ratioh,110*ratiow,205*ratioh,114*ratiow,201*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(107*ratiow,208*ratioh,58*ratiow,187*ratioh,20*ratiow,170*ratioh,1*ratiow,160*ratioh,1*ratiow,250*ratioh,4*ratiow,262*ratioh,10*ratiow,276*ratioh,14*ratiow,279*ratioh,8*ratiow,282*ratioh,6*ratiow,288*ratioh,20*ratiow,289*ratioh,42*ratiow,285*ratioh,61*ratiow,279*ratioh,72*ratiow,271*ratioh,84*ratiow,258*ratioh,89*ratiow,251*ratioh,94*ratiow,242*ratioh,99*ratiow,227*ratioh,103*ratiow,217*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(400*ratiow,693*ratioh,383*ratiow,694*ratioh,352*ratiow,688*ratioh,325*ratiow,679*ratioh,310*ratiow,672*ratioh,262*ratiow,645*ratioh,244*ratiow,634*ratioh,237*ratiow,601*ratioh,230*ratiow,570*ratioh,216*ratiow,529*ratioh,201*ratiow,500*ratioh,196*ratiow,492*ratioh,198*ratiow,466*ratioh,196*ratiow,447*ratioh,193*ratiow,441*ratioh,188*ratiow,438*ratioh,182*ratiow,438*ratioh,175*ratiow,442*ratioh,172*ratiow,448*ratioh,169*ratiow,456*ratioh,168*ratiow,470*ratioh,167*ratiow,486*ratioh,165*ratiow,482*ratioh,162*ratiow,474*ratioh,156*ratiow,469*ratioh,158*ratiow,461*ratioh,160*ratiow,451*ratioh,158*ratiow,407*ratioh,159*ratiow,373*ratioh,161*ratiow,339*ratioh,163*ratiow,326*ratioh,172*ratiow,305*ratioh,181*ratiow,283*ratioh,187*ratiow,271*ratioh,192*ratiow,262*ratioh,199*ratiow,254*ratioh,206*ratiow,248*ratioh,235*ratiow,248*ratioh,250*ratiow,250*ratioh,275*ratiow,254*ratioh,301*ratiow,263*ratioh,334*ratiow,279*ratioh,359*ratiow,296*ratioh,381*ratiow,314*ratioh,386*ratiow,319*ratioh,397*ratiow,330*ratioh,408*ratiow,344*ratioh,419*ratiow,360*ratioh,430*ratiow,377*ratioh,439*ratiow,398*ratioh,449*ratiow,421*ratioh,455*ratiow,439*ratioh,462*ratiow,460*ratioh,468*ratiow,488*ratioh,472*ratiow,507*ratioh,475*ratiow,528*ratioh,473*ratiow,558*ratioh,468*ratiow,575*ratioh,462*ratiow,592*ratioh,444*ratiow,631*ratioh,432*ratiow,654*ratioh,421*ratiow,673*ratioh,400*ratiow,693*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(401*ratiow,789*ratioh,399*ratiow,824*ratioh,422*ratiow,824*ratioh,439*ratiow,820*ratioh,457*ratiow,814*ratioh,467*ratiow,810*ratioh,481*ratiow,804*ratioh,509*ratiow,785*ratioh,524*ratiow,771*ratioh,539*ratiow,756*ratioh,557*ratiow,735*ratioh,571*ratiow,716*ratioh,580*ratiow,701*ratioh,588*ratiow,687*ratioh,593*ratiow,675*ratioh,596*ratiow,668*ratioh,586*ratiow,666*ratioh,566*ratiow,660*ratioh,568*ratiow,666*ratioh,565*ratiow,678*ratioh,556*ratiow,696*ratioh,548*ratiow,709*ratioh,535*ratiow,726*ratioh,520*ratiow,743*ratioh,505*ratiow,758*ratioh,489*ratiow,770*ratioh,472*ratiow,779*ratioh,459*ratiow,782*ratioh,436*ratiow,781*ratioh,429*ratiow,781*ratioh,414*ratiow,785*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(400*ratiow,772*ratioh,401*ratiow,790*ratioh,410*ratiow,787*ratioh,418*ratiow,783*ratioh,428*ratiow,781*ratioh,451*ratiow,781*ratioh,461*ratiow,781*ratioh,479*ratiow,776*ratioh,493*ratiow,767*ratioh,507*ratiow,755*ratioh,522*ratiow,742*ratioh,533*ratiow,728*ratioh,544*ratiow,715*ratioh,556*ratiow,697*ratioh,564*ratiow,682*ratioh,568*ratiow,669*ratioh,567*ratiow,661*ratioh,561*ratiow,659*ratioh,556*ratiow,664*ratioh,550*ratiow,678*ratioh,541*ratiow,695*ratioh,530*ratiow,710*ratioh,509*ratiow,733*ratioh,493*ratiow,747*ratioh,481*ratiow,756*ratioh,471*ratiow,760*ratioh,453*ratiow,765*ratioh,440*ratiow,768*ratioh,417*ratiow,768*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(374*ratiow,745*ratioh,382*ratiow,746*ratioh,389*ratiow,751*ratioh,395*ratiow,759*ratioh,400*ratiow,773*ratioh,407*ratiow,770*ratioh,414*ratiow,769*ratioh,427*ratiow,768*ratioh,441*ratiow,768*ratioh,471*ratiow,761*ratioh,486*ratiow,753*ratioh,502*ratiow,740*ratioh,528*ratiow,713*ratioh,539*ratiow,697*ratioh,547*ratiow,682*ratioh,555*ratiow,668*ratioh,558*ratiow,661*ratioh,561*ratiow,659*ratioh,545*ratiow,655*ratioh,526*ratiow,649*ratioh,505*ratiow,637*ratioh,498*ratiow,632*ratioh,495*ratiow,638*ratioh,487*ratiow,645*ratioh,483*ratiow,647*ratioh,488*ratiow,652*ratioh,490*ratiow,661*ratioh,487*ratiow,675*ratioh,480*ratiow,685*ratioh,472*ratiow,697*ratioh,459*ratiow,707*ratioh,448*ratiow,714*ratioh,433*ratiow,718*ratioh,424*ratiow,719*ratioh,414*ratiow,715*ratioh,410*ratiow,708*ratioh,407*ratiow,714*ratioh,399*ratiow,725*ratioh,386*ratiow,735*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile36(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 659;
var baseHeight = 841;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(540*ratiow,190*ratioh,559*ratiow,157*ratioh,582*ratiow,116*ratioh,604*ratiow,77*ratioh,622*ratiow,45*ratioh,625*ratiow,39*ratioh,634*ratiow,48*ratioh,644*ratiow,60*ratioh,652*ratiow,71*ratioh,657*ratiow,87*ratioh,658*ratiow,92*ratioh,658*ratiow,153*ratioh,606*ratiow,177*ratioh,557*ratiow,201*ratioh,553*ratiow,203*ratioh,550*ratiow,199*ratioh,547*ratiow,195*ratioh,542*ratiow,194*ratioh,539*ratiow,191*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(554*ratiow,202*ratioh,591*ratiow,184*ratioh,638*ratiow,163*ratioh,658*ratiow,153*ratioh,658*ratiow,259*ratioh,655*ratiow,264*ratioh,648*ratiow,270*ratioh,647*ratiow,272*ratioh,658*ratiow,271*ratioh,658*ratiow,287*ratioh,643*ratiow,285*ratioh,621*ratiow,279*ratioh,599*ratiow,273*ratioh,584*ratiow,267*ratioh,577*ratiow,259*ratioh,572*ratiow,245*ratioh,567*ratiow,230*ratioh,561*ratiow,215*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(244*ratiow,673*ratioh,261*ratiow,678*ratioh,270*ratiow,680*ratioh,273*ratiow,685*ratioh,274*ratiow,688*ratioh,284*ratiow,685*ratioh,287*ratiow,682*ratioh,287*ratiow,681*ratioh,291*ratiow,679*ratioh,308*ratiow,672*ratioh,328*ratiow,662*ratioh,347*ratiow,651*ratioh,364*ratiow,642*ratioh,368*ratiow,634*ratioh,377*ratiow,626*ratioh,382*ratiow,624*ratioh,386*ratiow,624*ratioh,389*ratiow,625*ratioh,390*ratiow,629*ratioh,405*ratiow,618*ratioh,406*ratiow,604*ratioh,404*ratiow,581*ratioh,401*ratiow,565*ratioh,399*ratiow,551*ratioh,400*ratiow,537*ratioh,404*ratiow,522*ratioh,409*ratiow,507*ratioh,418*ratiow,489*ratioh,427*ratiow,475*ratioh,437*ratiow,464*ratioh,441*ratiow,459*ratioh,451*ratiow,448*ratioh,459*ratiow,443*ratioh,460*ratiow,434*ratioh,464*ratiow,428*ratioh,469*ratiow,426*ratioh,475*ratiow,429*ratioh,480*ratiow,435*ratioh,486*ratiow,447*ratioh,490*ratiow,459*ratioh,491*ratiow,466*ratioh,498*ratiow,459*ratioh,495*ratiow,445*ratioh,495*ratiow,398*ratioh,495*ratiow,331*ratioh,493*ratiow,315*ratioh,487*ratiow,298*ratioh,481*ratiow,281*ratioh,472*ratiow,262*ratioh,466*ratiow,253*ratioh,458*ratiow,246*ratioh,433*ratiow,244*ratioh,407*ratiow,245*ratioh,375*ratiow,249*ratioh,350*ratiow,258*ratioh,338*ratiow,265*ratioh,325*ratiow,273*ratioh,310*ratiow,284*ratioh,294*ratiow,299*ratioh,278*ratiow,315*ratioh,265*ratiow,330*ratioh,249*ratiow,349*ratioh,235*ratiow,370*ratioh,221*ratiow,392*ratioh,210*ratiow,417*ratioh,201*ratiow,446*ratioh,196*ratiow,468*ratioh,193*ratiow,481*ratioh,189*ratiow,508*ratioh,187*ratiow,522*ratioh,187*ratiow,540*ratioh,190*ratiow,560*ratioh,199*ratiow,586*ratioh,213*ratiow,619*ratioh,219*ratiow,632*ratioh,226*ratiow,645*ratioh,234*ratiow,658*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(231*ratiow,782*ratioh,232*ratiow,821*ratioh,222*ratiow,819*ratioh,200*ratiow,813*ratioh,179*ratiow,805*ratioh,170*ratiow,800*ratioh,156*ratiow,792*ratioh,137*ratiow,776*ratioh,116*ratiow,756*ratioh,95*ratiow,733*ratioh,81*ratiow,714*ratioh,69*ratiow,696*ratioh,59*ratiow,677*ratioh,53*ratiow,660*ratioh,71*ratiow,657*ratioh,95*ratiow,652*ratioh,93*ratiow,660*ratioh,96*ratiow,674*ratioh,103*ratiow,691*ratioh,109*ratiow,706*ratioh,116*ratiow,720*ratioh,126*ratiow,729*ratioh,135*ratiow,737*ratioh,148*ratiow,746*ratioh,158*ratiow,756*ratioh,170*ratiow,766*ratioh,181*ratiow,774*ratioh,196*ratiow,779*ratioh,211*ratiow,781*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(233*ratiow,762*ratioh,231*ratiow,782*ratioh,208*ratiow,781*ratioh,192*ratiow,779*ratioh,180*ratiow,772*ratioh,165*ratiow,762*ratioh,153*ratiow,751*ratioh,144*ratiow,743*ratioh,134*ratiow,736*ratioh,122*ratiow,727*ratioh,114*ratiow,715*ratioh,106*ratiow,699*ratioh,100*ratiow,683*ratioh,95*ratiow,671*ratioh,93*ratiow,662*ratioh,94*ratiow,653*ratioh,97*ratiow,651*ratioh,100*ratiow,652*ratioh,104*ratiow,660*ratioh,109*ratiow,672*ratioh,117*ratiow,686*ratioh,128*ratiow,700*ratioh,137*ratiow,711*ratioh,158*ratiow,729*ratioh,175*ratiow,743*ratioh,191*ratiow,752*ratioh,207*ratiow,758*ratioh,222*ratiow,761*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(240*ratiow,713*ratioh,249*ratiow,727*ratioh,244*ratiow,735*ratioh,238*ratiow,748*ratioh,233*ratiow,763*ratioh,219*ratiow,761*ratioh,202*ratiow,757*ratioh,186*ratiow,749*ratioh,167*ratiow,737*ratioh,150*ratiow,723*ratioh,126*ratiow,699*ratioh,115*ratiow,683*ratioh,108*ratiow,669*ratioh,103*ratiow,658*ratioh,99*ratiow,651*ratioh,119*ratiow,646*ratioh,138*ratiow,638*ratioh,155*ratiow,630*ratioh,162*ratiow,627*ratioh,164*ratiow,632*ratioh,168*ratiow,638*ratioh,173*ratiow,642*ratioh,178*ratiow,643*ratioh,173*ratiow,651*ratioh,171*ratiow,661*ratioh,173*ratiow,673*ratioh,182*ratiow,687*ratioh,192*ratiow,697*ratioh,203*ratiow,706*ratioh,216*ratiow,712*ratioh,228*ratiow,714*ratioh,236*ratiow,714*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(119*ratiow,190*ratioh,100*ratiow,157*ratioh,77*ratiow,116*ratioh,55*ratiow,77*ratioh,37*ratiow,45*ratioh,34*ratiow,39*ratioh,25*ratiow,48*ratioh,15*ratiow,60*ratioh,7*ratiow,71*ratioh,2*ratiow,87*ratioh,1*ratiow,92*ratioh,1*ratiow,153*ratioh,53*ratiow,177*ratioh,102*ratiow,201*ratioh,106*ratiow,203*ratioh,109*ratiow,199*ratioh,112*ratiow,195*ratioh,117*ratiow,194*ratioh,120*ratiow,191*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(105*ratiow,202*ratioh,68*ratiow,184*ratioh,21*ratiow,163*ratioh,1*ratiow,153*ratioh,1*ratiow,259*ratioh,4*ratiow,264*ratioh,11*ratiow,270*ratioh,12*ratiow,272*ratioh,1*ratiow,271*ratioh,1*ratiow,287*ratioh,16*ratiow,285*ratioh,38*ratiow,279*ratioh,60*ratiow,273*ratioh,75*ratiow,267*ratioh,82*ratiow,259*ratioh,87*ratiow,245*ratioh,92*ratiow,230*ratioh,98*ratiow,215*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(415*ratiow,673*ratioh,398*ratiow,678*ratioh,389*ratiow,680*ratioh,386*ratiow,685*ratioh,385*ratiow,688*ratioh,375*ratiow,685*ratioh,372*ratiow,682*ratioh,372*ratiow,681*ratioh,368*ratiow,679*ratioh,351*ratiow,672*ratioh,331*ratiow,662*ratioh,312*ratiow,651*ratioh,295*ratiow,642*ratioh,291*ratiow,634*ratioh,282*ratiow,626*ratioh,277*ratiow,624*ratioh,273*ratiow,624*ratioh,270*ratiow,625*ratioh,269*ratiow,629*ratioh,254*ratiow,618*ratioh,253*ratiow,604*ratioh,255*ratiow,581*ratioh,258*ratiow,565*ratioh,260*ratiow,551*ratioh,259*ratiow,537*ratioh,255*ratiow,522*ratioh,250*ratiow,507*ratioh,241*ratiow,489*ratioh,232*ratiow,475*ratioh,222*ratiow,464*ratioh,218*ratiow,459*ratioh,208*ratiow,448*ratioh,200*ratiow,443*ratioh,199*ratiow,434*ratioh,195*ratiow,428*ratioh,190*ratiow,426*ratioh,184*ratiow,429*ratioh,179*ratiow,435*ratioh,173*ratiow,447*ratioh,169*ratiow,459*ratioh,168*ratiow,466*ratioh,161*ratiow,459*ratioh,164*ratiow,445*ratioh,164*ratiow,398*ratioh,164*ratiow,331*ratioh,166*ratiow,315*ratioh,172*ratiow,298*ratioh,178*ratiow,281*ratioh,187*ratiow,262*ratioh,193*ratiow,253*ratioh,201*ratiow,246*ratioh,226*ratiow,244*ratioh,252*ratiow,245*ratioh,284*ratiow,249*ratioh,309*ratiow,258*ratioh,321*ratiow,265*ratioh,334*ratiow,273*ratioh,349*ratiow,284*ratioh,365*ratiow,299*ratioh,381*ratiow,315*ratioh,394*ratiow,330*ratioh,410*ratiow,349*ratioh,424*ratiow,370*ratioh,438*ratiow,392*ratioh,449*ratiow,417*ratioh,458*ratiow,446*ratioh,463*ratiow,468*ratioh,466*ratiow,481*ratioh,470*ratiow,508*ratioh,472*ratiow,522*ratioh,472*ratiow,540*ratioh,469*ratiow,560*ratioh,460*ratiow,586*ratioh,446*ratiow,619*ratioh,440*ratiow,632*ratioh,433*ratiow,645*ratioh,425*ratiow,658*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(428*ratiow,782*ratioh,427*ratiow,821*ratioh,437*ratiow,819*ratioh,459*ratiow,813*ratioh,480*ratiow,805*ratioh,489*ratiow,800*ratioh,503*ratiow,792*ratioh,522*ratiow,776*ratioh,543*ratiow,756*ratioh,564*ratiow,733*ratioh,578*ratiow,714*ratioh,590*ratiow,696*ratioh,600*ratiow,677*ratioh,606*ratiow,660*ratioh,588*ratiow,657*ratioh,564*ratiow,652*ratioh,566*ratiow,660*ratioh,563*ratiow,674*ratioh,556*ratiow,691*ratioh,550*ratiow,706*ratioh,543*ratiow,720*ratioh,533*ratiow,729*ratioh,524*ratiow,737*ratioh,511*ratiow,746*ratioh,501*ratiow,756*ratioh,489*ratiow,766*ratioh,478*ratiow,774*ratioh,463*ratiow,779*ratioh,448*ratiow,781*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(426*ratiow,762*ratioh,428*ratiow,782*ratioh,451*ratiow,781*ratioh,467*ratiow,779*ratioh,479*ratiow,772*ratioh,494*ratiow,762*ratioh,506*ratiow,751*ratioh,515*ratiow,743*ratioh,525*ratiow,736*ratioh,537*ratiow,727*ratioh,545*ratiow,715*ratioh,553*ratiow,699*ratioh,559*ratiow,683*ratioh,564*ratiow,671*ratioh,566*ratiow,662*ratioh,565*ratiow,653*ratioh,562*ratiow,651*ratioh,559*ratiow,652*ratioh,555*ratiow,660*ratioh,550*ratiow,672*ratioh,542*ratiow,686*ratioh,531*ratiow,700*ratioh,522*ratiow,711*ratioh,501*ratiow,729*ratioh,484*ratiow,743*ratioh,468*ratiow,752*ratioh,452*ratiow,758*ratioh,437*ratiow,761*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(419*ratiow,713*ratioh,410*ratiow,727*ratioh,415*ratiow,735*ratioh,421*ratiow,748*ratioh,426*ratiow,763*ratioh,440*ratiow,761*ratioh,457*ratiow,757*ratioh,473*ratiow,749*ratioh,492*ratiow,737*ratioh,509*ratiow,723*ratioh,533*ratiow,699*ratioh,544*ratiow,683*ratioh,551*ratiow,669*ratioh,556*ratiow,658*ratioh,560*ratiow,651*ratioh,540*ratiow,646*ratioh,521*ratiow,638*ratioh,504*ratiow,630*ratioh,497*ratiow,627*ratioh,495*ratiow,632*ratioh,491*ratiow,638*ratioh,486*ratiow,642*ratioh,481*ratiow,643*ratioh,486*ratiow,651*ratioh,488*ratiow,661*ratioh,486*ratiow,673*ratioh,477*ratiow,687*ratioh,467*ratiow,697*ratioh,456*ratiow,706*ratioh,443*ratiow,712*ratioh,431*ratiow,714*ratioh,423*ratiow,714*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile37(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 651;
var baseHeight = 856;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(533*ratiow,176*ratioh,552*ratiow,148*ratioh,575*ratiow,113*ratioh,593*ratiow,85*ratioh,611*ratiow,58*ratioh,620*ratiow,44*ratioh,630*ratiow,52*ratioh,638*ratiow,61*ratioh,645*ratiow,70*ratioh,649*ratiow,78*ratioh,650*ratiow,84*ratioh,650*ratiow,161*ratioh,616*ratiow,171*ratioh,579*ratiow,181*ratioh,548*ratiow,190*ratioh,541*ratiow,192*ratioh,540*ratiow,186*ratioh,538*ratiow,182*ratioh,536*ratiow,178*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(542*ratiow,191*ratioh,577*ratiow,182*ratioh,622*ratiow,170*ratioh,650*ratiow,162*ratioh,650*ratiow,256*ratioh,649*ratiow,259*ratioh,645*ratiow,264*ratioh,640*ratiow,266*ratioh,646*ratiow,268*ratioh,650*ratiow,271*ratioh,650*ratiow,275*ratioh,641*ratiow,275*ratioh,627*ratiow,273*ratioh,605*ratiow,268*ratioh,587*ratiow,262*ratioh,575*ratiow,254*ratioh,566*ratiow,246*ratioh,561*ratiow,238*ratioh,555*ratiow,227*ratioh,550*ratiow,214*ratioh,546*ratiow,204*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(275*ratiow,693*ratioh,283*ratiow,694*ratioh,291*ratiow,694*ratioh,295*ratiow,691*ratioh,301*ratiow,690*ratioh,315*ratiow,685*ratioh,330*ratiow,678*ratioh,337*ratiow,673*ratioh,348*ratiow,663*ratioh,364*ratiow,651*ratioh,375*ratiow,641*ratioh,382*ratiow,634*ratioh,390*ratiow,628*ratioh,386*ratiow,615*ratioh,378*ratiow,594*ratioh,370*ratiow,570*ratioh,367*ratiow,549*ratioh,368*ratiow,527*ratioh,375*ratiow,504*ratioh,383*ratiow,486*ratioh,395*ratiow,468*ratioh,407*ratiow,454*ratioh,421*ratiow,442*ratioh,432*ratiow,434*ratioh,434*ratiow,432*ratioh,431*ratiow,411*ratioh,429*ratiow,396*ratioh,427*ratiow,371*ratioh,427*ratiow,355*ratioh,428*ratiow,350*ratioh,432*ratiow,346*ratioh,435*ratiow,346*ratioh,439*ratiow,348*ratioh,443*ratiow,351*ratioh,447*ratiow,364*ratioh,455*ratiow,388*ratioh,461*ratiow,405*ratioh,467*ratiow,435*ratioh,470*ratiow,429*ratioh,473*ratiow,419*ratioh,473*ratiow,394*ratioh,467*ratiow,332*ratioh,465*ratiow,307*ratioh,459*ratiow,288*ratioh,454*ratiow,272*ratioh,448*ratiow,262*ratioh,435*ratiow,256*ratioh,421*ratiow,251*ratioh,408*ratiow,249*ratioh,391*ratiow,250*ratioh,365*ratiow,256*ratioh,336*ratiow,267*ratioh,317*ratiow,277*ratioh,306*ratiow,284*ratioh,285*ratiow,302*ratioh,268*ratiow,317*ratioh,252*ratiow,336*ratioh,239*ratiow,353*ratioh,224*ratiow,377*ratioh,213*ratiow,399*ratioh,205*ratiow,422*ratioh,201*ratiow,439*ratioh,195*ratiow,461*ratioh,190*ratiow,484*ratioh,186*ratiow,512*ratioh,189*ratiow,558*ratioh,196*ratiow,583*ratioh,202*ratiow,600*ratioh,210*ratiow,613*ratioh,219*ratiow,630*ratioh,222*ratiow,634*ratioh,224*ratiow,645*ratioh,230*ratiow,656*ratioh,241*ratiow,668*ratioh,255*ratiow,682*ratioh,270*ratiow,691*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(238*ratiow,815*ratioh,235*ratiow,826*ratioh,235*ratiow,836*ratioh,237*ratiow,845*ratioh,222*ratiow,841*ratioh,202*ratiow,832*ratioh,180*ratiow,820*ratioh,162*ratiow,808*ratioh,144*ratiow,794*ratioh,129*ratiow,781*ratioh,115*ratiow,764*ratioh,88*ratiow,729*ratioh,75*ratiow,706*ratioh,60*ratiow,679*ratioh,66*ratiow,677*ratioh,96*ratiow,671*ratioh,96*ratiow,674*ratioh,98*ratiow,682*ratioh,101*ratiow,691*ratioh,107*ratiow,702*ratioh,120*ratiow,722*ratioh,129*ratiow,734*ratioh,138*ratiow,747*ratioh,149*ratiow,758*ratioh,172*ratiow,781*ratioh,192*ratiow,796*ratioh,203*ratiow,804*ratioh,214*ratiow,811*ratioh,225*ratiow,813*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(242*ratiow,794*ratioh,241*ratiow,804*ratioh,238*ratiow,814*ratioh,222*ratiow,813*ratioh,205*ratiow,806*ratioh,194*ratiow,798*ratioh,169*ratiow,778*ratioh,151*ratiow,760*ratioh,134*ratiow,741*ratioh,116*ratiow,717*ratioh,103*ratiow,694*ratioh,97*ratiow,681*ratioh,95*ratiow,671*ratioh,102*ratiow,669*ratioh,110*ratiow,671*ratioh,122*ratiow,692*ratioh,134*ratiow,711*ratioh,148*ratiow,729*ratioh,162*ratiow,745*ratioh,178*ratiow,760*ratioh,195*ratiow,774*ratioh,210*ratiow,783*ratioh,221*ratiow,789*ratioh,229*ratiow,793*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(242*ratiow,793*ratioh,231*ratiow,793*ratioh,216*ratiow,786*ratioh,197*ratiow,775*ratioh,177*ratiow,760*ratioh,158*ratiow,740*ratioh,137*ratiow,714*ratioh,115*ratiow,682*ratioh,109*ratiow,672*ratioh,103*ratiow,668*ratioh,124*ratiow,662*ratioh,158*ratiow,646*ratioh,170*ratiow,637*ratioh,172*ratiow,642*ratioh,177*ratiow,647*ratioh,183*ratiow,648*ratioh,179*ratiow,653*ratioh,175*ratiow,661*ratioh,177*ratiow,675*ratioh,176*ratiow,682*ratioh,177*ratiow,689*ratioh,180*ratiow,695*ratioh,192*ratiow,704*ratioh,202*ratiow,708*ratioh,209*ratiow,709*ratioh,217*ratiow,709*ratioh,230*ratiow,717*ratioh,243*ratiow,724*ratioh,254*ratiow,731*ratioh,264*ratiow,739*ratioh,257*ratiow,748*ratioh,252*ratiow,758*ratioh,246*ratiow,776*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(118*ratiow,176*ratioh,99*ratiow,148*ratioh,76*ratiow,113*ratioh,58*ratiow,85*ratioh,40*ratiow,58*ratioh,31*ratiow,44*ratioh,21*ratiow,52*ratioh,13*ratiow,61*ratioh,6*ratiow,70*ratioh,2*ratiow,78*ratioh,1*ratiow,84*ratioh,1*ratiow,161*ratioh,35*ratiow,171*ratioh,72*ratiow,181*ratioh,103*ratiow,190*ratioh,110*ratiow,192*ratioh,111*ratiow,186*ratioh,113*ratiow,182*ratioh,115*ratiow,178*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(109*ratiow,191*ratioh,74*ratiow,182*ratioh,29*ratiow,170*ratioh,1*ratiow,162*ratioh,1*ratiow,256*ratioh,2*ratiow,259*ratioh,6*ratiow,264*ratioh,11*ratiow,266*ratioh,5*ratiow,268*ratioh,1*ratiow,271*ratioh,1*ratiow,275*ratioh,10*ratiow,275*ratioh,24*ratiow,273*ratioh,46*ratiow,268*ratioh,64*ratiow,262*ratioh,76*ratiow,254*ratioh,85*ratiow,246*ratioh,90*ratiow,238*ratioh,96*ratiow,227*ratioh,101*ratiow,214*ratioh,105*ratiow,204*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(376*ratiow,693*ratioh,368*ratiow,694*ratioh,360*ratiow,694*ratioh,356*ratiow,691*ratioh,350*ratiow,690*ratioh,336*ratiow,685*ratioh,321*ratiow,678*ratioh,314*ratiow,673*ratioh,303*ratiow,663*ratioh,287*ratiow,651*ratioh,276*ratiow,641*ratioh,269*ratiow,634*ratioh,261*ratiow,628*ratioh,265*ratiow,615*ratioh,273*ratiow,594*ratioh,281*ratiow,570*ratioh,284*ratiow,549*ratioh,283*ratiow,527*ratioh,276*ratiow,504*ratioh,268*ratiow,486*ratioh,256*ratiow,468*ratioh,244*ratiow,454*ratioh,230*ratiow,442*ratioh,219*ratiow,434*ratioh,217*ratiow,432*ratioh,220*ratiow,411*ratioh,222*ratiow,396*ratioh,224*ratiow,371*ratioh,224*ratiow,355*ratioh,223*ratiow,350*ratioh,219*ratiow,346*ratioh,216*ratiow,346*ratioh,212*ratiow,348*ratioh,208*ratiow,351*ratioh,204*ratiow,364*ratioh,196*ratiow,388*ratioh,190*ratiow,405*ratioh,184*ratiow,435*ratioh,181*ratiow,429*ratioh,178*ratiow,419*ratioh,178*ratiow,394*ratioh,184*ratiow,332*ratioh,186*ratiow,307*ratioh,192*ratiow,288*ratioh,197*ratiow,272*ratioh,203*ratiow,262*ratioh,216*ratiow,256*ratioh,230*ratiow,251*ratioh,243*ratiow,249*ratioh,260*ratiow,250*ratioh,286*ratiow,256*ratioh,315*ratiow,267*ratioh,334*ratiow,277*ratioh,345*ratiow,284*ratioh,366*ratiow,302*ratioh,383*ratiow,317*ratioh,399*ratiow,336*ratioh,412*ratiow,353*ratioh,427*ratiow,377*ratioh,438*ratiow,399*ratioh,446*ratiow,422*ratioh,450*ratiow,439*ratioh,456*ratiow,461*ratioh,461*ratiow,484*ratioh,465*ratiow,512*ratioh,462*ratiow,558*ratioh,455*ratiow,583*ratioh,449*ratiow,600*ratioh,441*ratiow,613*ratioh,432*ratiow,630*ratioh,429*ratiow,634*ratioh,427*ratiow,645*ratioh,421*ratiow,656*ratioh,410*ratiow,668*ratioh,396*ratiow,682*ratioh,381*ratiow,691*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(413*ratiow,815*ratioh,416*ratiow,826*ratioh,416*ratiow,836*ratioh,414*ratiow,845*ratioh,429*ratiow,841*ratioh,449*ratiow,832*ratioh,471*ratiow,820*ratioh,489*ratiow,808*ratioh,507*ratiow,794*ratioh,522*ratiow,781*ratioh,536*ratiow,764*ratioh,563*ratiow,729*ratioh,576*ratiow,706*ratioh,591*ratiow,679*ratioh,585*ratiow,677*ratioh,555*ratiow,671*ratioh,555*ratiow,674*ratioh,553*ratiow,682*ratioh,550*ratiow,691*ratioh,544*ratiow,702*ratioh,531*ratiow,722*ratioh,522*ratiow,734*ratioh,513*ratiow,747*ratioh,502*ratiow,758*ratioh,479*ratiow,781*ratioh,459*ratiow,796*ratioh,448*ratiow,804*ratioh,437*ratiow,811*ratioh,426*ratiow,813*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(409*ratiow,794*ratioh,410*ratiow,804*ratioh,413*ratiow,814*ratioh,429*ratiow,813*ratioh,446*ratiow,806*ratioh,457*ratiow,798*ratioh,482*ratiow,778*ratioh,500*ratiow,760*ratioh,517*ratiow,741*ratioh,535*ratiow,717*ratioh,548*ratiow,694*ratioh,554*ratiow,681*ratioh,556*ratiow,671*ratioh,549*ratiow,669*ratioh,541*ratiow,671*ratioh,529*ratiow,692*ratioh,517*ratiow,711*ratioh,503*ratiow,729*ratioh,489*ratiow,745*ratioh,473*ratiow,760*ratioh,456*ratiow,774*ratioh,441*ratiow,783*ratioh,430*ratiow,789*ratioh,422*ratiow,793*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(409*ratiow,793*ratioh,420*ratiow,793*ratioh,435*ratiow,786*ratioh,454*ratiow,775*ratioh,474*ratiow,760*ratioh,493*ratiow,740*ratioh,514*ratiow,714*ratioh,536*ratiow,682*ratioh,542*ratiow,672*ratioh,548*ratiow,668*ratioh,527*ratiow,662*ratioh,493*ratiow,646*ratioh,481*ratiow,637*ratioh,479*ratiow,642*ratioh,474*ratiow,647*ratioh,468*ratiow,648*ratioh,472*ratiow,653*ratioh,476*ratiow,661*ratioh,474*ratiow,675*ratioh,475*ratiow,682*ratioh,474*ratiow,689*ratioh,471*ratiow,695*ratioh,459*ratiow,704*ratioh,449*ratiow,708*ratioh,442*ratiow,709*ratioh,434*ratiow,709*ratioh,421*ratiow,717*ratioh,408*ratiow,724*ratioh,397*ratiow,731*ratioh,387*ratiow,739*ratioh,394*ratiow,748*ratioh,399*ratiow,758*ratioh,405*ratiow,776*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile38(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 663;
var baseHeight = 860;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(526*ratiow,187*ratioh,554*ratiow,143*ratioh,591*ratiow,85*ratioh,612*ratiow,52*ratioh,619*ratiow,41*ratioh,627*ratiow,48*ratioh,635*ratiow,56*ratioh,643*ratiow,66*ratioh,651*ratiow,79*ratioh,657*ratiow,88*ratioh,660*ratiow,99*ratioh,662*ratiow,112*ratioh,662*ratiow,145*ratioh,644*ratiow,151*ratioh,590*ratiow,170*ratioh,554*ratiow,183*ratioh,533*ratiow,190*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(533*ratiow,190*ratioh,577*ratiow,175*ratioh,634*ratiow,154*ratioh,662*ratiow,145*ratioh,662*ratiow,256*ratioh,659*ratiow,262*ratioh,653*ratiow,268*ratioh,657*ratiow,271*ratioh,662*ratiow,277*ratioh,662*ratiow,281*ratioh,652*ratiow,281*ratioh,630*ratiow,277*ratioh,600*ratiow,270*ratioh,593*ratiow,266*ratioh,584*ratiow,259*ratioh,576*ratiow,251*ratioh,566*ratiow,236*ratioh,558*ratiow,222*ratioh,549*ratiow,210*ratioh,544*ratiow,201*ratioh,540*ratiow,195*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(268*ratiow,691*ratioh,281*ratiow,697*ratioh,290*ratiow,696*ratioh,306*ratiow,692*ratioh,326*ratiow,680*ratioh,350*ratiow,664*ratioh,365*ratiow,650*ratioh,364*ratiow,629*ratioh,359*ratiow,608*ratioh,354*ratiow,583*ratioh,348*ratiow,559*ratioh,347*ratiow,540*ratioh,350*ratiow,523*ratioh,360*ratiow,501*ratioh,372*ratiow,481*ratioh,382*ratiow,469*ratioh,398*ratiow,456*ratioh,417*ratiow,444*ratioh,427*ratiow,440*ratioh,436*ratiow,441*ratioh,441*ratiow,446*ratioh,435*ratiow,430*ratioh,421*ratiow,399*ratioh,416*ratiow,384*ratioh,416*ratiow,376*ratioh,421*ratiow,370*ratioh,427*ratiow,367*ratioh,435*ratiow,367*ratioh,443*ratiow,370*ratioh,448*ratiow,378*ratioh,458*ratiow,399*ratioh,465*ratiow,416*ratioh,468*ratiow,424*ratioh,466*ratiow,411*ratioh,464*ratiow,383*ratioh,466*ratiow,356*ratioh,468*ratiow,331*ratioh,468*ratiow,311*ratioh,463*ratiow,289*ratioh,454*ratiow,270*ratioh,446*ratiow,262*ratioh,438*ratiow,256*ratioh,429*ratiow,252*ratioh,399*ratiow,254*ratioh,367*ratiow,260*ratioh,350*ratiow,266*ratioh,327*ratiow,278*ratioh,308*ratiow,291*ratioh,292*ratiow,303*ratioh,273*ratiow,321*ratioh,259*ratiow,336*ratioh,237*ratiow,368*ratioh,225*ratiow,387*ratioh,216*ratiow,404*ratioh,211*ratiow,414*ratioh,204*ratiow,431*ratioh,197*ratiow,450*ratioh,192*ratiow,472*ratioh,188*ratiow,500*ratioh,186*ratiow,531*ratioh,187*ratiow,555*ratioh,191*ratiow,575*ratioh,197*ratiow,596*ratioh,208*ratiow,622*ratioh,217*ratiow,638*ratioh,230*ratiow,659*ratioh,240*ratiow,672*ratioh,251*ratiow,681*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(246*ratiow,831*ratioh,246*ratiow,850*ratioh,231*ratiow,849*ratioh,209*ratiow,843*ratioh,189*ratiow,836*ratioh,185*ratiow,835*ratioh,174*ratiow,826*ratioh,159*ratiow,817*ratioh,150*ratiow,811*ratioh,134*ratiow,797*ratioh,117*ratiow,778*ratioh,100*ratiow,756*ratioh,86*ratiow,734*ratioh,80*ratiow,720*ratioh,68*ratiow,693*ratioh,65*ratiow,686*ratioh,73*ratiow,684*ratioh,93*ratiow,680*ratioh,91*ratiow,686*ratioh,92*ratiow,694*ratioh,95*ratiow,704*ratioh,102*ratiow,714*ratioh,129*ratiow,750*ratioh,142*ratiow,765*ratioh,152*ratiow,776*ratioh,174*ratiow,797*ratioh,188*ratiow,807*ratioh,205*ratiow,818*ratioh,219*ratiow,825*ratioh,232*ratiow,830*ratioh,246*ratiow,831*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(246*ratiow,810*ratioh,246*ratiow,831*ratioh,236*ratiow,830*ratioh,221*ratiow,825*ratioh,208*ratiow,819*ratioh,192*ratiow,810*ratioh,173*ratiow,796*ratioh,157*ratiow,782*ratioh,141*ratiow,764*ratioh,113*ratiow,730*ratioh,99*ratiow,710*ratioh,93*ratiow,698*ratioh,91*ratiow,687*ratioh,92*ratiow,680*ratioh,101*ratiow,678*ratioh,107*ratiow,683*ratioh,116*ratiow,699*ratioh,124*ratiow,712*ratioh,146*ratiow,739*ratioh,161*ratiow,756*ratioh,177*ratiow,771*ratioh,194*ratiow,786*ratioh,214*ratiow,798*ratioh,232*ratiow,807*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(246*ratiow,810*ratioh,234*ratiow,808*ratioh,217*ratiow,799*ratioh,198*ratiow,789*ratioh,187*ratiow,780*ratioh,160*ratiow,754*ratioh,141*ratiow,733*ratioh,118*ratiow,702*ratioh,110*ratiow,688*ratioh,106*ratiow,682*ratioh,100*ratiow,678*ratioh,123*ratiow,670*ratioh,156*ratiow,653*ratioh,167*ratiow,646*ratioh,169*ratiow,653*ratioh,174*ratiow,663*ratioh,186*ratiow,671*ratioh,196*ratiow,672*ratioh,190*ratiow,682*ratioh,185*ratiow,692*ratioh,185*ratiow,705*ratioh,190*ratiow,713*ratioh,199*ratiow,720*ratioh,212*ratiow,727*ratioh,225*ratiow,730*ratioh,233*ratiow,731*ratioh,237*ratiow,731*ratioh,246*ratiow,737*ratioh,254*ratiow,744*ratioh,251*ratiow,756*ratioh,248*ratiow,769*ratioh,247*ratiow,790*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(137*ratiow,187*ratioh,109*ratiow,143*ratioh,72*ratiow,85*ratioh,51*ratiow,52*ratioh,44*ratiow,41*ratioh,36*ratiow,48*ratioh,28*ratiow,56*ratioh,20*ratiow,66*ratioh,12*ratiow,79*ratioh,6*ratiow,88*ratioh,3*ratiow,99*ratioh,1*ratiow,112*ratioh,1*ratiow,145*ratioh,19*ratiow,151*ratioh,73*ratiow,170*ratioh,109*ratiow,183*ratioh,130*ratiow,190*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(130*ratiow,190*ratioh,86*ratiow,175*ratioh,29*ratiow,154*ratioh,1*ratiow,145*ratioh,1*ratiow,256*ratioh,4*ratiow,262*ratioh,10*ratiow,268*ratioh,6*ratiow,271*ratioh,1*ratiow,277*ratioh,1*ratiow,281*ratioh,11*ratiow,281*ratioh,33*ratiow,277*ratioh,63*ratiow,270*ratioh,70*ratiow,266*ratioh,79*ratiow,259*ratioh,87*ratiow,251*ratioh,97*ratiow,236*ratioh,105*ratiow,222*ratioh,114*ratiow,210*ratioh,119*ratiow,201*ratioh,123*ratiow,195*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(395*ratiow,691*ratioh,382*ratiow,697*ratioh,373*ratiow,696*ratioh,357*ratiow,692*ratioh,337*ratiow,680*ratioh,313*ratiow,664*ratioh,298*ratiow,650*ratioh,299*ratiow,629*ratioh,304*ratiow,608*ratioh,309*ratiow,583*ratioh,315*ratiow,559*ratioh,316*ratiow,540*ratioh,313*ratiow,523*ratioh,303*ratiow,501*ratioh,291*ratiow,481*ratioh,281*ratiow,469*ratioh,265*ratiow,456*ratioh,246*ratiow,444*ratioh,236*ratiow,440*ratioh,227*ratiow,441*ratioh,222*ratiow,446*ratioh,228*ratiow,430*ratioh,242*ratiow,399*ratioh,247*ratiow,384*ratioh,247*ratiow,376*ratioh,242*ratiow,370*ratioh,236*ratiow,367*ratioh,228*ratiow,367*ratioh,220*ratiow,370*ratioh,215*ratiow,378*ratioh,205*ratiow,399*ratioh,198*ratiow,416*ratioh,195*ratiow,424*ratioh,197*ratiow,411*ratioh,199*ratiow,383*ratioh,197*ratiow,356*ratioh,195*ratiow,331*ratioh,195*ratiow,311*ratioh,200*ratiow,289*ratioh,209*ratiow,270*ratioh,217*ratiow,262*ratioh,225*ratiow,256*ratioh,234*ratiow,252*ratioh,264*ratiow,254*ratioh,296*ratiow,260*ratioh,313*ratiow,266*ratioh,336*ratiow,278*ratioh,355*ratiow,291*ratioh,371*ratiow,303*ratioh,390*ratiow,321*ratioh,404*ratiow,336*ratioh,426*ratiow,368*ratioh,438*ratiow,387*ratioh,447*ratiow,404*ratioh,452*ratiow,414*ratioh,459*ratiow,431*ratioh,466*ratiow,450*ratioh,471*ratiow,472*ratioh,475*ratiow,500*ratioh,477*ratiow,531*ratioh,476*ratiow,555*ratioh,472*ratiow,575*ratioh,466*ratiow,596*ratioh,455*ratiow,622*ratioh,446*ratiow,638*ratioh,433*ratiow,659*ratioh,423*ratiow,672*ratioh,412*ratiow,681*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(246*ratiow,831*ratioh,246*ratiow,850*ratioh,231*ratiow,849*ratioh,209*ratiow,843*ratioh,189*ratiow,836*ratioh,185*ratiow,835*ratioh,174*ratiow,826*ratioh,159*ratiow,817*ratioh,150*ratiow,811*ratioh,134*ratiow,797*ratioh,117*ratiow,778*ratioh,100*ratiow,756*ratioh,86*ratiow,734*ratioh,80*ratiow,720*ratioh,68*ratiow,693*ratioh,65*ratiow,686*ratioh,73*ratiow,684*ratioh,93*ratiow,680*ratioh,91*ratiow,686*ratioh,92*ratiow,694*ratioh,95*ratiow,704*ratioh,102*ratiow,714*ratioh,129*ratiow,750*ratioh,142*ratiow,765*ratioh,152*ratiow,776*ratioh,174*ratiow,797*ratioh,188*ratiow,807*ratioh,205*ratiow,818*ratioh,219*ratiow,825*ratioh,232*ratiow,830*ratioh,246*ratiow,831*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(417*ratiow,810*ratioh,417*ratiow,831*ratioh,427*ratiow,830*ratioh,442*ratiow,825*ratioh,455*ratiow,819*ratioh,471*ratiow,810*ratioh,490*ratiow,796*ratioh,506*ratiow,782*ratioh,522*ratiow,764*ratioh,550*ratiow,730*ratioh,564*ratiow,710*ratioh,570*ratiow,698*ratioh,572*ratiow,687*ratioh,571*ratiow,680*ratioh,562*ratiow,678*ratioh,556*ratiow,683*ratioh,547*ratiow,699*ratioh,539*ratiow,712*ratioh,517*ratiow,739*ratioh,502*ratiow,756*ratioh,486*ratiow,771*ratioh,469*ratiow,786*ratioh,449*ratiow,798*ratioh,431*ratiow,807*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(417*ratiow,810*ratioh,429*ratiow,808*ratioh,446*ratiow,799*ratioh,465*ratiow,789*ratioh,476*ratiow,780*ratioh,503*ratiow,754*ratioh,522*ratiow,733*ratioh,545*ratiow,702*ratioh,553*ratiow,688*ratioh,557*ratiow,682*ratioh,563*ratiow,678*ratioh,540*ratiow,670*ratioh,507*ratiow,653*ratioh,496*ratiow,646*ratioh,494*ratiow,653*ratioh,489*ratiow,663*ratioh,477*ratiow,671*ratioh,467*ratiow,672*ratioh,473*ratiow,682*ratioh,478*ratiow,692*ratioh,478*ratiow,705*ratioh,473*ratiow,713*ratioh,464*ratiow,720*ratioh,451*ratiow,727*ratioh,438*ratiow,730*ratioh,430*ratiow,731*ratioh,426*ratiow,731*ratioh,417*ratiow,737*ratioh,409*ratiow,744*ratioh,412*ratiow,756*ratioh,415*ratiow,769*ratioh,416*ratiow,790*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile39(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 677;
var baseHeight = 873;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(558*ratiow,197*ratioh,578*ratiow,167*ratioh,602*ratiow,128*ratioh,621*ratiow,99*ratioh,636*ratiow,76*ratioh,647*ratiow,59*ratioh,653*ratiow,66*ratioh,660*ratiow,75*ratioh,665*ratiow,83*ratioh,670*ratiow,92*ratioh,674*ratiow,102*ratioh,676*ratiow,114*ratioh,676*ratiow,167*ratioh,643*ratiow,178*ratioh,589*ratiow,194*ratioh,562*ratiow,203*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(562*ratiow,203*ratioh,607*ratiow,189*ratioh,659*ratiow,173*ratioh,676*ratiow,167*ratioh,676*ratiow,263*ratioh,674*ratiow,268*ratioh,668*ratiow,275*ratioh,674*ratiow,278*ratioh,676*ratiow,285*ratioh,676*ratiow,288*ratioh,662*ratiow,288*ratioh,650*ratiow,286*ratioh,625*ratiow,281*ratioh,609*ratiow,274*ratioh,596*ratiow,263*ratioh,584*ratiow,248*ratioh,575*ratiow,231*ratioh,568*ratiow,216*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(250*ratiow,693*ratioh,260*ratiow,699*ratioh,275*ratiow,703*ratioh,303*ratiow,699*ratioh,329*ratiow,685*ratioh,352*ratiow,670*ratioh,380*ratiow,654*ratioh,389*ratiow,648*ratioh,374*ratiow,629*ratioh,357*ratiow,602*ratioh,348*ratiow,577*ratioh,345*ratiow,549*ratioh,346*ratiow,534*ratioh,352*ratiow,505*ratioh,363*ratiow,483*ratioh,380*ratiow,461*ratioh,396*ratiow,447*ratioh,409*ratiow,441*ratioh,418*ratiow,439*ratioh,423*ratiow,439*ratioh,417*ratiow,427*ratioh,407*ratiow,409*ratioh,402*ratiow,393*ratioh,403*ratiow,371*ratioh,413*ratiow,349*ratioh,421*ratiow,341*ratioh,427*ratiow,338*ratioh,431*ratiow,338*ratioh,436*ratiow,340*ratioh,439*ratiow,344*ratioh,440*ratiow,351*ratioh,441*ratiow,366*ratioh,444*ratiow,382*ratioh,448*ratiow,392*ratioh,453*ratiow,401*ratioh,460*ratiow,413*ratioh,461*ratiow,404*ratioh,464*ratiow,396*ratioh,465*ratiow,386*ratioh,465*ratiow,369*ratioh,468*ratiow,348*ratioh,467*ratiow,322*ratioh,464*ratiow,306*ratioh,458*ratiow,293*ratioh,452*ratiow,284*ratioh,446*ratiow,277*ratioh,441*ratiow,271*ratioh,431*ratiow,267*ratioh,417*ratiow,265*ratioh,390*ratiow,265*ratioh,370*ratiow,269*ratioh,352*ratiow,275*ratioh,322*ratiow,290*ratioh,298*ratiow,307*ratioh,278*ratiow,324*ratioh,261*ratiow,341*ratioh,248*ratiow,357*ratioh,232*ratiow,381*ratioh,215*ratiow,408*ratioh,205*ratiow,432*ratioh,198*ratiow,454*ratioh,192*ratiow,474*ratioh,188*ratiow,493*ratioh,185*ratiow,514*ratioh,184*ratiow,537*ratioh,184*ratiow,567*ratioh,186*ratiow,586*ratioh,190*ratiow,599*ratioh,194*ratiow,612*ratioh,197*ratiow,622*ratioh,205*ratiow,640*ratioh,215*ratiow,656*ratioh,225*ratiow,669*ratioh,235*ratiow,681*ratioh,250*ratiow,693*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(250*ratiow,846*ratioh,249*ratiow,863*ratioh,236*ratiow,862*ratioh,217*ratiow,858*ratioh,195*ratiow,851*ratioh,167*ratiow,840*ratioh,151*ratiow,830*ratioh,134*ratiow,816*ratioh,112*ratiow,795*ratioh,95*ratiow,767*ratioh,77*ratiow,733*ratioh,54*ratiow,682*ratioh,77*ratiow,677*ratioh,86*ratiow,675*ratioh,82*ratiow,680*ratioh,83*ratiow,690*ratioh,93*ratiow,709*ratioh,111*ratiow,742*ratioh,124*ratiow,760*ratioh,135*ratiow,775*ratioh,152*ratiow,792*ratioh,165*ratiow,803*ratioh,187*ratiow,816*ratioh,203*ratiow,826*ratioh,226*ratiow,838*ratioh,241*ratiow,844*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(252*ratiow,820*ratioh,250*ratiow,846*ratioh,239*ratiow,843*ratioh,225*ratiow,838*ratioh,211*ratiow,831*ratioh,195*ratiow,821*ratioh,172*ratiow,807*ratioh,155*ratiow,795*ratioh,141*ratiow,781*ratioh,130*ratiow,768*ratioh,114*ratiow,746*ratioh,102*ratiow,726*ratioh,93*ratiow,709*ratioh,86*ratiow,695*ratioh,83*ratiow,687*ratioh,83*ratiow,679*ratioh,86*ratiow,674*ratioh,93*ratiow,674*ratioh,100*ratiow,682*ratioh,108*ratiow,700*ratioh,125*ratiow,727*ratioh,134*ratiow,739*ratioh,147*ratiow,756*ratioh,165*ratiow,773*ratioh,182*ratiow,789*ratioh,204*ratiow,805*ratioh,219*ratiow,813*ratioh,230*ratiow,817*ratioh,243*ratiow,820*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(252*ratiow,819*ratioh,242*ratiow,819*ratioh,232*ratiow,817*ratioh,215*ratiow,811*ratioh,200*ratiow,802*ratioh,174*ratiow,782*ratioh,158*ratiow,766*ratioh,146*ratiow,754*ratioh,132*ratiow,738*ratioh,119*ratiow,719*ratioh,105*ratiow,693*ratioh,99*ratiow,680*ratioh,94*ratiow,675*ratioh,90*ratiow,674*ratioh,111*ratiow,668*ratioh,136*ratiow,660*ratioh,149*ratiow,650*ratioh,159*ratiow,638*ratioh,165*ratiow,649*ratioh,168*ratiow,654*ratioh,174*ratiow,658*ratioh,171*ratiow,669*ratioh,167*ratiow,682*ratioh,166*ratiow,696*ratioh,169*ratiow,705*ratioh,173*ratiow,712*ratioh,182*ratiow,717*ratioh,192*ratiow,719*ratioh,214*ratiow,719*ratioh,221*ratiow,717*ratioh,228*ratiow,712*ratioh,232*ratiow,706*ratioh,239*ratiow,715*ratioh,247*ratiow,725*ratioh,257*ratiow,734*ratioh,270*ratiow,743*ratioh,280*ratiow,750*ratioh,298*ratiow,757*ratioh,295*ratiow,759*ratioh,275*ratiow,761*ratioh,264*ratiow,767*ratioh,259*ratiow,772*ratioh,257*ratiow,780*ratioh,255*ratiow,789*ratioh,253*ratiow,800*ratioh,252*ratiow,819*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(119*ratiow,197*ratioh,99*ratiow,167*ratioh,75*ratiow,128*ratioh,56*ratiow,99*ratioh,41*ratiow,76*ratioh,30*ratiow,59*ratioh,24*ratiow,66*ratioh,17*ratiow,75*ratioh,12*ratiow,83*ratioh,7*ratiow,92*ratioh,3*ratiow,102*ratioh,1*ratiow,114*ratioh,1*ratiow,167*ratioh,34*ratiow,178*ratioh,88*ratiow,194*ratioh,115*ratiow,203*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(115*ratiow,203*ratioh,70*ratiow,189*ratioh,18*ratiow,173*ratioh,1*ratiow,167*ratioh,1*ratiow,263*ratioh,3*ratiow,268*ratioh,9*ratiow,275*ratioh,3*ratiow,278*ratioh,1*ratiow,285*ratioh,1*ratiow,288*ratioh,15*ratiow,288*ratioh,27*ratiow,286*ratioh,52*ratiow,281*ratioh,68*ratiow,274*ratioh,81*ratiow,263*ratioh,93*ratiow,248*ratioh,102*ratiow,231*ratioh,109*ratiow,216*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(427*ratiow,693*ratioh,417*ratiow,699*ratioh,402*ratiow,703*ratioh,374*ratiow,699*ratioh,348*ratiow,685*ratioh,325*ratiow,670*ratioh,297*ratiow,654*ratioh,288*ratiow,648*ratioh,303*ratiow,629*ratioh,320*ratiow,602*ratioh,329*ratiow,577*ratioh,332*ratiow,549*ratioh,331*ratiow,534*ratioh,325*ratiow,505*ratioh,314*ratiow,483*ratioh,297*ratiow,461*ratioh,281*ratiow,447*ratioh,268*ratiow,441*ratioh,259*ratiow,439*ratioh,254*ratiow,439*ratioh,260*ratiow,427*ratioh,270*ratiow,409*ratioh,275*ratiow,393*ratioh,274*ratiow,371*ratioh,264*ratiow,349*ratioh,256*ratiow,341*ratioh,250*ratiow,338*ratioh,246*ratiow,338*ratioh,241*ratiow,340*ratioh,238*ratiow,344*ratioh,237*ratiow,351*ratioh,236*ratiow,366*ratioh,233*ratiow,382*ratioh,229*ratiow,392*ratioh,224*ratiow,401*ratioh,217*ratiow,413*ratioh,216*ratiow,404*ratioh,213*ratiow,396*ratioh,212*ratiow,386*ratioh,212*ratiow,369*ratioh,209*ratiow,348*ratioh,210*ratiow,322*ratioh,213*ratiow,306*ratioh,219*ratiow,293*ratioh,225*ratiow,284*ratioh,231*ratiow,277*ratioh,236*ratiow,271*ratioh,246*ratiow,267*ratioh,260*ratiow,265*ratioh,287*ratiow,265*ratioh,307*ratiow,269*ratioh,325*ratiow,275*ratioh,355*ratiow,290*ratioh,379*ratiow,307*ratioh,399*ratiow,324*ratioh,416*ratiow,341*ratioh,429*ratiow,357*ratioh,445*ratiow,381*ratioh,462*ratiow,408*ratioh,472*ratiow,432*ratioh,479*ratiow,454*ratioh,485*ratiow,474*ratioh,489*ratiow,493*ratioh,492*ratiow,514*ratioh,493*ratiow,537*ratioh,493*ratiow,567*ratioh,491*ratiow,586*ratioh,487*ratiow,599*ratioh,483*ratiow,612*ratioh,480*ratiow,622*ratioh,472*ratiow,640*ratioh,462*ratiow,656*ratioh,452*ratiow,669*ratioh,442*ratiow,681*ratioh,427*ratiow,693*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(427*ratiow,846*ratioh,428*ratiow,863*ratioh,441*ratiow,862*ratioh,460*ratiow,858*ratioh,482*ratiow,851*ratioh,510*ratiow,840*ratioh,526*ratiow,830*ratioh,543*ratiow,816*ratioh,565*ratiow,795*ratioh,582*ratiow,767*ratioh,600*ratiow,733*ratioh,623*ratiow,682*ratioh,600*ratiow,677*ratioh,591*ratiow,675*ratioh,595*ratiow,680*ratioh,594*ratiow,690*ratioh,584*ratiow,709*ratioh,566*ratiow,742*ratioh,553*ratiow,760*ratioh,542*ratiow,775*ratioh,525*ratiow,792*ratioh,512*ratiow,803*ratioh,490*ratiow,816*ratioh,474*ratiow,826*ratioh,451*ratiow,838*ratioh,436*ratiow,844*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(425*ratiow,820*ratioh,427*ratiow,846*ratioh,438*ratiow,843*ratioh,452*ratiow,838*ratioh,466*ratiow,831*ratioh,482*ratiow,821*ratioh,505*ratiow,807*ratioh,522*ratiow,795*ratioh,536*ratiow,781*ratioh,547*ratiow,768*ratioh,563*ratiow,746*ratioh,575*ratiow,726*ratioh,584*ratiow,709*ratioh,591*ratiow,695*ratioh,594*ratiow,687*ratioh,594*ratiow,679*ratioh,591*ratiow,674*ratioh,584*ratiow,674*ratioh,577*ratiow,682*ratioh,569*ratiow,700*ratioh,552*ratiow,727*ratioh,543*ratiow,739*ratioh,530*ratiow,756*ratioh,512*ratiow,773*ratioh,495*ratiow,789*ratioh,473*ratiow,805*ratioh,458*ratiow,813*ratioh,447*ratiow,817*ratioh,434*ratiow,820*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(425*ratiow,819*ratioh,435*ratiow,819*ratioh,445*ratiow,817*ratioh,462*ratiow,811*ratioh,477*ratiow,802*ratioh,503*ratiow,782*ratioh,519*ratiow,766*ratioh,531*ratiow,754*ratioh,545*ratiow,738*ratioh,558*ratiow,719*ratioh,572*ratiow,693*ratioh,578*ratiow,680*ratioh,583*ratiow,675*ratioh,587*ratiow,674*ratioh,566*ratiow,668*ratioh,541*ratiow,660*ratioh,528*ratiow,650*ratioh,518*ratiow,638*ratioh,512*ratiow,649*ratioh,509*ratiow,654*ratioh,503*ratiow,658*ratioh,506*ratiow,669*ratioh,510*ratiow,682*ratioh,511*ratiow,696*ratioh,508*ratiow,705*ratioh,504*ratiow,712*ratioh,495*ratiow,717*ratioh,485*ratiow,719*ratioh,463*ratiow,719*ratioh,456*ratiow,717*ratioh,449*ratiow,712*ratioh,445*ratiow,706*ratioh,438*ratiow,715*ratioh,430*ratiow,725*ratioh,420*ratiow,734*ratioh,407*ratiow,743*ratioh,397*ratiow,750*ratioh,379*ratiow,757*ratioh,382*ratiow,759*ratioh,402*ratiow,761*ratioh,413*ratiow,767*ratioh,418*ratiow,772*ratioh,420*ratiow,780*ratioh,422*ratiow,789*ratioh,424*ratiow,800*ratioh,425*ratiow,819*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile40(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 674;
var baseHeight = 871;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, CPu, Pir1, Pir2, Pir3, PVA";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(558*ratiow,182*ratioh,590*ratiow,116*ratioh,608*ratiow,77*ratioh,620*ratiow,54*ratioh,629*ratiow,34*ratioh,635*ratiow,39*ratioh,642*ratiow,47*ratioh,651*ratiow,57*ratioh,658*ratiow,65*ratioh,664*ratiow,75*ratioh,671*ratiow,87*ratioh,673*ratiow,96*ratioh,673*ratiow,138*ratioh,662*ratiow,143*ratioh,639*ratiow,153*ratioh,613*ratiow,164*ratioh,568*ratiow,184*ratioh,565*ratiow,185*ratioh,563*ratiow,184*ratioh,561*ratiow,183*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(565*ratiow,185*ratioh,587*ratiow,176*ratioh,614*ratiow,164*ratioh,641*ratiow,152*ratioh,673*ratiow,138*ratioh,673*ratiow,240*ratioh,672*ratiow,245*ratioh,669*ratiow,252*ratioh,665*ratiow,259*ratioh,660*ratiow,265*ratioh,665*ratiow,267*ratioh,667*ratiow,270*ratioh,669*ratiow,275*ratioh,653*ratiow,274*ratioh,637*ratiow,271*ratioh,619*ratiow,266*ratioh,611*ratiow,262*ratioh,602*ratiow,254*ratioh,597*ratiow,248*ratioh,593*ratiow,241*ratioh,588*ratiow,232*ratioh,582*ratiow,220*ratioh,577*ratiow,208*ratioh,573*ratiow,197*ratioh,570*ratiow,192*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(262*ratiow,703*ratioh,264*ratiow,704*ratioh,273*ratiow,705*ratioh,287*ratiow,702*ratioh,306*ratiow,694*ratioh,322*ratiow,685*ratioh,343*ratiow,672*ratioh,362*ratiow,657*ratioh,362*ratiow,651*ratioh,358*ratiow,639*ratioh,346*ratiow,592*ratioh,342*ratiow,574*ratioh,339*ratiow,553*ratioh,338*ratiow,533*ratioh,340*ratiow,516*ratioh,345*ratiow,494*ratioh,354*ratiow,472*ratioh,365*ratiow,455*ratioh,375*ratiow,441*ratioh,384*ratiow,433*ratioh,395*ratiow,425*ratioh,402*ratiow,422*ratioh,412*ratiow,421*ratioh,409*ratiow,410*ratioh,406*ratiow,392*ratioh,404*ratiow,375*ratioh,404*ratiow,353*ratioh,408*ratiow,339*ratioh,414*ratiow,330*ratioh,419*ratiow,327*ratioh,424*ratiow,327*ratioh,427*ratiow,331*ratioh,432*ratiow,340*ratioh,436*ratiow,351*ratioh,440*ratiow,364*ratioh,443*ratiow,379*ratioh,445*ratiow,393*ratioh,450*ratiow,408*ratioh,455*ratiow,395*ratioh,460*ratiow,379*ratioh,465*ratiow,362*ratioh,469*ratiow,339*ratioh,469*ratiow,324*ratioh,467*ratiow,313*ratioh,463*ratiow,300*ratioh,456*ratiow,286*ratioh,451*ratiow,278*ratioh,447*ratiow,270*ratioh,446*ratiow,266*ratioh,452*ratiow,260*ratioh,460*ratiow,254*ratioh,472*ratiow,249*ratioh,468*ratiow,249*ratioh,457*ratiow,251*ratioh,444*ratiow,257*ratioh,429*ratiow,263*ratioh,396*ratiow,263*ratioh,375*ratiow,267*ratioh,357*ratiow,273*ratioh,341*ratiow,281*ratioh,326*ratiow,291*ratioh,315*ratiow,300*ratioh,282*ratiow,329*ratioh,260*ratiow,353*ratioh,240*ratiow,378*ratioh,233*ratiow,388*ratioh,223*ratiow,403*ratioh,215*ratiow,417*ratioh,206*ratiow,436*ratioh,199*ratiow,452*ratioh,193*ratiow,474*ratioh,188*ratiow,497*ratioh,187*ratiow,520*ratioh,187*ratiow,547*ratioh,189*ratiow,567*ratioh,191*ratiow,579*ratioh,194*ratiow,592*ratioh,203*ratiow,618*ratioh,210*ratiow,633*ratioh,218*ratiow,647*ratioh,226*ratiow,661*ratioh,238*ratiow,684*ratioh,247*ratiow,694*ratioh,255*ratiow,701*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(248*ratiow,847*ratioh,246*ratiow,862*ratioh,221*ratiow,857*ratioh,202*ratiow,853*ratioh,178*ratiow,841*ratioh,154*ratiow,824*ratioh,138*ratiow,809*ratioh,126*ratiow,799*ratioh,118*ratiow,792*ratioh,113*ratiow,790*ratioh,100*ratiow,774*ratioh,84*ratiow,751*ratioh,73*ratiow,733*ratioh,65*ratiow,714*ratioh,59*ratiow,699*ratioh,73*ratiow,696*ratioh,93*ratiow,690*ratioh,93*ratiow,693*ratioh,96*ratiow,702*ratioh,102*ratiow,716*ratioh,110*ratiow,728*ratioh,120*ratiow,743*ratioh,136*ratiow,764*ratioh,150*ratiow,781*ratioh,164*ratiow,797*ratioh,175*ratiow,807*ratioh,191*ratiow,820*ratioh,202*ratiow,827*ratioh,219*ratiow,837*ratioh,233*ratiow,843*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(251*ratiow,828*ratioh,249*ratiow,846*ratioh,245*ratiow,846*ratioh,234*ratiow,843*ratioh,220*ratiow,837*ratioh,207*ratiow,830*ratioh,191*ratiow,819*ratioh,177*ratiow,809*ratioh,156*ratiow,789*ratioh,144*ratiow,772*ratioh,129*ratiow,754*ratioh,112*ratiow,732*ratioh,101*ratiow,713*ratioh,95*ratiow,700*ratioh,93*ratiow,694*ratioh,94*ratiow,689*ratioh,104*ratiow,687*ratioh,110*ratiow,690*ratioh,117*ratiow,705*ratioh,128*ratiow,726*ratioh,144*ratiow,746*ratioh,158*ratiow,761*ratioh,177*ratiow,782*ratioh,194*ratiow,796*ratioh,215*ratiow,811*ratioh,232*ratiow,822*ratioh,244*ratiow,827*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(251*ratiow,828*ratioh,237*ratiow,824*ratioh,219*ratiow,814*ratioh,201*ratiow,801*ratioh,177*ratiow,782*ratioh,162*ratiow,766*ratioh,146*ratiow,747*ratioh,133*ratiow,734*ratioh,122*ratiow,715*ratioh,114*ratiow,699*ratioh,110*ratiow,690*ratioh,104*ratiow,687*ratioh,123*ratiow,679*ratioh,145*ratiow,669*ratioh,163*ratiow,658*ratioh,174*ratiow,651*ratioh,177*ratiow,660*ratioh,180*ratiow,667*ratioh,188*ratiow,674*ratioh,186*ratiow,681*ratioh,183*ratiow,687*ratioh,182*ratiow,700*ratioh,182*ratiow,716*ratioh,189*ratiow,729*ratioh,197*ratiow,737*ratioh,206*ratiow,742*ratioh,214*ratiow,744*ratioh,222*ratiow,744*ratioh,234*ratiow,742*ratioh,241*ratiow,748*ratioh,253*ratiow,757*ratioh,265*ratiow,764*ratioh,272*ratiow,767*ratioh,284*ratiow,771*ratioh,276*ratiow,772*ratioh,270*ratiow,773*ratioh,264*ratiow,777*ratioh,258*ratiow,783*ratioh,253*ratiow,790*ratioh,253*ratiow,803*ratioh,253*ratiow,814*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(613*ratiow,504*ratioh,613*ratiow,499*ratioh,618*ratiow,493*ratioh,621*ratiow,491*ratioh,629*ratiow,491*ratioh,634*ratiow,493*ratioh,640*ratiow,497*ratioh,645*ratiow,503*ratioh,648*ratiow,507*ratioh,651*ratiow,513*ratioh,654*ratiow,520*ratioh,656*ratiow,526*ratioh,657*ratiow,535*ratioh,656*ratiow,546*ratioh,655*ratiow,554*ratioh,653*ratiow,561*ratioh,651*ratiow,551*ratioh,649*ratiow,544*ratioh,646*ratiow,535*ratioh,643*ratiow,528*ratioh,638*ratiow,522*ratioh,634*ratiow,516*ratioh,627*ratiow,511*ratioh,620*ratiow,508*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(116*ratiow,182*ratioh,84*ratiow,116*ratioh,66*ratiow,77*ratioh,54*ratiow,54*ratioh,45*ratiow,34*ratioh,39*ratiow,39*ratioh,32*ratiow,47*ratioh,23*ratiow,57*ratioh,16*ratiow,65*ratioh,10*ratiow,75*ratioh,3*ratiow,87*ratioh,1*ratiow,96*ratioh,1*ratiow,138*ratioh,12*ratiow,143*ratioh,35*ratiow,153*ratioh,61*ratiow,164*ratioh,106*ratiow,184*ratioh,109*ratiow,185*ratioh,111*ratiow,184*ratioh,113*ratiow,183*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(109*ratiow,185*ratioh,87*ratiow,176*ratioh,60*ratiow,164*ratioh,33*ratiow,152*ratioh,1*ratiow,138*ratioh,1*ratiow,240*ratioh,2*ratiow,245*ratioh,5*ratiow,252*ratioh,9*ratiow,259*ratioh,14*ratiow,265*ratioh,9*ratiow,267*ratioh,7*ratiow,270*ratioh,5*ratiow,275*ratioh,21*ratiow,274*ratioh,37*ratiow,271*ratioh,55*ratiow,266*ratioh,63*ratiow,262*ratioh,72*ratiow,254*ratioh,77*ratiow,248*ratioh,81*ratiow,241*ratioh,86*ratiow,232*ratioh,92*ratiow,220*ratioh,97*ratiow,208*ratioh,101*ratiow,197*ratioh,104*ratiow,192*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(412*ratiow,703*ratioh,410*ratiow,704*ratioh,401*ratiow,705*ratioh,387*ratiow,702*ratioh,368*ratiow,694*ratioh,352*ratiow,685*ratioh,331*ratiow,672*ratioh,312*ratiow,657*ratioh,312*ratiow,651*ratioh,316*ratiow,639*ratioh,328*ratiow,592*ratioh,332*ratiow,574*ratioh,335*ratiow,553*ratioh,336*ratiow,533*ratioh,334*ratiow,516*ratioh,329*ratiow,494*ratioh,320*ratiow,472*ratioh,309*ratiow,455*ratioh,299*ratiow,441*ratioh,290*ratiow,433*ratioh,279*ratiow,425*ratioh,272*ratiow,422*ratioh,262*ratiow,421*ratioh,265*ratiow,410*ratioh,268*ratiow,392*ratioh,270*ratiow,375*ratioh,270*ratiow,353*ratioh,266*ratiow,339*ratioh,260*ratiow,330*ratioh,255*ratiow,327*ratioh,250*ratiow,327*ratioh,247*ratiow,331*ratioh,242*ratiow,340*ratioh,238*ratiow,351*ratioh,234*ratiow,364*ratioh,231*ratiow,379*ratioh,229*ratiow,393*ratioh,224*ratiow,408*ratioh,219*ratiow,395*ratioh,214*ratiow,379*ratioh,209*ratiow,362*ratioh,205*ratiow,339*ratioh,205*ratiow,324*ratioh,207*ratiow,313*ratioh,211*ratiow,300*ratioh,218*ratiow,286*ratioh,223*ratiow,278*ratioh,227*ratiow,270*ratioh,228*ratiow,266*ratioh,222*ratiow,260*ratioh,214*ratiow,254*ratioh,202*ratiow,249*ratioh,206*ratiow,249*ratioh,217*ratiow,251*ratioh,230*ratiow,257*ratioh,245*ratiow,263*ratioh,278*ratiow,263*ratioh,299*ratiow,267*ratioh,317*ratiow,273*ratioh,333*ratiow,281*ratioh,348*ratiow,291*ratioh,359*ratiow,300*ratioh,392*ratiow,329*ratioh,414*ratiow,353*ratioh,434*ratiow,378*ratioh,441*ratiow,388*ratioh,451*ratiow,403*ratioh,459*ratiow,417*ratioh,468*ratiow,436*ratioh,475*ratiow,452*ratioh,481*ratiow,474*ratioh,486*ratiow,497*ratioh,487*ratiow,520*ratioh,487*ratiow,547*ratioh,485*ratiow,567*ratioh,483*ratiow,579*ratioh,480*ratiow,592*ratioh,471*ratiow,618*ratioh,464*ratiow,633*ratioh,456*ratiow,647*ratioh,448*ratiow,661*ratioh,436*ratiow,684*ratioh,427*ratiow,694*ratioh,419*ratiow,701*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(426*ratiow,847*ratioh,428*ratiow,862*ratioh,453*ratiow,857*ratioh,472*ratiow,853*ratioh,496*ratiow,841*ratioh,520*ratiow,824*ratioh,536*ratiow,809*ratioh,548*ratiow,799*ratioh,556*ratiow,792*ratioh,561*ratiow,790*ratioh,574*ratiow,774*ratioh,590*ratiow,751*ratioh,601*ratiow,733*ratioh,609*ratiow,714*ratioh,615*ratiow,699*ratioh,601*ratiow,696*ratioh,581*ratiow,690*ratioh,581*ratiow,693*ratioh,578*ratiow,702*ratioh,572*ratiow,716*ratioh,564*ratiow,728*ratioh,554*ratiow,743*ratioh,538*ratiow,764*ratioh,524*ratiow,781*ratioh,510*ratiow,797*ratioh,499*ratiow,807*ratioh,483*ratiow,820*ratioh,472*ratiow,827*ratioh,455*ratiow,837*ratioh,441*ratiow,843*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(423*ratiow,828*ratioh,425*ratiow,846*ratioh,429*ratiow,846*ratioh,440*ratiow,843*ratioh,454*ratiow,837*ratioh,467*ratiow,830*ratioh,483*ratiow,819*ratioh,497*ratiow,809*ratioh,518*ratiow,789*ratioh,530*ratiow,772*ratioh,545*ratiow,754*ratioh,562*ratiow,732*ratioh,573*ratiow,713*ratioh,579*ratiow,700*ratioh,581*ratiow,694*ratioh,580*ratiow,689*ratioh,570*ratiow,687*ratioh,564*ratiow,690*ratioh,557*ratiow,705*ratioh,546*ratiow,726*ratioh,530*ratiow,746*ratioh,516*ratiow,761*ratioh,497*ratiow,782*ratioh,480*ratiow,796*ratioh,459*ratiow,811*ratioh,442*ratiow,822*ratioh,430*ratiow,827*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(423*ratiow,828*ratioh,437*ratiow,824*ratioh,455*ratiow,814*ratioh,473*ratiow,801*ratioh,497*ratiow,782*ratioh,512*ratiow,766*ratioh,528*ratiow,747*ratioh,541*ratiow,734*ratioh,552*ratiow,715*ratioh,560*ratiow,699*ratioh,564*ratiow,690*ratioh,570*ratiow,687*ratioh,551*ratiow,679*ratioh,529*ratiow,669*ratioh,511*ratiow,658*ratioh,500*ratiow,651*ratioh,497*ratiow,660*ratioh,494*ratiow,667*ratioh,486*ratiow,674*ratioh,488*ratiow,681*ratioh,491*ratiow,687*ratioh,492*ratiow,700*ratioh,492*ratiow,716*ratioh,485*ratiow,729*ratioh,477*ratiow,737*ratioh,468*ratiow,742*ratioh,460*ratiow,744*ratioh,452*ratiow,744*ratioh,440*ratiow,742*ratioh,433*ratiow,748*ratioh,421*ratiow,757*ratioh,409*ratiow,764*ratioh,402*ratiow,767*ratioh,390*ratiow,771*ratioh,398*ratiow,772*ratioh,404*ratiow,773*ratioh,410*ratiow,777*ratioh,416*ratiow,783*ratioh,421*ratiow,790*ratioh,421*ratiow,803*ratioh,421*ratiow,814*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(61*ratiow,504*ratioh,61*ratiow,499*ratioh,56*ratiow,493*ratioh,53*ratiow,491*ratioh,45*ratiow,491*ratioh,40*ratiow,493*ratioh,34*ratiow,497*ratioh,29*ratiow,503*ratioh,26*ratiow,507*ratioh,23*ratiow,513*ratioh,20*ratiow,520*ratioh,18*ratiow,526*ratioh,17*ratiow,535*ratioh,18*ratiow,546*ratioh,19*ratiow,554*ratioh,21*ratiow,561*ratioh,23*ratiow,551*ratioh,25*ratiow,544*ratioh,28*ratiow,535*ratioh,31*ratiow,528*ratioh,36*ratiow,522*ratioh,40*ratiow,516*ratioh,47*ratiow,511*ratioh,54*ratiow,508*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile41(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 668;
var baseHeight = 880;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, CPu, Pir1, Pir2, Pir3, PVA";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(559*ratiow,178*ratioh,574*ratiow,146*ratioh,588*ratiow,116*ratioh,607*ratiow,77*ratioh,624*ratiow,41*ratioh,629*ratiow,30*ratioh,634*ratiow,33*ratioh,642*ratiow,41*ratioh,650*ratiow,49*ratioh,656*ratiow,57*ratioh,662*ratiow,67*ratioh,666*ratiow,78*ratioh,667*ratiow,86*ratioh,667*ratiow,144*ratioh,645*ratiow,154*ratioh,614*ratiow,166*ratioh,578*ratiow,181*ratioh,563*ratiow,187*ratioh,562*ratiow,184*ratioh,561*ratiow,181*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(562*ratiow,187*ratioh,630*ratiow,160*ratioh,667*ratiow,144*ratioh,667*ratiow,234*ratioh,665*ratiow,242*ratioh,657*ratiow,255*ratioh,656*ratiow,256*ratioh,661*ratiow,259*ratioh,664*ratiow,265*ratioh,663*ratiow,266*ratioh,631*ratiow,265*ratioh,611*ratiow,261*ratioh,599*ratiow,255*ratioh,587*ratiow,243*ratioh,579*ratiow,232*ratioh,571*ratiow,212*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(277*ratiow,703*ratioh,306*ratiow,693*ratioh,326*ratiow,684*ratioh,342*ratiow,672*ratioh,351*ratiow,661*ratioh,357*ratiow,649*ratioh,351*ratiow,638*ratioh,344*ratiow,622*ratioh,338*ratiow,607*ratioh,334*ratiow,592*ratioh,328*ratiow,571*ratioh,327*ratiow,543*ratioh,329*ratiow,519*ratioh,333*ratiow,496*ratioh,340*ratiow,479*ratioh,350*ratiow,462*ratioh,366*ratiow,443*ratioh,386*ratiow,428*ratioh,400*ratiow,420*ratioh,400*ratiow,412*ratioh,410*ratiow,396*ratioh,417*ratiow,386*ratioh,421*ratiow,377*ratioh,427*ratiow,372*ratioh,433*ratiow,371*ratioh,438*ratiow,375*ratioh,440*ratiow,366*ratioh,447*ratiow,349*ratioh,449*ratiow,334*ratioh,445*ratiow,314*ratioh,440*ratiow,298*ratioh,431*ratiow,283*ratioh,420*ratiow,272*ratioh,407*ratiow,267*ratioh,395*ratiow,266*ratioh,381*ratiow,266*ratioh,362*ratiow,271*ratioh,339*ratiow,280*ratioh,320*ratiow,291*ratioh,305*ratiow,300*ratioh,291*ratiow,311*ratioh,273*ratiow,329*ratioh,260*ratiow,343*ratioh,244*ratiow,365*ratioh,233*ratiow,384*ratioh,222*ratiow,405*ratioh,215*ratiow,424*ratioh,206*ratiow,445*ratioh,199*ratiow,467*ratioh,193*ratiow,497*ratioh,190*ratiow,528*ratioh,192*ratiow,557*ratioh,198*ratiow,593*ratioh,204*ratiow,612*ratioh,207*ratiow,620*ratioh,215*ratiow,637*ratioh,227*ratiow,656*ratioh,243*ratiow,677*ratioh,253*ratiow,688*ratioh,269*ratiow,701*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(271*ratiow,852*ratioh,272*ratiow,874*ratioh,239*ratiow,873*ratioh,214*ratiow,869*ratioh,194*ratiow,861*ratioh,176*ratiow,850*ratioh,157*ratiow,831*ratioh,139*ratiow,814*ratioh,121*ratiow,794*ratioh,101*ratiow,770*ratioh,82*ratiow,743*ratioh,73*ratiow,723*ratioh,67*ratiow,711*ratioh,66*ratiow,706*ratioh,96*ratiow,701*ratioh,104*ratiow,698*ratioh,102*ratiow,701*ratioh,102*ratiow,708*ratioh,105*ratiow,716*ratioh,110*ratiow,728*ratioh,118*ratiow,740*ratioh,128*ratiow,754*ratioh,137*ratiow,765*ratioh,155*ratiow,785*ratioh,170*ratiow,799*ratioh,183*ratiow,811*ratioh,195*ratiow,822*ratioh,206*ratiow,831*ratioh,218*ratiow,838*ratioh,234*ratiow,846*ratioh,250*ratiow,850*ratioh,258*ratiow,852*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(271*ratiow,828*ratioh,271*ratiow,851*ratioh,257*ratiow,851*ratioh,242*ratiow,848*ratioh,228*ratiow,844*ratioh,214*ratiow,836*ratioh,201*ratiow,827*ratioh,189*ratiow,817*ratioh,178*ratiow,806*ratioh,162*ratiow,792*ratioh,150*ratiow,780*ratioh,136*ratiow,764*ratioh,119*ratiow,743*ratioh,109*ratiow,728*ratioh,103*ratiow,712*ratioh,102*ratiow,705*ratioh,103*ratiow,699*ratioh,108*ratiow,698*ratioh,113*ratiow,698*ratioh,117*ratiow,703*ratioh,124*ratiow,716*ratioh,134*ratiow,732*ratioh,144*ratiow,746*ratioh,157*ratiow,760*ratioh,178*ratiow,781*ratioh,194*ratiow,795*ratioh,207*ratiow,805*ratioh,220*ratiow,817*ratioh,232*ratiow,823*ratioh,246*ratiow,829*ratioh,260*ratiow,831*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(271*ratiow,828*ratioh,264*ratiow,831*ratioh,252*ratiow,830*ratioh,234*ratiow,824*ratioh,221*ratiow,818*ratioh,202*ratiow,800*ratioh,187*ratiow,789*ratioh,175*ratiow,778*ratioh,160*ratiow,763*ratioh,146*ratiow,749*ratioh,134*ratiow,731*ratioh,125*ratiow,718*ratioh,116*ratiow,703*ratioh,114*ratiow,699*ratioh,109*ratiow,697*ratioh,134*ratiow,691*ratioh,163*ratiow,684*ratioh,181*ratiow,676*ratioh,196*ratiow,668*ratioh,201*ratiow,664*ratioh,200*ratiow,670*ratioh,198*ratiow,680*ratioh,198*ratiow,699*ratioh,202*ratiow,713*ratioh,210*ratiow,723*ratioh,217*ratiow,731*ratioh,231*ratiow,736*ratioh,240*ratiow,736*ratioh,248*ratiow,734*ratioh,250*ratiow,743*ratioh,256*ratiow,750*ratioh,266*ratiow,758*ratioh,273*ratiow,762*ratioh,283*ratiow,767*ratioh,298*ratiow,771*ratioh,307*ratiow,773*ratioh,303*ratiow,775*ratioh,296*ratiow,780*ratioh,290*ratiow,786*ratioh,283*ratiow,797*ratioh,278*ratiow,806*ratioh,274*ratiow,815*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(636*ratiow,480*ratioh,643*ratiow,484*ratioh,648*ratiow,492*ratioh,652*ratiow,502*ratioh,654*ratiow,511*ratioh,655*ratiow,521*ratioh,655*ratiow,531*ratioh,653*ratiow,542*ratioh,651*ratiow,556*ratioh,649*ratiow,566*ratioh,647*ratiow,572*ratioh,644*ratiow,575*ratioh,640*ratiow,574*ratioh,636*ratiow,568*ratioh,633*ratiow,564*ratioh,635*ratiow,554*ratioh,636*ratiow,540*ratioh,635*ratiow,525*ratioh,634*ratiow,511*ratioh,633*ratiow,502*ratioh,631*ratiow,493*ratioh,631*ratiow,485*ratioh,633*ratiow,481*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(109*ratiow,178*ratioh,94*ratiow,146*ratioh,80*ratiow,116*ratioh,61*ratiow,77*ratioh,44*ratiow,41*ratioh,39*ratiow,30*ratioh,34*ratiow,33*ratioh,26*ratiow,41*ratioh,18*ratiow,49*ratioh,12*ratiow,57*ratioh,6*ratiow,67*ratioh,2*ratiow,78*ratioh,1*ratiow,86*ratioh,1*ratiow,144*ratioh,23*ratiow,154*ratioh,54*ratiow,166*ratioh,90*ratiow,181*ratioh,105*ratiow,187*ratioh,106*ratiow,184*ratioh,107*ratiow,181*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(106*ratiow,187*ratioh,38*ratiow,160*ratioh,1*ratiow,144*ratioh,1*ratiow,234*ratioh,3*ratiow,242*ratioh,11*ratiow,255*ratioh,12*ratiow,256*ratioh,7*ratiow,259*ratioh,4*ratiow,265*ratioh,5*ratiow,266*ratioh,37*ratiow,265*ratioh,57*ratiow,261*ratioh,69*ratiow,255*ratioh,81*ratiow,243*ratioh,89*ratiow,232*ratioh,97*ratiow,212*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(391*ratiow,703*ratioh,362*ratiow,693*ratioh,342*ratiow,684*ratioh,326*ratiow,672*ratioh,317*ratiow,661*ratioh,311*ratiow,649*ratioh,317*ratiow,638*ratioh,324*ratiow,622*ratioh,330*ratiow,607*ratioh,334*ratiow,592*ratioh,340*ratiow,571*ratioh,341*ratiow,543*ratioh,339*ratiow,519*ratioh,335*ratiow,496*ratioh,328*ratiow,479*ratioh,318*ratiow,462*ratioh,302*ratiow,443*ratioh,282*ratiow,428*ratioh,268*ratiow,420*ratioh,268*ratiow,412*ratioh,258*ratiow,396*ratioh,251*ratiow,386*ratioh,247*ratiow,377*ratioh,241*ratiow,372*ratioh,235*ratiow,371*ratioh,230*ratiow,375*ratioh,228*ratiow,366*ratioh,221*ratiow,349*ratioh,219*ratiow,334*ratioh,223*ratiow,314*ratioh,228*ratiow,298*ratioh,237*ratiow,283*ratioh,248*ratiow,272*ratioh,261*ratiow,267*ratioh,273*ratiow,266*ratioh,287*ratiow,266*ratioh,306*ratiow,271*ratioh,329*ratiow,280*ratioh,348*ratiow,291*ratioh,363*ratiow,300*ratioh,377*ratiow,311*ratioh,395*ratiow,329*ratioh,408*ratiow,343*ratioh,424*ratiow,365*ratioh,435*ratiow,384*ratioh,446*ratiow,405*ratioh,453*ratiow,424*ratioh,462*ratiow,445*ratioh,469*ratiow,467*ratioh,475*ratiow,497*ratioh,478*ratiow,528*ratioh,476*ratiow,557*ratioh,470*ratiow,593*ratioh,464*ratiow,612*ratioh,461*ratiow,620*ratioh,453*ratiow,637*ratioh,441*ratiow,656*ratioh,425*ratiow,677*ratioh,415*ratiow,688*ratioh,399*ratiow,701*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(397*ratiow,852*ratioh,396*ratiow,874*ratioh,429*ratiow,873*ratioh,454*ratiow,869*ratioh,474*ratiow,861*ratioh,492*ratiow,850*ratioh,511*ratiow,831*ratioh,529*ratiow,814*ratioh,547*ratiow,794*ratioh,567*ratiow,770*ratioh,586*ratiow,743*ratioh,595*ratiow,723*ratioh,601*ratiow,711*ratioh,602*ratiow,706*ratioh,572*ratiow,701*ratioh,564*ratiow,698*ratioh,566*ratiow,701*ratioh,566*ratiow,708*ratioh,563*ratiow,716*ratioh,558*ratiow,728*ratioh,550*ratiow,740*ratioh,540*ratiow,754*ratioh,531*ratiow,765*ratioh,513*ratiow,785*ratioh,498*ratiow,799*ratioh,485*ratiow,811*ratioh,473*ratiow,822*ratioh,462*ratiow,831*ratioh,450*ratiow,838*ratioh,434*ratiow,846*ratioh,418*ratiow,850*ratioh,410*ratiow,852*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(397*ratiow,828*ratioh,397*ratiow,851*ratioh,411*ratiow,851*ratioh,426*ratiow,848*ratioh,440*ratiow,844*ratioh,454*ratiow,836*ratioh,467*ratiow,827*ratioh,479*ratiow,817*ratioh,490*ratiow,806*ratioh,506*ratiow,792*ratioh,518*ratiow,780*ratioh,532*ratiow,764*ratioh,549*ratiow,743*ratioh,559*ratiow,728*ratioh,565*ratiow,712*ratioh,566*ratiow,705*ratioh,565*ratiow,699*ratioh,560*ratiow,698*ratioh,555*ratiow,698*ratioh,551*ratiow,703*ratioh,544*ratiow,716*ratioh,534*ratiow,732*ratioh,524*ratiow,746*ratioh,511*ratiow,760*ratioh,490*ratiow,781*ratioh,474*ratiow,795*ratioh,461*ratiow,805*ratioh,448*ratiow,817*ratioh,436*ratiow,823*ratioh,422*ratiow,829*ratioh,408*ratiow,831*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(397*ratiow,828*ratioh,404*ratiow,831*ratioh,416*ratiow,830*ratioh,434*ratiow,824*ratioh,447*ratiow,818*ratioh,466*ratiow,800*ratioh,481*ratiow,789*ratioh,493*ratiow,778*ratioh,508*ratiow,763*ratioh,522*ratiow,749*ratioh,534*ratiow,731*ratioh,543*ratiow,718*ratioh,552*ratiow,703*ratioh,554*ratiow,699*ratioh,559*ratiow,697*ratioh,534*ratiow,691*ratioh,505*ratiow,684*ratioh,487*ratiow,676*ratioh,472*ratiow,668*ratioh,467*ratiow,664*ratioh,468*ratiow,670*ratioh,470*ratiow,680*ratioh,470*ratiow,699*ratioh,466*ratiow,713*ratioh,458*ratiow,723*ratioh,451*ratiow,731*ratioh,437*ratiow,736*ratioh,428*ratiow,736*ratioh,420*ratiow,734*ratioh,418*ratiow,743*ratioh,412*ratiow,750*ratioh,402*ratiow,758*ratioh,395*ratiow,762*ratioh,385*ratiow,767*ratioh,370*ratiow,771*ratioh,361*ratiow,773*ratioh,365*ratiow,775*ratioh,372*ratiow,780*ratioh,378*ratiow,786*ratioh,385*ratiow,797*ratioh,390*ratiow,806*ratioh,394*ratiow,815*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(32*ratiow,480*ratioh,25*ratiow,484*ratioh,20*ratiow,492*ratioh,16*ratiow,502*ratioh,14*ratiow,511*ratioh,13*ratiow,521*ratioh,13*ratiow,531*ratioh,15*ratiow,542*ratioh,17*ratiow,556*ratioh,19*ratiow,566*ratioh,21*ratiow,572*ratioh,24*ratiow,575*ratioh,28*ratiow,574*ratioh,32*ratiow,568*ratioh,35*ratiow,564*ratioh,33*ratiow,554*ratioh,32*ratiow,540*ratioh,33*ratiow,525*ratioh,34*ratiow,511*ratioh,35*ratiow,502*ratioh,37*ratiow,493*ratioh,37*ratiow,485*ratioh,35*ratiow,481*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile42(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 651;
var baseHeight = 866;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, CPu, Pir1, Pir2, Pir3, PVA";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(543*ratiow,181*ratioh,557*ratiow,150*ratioh,574*ratiow,112*ratioh,587*ratiow,82*ratioh,598*ratiow,57*ratioh,607*ratiow,35*ratioh,612*ratiow,38*ratioh,621*ratiow,44*ratioh,629*ratiow,50*ratioh,639*ratiow,59*ratioh,648*ratiow,70*ratioh,650*ratiow,73*ratioh,650*ratiow,137*ratioh,636*ratiow,145*ratioh,611*ratiow,158*ratioh,583*ratiow,172*ratioh,564*ratiow,182*ratioh,552*ratiow,188*ratioh,550*ratiow,186*ratioh,546*ratiow,184*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(552*ratiow,188*ratioh,580*ratiow,174*ratioh,618*ratiow,154*ratioh,650*ratiow,138*ratioh,650*ratiow,243*ratioh,648*ratiow,250*ratioh,645*ratiow,257*ratioh,642*ratiow,260*ratioh,650*ratiow,260*ratioh,650*ratiow,273*ratioh,642*ratiow,273*ratioh,631*ratiow,273*ratioh,610*ratiow,270*ratioh,596*ratiow,265*ratioh,588*ratiow,257*ratioh,579*ratiow,243*ratioh,573*ratiow,229*ratioh,568*ratiow,217*ratioh,563*ratiow,206*ratioh,559*ratiow,197*ratioh,556*ratiow,192*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(255*ratiow,694*ratioh,266*ratiow,696*ratioh,285*ratiow,694*ratioh,298*ratiow,687*ratioh,310*ratiow,670*ratioh,320*ratiow,650*ratioh,324*ratiow,634*ratioh,315*ratiow,615*ratioh,306*ratiow,593*ratioh,301*ratiow,571*ratioh,302*ratiow,549*ratioh,305*ratiow,526*ratioh,310*ratiow,504*ratioh,315*ratiow,489*ratioh,323*ratiow,470*ratioh,334*ratiow,453*ratioh,340*ratiow,442*ratioh,354*ratiow,426*ratioh,365*ratiow,415*ratioh,372*ratiow,407*ratioh,369*ratiow,397*ratioh,371*ratiow,382*ratioh,376*ratiow,373*ratioh,379*ratiow,363*ratioh,381*ratiow,352*ratioh,384*ratiow,345*ratioh,390*ratiow,342*ratioh,398*ratiow,342*ratioh,405*ratiow,344*ratioh,409*ratiow,352*ratioh,412*ratiow,366*ratioh,415*ratiow,381*ratioh,419*ratiow,394*ratioh,421*ratiow,370*ratioh,425*ratiow,352*ratioh,426*ratiow,330*ratioh,425*ratiow,313*ratioh,420*ratiow,296*ratioh,414*ratiow,284*ratioh,410*ratiow,276*ratioh,404*ratiow,270*ratioh,417*ratiow,259*ratioh,406*ratiow,259*ratioh,380*ratiow,264*ratioh,353*ratiow,270*ratioh,334*ratiow,276*ratioh,315*ratiow,284*ratioh,290*ratiow,299*ratioh,269*ratiow,322*ratioh,248*ratiow,350*ratioh,234*ratiow,371*ratioh,207*ratiow,421*ratioh,197*ratiow,443*ratioh,190*ratiow,466*ratioh,184*ratiow,494*ratioh,181*ratiow,525*ratioh,180*ratiow,560*ratioh,183*ratiow,585*ratioh,189*ratiow,605*ratioh,195*ratiow,620*ratioh,200*ratiow,633*ratioh,204*ratiow,642*ratioh,211*ratiow,653*ratioh,230*ratiow,678*ratioh,241*ratiow,688*ratioh,251*ratiow,694*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(256*ratiow,843*ratioh,257*ratiow,861*ratioh,233*ratiow,861*ratioh,215*ratiow,859*ratioh,201*ratiow,856*ratioh,165*ratiow,842*ratioh,142*ratiow,828*ratioh,125*ratiow,812*ratioh,112*ratiow,799*ratioh,105*ratiow,790*ratioh,83*ratiow,761*ratioh,70*ratiow,739*ratioh,61*ratiow,721*ratioh,57*ratiow,711*ratioh,71*ratiow,708*ratioh,85*ratiow,705*ratioh,98*ratiow,701*ratioh,96*ratiow,706*ratioh,94*ratiow,715*ratioh,96*ratiow,722*ratioh,102*ratiow,730*ratioh,109*ratiow,741*ratioh,117*ratiow,753*ratioh,129*ratiow,772*ratioh,141*ratiow,788*ratioh,152*ratiow,800*ratioh,173*ratiow,821*ratioh,189*ratiow,834*ratioh,204*ratiow,843*ratioh,221*ratiow,848*ratioh,231*ratiow,849*ratioh,247*ratiow,847*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(252*ratiow,820*ratioh,255*ratiow,832*ratioh,256*ratiow,843*ratioh,242*ratiow,848*ratioh,222*ratiow,848*ratioh,207*ratiow,844*ratioh,192*ratiow,836*ratioh,181*ratiow,827*ratioh,170*ratiow,817*ratioh,157*ratiow,806*ratioh,144*ratiow,791*ratioh,133*ratiow,777*ratioh,116*ratiow,752*ratioh,106*ratiow,737*ratioh,98*ratiow,725*ratioh,94*ratiow,718*ratioh,94*ratiow,707*ratioh,97*ratiow,701*ratioh,103*ratiow,700*ratioh,107*ratiow,704*ratioh,111*ratiow,714*ratioh,120*ratiow,730*ratioh,135*ratiow,754*ratioh,148*ratiow,772*ratioh,163*ratiow,791*ratioh,173*ratiow,800*ratioh,184*ratiow,809*ratioh,196*ratiow,817*ratioh,211*ratiow,822*ratioh,224*ratiow,825*ratioh,239*ratiow,824*ratioh,252*ratiow,820*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(254*ratiow,769*ratioh,252*ratiow,820*ratioh,236*ratiow,825*ratioh,218*ratiow,824*ratioh,196*ratiow,817*ratioh,178*ratiow,805*ratioh,159*ratiow,787*ratioh,145*ratiow,768*ratioh,132*ratiow,749*ratioh,122*ratiow,733*ratioh,106*ratiow,703*ratioh,103*ratiow,699*ratioh,130*ratiow,691*ratioh,148*ratiow,684*ratioh,180*ratiow,669*ratioh,175*ratiow,676*ratioh,172*ratiow,689*ratioh,173*ratiow,699*ratioh,179*ratiow,710*ratioh,185*ratiow,719*ratioh,196*ratiow,728*ratioh,205*ratiow,733*ratioh,211*ratiow,735*ratioh,213*ratiow,743*ratioh,220*ratiow,755*ratioh,234*ratiow,764*ratioh,246*ratiow,768*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(617*ratiow,465*ratioh,625*ratiow,469*ratioh,635*ratiow,479*ratioh,642*ratiow,488*ratioh,647*ratiow,495*ratioh,648*ratiow,505*ratioh,649*ratiow,514*ratioh,649*ratiow,528*ratioh,647*ratiow,542*ratioh,645*ratiow,557*ratioh,640*ratiow,571*ratioh,633*ratiow,582*ratioh,628*ratiow,585*ratioh,626*ratiow,584*ratioh,627*ratiow,569*ratioh,629*ratiow,554*ratioh,627*ratiow,540*ratioh,625*ratiow,530*ratioh,626*ratiow,518*ratioh,626*ratiow,508*ratioh,624*ratiow,495*ratioh,621*ratiow,481*ratioh,617*ratiow,468*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(108*ratiow,181*ratioh,94*ratiow,150*ratioh,77*ratiow,112*ratioh,64*ratiow,82*ratioh,53*ratiow,57*ratioh,44*ratiow,35*ratioh,39*ratiow,38*ratioh,30*ratiow,44*ratioh,22*ratiow,50*ratioh,12*ratiow,59*ratioh,3*ratiow,70*ratioh,1*ratiow,73*ratioh,1*ratiow,137*ratioh,15*ratiow,145*ratioh,40*ratiow,158*ratioh,68*ratiow,172*ratioh,87*ratiow,182*ratioh,99*ratiow,188*ratioh,101*ratiow,186*ratioh,105*ratiow,184*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(99*ratiow,188*ratioh,71*ratiow,174*ratioh,33*ratiow,154*ratioh,1*ratiow,138*ratioh,1*ratiow,243*ratioh,3*ratiow,250*ratioh,6*ratiow,257*ratioh,9*ratiow,260*ratioh,1*ratiow,260*ratioh,1*ratiow,273*ratioh,9*ratiow,273*ratioh,20*ratiow,273*ratioh,41*ratiow,270*ratioh,55*ratiow,265*ratioh,63*ratiow,257*ratioh,72*ratiow,243*ratioh,78*ratiow,229*ratioh,83*ratiow,217*ratioh,88*ratiow,206*ratioh,92*ratiow,197*ratioh,95*ratiow,192*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(396*ratiow,694*ratioh,385*ratiow,696*ratioh,366*ratiow,694*ratioh,353*ratiow,687*ratioh,341*ratiow,670*ratioh,331*ratiow,650*ratioh,327*ratiow,634*ratioh,336*ratiow,615*ratioh,345*ratiow,593*ratioh,350*ratiow,571*ratioh,349*ratiow,549*ratioh,346*ratiow,526*ratioh,341*ratiow,504*ratioh,336*ratiow,489*ratioh,328*ratiow,470*ratioh,317*ratiow,453*ratioh,311*ratiow,442*ratioh,297*ratiow,426*ratioh,286*ratiow,415*ratioh,279*ratiow,407*ratioh,282*ratiow,397*ratioh,280*ratiow,382*ratioh,275*ratiow,373*ratioh,272*ratiow,363*ratioh,270*ratiow,352*ratioh,267*ratiow,345*ratioh,261*ratiow,342*ratioh,253*ratiow,342*ratioh,246*ratiow,344*ratioh,242*ratiow,352*ratioh,239*ratiow,366*ratioh,236*ratiow,381*ratioh,232*ratiow,394*ratioh,230*ratiow,370*ratioh,226*ratiow,352*ratioh,225*ratiow,330*ratioh,226*ratiow,313*ratioh,231*ratiow,296*ratioh,237*ratiow,284*ratioh,241*ratiow,276*ratioh,247*ratiow,270*ratioh,234*ratiow,259*ratioh,245*ratiow,259*ratioh,271*ratiow,264*ratioh,298*ratiow,270*ratioh,317*ratiow,276*ratioh,336*ratiow,284*ratioh,361*ratiow,299*ratioh,382*ratiow,322*ratioh,403*ratiow,350*ratioh,417*ratiow,371*ratioh,444*ratiow,421*ratioh,454*ratiow,443*ratioh,461*ratiow,466*ratioh,467*ratiow,494*ratioh,470*ratiow,525*ratioh,471*ratiow,560*ratioh,468*ratiow,585*ratioh,462*ratiow,605*ratioh,456*ratiow,620*ratioh,451*ratiow,633*ratioh,447*ratiow,642*ratioh,440*ratiow,653*ratioh,421*ratiow,678*ratioh,410*ratiow,688*ratioh,400*ratiow,694*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(395*ratiow,843*ratioh,394*ratiow,861*ratioh,418*ratiow,861*ratioh,436*ratiow,859*ratioh,450*ratiow,856*ratioh,486*ratiow,842*ratioh,509*ratiow,828*ratioh,526*ratiow,812*ratioh,539*ratiow,799*ratioh,546*ratiow,790*ratioh,568*ratiow,761*ratioh,581*ratiow,739*ratioh,590*ratiow,721*ratioh,594*ratiow,711*ratioh,580*ratiow,708*ratioh,566*ratiow,705*ratioh,553*ratiow,701*ratioh,555*ratiow,706*ratioh,557*ratiow,715*ratioh,555*ratiow,722*ratioh,549*ratiow,730*ratioh,542*ratiow,741*ratioh,534*ratiow,753*ratioh,522*ratiow,772*ratioh,510*ratiow,788*ratioh,499*ratiow,800*ratioh,478*ratiow,821*ratioh,462*ratiow,834*ratioh,447*ratiow,843*ratioh,430*ratiow,848*ratioh,420*ratiow,849*ratioh,404*ratiow,847*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(399*ratiow,820*ratioh,396*ratiow,832*ratioh,395*ratiow,843*ratioh,409*ratiow,848*ratioh,429*ratiow,848*ratioh,444*ratiow,844*ratioh,459*ratiow,836*ratioh,470*ratiow,827*ratioh,481*ratiow,817*ratioh,494*ratiow,806*ratioh,507*ratiow,791*ratioh,518*ratiow,777*ratioh,535*ratiow,752*ratioh,545*ratiow,737*ratioh,553*ratiow,725*ratioh,557*ratiow,718*ratioh,557*ratiow,707*ratioh,554*ratiow,701*ratioh,548*ratiow,700*ratioh,544*ratiow,704*ratioh,540*ratiow,714*ratioh,531*ratiow,730*ratioh,516*ratiow,754*ratioh,503*ratiow,772*ratioh,488*ratiow,791*ratioh,478*ratiow,800*ratioh,467*ratiow,809*ratioh,455*ratiow,817*ratioh,440*ratiow,822*ratioh,427*ratiow,825*ratioh,412*ratiow,824*ratioh,399*ratiow,820*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(397*ratiow,769*ratioh,399*ratiow,820*ratioh,415*ratiow,825*ratioh,433*ratiow,824*ratioh,455*ratiow,817*ratioh,473*ratiow,805*ratioh,492*ratiow,787*ratioh,506*ratiow,768*ratioh,519*ratiow,749*ratioh,529*ratiow,733*ratioh,545*ratiow,703*ratioh,548*ratiow,699*ratioh,521*ratiow,691*ratioh,503*ratiow,684*ratioh,471*ratiow,669*ratioh,476*ratiow,676*ratioh,479*ratiow,689*ratioh,478*ratiow,699*ratioh,472*ratiow,710*ratioh,466*ratiow,719*ratioh,455*ratiow,728*ratioh,446*ratiow,733*ratioh,440*ratiow,735*ratioh,438*ratiow,743*ratioh,431*ratiow,755*ratioh,417*ratiow,764*ratioh,405*ratiow,768*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(34*ratiow,465*ratioh,26*ratiow,469*ratioh,16*ratiow,479*ratioh,9*ratiow,488*ratioh,4*ratiow,495*ratioh,3*ratiow,505*ratioh,2*ratiow,514*ratioh,2*ratiow,528*ratioh,4*ratiow,542*ratioh,6*ratiow,557*ratioh,11*ratiow,571*ratioh,18*ratiow,582*ratioh,23*ratiow,585*ratioh,25*ratiow,584*ratioh,24*ratiow,569*ratioh,22*ratiow,554*ratioh,24*ratiow,540*ratioh,26*ratiow,530*ratioh,25*ratiow,518*ratioh,25*ratiow,508*ratioh,27*ratiow,495*ratioh,30*ratiow,481*ratioh,34*ratiow,468*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile43(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 669;
var baseHeight = 898;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, PVA, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(558*ratiow,182*ratioh,573*ratiow,143*ratioh,587*ratiow,107*ratioh,599*ratiow,76*ratioh,610*ratiow,48*ratioh,619*ratiow,26*ratioh,623*ratiow,28*ratioh,627*ratiow,31*ratioh,631*ratiow,34*ratioh,635*ratiow,37*ratioh,639*ratiow,41*ratioh,644*ratiow,46*ratioh,649*ratiow,52*ratioh,653*ratiow,58*ratioh,657*ratiow,66*ratioh,661*ratiow,79*ratioh,664*ratiow,89*ratioh,666*ratiow,100*ratioh,668*ratiow,110*ratioh,668*ratiow,126*ratioh,659*ratiow,131*ratioh,640*ratiow,142*ratioh,624*ratiow,152*ratioh,609*ratiow,161*ratioh,595*ratiow,170*ratioh,584*ratiow,177*ratioh,569*ratiow,187*ratioh,564*ratiow,191*ratioh,562*ratiow,187*ratioh,560*ratiow,185*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(565*ratiow,189*ratioh,596*ratiow,169*ratioh,622*ratiow,153*ratioh,641*ratiow,142*ratioh,659*ratiow,131*ratioh,668*ratiow,125*ratioh,668*ratiow,225*ratioh,668*ratiow,234*ratioh,666*ratiow,243*ratioh,661*ratiow,257*ratioh,657*ratiow,260*ratioh,661*ratiow,263*ratioh,664*ratiow,268*ratioh,665*ratiow,273*ratioh,662*ratiow,274*ratioh,652*ratiow,273*ratioh,642*ratiow,272*ratioh,631*ratiow,270*ratioh,622*ratiow,269*ratioh,615*ratiow,267*ratioh,609*ratiow,265*ratioh,605*ratiow,262*ratioh,602*ratiow,260*ratioh,599*ratiow,257*ratioh,596*ratiow,252*ratioh,593*ratiow,248*ratioh,591*ratiow,244*ratioh,588*ratiow,240*ratioh,585*ratiow,234*ratioh,583*ratiow,229*ratioh,581*ratiow,225*ratioh,579*ratiow,220*ratioh,578*ratiow,216*ratioh,576*ratiow,214*ratioh,574*ratiow,211*ratioh,573*ratiow,207*ratioh,571*ratiow,204*ratioh,569*ratiow,200*ratioh,568*ratiow,197*ratioh,566*ratiow,194*ratioh,565*ratiow,191*ratioh);
data = analyze_pic(data);

//PVA 
selectWindow(name);
makePolygon(668*ratiow,483*ratioh,664*ratiow,479*ratioh,661*ratiow,476*ratioh,659*ratiow,473*ratioh,656*ratiow,471*ratioh,651*ratiow,469*ratioh,646*ratiow,469*ratioh,643*ratiow,469*ratioh,641*ratiow,470*ratioh,645*ratiow,474*ratioh,645*ratiow,477*ratioh,646*ratiow,482*ratioh,647*ratiow,488*ratioh,648*ratiow,493*ratioh,648*ratiow,496*ratioh,649*ratiow,503*ratioh,649*ratiow,507*ratioh,650*ratiow,512*ratioh,650*ratiow,516*ratioh,650*ratiow,520*ratioh,649*ratiow,525*ratioh,649*ratiow,528*ratioh,649*ratiow,532*ratioh,649*ratiow,536*ratioh,649*ratiow,539*ratioh,648*ratiow,542*ratioh,648*ratiow,544*ratioh,647*ratiow,547*ratioh,646*ratiow,550*ratioh,644*ratiow,552*ratioh,642*ratiow,555*ratioh,640*ratiow,556*ratioh,643*ratiow,557*ratioh,645*ratiow,559*ratioh,646*ratiow,561*ratioh,649*ratiow,564*ratioh,650*ratiow,566*ratioh,652*ratiow,570*ratioh,654*ratiow,574*ratioh,654*ratiow,576*ratioh,654*ratiow,578*ratioh,655*ratiow,583*ratioh,655*ratiow,585*ratioh,656*ratiow,588*ratioh,657*ratiow,592*ratioh,657*ratiow,594*ratioh,657*ratiow,596*ratioh,657*ratiow,599*ratioh,657*ratiow,602*ratioh,658*ratiow,604*ratioh,658*ratiow,608*ratioh,658*ratiow,610*ratioh,658*ratiow,611*ratioh,660*ratiow,611*ratioh,663*ratiow,609*ratioh,663*ratiow,607*ratioh,663*ratiow,603*ratioh,664*ratiow,600*ratioh,664*ratiow,597*ratioh,664*ratiow,594*ratioh,665*ratiow,591*ratioh,667*ratiow,588*ratioh,668*ratiow,586*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(396*ratiow,264*ratioh,388*ratiow,267*ratioh,380*ratiow,270*ratioh,369*ratiow,274*ratioh,360*ratiow,278*ratioh,352*ratiow,282*ratioh,342*ratiow,286*ratioh,336*ratiow,289*ratioh,327*ratiow,294*ratioh,319*ratiow,298*ratioh,313*ratiow,303*ratioh,307*ratiow,307*ratioh,299*ratiow,313*ratioh,291*ratiow,320*ratioh,285*ratiow,325*ratioh,281*ratiow,329*ratioh,275*ratiow,335*ratioh,269*ratiow,342*ratioh,264*ratiow,347*ratioh,259*ratiow,352*ratioh,255*ratiow,357*ratioh,250*ratiow,363*ratioh,246*ratiow,368*ratioh,242*ratiow,373*ratioh,236*ratiow,382*ratioh,229*ratiow,392*ratioh,223*ratiow,401*ratioh,219*ratiow,410*ratioh,214*ratiow,417*ratioh,212*ratiow,423*ratioh,208*ratiow,431*ratioh,205*ratiow,439*ratioh,202*ratiow,446*ratioh,200*ratiow,453*ratioh,197*ratiow,462*ratioh,195*ratiow,470*ratioh,193*ratiow,478*ratioh,192*ratiow,485*ratioh,191*ratiow,490*ratioh,190*ratiow,495*ratioh,189*ratiow,502*ratioh,188*ratiow,510*ratioh,187*ratiow,519*ratioh,186*ratiow,529*ratioh,185*ratiow,539*ratioh,185*ratiow,554*ratioh,185*ratiow,568*ratioh,185*ratiow,580*ratioh,185*ratiow,589*ratioh,185*ratiow,593*ratioh,186*ratiow,598*ratioh,186*ratiow,604*ratioh,187*ratiow,609*ratioh,188*ratiow,613*ratioh,190*ratiow,619*ratioh,192*ratiow,625*ratioh,194*ratiow,629*ratioh,197*ratiow,633*ratioh,199*ratiow,638*ratioh,202*ratiow,642*ratioh,204*ratiow,646*ratioh,207*ratiow,649*ratioh,210*ratiow,653*ratioh,212*ratiow,656*ratioh,216*ratiow,661*ratioh,221*ratiow,666*ratioh,226*ratiow,671*ratioh,231*ratiow,676*ratioh,233*ratiow,680*ratioh,237*ratiow,684*ratioh,239*ratiow,687*ratioh,247*ratiow,695*ratioh,249*ratiow,698*ratioh,253*ratiow,702*ratioh,256*ratiow,706*ratioh,260*ratiow,710*ratioh,264*ratiow,713*ratioh,266*ratiow,715*ratioh,272*ratiow,714*ratioh,281*ratiow,713*ratioh,287*ratiow,711*ratioh,301*ratiow,704*ratioh,307*ratiow,699*ratioh,313*ratiow,693*ratioh,318*ratiow,687*ratioh,322*ratiow,681*ratioh,326*ratiow,674*ratioh,329*ratiow,667*ratioh,333*ratiow,656*ratioh,334*ratiow,650*ratioh,334*ratiow,646*ratioh,329*ratiow,637*ratioh,324*ratiow,628*ratioh,321*ratiow,621*ratioh,317*ratiow,612*ratioh,314*ratiow,604*ratioh,311*ratiow,596*ratioh,310*ratiow,585*ratioh,310*ratiow,568*ratioh,309*ratiow,554*ratioh,309*ratiow,543*ratioh,309*ratiow,535*ratioh,310*ratiow,528*ratioh,310*ratiow,519*ratioh,312*ratiow,511*ratioh,315*ratiow,501*ratioh,318*ratiow,493*ratioh,321*ratiow,486*ratioh,323*ratiow,480*ratioh,327*ratiow,474*ratioh,331*ratiow,467*ratioh,335*ratiow,461*ratioh,339*ratiow,455*ratioh,345*ratiow,447*ratioh,351*ratiow,440*ratioh,358*ratiow,433*ratioh,366*ratiow,427*ratioh,374*ratiow,422*ratioh,377*ratiow,420*ratioh,375*ratiow,412*ratioh,373*ratiow,405*ratioh,371*ratiow,398*ratioh,369*ratiow,390*ratioh,370*ratiow,382*ratioh,373*ratiow,375*ratioh,378*ratiow,370*ratioh,382*ratiow,367*ratioh,387*ratiow,364*ratioh,393*ratiow,362*ratioh,397*ratiow,363*ratioh,401*ratiow,366*ratioh,406*ratiow,372*ratioh,409*ratiow,377*ratioh,409*ratiow,371*ratioh,412*ratiow,367*ratioh,414*ratiow,362*ratioh,416*ratiow,356*ratioh,417*ratiow,350*ratioh,418*ratiow,342*ratioh,418*ratiow,333*ratioh,418*ratiow,324*ratioh,417*ratiow,318*ratioh,416*ratiow,314*ratioh,414*ratiow,307*ratioh,411*ratiow,302*ratioh,408*ratiow,296*ratioh,405*ratiow,290*ratioh,402*ratiow,287*ratioh,397*ratiow,282*ratioh,394*ratiow,278*ratioh,393*ratiow,274*ratioh,394*ratiow,269*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(253*ratiow,871*ratioh,253*ratiow,891*ratioh,244*ratiow,891*ratioh,239*ratiow,890*ratioh,232*ratiow,889*ratioh,225*ratiow,888*ratioh,218*ratiow,886*ratioh,212*ratiow,884*ratioh,205*ratiow,881*ratioh,198*ratiow,879*ratioh,190*ratiow,876*ratioh,184*ratiow,873*ratioh,178*ratiow,871*ratioh,172*ratiow,868*ratioh,168*ratiow,864*ratioh,161*ratiow,861*ratioh,156*ratiow,857*ratioh,152*ratiow,854*ratioh,148*ratiow,851*ratioh,143*ratiow,847*ratioh,139*ratiow,844*ratioh,136*ratiow,841*ratioh,132*ratiow,837*ratioh,127*ratiow,833*ratioh,123*ratiow,828*ratioh,119*ratiow,825*ratioh,116*ratiow,821*ratioh,111*ratiow,816*ratioh,108*ratiow,811*ratioh,104*ratiow,807*ratioh,101*ratiow,803*ratioh,95*ratiow,795*ratioh,89*ratiow,787*ratioh,85*ratiow,781*ratioh,81*ratiow,775*ratioh,79*ratiow,770*ratioh,76*ratiow,764*ratioh,74*ratiow,756*ratioh,72*ratiow,746*ratioh,69*ratiow,738*ratioh,66*ratiow,732*ratioh,64*ratiow,729*ratioh,62*ratiow,726*ratioh,68*ratiow,724*ratioh,78*ratiow,721*ratioh,86*ratiow,719*ratioh,93*ratiow,717*ratioh,98*ratiow,716*ratioh,99*ratiow,718*ratioh,96*ratiow,719*ratioh,94*ratiow,722*ratioh,92*ratiow,724*ratioh,91*ratiow,727*ratioh,91*ratiow,732*ratioh,92*ratiow,737*ratioh,93*ratiow,740*ratioh,95*ratiow,744*ratioh,108*ratiow,764*ratioh,113*ratiow,772*ratioh,118*ratiow,778*ratioh,122*ratiow,784*ratioh,126*ratiow,789*ratioh,131*ratiow,796*ratioh,136*ratiow,802*ratioh,141*ratiow,807*ratioh,146*ratiow,813*ratioh,152*ratiow,818*ratioh,157*ratiow,823*ratioh,162*ratiow,828*ratioh,166*ratiow,832*ratioh,184*ratiow,846*ratioh,190*ratiow,850*ratioh,197*ratiow,854*ratioh,205*ratiow,858*ratioh,210*ratiow,860*ratioh,230*ratiow,866*ratioh,240*ratiow,868*ratioh,247*ratiow,870*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(254*ratiow,853*ratioh,254*ratiow,856*ratioh,253*ratiow,861*ratioh,253*ratiow,866*ratioh,253*ratiow,872*ratioh,247*ratiow,871*ratioh,240*ratiow,868*ratioh,232*ratiow,866*ratioh,224*ratiow,864*ratioh,216*ratiow,863*ratioh,208*ratiow,860*ratioh,200*ratiow,856*ratioh,195*ratiow,853*ratioh,189*ratiow,849*ratioh,183*ratiow,845*ratioh,177*ratiow,841*ratioh,171*ratiow,836*ratioh,165*ratiow,831*ratioh,158*ratiow,824*ratioh,153*ratiow,820*ratioh,148*ratiow,815*ratioh,143*ratiow,809*ratioh,138*ratiow,804*ratioh,123*ratiow,786*ratioh,110*ratiow,768*ratioh,102*ratiow,755*ratioh,98*ratiow,749*ratioh,95*ratiow,743*ratioh,91*ratiow,736*ratioh,91*ratiow,728*ratioh,93*ratiow,722*ratioh,97*ratiow,719*ratioh,101*ratiow,717*ratioh,107*ratiow,719*ratioh,111*ratiow,724*ratioh,115*ratiow,730*ratioh,124*ratiow,744*ratioh,132*ratiow,756*ratioh,136*ratiow,762*ratioh,154*ratiow,785*ratioh,161*ratiow,794*ratioh,165*ratiow,798*ratioh,171*ratiow,804*ratioh,176*ratiow,810*ratioh,181*ratiow,814*ratioh,196*ratiow,827*ratioh,202*ratiow,831*ratioh,209*ratiow,835*ratioh,215*ratiow,838*ratioh,220*ratiow,841*ratioh,228*ratiow,844*ratioh,241*ratiow,850*ratioh,254*ratiow,853*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(99*ratiow,717*ratioh,98*ratiow,715*ratioh,115*ratiow,710*ratioh,133*ratiow,704*ratioh,142*ratiow,700*ratioh,154*ratiow,695*ratioh,163*ratiow,691*ratioh,171*ratiow,688*ratioh,178*ratiow,684*ratioh,182*ratiow,682*ratioh,184*ratiow,685*ratioh,183*ratiow,689*ratioh,181*ratiow,694*ratioh,179*ratiow,700*ratioh,178*ratiow,704*ratioh,177*ratiow,710*ratioh,178*ratiow,717*ratioh,179*ratiow,723*ratioh,180*ratiow,727*ratioh,183*ratiow,732*ratioh,186*ratiow,737*ratioh,190*ratiow,741*ratioh,194*ratiow,744*ratioh,198*ratiow,746*ratioh,201*ratiow,747*ratioh,205*ratiow,748*ratioh,215*ratiow,749*ratioh,225*ratiow,750*ratioh,232*ratiow,749*ratioh,236*ratiow,749*ratioh,238*ratiow,749*ratioh,237*ratiow,754*ratioh,239*ratiow,759*ratioh,241*ratiow,762*ratioh,242*ratiow,765*ratioh,244*ratiow,769*ratioh,247*ratiow,772*ratioh,249*ratiow,775*ratioh,252*ratiow,779*ratioh,255*ratiow,782*ratioh,259*ratiow,786*ratioh,263*ratiow,789*ratioh,266*ratiow,791*ratioh,270*ratiow,794*ratioh,272*ratiow,795*ratioh,278*ratiow,796*ratioh,285*ratiow,798*ratioh,290*ratiow,799*ratioh,289*ratiow,802*ratioh,286*ratiow,805*ratioh,283*ratiow,810*ratioh,281*ratiow,814*ratioh,278*ratiow,820*ratioh,275*ratiow,825*ratioh,272*ratiow,829*ratioh,269*ratiow,833*ratioh,265*ratiow,837*ratioh,261*ratiow,843*ratioh,257*ratiow,847*ratioh,255*ratiow,852*ratioh,253*ratiow,853*ratioh,248*ratiow,852*ratioh,242*ratiow,850*ratioh,237*ratiow,848*ratioh,232*ratiow,846*ratioh,207*ratiow,834*ratioh,201*ratiow,830*ratioh,195*ratiow,827*ratioh,184*ratiow,817*ratioh,177*ratiow,810*ratioh,172*ratiow,806*ratioh,165*ratiow,798*ratioh,160*ratiow,792*ratioh,155*ratiow,786*ratioh,151*ratiow,781*ratioh,147*ratiow,776*ratioh,135*ratiow,761*ratioh,131*ratiow,755*ratioh,128*ratiow,751*ratioh,125*ratiow,746*ratioh,121*ratiow,740*ratioh,117*ratiow,732*ratioh,113*ratiow,727*ratioh,110*ratiow,723*ratioh,108*ratiow,721*ratioh,105*ratiow,718*ratioh,102*ratiow,717*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(111*ratiow,182*ratioh,96*ratiow,143*ratioh,82*ratiow,107*ratioh,70*ratiow,76*ratioh,59*ratiow,48*ratioh,50*ratiow,26*ratioh,46*ratiow,28*ratioh,42*ratiow,31*ratioh,38*ratiow,34*ratioh,34*ratiow,37*ratioh,30*ratiow,41*ratioh,25*ratiow,46*ratioh,20*ratiow,52*ratioh,16*ratiow,58*ratioh,12*ratiow,66*ratioh,8*ratiow,79*ratioh,5*ratiow,89*ratioh,3*ratiow,100*ratioh,1*ratiow,110*ratioh,1*ratiow,126*ratioh,10*ratiow,131*ratioh,29*ratiow,142*ratioh,45*ratiow,152*ratioh,60*ratiow,161*ratioh,74*ratiow,170*ratioh,85*ratiow,177*ratioh,100*ratiow,187*ratioh,105*ratiow,191*ratioh,107*ratiow,187*ratioh,109*ratiow,185*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(104*ratiow,189*ratioh,73*ratiow,169*ratioh,47*ratiow,153*ratioh,28*ratiow,142*ratioh,10*ratiow,131*ratioh,1*ratiow,125*ratioh,1*ratiow,225*ratioh,1*ratiow,234*ratioh,3*ratiow,243*ratioh,8*ratiow,257*ratioh,12*ratiow,260*ratioh,8*ratiow,263*ratioh,5*ratiow,268*ratioh,4*ratiow,273*ratioh,7*ratiow,274*ratioh,17*ratiow,273*ratioh,27*ratiow,272*ratioh,38*ratiow,270*ratioh,47*ratiow,269*ratioh,54*ratiow,267*ratioh,60*ratiow,265*ratioh,64*ratiow,262*ratioh,67*ratiow,260*ratioh,70*ratiow,257*ratioh,73*ratiow,252*ratioh,76*ratiow,248*ratioh,78*ratiow,244*ratioh,81*ratiow,240*ratioh,84*ratiow,234*ratioh,86*ratiow,229*ratioh,88*ratiow,225*ratioh,90*ratiow,220*ratioh,91*ratiow,216*ratioh,93*ratiow,214*ratioh,95*ratiow,211*ratioh,96*ratiow,207*ratioh,98*ratiow,204*ratioh,100*ratiow,200*ratioh,101*ratiow,197*ratioh,103*ratiow,194*ratioh,104*ratiow,191*ratioh);
data = analyze_pic(data);

//PVA 
selectWindow(name);
makePolygon(1*ratiow,483*ratioh,5*ratiow,479*ratioh,8*ratiow,476*ratioh,10*ratiow,473*ratioh,13*ratiow,471*ratioh,18*ratiow,469*ratioh,23*ratiow,469*ratioh,26*ratiow,469*ratioh,28*ratiow,470*ratioh,24*ratiow,474*ratioh,24*ratiow,477*ratioh,23*ratiow,482*ratioh,22*ratiow,488*ratioh,21*ratiow,493*ratioh,21*ratiow,496*ratioh,20*ratiow,503*ratioh,20*ratiow,507*ratioh,19*ratiow,512*ratioh,19*ratiow,516*ratioh,19*ratiow,520*ratioh,20*ratiow,525*ratioh,20*ratiow,528*ratioh,20*ratiow,532*ratioh,20*ratiow,536*ratioh,20*ratiow,539*ratioh,21*ratiow,542*ratioh,21*ratiow,544*ratioh,22*ratiow,547*ratioh,23*ratiow,550*ratioh,25*ratiow,552*ratioh,27*ratiow,555*ratioh,29*ratiow,556*ratioh,26*ratiow,557*ratioh,24*ratiow,559*ratioh,23*ratiow,561*ratioh,20*ratiow,564*ratioh,19*ratiow,566*ratioh,17*ratiow,570*ratioh,15*ratiow,574*ratioh,15*ratiow,576*ratioh,15*ratiow,578*ratioh,14*ratiow,583*ratioh,14*ratiow,585*ratioh,13*ratiow,588*ratioh,12*ratiow,592*ratioh,12*ratiow,594*ratioh,12*ratiow,596*ratioh,12*ratiow,599*ratioh,12*ratiow,602*ratioh,11*ratiow,604*ratioh,11*ratiow,608*ratioh,11*ratiow,610*ratioh,11*ratiow,611*ratioh,9*ratiow,611*ratioh,6*ratiow,609*ratioh,6*ratiow,607*ratioh,6*ratiow,603*ratioh,5*ratiow,600*ratioh,5*ratiow,597*ratioh,5*ratiow,594*ratioh,4*ratiow,591*ratioh,2*ratiow,588*ratioh,1*ratiow,586*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(273*ratiow,264*ratioh,281*ratiow,267*ratioh,289*ratiow,270*ratioh,300*ratiow,274*ratioh,309*ratiow,278*ratioh,317*ratiow,282*ratioh,327*ratiow,286*ratioh,333*ratiow,289*ratioh,342*ratiow,294*ratioh,350*ratiow,298*ratioh,356*ratiow,303*ratioh,362*ratiow,307*ratioh,370*ratiow,313*ratioh,378*ratiow,320*ratioh,384*ratiow,325*ratioh,388*ratiow,329*ratioh,394*ratiow,335*ratioh,400*ratiow,342*ratioh,405*ratiow,347*ratioh,410*ratiow,352*ratioh,414*ratiow,357*ratioh,419*ratiow,363*ratioh,423*ratiow,368*ratioh,427*ratiow,373*ratioh,433*ratiow,382*ratioh,440*ratiow,392*ratioh,446*ratiow,401*ratioh,450*ratiow,410*ratioh,455*ratiow,417*ratioh,457*ratiow,423*ratioh,461*ratiow,431*ratioh,464*ratiow,439*ratioh,467*ratiow,446*ratioh,469*ratiow,453*ratioh,472*ratiow,462*ratioh,474*ratiow,470*ratioh,476*ratiow,478*ratioh,477*ratiow,485*ratioh,478*ratiow,490*ratioh,479*ratiow,495*ratioh,480*ratiow,502*ratioh,481*ratiow,510*ratioh,482*ratiow,519*ratioh,483*ratiow,529*ratioh,484*ratiow,539*ratioh,484*ratiow,554*ratioh,484*ratiow,568*ratioh,484*ratiow,580*ratioh,484*ratiow,589*ratioh,484*ratiow,593*ratioh,483*ratiow,598*ratioh,483*ratiow,604*ratioh,482*ratiow,609*ratioh,481*ratiow,613*ratioh,479*ratiow,619*ratioh,477*ratiow,625*ratioh,475*ratiow,629*ratioh,472*ratiow,633*ratioh,470*ratiow,638*ratioh,467*ratiow,642*ratioh,465*ratiow,646*ratioh,462*ratiow,649*ratioh,459*ratiow,653*ratioh,457*ratiow,656*ratioh,453*ratiow,661*ratioh,448*ratiow,666*ratioh,443*ratiow,671*ratioh,438*ratiow,676*ratioh,436*ratiow,680*ratioh,432*ratiow,684*ratioh,430*ratiow,687*ratioh,422*ratiow,695*ratioh,420*ratiow,698*ratioh,416*ratiow,702*ratioh,413*ratiow,706*ratioh,409*ratiow,710*ratioh,405*ratiow,713*ratioh,403*ratiow,715*ratioh,397*ratiow,714*ratioh,388*ratiow,713*ratioh,382*ratiow,711*ratioh,368*ratiow,704*ratioh,362*ratiow,699*ratioh,356*ratiow,693*ratioh,351*ratiow,687*ratioh,347*ratiow,681*ratioh,343*ratiow,674*ratioh,340*ratiow,667*ratioh,336*ratiow,656*ratioh,335*ratiow,650*ratioh,335*ratiow,646*ratioh,340*ratiow,637*ratioh,345*ratiow,628*ratioh,348*ratiow,621*ratioh,352*ratiow,612*ratioh,355*ratiow,604*ratioh,358*ratiow,596*ratioh,359*ratiow,585*ratioh,359*ratiow,568*ratioh,360*ratiow,554*ratioh,360*ratiow,543*ratioh,360*ratiow,535*ratioh,359*ratiow,528*ratioh,359*ratiow,519*ratioh,357*ratiow,511*ratioh,354*ratiow,501*ratioh,351*ratiow,493*ratioh,348*ratiow,486*ratioh,346*ratiow,480*ratioh,342*ratiow,474*ratioh,338*ratiow,467*ratioh,334*ratiow,461*ratioh,330*ratiow,455*ratioh,324*ratiow,447*ratioh,318*ratiow,440*ratioh,311*ratiow,433*ratioh,303*ratiow,427*ratioh,295*ratiow,422*ratioh,292*ratiow,420*ratioh,294*ratiow,412*ratioh,296*ratiow,405*ratioh,298*ratiow,398*ratioh,300*ratiow,390*ratioh,299*ratiow,382*ratioh,296*ratiow,375*ratioh,291*ratiow,370*ratioh,287*ratiow,367*ratioh,282*ratiow,364*ratioh,276*ratiow,362*ratioh,272*ratiow,363*ratioh,268*ratiow,366*ratioh,263*ratiow,372*ratioh,260*ratiow,377*ratioh,260*ratiow,371*ratioh,257*ratiow,367*ratioh,255*ratiow,362*ratioh,253*ratiow,356*ratioh,252*ratiow,350*ratioh,251*ratiow,342*ratioh,251*ratiow,333*ratioh,251*ratiow,324*ratioh,252*ratiow,318*ratioh,253*ratiow,314*ratioh,255*ratiow,307*ratioh,258*ratiow,302*ratioh,261*ratiow,296*ratioh,264*ratiow,290*ratioh,267*ratiow,287*ratioh,272*ratiow,282*ratioh,275*ratiow,278*ratioh,276*ratiow,274*ratioh,275*ratiow,269*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(416*ratiow,871*ratioh,416*ratiow,891*ratioh,425*ratiow,891*ratioh,430*ratiow,890*ratioh,437*ratiow,889*ratioh,444*ratiow,888*ratioh,451*ratiow,886*ratioh,457*ratiow,884*ratioh,464*ratiow,881*ratioh,471*ratiow,879*ratioh,479*ratiow,876*ratioh,485*ratiow,873*ratioh,491*ratiow,871*ratioh,497*ratiow,868*ratioh,501*ratiow,864*ratioh,508*ratiow,861*ratioh,513*ratiow,857*ratioh,517*ratiow,854*ratioh,521*ratiow,851*ratioh,526*ratiow,847*ratioh,530*ratiow,844*ratioh,533*ratiow,841*ratioh,537*ratiow,837*ratioh,542*ratiow,833*ratioh,546*ratiow,828*ratioh,550*ratiow,825*ratioh,553*ratiow,821*ratioh,558*ratiow,816*ratioh,561*ratiow,811*ratioh,565*ratiow,807*ratioh,568*ratiow,803*ratioh,574*ratiow,795*ratioh,580*ratiow,787*ratioh,584*ratiow,781*ratioh,588*ratiow,775*ratioh,590*ratiow,770*ratioh,593*ratiow,764*ratioh,595*ratiow,756*ratioh,597*ratiow,746*ratioh,600*ratiow,738*ratioh,603*ratiow,732*ratioh,605*ratiow,729*ratioh,607*ratiow,726*ratioh,601*ratiow,724*ratioh,591*ratiow,721*ratioh,583*ratiow,719*ratioh,576*ratiow,717*ratioh,571*ratiow,716*ratioh,570*ratiow,718*ratioh,573*ratiow,719*ratioh,575*ratiow,722*ratioh,577*ratiow,724*ratioh,578*ratiow,727*ratioh,578*ratiow,732*ratioh,577*ratiow,737*ratioh,576*ratiow,740*ratioh,574*ratiow,744*ratioh,561*ratiow,764*ratioh,556*ratiow,772*ratioh,551*ratiow,778*ratioh,547*ratiow,784*ratioh,543*ratiow,789*ratioh,538*ratiow,796*ratioh,533*ratiow,802*ratioh,528*ratiow,807*ratioh,523*ratiow,813*ratioh,517*ratiow,818*ratioh,512*ratiow,823*ratioh,507*ratiow,828*ratioh,503*ratiow,832*ratioh,485*ratiow,846*ratioh,479*ratiow,850*ratioh,472*ratiow,854*ratioh,464*ratiow,858*ratioh,459*ratiow,860*ratioh,439*ratiow,866*ratioh,429*ratiow,868*ratioh,422*ratiow,870*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(415*ratiow,853*ratioh,415*ratiow,856*ratioh,416*ratiow,861*ratioh,416*ratiow,866*ratioh,416*ratiow,872*ratioh,422*ratiow,871*ratioh,429*ratiow,868*ratioh,437*ratiow,866*ratioh,445*ratiow,864*ratioh,453*ratiow,863*ratioh,461*ratiow,860*ratioh,469*ratiow,856*ratioh,474*ratiow,853*ratioh,480*ratiow,849*ratioh,486*ratiow,845*ratioh,492*ratiow,841*ratioh,498*ratiow,836*ratioh,504*ratiow,831*ratioh,511*ratiow,824*ratioh,516*ratiow,820*ratioh,521*ratiow,815*ratioh,526*ratiow,809*ratioh,531*ratiow,804*ratioh,546*ratiow,786*ratioh,559*ratiow,768*ratioh,567*ratiow,755*ratioh,571*ratiow,749*ratioh,574*ratiow,743*ratioh,578*ratiow,736*ratioh,578*ratiow,728*ratioh,576*ratiow,722*ratioh,572*ratiow,719*ratioh,568*ratiow,717*ratioh,562*ratiow,719*ratioh,558*ratiow,724*ratioh,554*ratiow,730*ratioh,545*ratiow,744*ratioh,537*ratiow,756*ratioh,533*ratiow,762*ratioh,515*ratiow,785*ratioh,508*ratiow,794*ratioh,504*ratiow,798*ratioh,498*ratiow,804*ratioh,493*ratiow,810*ratioh,488*ratiow,814*ratioh,473*ratiow,827*ratioh,467*ratiow,831*ratioh,460*ratiow,835*ratioh,454*ratiow,838*ratioh,449*ratiow,841*ratioh,441*ratiow,844*ratioh,428*ratiow,850*ratioh,415*ratiow,853*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(570*ratiow,717*ratioh,571*ratiow,715*ratioh,554*ratiow,710*ratioh,536*ratiow,704*ratioh,527*ratiow,700*ratioh,515*ratiow,695*ratioh,506*ratiow,691*ratioh,498*ratiow,688*ratioh,491*ratiow,684*ratioh,487*ratiow,682*ratioh,485*ratiow,685*ratioh,486*ratiow,689*ratioh,488*ratiow,694*ratioh,490*ratiow,700*ratioh,491*ratiow,704*ratioh,492*ratiow,710*ratioh,491*ratiow,717*ratioh,490*ratiow,723*ratioh,489*ratiow,727*ratioh,486*ratiow,732*ratioh,483*ratiow,737*ratioh,479*ratiow,741*ratioh,475*ratiow,744*ratioh,471*ratiow,746*ratioh,468*ratiow,747*ratioh,464*ratiow,748*ratioh,454*ratiow,749*ratioh,444*ratiow,750*ratioh,437*ratiow,749*ratioh,433*ratiow,749*ratioh,431*ratiow,749*ratioh,432*ratiow,754*ratioh,430*ratiow,759*ratioh,428*ratiow,762*ratioh,427*ratiow,765*ratioh,425*ratiow,769*ratioh,422*ratiow,772*ratioh,420*ratiow,775*ratioh,417*ratiow,779*ratioh,414*ratiow,782*ratioh,410*ratiow,786*ratioh,406*ratiow,789*ratioh,403*ratiow,791*ratioh,399*ratiow,794*ratioh,397*ratiow,795*ratioh,391*ratiow,796*ratioh,384*ratiow,798*ratioh,379*ratiow,799*ratioh,380*ratiow,802*ratioh,383*ratiow,805*ratioh,386*ratiow,810*ratioh,388*ratiow,814*ratioh,391*ratiow,820*ratioh,394*ratiow,825*ratioh,397*ratiow,829*ratioh,400*ratiow,833*ratioh,404*ratiow,837*ratioh,408*ratiow,843*ratioh,412*ratiow,847*ratioh,414*ratiow,852*ratioh,416*ratiow,853*ratioh,421*ratiow,852*ratioh,427*ratiow,850*ratioh,432*ratiow,848*ratioh,437*ratiow,846*ratioh,462*ratiow,834*ratioh,468*ratiow,830*ratioh,474*ratiow,827*ratioh,485*ratiow,817*ratioh,492*ratiow,810*ratioh,497*ratiow,806*ratioh,504*ratiow,798*ratioh,509*ratiow,792*ratioh,514*ratiow,786*ratioh,518*ratiow,781*ratioh,522*ratiow,776*ratioh,534*ratiow,761*ratioh,538*ratiow,755*ratioh,541*ratiow,751*ratioh,544*ratiow,746*ratioh,548*ratiow,740*ratioh,552*ratiow,732*ratioh,556*ratiow,727*ratioh,559*ratiow,723*ratioh,561*ratiow,721*ratioh,564*ratiow,718*ratioh,567*ratiow,717*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile44(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 656;
var baseHeight = 892;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, CPu, Pir1, Pir2, Pir3, PVA";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(535*ratiow,187*ratioh,550*ratiow,160*ratioh,568*ratiow,122*ratioh,589*ratiow,83*ratioh,606*ratiow,49*ratioh,617*ratiow,29*ratioh,627*ratiow,37*ratioh,635*ratiow,46*ratioh,644*ratiow,60*ratioh,649*ratiow,76*ratioh,653*ratiow,90*ratioh,655*ratiow,102*ratioh,655*ratiow,133*ratioh,623*ratiow,150*ratioh,585*ratiow,171*ratioh,553*ratiow,187*ratioh,543*ratiow,192*ratioh,540*ratiow,190*ratioh,537*ratiow,189*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(543*ratiow,191*ratioh,606*ratiow,159*ratioh,651*ratiow,135*ratioh,655*ratiow,132*ratioh,655*ratiow,283*ratioh,647*ratiow,282*ratioh,634*ratiow,280*ratioh,624*ratiow,278*ratioh,609*ratiow,272*ratioh,598*ratiow,266*ratioh,590*ratiow,258*ratioh,581*ratiow,247*ratioh,570*ratiow,230*ratioh,564*ratiow,218*ratioh,558*ratiow,207*ratioh,552*ratiow,200*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(254*ratiow,751*ratioh,255*ratiow,741*ratioh,266*ratiow,731*ratioh,284*ratiow,721*ratioh,300*ratiow,708*ratioh,312*ratiow,697*ratioh,320*ratiow,685*ratioh,324*ratiow,676*ratioh,325*ratiow,662*ratioh,310*ratiow,646*ratioh,302*ratiow,632*ratioh,294*ratiow,613*ratioh,290*ratiow,593*ratioh,289*ratiow,578*ratioh,289*ratiow,562*ratioh,292*ratiow,542*ratioh,297*ratiow,524*ratioh,306*ratiow,499*ratioh,316*ratiow,478*ratioh,329*ratiow,457*ratioh,342*ratiow,438*ratioh,350*ratiow,427*ratioh,353*ratiow,421*ratioh,351*ratiow,412*ratioh,346*ratiow,389*ratioh,347*ratiow,378*ratioh,352*ratiow,365*ratioh,362*ratiow,352*ratioh,371*ratiow,346*ratioh,377*ratiow,345*ratioh,385*ratiow,347*ratioh,393*ratiow,353*ratioh,396*ratiow,358*ratioh,396*ratiow,372*ratioh,401*ratiow,353*ratioh,403*ratiow,342*ratioh,404*ratiow,321*ratioh,403*ratiow,309*ratioh,400*ratiow,298*ratioh,398*ratiow,295*ratioh,393*ratiow,288*ratioh,389*ratiow,284*ratioh,386*ratiow,281*ratioh,407*ratiow,265*ratioh,401*ratiow,265*ratioh,386*ratiow,269*ratioh,365*ratiow,275*ratioh,332*ratiow,289*ratioh,312*ratiow,300*ratioh,292*ratiow,311*ratioh,267*ratiow,331*ratioh,247*ratiow,354*ratioh,235*ratiow,370*ratioh,213*ratiow,402*ratioh,197*ratiow,435*ratioh,188*ratiow,459*ratioh,181*ratiow,480*ratioh,176*ratiow,507*ratioh,173*ratiow,530*ratioh,172*ratiow,558*ratioh,173*ratiow,587*ratioh,176*ratiow,602*ratioh,181*ratiow,615*ratioh,188*ratiow,628*ratioh,198*ratiow,646*ratioh,209*ratiow,663*ratioh,217*ratiow,677*ratioh,225*ratiow,696*ratioh,234*ratiow,720*ratioh,243*ratiow,737*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(220*ratiow,861*ratioh,211*ratiow,881*ratioh,198*ratiow,878*ratioh,184*ratiow,874*ratioh,169*ratiow,871*ratioh,155*ratiow,863*ratioh,133*ratiow,847*ratioh,116*ratiow,830*ratioh,96*ratiow,808*ratioh,80*ratiow,786*ratioh,68*ratiow,767*ratioh,51*ratiow,741*ratioh,43*ratiow,720*ratioh,40*ratiow,708*ratioh,56*ratiow,706*ratioh,76*ratiow,703*ratioh,74*ratiow,706*ratioh,76*ratiow,715*ratioh,80*ratiow,726*ratioh,86*ratiow,738*ratioh,102*ratiow,765*ratioh,123*ratiow,792*ratioh,134*ratiow,807*ratioh,147*ratiow,820*ratioh,159*ratiow,830*ratioh,176*ratiow,844*ratioh,191*ratiow,853*ratioh,204*ratiow,858*ratioh,214*ratiow,860*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(222*ratiow,845*ratioh,221*ratiow,862*ratioh,207*ratiow,859*ratioh,189*ratiow,852*ratioh,169*ratiow,839*ratioh,157*ratiow,829*ratioh,127*ratiow,798*ratioh,109*ratiow,774*ratioh,82*ratiow,732*ratioh,76*ratiow,715*ratioh,74*ratiow,703*ratioh,84*ratiow,701*ratioh,87*ratiow,709*ratioh,97*ratiow,725*ratioh,107*ratiow,743*ratioh,120*ratiow,759*ratioh,145*ratiow,791*ratioh,161*ratiow,812*ratioh,172*ratiow,824*ratioh,194*ratiow,836*ratioh,210*ratiow,842*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(222*ratiow,845*ratioh,206*ratiow,841*ratioh,188*ratiow,834*ratioh,172*ratiow,823*ratioh,156*ratiow,806*ratioh,141*ratiow,786*ratioh,127*ratiow,769*ratioh,107*ratiow,743*ratioh,97*ratiow,725*ratioh,88*ratiow,710*ratioh,83*ratiow,701*ratioh,110*ratiow,695*ratioh,129*ratiow,690*ratioh,163*ratiow,678*ratioh,176*ratiow,673*ratioh,180*ratiow,674*ratioh,177*ratiow,678*ratioh,174*ratiow,685*ratioh,169*ratiow,696*ratioh,166*ratiow,712*ratioh,164*ratiow,725*ratioh,169*ratiow,741*ratioh,174*ratiow,749*ratioh,184*ratiow,758*ratioh,196*ratiow,764*ratioh,203*ratiow,765*ratioh,211*ratiow,762*ratioh,220*ratiow,752*ratioh,221*ratiow,750*ratioh,225*ratiow,758*ratioh,229*ratiow,764*ratioh,239*ratiow,772*ratioh,248*ratiow,777*ratioh,237*ratiow,780*ratioh,227*ratiow,788*ratioh,221*ratiow,795*ratioh,222*ratiow,845*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(655*ratiow,563*ratioh,643*ratiow,564*ratioh,644*ratiow,569*ratioh,646*ratiow,574*ratioh,648*ratiow,585*ratioh,649*ratiow,598*ratioh,649*ratiow,613*ratioh,649*ratiow,619*ratioh,655*ratiow,618*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(121*ratiow,187*ratioh,106*ratiow,160*ratioh,88*ratiow,122*ratioh,67*ratiow,83*ratioh,50*ratiow,49*ratioh,39*ratiow,29*ratioh,29*ratiow,37*ratioh,21*ratiow,46*ratioh,12*ratiow,60*ratioh,7*ratiow,76*ratioh,3*ratiow,90*ratioh,1*ratiow,102*ratioh,1*ratiow,133*ratioh,33*ratiow,150*ratioh,71*ratiow,171*ratioh,103*ratiow,187*ratioh,113*ratiow,192*ratioh,116*ratiow,190*ratioh,119*ratiow,189*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(113*ratiow,191*ratioh,50*ratiow,159*ratioh,5*ratiow,135*ratioh,1*ratiow,132*ratioh,1*ratiow,283*ratioh,9*ratiow,282*ratioh,22*ratiow,280*ratioh,32*ratiow,278*ratioh,47*ratiow,272*ratioh,58*ratiow,266*ratioh,66*ratiow,258*ratioh,75*ratiow,247*ratioh,86*ratiow,230*ratioh,92*ratiow,218*ratioh,98*ratiow,207*ratioh,104*ratiow,200*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(402*ratiow,751*ratioh,401*ratiow,741*ratioh,390*ratiow,731*ratioh,372*ratiow,721*ratioh,356*ratiow,708*ratioh,344*ratiow,697*ratioh,336*ratiow,685*ratioh,332*ratiow,676*ratioh,331*ratiow,662*ratioh,346*ratiow,646*ratioh,354*ratiow,632*ratioh,362*ratiow,613*ratioh,366*ratiow,593*ratioh,367*ratiow,578*ratioh,367*ratiow,562*ratioh,364*ratiow,542*ratioh,359*ratiow,524*ratioh,350*ratiow,499*ratioh,340*ratiow,478*ratioh,327*ratiow,457*ratioh,314*ratiow,438*ratioh,306*ratiow,427*ratioh,303*ratiow,421*ratioh,305*ratiow,412*ratioh,310*ratiow,389*ratioh,309*ratiow,378*ratioh,304*ratiow,365*ratioh,294*ratiow,352*ratioh,285*ratiow,346*ratioh,279*ratiow,345*ratioh,271*ratiow,347*ratioh,263*ratiow,353*ratioh,260*ratiow,358*ratioh,260*ratiow,372*ratioh,255*ratiow,353*ratioh,253*ratiow,342*ratioh,252*ratiow,321*ratioh,253*ratiow,309*ratioh,256*ratiow,298*ratioh,258*ratiow,295*ratioh,263*ratiow,288*ratioh,267*ratiow,284*ratioh,270*ratiow,281*ratioh,249*ratiow,265*ratioh,255*ratiow,265*ratioh,270*ratiow,269*ratioh,291*ratiow,275*ratioh,324*ratiow,289*ratioh,344*ratiow,300*ratioh,364*ratiow,311*ratioh,389*ratiow,331*ratioh,409*ratiow,354*ratioh,421*ratiow,370*ratioh,443*ratiow,402*ratioh,459*ratiow,435*ratioh,468*ratiow,459*ratioh,475*ratiow,480*ratioh,480*ratiow,507*ratioh,483*ratiow,530*ratioh,484*ratiow,558*ratioh,483*ratiow,587*ratioh,480*ratiow,602*ratioh,475*ratiow,615*ratioh,468*ratiow,628*ratioh,458*ratiow,646*ratioh,447*ratiow,663*ratioh,439*ratiow,677*ratioh,431*ratiow,696*ratioh,422*ratiow,720*ratioh,413*ratiow,737*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(436*ratiow,861*ratioh,445*ratiow,881*ratioh,458*ratiow,878*ratioh,472*ratiow,874*ratioh,487*ratiow,871*ratioh,501*ratiow,863*ratioh,523*ratiow,847*ratioh,540*ratiow,830*ratioh,560*ratiow,808*ratioh,576*ratiow,786*ratioh,588*ratiow,767*ratioh,605*ratiow,741*ratioh,613*ratiow,720*ratioh,616*ratiow,708*ratioh,600*ratiow,706*ratioh,580*ratiow,703*ratioh,582*ratiow,706*ratioh,580*ratiow,715*ratioh,576*ratiow,726*ratioh,570*ratiow,738*ratioh,554*ratiow,765*ratioh,533*ratiow,792*ratioh,522*ratiow,807*ratioh,509*ratiow,820*ratioh,497*ratiow,830*ratioh,480*ratiow,844*ratioh,465*ratiow,853*ratioh,452*ratiow,858*ratioh,442*ratiow,860*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(434*ratiow,845*ratioh,435*ratiow,862*ratioh,449*ratiow,859*ratioh,467*ratiow,852*ratioh,487*ratiow,839*ratioh,499*ratiow,829*ratioh,529*ratiow,798*ratioh,547*ratiow,774*ratioh,574*ratiow,732*ratioh,580*ratiow,715*ratioh,582*ratiow,703*ratioh,572*ratiow,701*ratioh,569*ratiow,709*ratioh,559*ratiow,725*ratioh,549*ratiow,743*ratioh,536*ratiow,759*ratioh,511*ratiow,791*ratioh,495*ratiow,812*ratioh,484*ratiow,824*ratioh,462*ratiow,836*ratioh,446*ratiow,842*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(434*ratiow,845*ratioh,450*ratiow,841*ratioh,468*ratiow,834*ratioh,484*ratiow,823*ratioh,500*ratiow,806*ratioh,515*ratiow,786*ratioh,529*ratiow,769*ratioh,549*ratiow,743*ratioh,559*ratiow,725*ratioh,568*ratiow,710*ratioh,573*ratiow,701*ratioh,546*ratiow,695*ratioh,527*ratiow,690*ratioh,493*ratiow,678*ratioh,480*ratiow,673*ratioh,476*ratiow,674*ratioh,479*ratiow,678*ratioh,482*ratiow,685*ratioh,487*ratiow,696*ratioh,490*ratiow,712*ratioh,492*ratiow,725*ratioh,487*ratiow,741*ratioh,482*ratiow,749*ratioh,472*ratiow,758*ratioh,460*ratiow,764*ratioh,453*ratiow,765*ratioh,445*ratiow,762*ratioh,436*ratiow,752*ratioh,435*ratiow,750*ratioh,431*ratiow,758*ratioh,427*ratiow,764*ratioh,417*ratiow,772*ratioh,408*ratiow,777*ratioh,419*ratiow,780*ratioh,429*ratiow,788*ratioh,435*ratiow,795*ratioh,434*ratiow,845*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(1*ratiow,563*ratioh,13*ratiow,564*ratioh,12*ratiow,569*ratioh,10*ratiow,574*ratioh,8*ratiow,585*ratioh,7*ratiow,598*ratioh,7*ratiow,613*ratioh,7*ratiow,619*ratioh,1*ratiow,618*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile45(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 655;
var baseHeight = 899;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, CPu, Pir1, Pir2, Pir3, PVA";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(548*ratiow,184*ratioh,562*ratiow,150*ratioh,582*ratiow,99*ratioh,597*ratiow,60*ratioh,609*ratiow,29*ratioh,612*ratiow,22*ratioh,622*ratiow,28*ratioh,636*ratiow,37*ratioh,646*ratiow,48*ratioh,654*ratiow,59*ratioh,654*ratiow,142*ratioh,637*ratiow,151*ratioh,612*ratiow,162*ratioh,580*ratiow,177*ratioh,557*ratiow,188*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(557*ratiow,187*ratioh,626*ratiow,156*ratioh,654*ratiow,143*ratioh,654*ratiow,258*ratioh,650*ratiow,262*ratioh,654*ratiow,267*ratioh,653*ratiow,277*ratioh,630*ratiow,276*ratioh,605*ratiow,270*ratioh,594*ratiow,263*ratioh,582*ratiow,249*ratioh,576*ratiow,237*ratioh,572*ratiow,223*ratioh,569*ratiow,209*ratioh,567*ratiow,199*ratioh,563*ratiow,193*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(239*ratiow,713*ratioh,250*ratiow,710*ratioh,269*ratiow,705*ratioh,286*ratiow,700*ratioh,302*ratiow,690*ratioh,312*ratiow,678*ratioh,320*ratiow,665*ratioh,324*ratiow,653*ratioh,323*ratiow,650*ratioh,315*ratiow,641*ratioh,306*ratiow,629*ratioh,299*ratiow,612*ratioh,295*ratiow,591*ratioh,293*ratiow,566*ratioh,296*ratiow,545*ratioh,298*ratiow,524*ratioh,306*ratiow,504*ratioh,310*ratiow,486*ratioh,315*ratiow,467*ratioh,325*ratiow,446*ratioh,336*ratiow,428*ratioh,343*ratiow,420*ratioh,339*ratiow,411*ratioh,338*ratiow,399*ratioh,343*ratiow,384*ratioh,348*ratiow,375*ratioh,359*ratiow,366*ratioh,369*ratiow,364*ratioh,379*ratiow,365*ratioh,384*ratiow,367*ratioh,384*ratiow,361*ratioh,391*ratiow,351*ratioh,393*ratiow,340*ratioh,391*ratiow,324*ratioh,386*ratiow,313*ratioh,379*ratiow,301*ratioh,373*ratiow,292*ratioh,372*ratiow,289*ratioh,372*ratiow,284*ratioh,374*ratiow,281*ratioh,363*ratiow,283*ratioh,344*ratiow,288*ratioh,328*ratiow,294*ratioh,308*ratiow,306*ratioh,281*ratiow,328*ratioh,260*ratiow,351*ratioh,244*ratiow,370*ratioh,223*ratiow,398*ratioh,210*ratiow,423*ratioh,202*ratiow,444*ratioh,188*ratiow,482*ratioh,178*ratiow,520*ratioh,173*ratiow,557*ratioh,174*ratiow,579*ratioh,177*ratiow,607*ratioh,183*ratiow,624*ratioh,190*ratiow,637*ratioh,199*ratiow,651*ratioh,219*ratiow,680*ratioh,231*ratiow,700*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(216*ratiow,878*ratioh,210*ratiow,897*ratioh,200*ratiow,897*ratioh,180*ratiow,891*ratioh,156*ratiow,876*ratioh,132*ratiow,858*ratioh,107*ratiow,838*ratioh,86*ratiow,815*ratioh,71*ratiow,794*ratioh,58*ratiow,767*ratioh,49*ratiow,750*ratioh,45*ratiow,738*ratioh,46*ratiow,726*ratioh,72*ratiow,718*ratioh,68*ratiow,721*ratioh,69*ratiow,731*ratioh,75*ratiow,744*ratioh,84*ratiow,761*ratioh,94*ratiow,777*ratioh,107*ratiow,790*ratioh,117*ratiow,801*ratioh,129*ratiow,816*ratioh,140*ratiow,830*ratioh,155*ratiow,846*ratioh,173*ratiow,861*ratioh,191*ratiow,871*ratioh,205*ratiow,876*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(220*ratiow,856*ratioh,215*ratiow,877*ratioh,209*ratiow,877*ratioh,196*ratiow,873*ratioh,177*ratiow,864*ratioh,154*ratiow,845*ratioh,138*ratiow,828*ratioh,126*ratiow,811*ratioh,109*ratiow,792*ratioh,93*ratiow,776*ratioh,82*ratiow,758*ratioh,72*ratiow,738*ratioh,68*ratiow,726*ratioh,69*ratiow,719*ratioh,74*ratiow,717*ratioh,80*ratiow,719*ratioh,90*ratiow,730*ratioh,101*ratiow,744*ratioh,119*ratiow,764*ratioh,131*ratiow,779*ratioh,141*ratiow,794*ratioh,152*ratiow,809*ratioh,166*ratiow,825*ratioh,177*ratiow,836*ratioh,194*ratiow,845*ratioh,211*ratiow,854*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(220*ratiow,856*ratioh,208*ratiow,852*ratioh,192*ratiow,844*ratioh,172*ratiow,832*ratioh,156*ratiow,814*ratioh,143*ratiow,797*ratioh,133*ratiow,781*ratioh,106*ratiow,750*ratioh,93*ratiow,734*ratioh,84*ratiow,724*ratioh,80*ratiow,719*ratioh,73*ratiow,717*ratioh,107*ratiow,706*ratioh,141*ratiow,694*ratioh,156*ratiow,689*ratioh,178*ratiow,681*ratioh,182*ratiow,684*ratioh,177*ratiow,688*ratioh,172*ratiow,699*ratioh,169*ratiow,717*ratioh,169*ratiow,735*ratioh,171*ratiow,745*ratioh,178*ratiow,754*ratioh,187*ratiow,759*ratioh,193*ratiow,760*ratioh,200*ratiow,759*ratioh,207*ratiow,756*ratioh,215*ratiow,751*ratioh,217*ratiow,759*ratioh,229*ratiow,775*ratioh,243*ratiow,786*ratioh,251*ratiow,789*ratioh,245*ratiow,796*ratioh,239*ratiow,807*ratioh,232*ratiow,822*ratioh,226*ratiow,836*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(654*ratiow,458*ratioh,649*ratiow,457*ratioh,641*ratiow,453*ratioh,636*ratiow,447*ratioh,631*ratiow,444*ratioh,628*ratiow,444*ratioh,625*ratiow,448*ratioh,626*ratiow,453*ratioh,630*ratiow,464*ratioh,632*ratiow,471*ratioh,634*ratiow,487*ratioh,636*ratiow,497*ratioh,639*ratiow,503*ratioh,642*ratiow,505*ratioh,646*ratiow,503*ratioh,654*ratiow,503*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(107*ratiow,184*ratioh,93*ratiow,150*ratioh,73*ratiow,99*ratioh,58*ratiow,60*ratioh,46*ratiow,29*ratioh,43*ratiow,22*ratioh,33*ratiow,28*ratioh,19*ratiow,37*ratioh,9*ratiow,48*ratioh,1*ratiow,59*ratioh,1*ratiow,142*ratioh,18*ratiow,151*ratioh,43*ratiow,162*ratioh,75*ratiow,177*ratioh,98*ratiow,188*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(98*ratiow,187*ratioh,29*ratiow,156*ratioh,1*ratiow,143*ratioh,1*ratiow,258*ratioh,5*ratiow,262*ratioh,1*ratiow,267*ratioh,2*ratiow,277*ratioh,25*ratiow,276*ratioh,50*ratiow,270*ratioh,61*ratiow,263*ratioh,73*ratiow,249*ratioh,79*ratiow,237*ratioh,83*ratiow,223*ratioh,86*ratiow,209*ratioh,88*ratiow,199*ratioh,92*ratiow,193*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(416*ratiow,713*ratioh,405*ratiow,710*ratioh,386*ratiow,705*ratioh,369*ratiow,700*ratioh,353*ratiow,690*ratioh,343*ratiow,678*ratioh,335*ratiow,665*ratioh,331*ratiow,653*ratioh,332*ratiow,650*ratioh,340*ratiow,641*ratioh,349*ratiow,629*ratioh,356*ratiow,612*ratioh,360*ratiow,591*ratioh,362*ratiow,566*ratioh,359*ratiow,545*ratioh,357*ratiow,524*ratioh,349*ratiow,504*ratioh,345*ratiow,486*ratioh,340*ratiow,467*ratioh,330*ratiow,446*ratioh,319*ratiow,428*ratioh,312*ratiow,420*ratioh,316*ratiow,411*ratioh,317*ratiow,399*ratioh,312*ratiow,384*ratioh,307*ratiow,375*ratioh,296*ratiow,366*ratioh,286*ratiow,364*ratioh,276*ratiow,365*ratioh,271*ratiow,367*ratioh,271*ratiow,361*ratioh,264*ratiow,351*ratioh,262*ratiow,340*ratioh,264*ratiow,324*ratioh,269*ratiow,313*ratioh,276*ratiow,301*ratioh,282*ratiow,292*ratioh,283*ratiow,289*ratioh,283*ratiow,284*ratioh,281*ratiow,281*ratioh,292*ratiow,283*ratioh,311*ratiow,288*ratioh,327*ratiow,294*ratioh,347*ratiow,306*ratioh,374*ratiow,328*ratioh,395*ratiow,351*ratioh,411*ratiow,370*ratioh,432*ratiow,398*ratioh,445*ratiow,423*ratioh,453*ratiow,444*ratioh,467*ratiow,482*ratioh,477*ratiow,520*ratioh,482*ratiow,557*ratioh,481*ratiow,579*ratioh,478*ratiow,607*ratioh,472*ratiow,624*ratioh,465*ratiow,637*ratioh,456*ratiow,651*ratioh,436*ratiow,680*ratioh,424*ratiow,700*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(439*ratiow,878*ratioh,445*ratiow,897*ratioh,455*ratiow,897*ratioh,475*ratiow,891*ratioh,499*ratiow,876*ratioh,523*ratiow,858*ratioh,548*ratiow,838*ratioh,569*ratiow,815*ratioh,584*ratiow,794*ratioh,597*ratiow,767*ratioh,606*ratiow,750*ratioh,610*ratiow,738*ratioh,609*ratiow,726*ratioh,583*ratiow,718*ratioh,587*ratiow,721*ratioh,586*ratiow,731*ratioh,580*ratiow,744*ratioh,571*ratiow,761*ratioh,561*ratiow,777*ratioh,548*ratiow,790*ratioh,538*ratiow,801*ratioh,526*ratiow,816*ratioh,515*ratiow,830*ratioh,500*ratiow,846*ratioh,482*ratiow,861*ratioh,464*ratiow,871*ratioh,450*ratiow,876*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(435*ratiow,856*ratioh,440*ratiow,877*ratioh,446*ratiow,877*ratioh,459*ratiow,873*ratioh,478*ratiow,864*ratioh,501*ratiow,845*ratioh,517*ratiow,828*ratioh,529*ratiow,811*ratioh,546*ratiow,792*ratioh,562*ratiow,776*ratioh,573*ratiow,758*ratioh,583*ratiow,738*ratioh,587*ratiow,726*ratioh,586*ratiow,719*ratioh,581*ratiow,717*ratioh,575*ratiow,719*ratioh,565*ratiow,730*ratioh,554*ratiow,744*ratioh,536*ratiow,764*ratioh,524*ratiow,779*ratioh,514*ratiow,794*ratioh,503*ratiow,809*ratioh,489*ratiow,825*ratioh,478*ratiow,836*ratioh,461*ratiow,845*ratioh,444*ratiow,854*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(435*ratiow,856*ratioh,447*ratiow,852*ratioh,463*ratiow,844*ratioh,483*ratiow,832*ratioh,499*ratiow,814*ratioh,512*ratiow,797*ratioh,522*ratiow,781*ratioh,549*ratiow,750*ratioh,562*ratiow,734*ratioh,571*ratiow,724*ratioh,575*ratiow,719*ratioh,582*ratiow,717*ratioh,548*ratiow,706*ratioh,514*ratiow,694*ratioh,499*ratiow,689*ratioh,477*ratiow,681*ratioh,473*ratiow,684*ratioh,478*ratiow,688*ratioh,483*ratiow,699*ratioh,486*ratiow,717*ratioh,486*ratiow,735*ratioh,484*ratiow,745*ratioh,477*ratiow,754*ratioh,468*ratiow,759*ratioh,462*ratiow,760*ratioh,455*ratiow,759*ratioh,448*ratiow,756*ratioh,440*ratiow,751*ratioh,438*ratiow,759*ratioh,426*ratiow,775*ratioh,412*ratiow,786*ratioh,404*ratiow,789*ratioh,410*ratiow,796*ratioh,416*ratiow,807*ratioh,423*ratiow,822*ratioh,429*ratiow,836*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(1*ratiow,458*ratioh,6*ratiow,457*ratioh,14*ratiow,453*ratioh,19*ratiow,447*ratioh,24*ratiow,444*ratioh,27*ratiow,444*ratioh,30*ratiow,448*ratioh,29*ratiow,453*ratioh,25*ratiow,464*ratioh,23*ratiow,471*ratioh,21*ratiow,487*ratioh,19*ratiow,497*ratioh,16*ratiow,503*ratioh,13*ratiow,505*ratioh,9*ratiow,503*ratioh,1*ratiow,503*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile46(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 670;
var baseHeight = 885;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Cg1, Cg2, CPu, Pir1, Pir2, Pir3, PVA";
partNames = split(parts, ", ");

if (leftSide)  {
//Cg1
selectWindow(name);
makePolygon(562*ratiow,175*ratioh,575*ratiow,130*ratioh,592*ratiow,77*ratioh,604*ratiow,37*ratioh,610*ratiow,16*ratioh,618*ratiow,18*ratioh,631*ratiow,23*ratioh,641*ratiow,29*ratioh,652*ratiow,38*ratioh,659*ratiow,47*ratioh,664*ratiow,56*ratioh,668*ratiow,70*ratioh,669*ratiow,78*ratioh,668*ratiow,146*ratioh,652*ratiow,151*ratioh,618*ratiow,164*ratioh,589*ratiow,174*ratioh,569*ratiow,181*ratioh,565*ratiow,178*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(569*ratiow,181*ratioh,614*ratiow,166*ratioh,649*ratiow,152*ratioh,669*ratiow,145*ratioh,669*ratiow,270*ratioh,652*ratiow,268*ratioh,628*ratiow,262*ratioh,617*ratiow,258*ratioh,605*ratiow,247*ratioh,592*ratiow,233*ratioh,584*ratiow,215*ratioh,579*ratiow,199*ratioh,573*ratiow,188*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(287*ratiow,724*ratioh,285*ratiow,711*ratioh,297*ratiow,694*ratioh,313*ratiow,675*ratioh,325*ratiow,671*ratioh,348*ratiow,671*ratioh,331*ratiow,654*ratioh,306*ratiow,620*ratioh,294*ratiow,590*ratioh,290*ratiow,562*ratioh,290*ratiow,535*ratioh,297*ratiow,496*ratioh,308*ratiow,464*ratioh,320*ratiow,439*ratioh,333*ratiow,416*ratioh,343*ratiow,394*ratioh,338*ratiow,367*ratioh,338*ratiow,359*ratioh,342*ratiow,351*ratioh,348*ratiow,348*ratioh,357*ratiow,348*ratioh,366*ratiow,352*ratioh,372*ratiow,360*ratioh,375*ratiow,371*ratioh,377*ratiow,363*ratioh,381*ratiow,358*ratioh,379*ratiow,356*ratioh,379*ratiow,352*ratioh,383*ratiow,349*ratioh,388*ratiow,337*ratioh,391*ratiow,320*ratioh,389*ratiow,303*ratioh,383*ratiow,287*ratioh,378*ratiow,279*ratioh,376*ratiow,275*ratioh,381*ratiow,267*ratioh,388*ratiow,261*ratioh,377*ratiow,264*ratioh,349*ratiow,275*ratioh,325*ratiow,287*ratioh,296*ratiow,307*ratioh,270*ratiow,329*ratioh,249*ratiow,353*ratioh,233*ratiow,375*ratioh,220*ratiow,397*ratioh,207*ratiow,426*ratioh,200*ratiow,453*ratioh,188*ratiow,498*ratioh,185*ratiow,527*ratioh,186*ratiow,557*ratioh,191*ratiow,586*ratioh,200*ratiow,618*ratioh,212*ratiow,642*ratioh,230*ratiow,668*ratioh,249*ratiow,689*ratioh,263*ratiow,701*ratioh,272*ratiow,707*ratioh,277*ratiow,711*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(213*ratiow,854*ratioh,212*ratiow,880*ratioh,198*ratiow,874*ratioh,178*ratiow,862*ratioh,160*ratiow,847*ratioh,137*ratiow,827*ratioh,120*ratiow,808*ratioh,103*ratiow,788*ratioh,88*ratiow,767*ratioh,64*ratiow,725*ratioh,59*ratiow,713*ratioh,90*ratiow,706*ratioh,88*ratiow,709*ratioh,91*ratiow,718*ratioh,101*ratiow,735*ratioh,121*ratiow,760*ratioh,135*ratiow,776*ratioh,149*ratiow,795*ratioh,163*ratiow,812*ratioh,178*ratiow,829*ratioh,191*ratiow,841*ratioh,203*ratiow,848*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(214*ratiow,838*ratioh,213*ratiow,854*ratioh,202*ratiow,848*ratioh,186*ratiow,837*ratioh,173*ratiow,824*ratioh,159*ratiow,808*ratioh,145*ratiow,789*ratioh,133*ratiow,775*ratioh,116*ratiow,753*ratioh,103*ratiow,737*ratioh,92*ratiow,720*ratioh,88*ratiow,712*ratioh,89*ratiow,706*ratioh,94*ratiow,704*ratioh,100*ratiow,703*ratioh,109*ratiow,715*ratioh,125*ratiow,737*ratioh,137*ratiow,754*ratioh,168*ratiow,794*ratioh,186*ratiow,812*ratioh,199*ratiow,826*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(215*ratiow,838*ratioh,205*ratiow,831*ratioh,193*ratiow,818*ratioh,173*ratiow,799*ratioh,158*ratiow,782*ratioh,144*ratiow,762*ratioh,132*ratiow,746*ratioh,113*ratiow,721*ratioh,102*ratiow,707*ratioh,98*ratiow,703*ratioh,118*ratiow,696*ratioh,140*ratiow,686*ratioh,160*ratiow,676*ratioh,174*ratiow,667*ratioh,179*ratiow,663*ratioh,178*ratiow,675*ratioh,176*ratiow,689*ratioh,177*ratiow,706*ratioh,180*ratiow,724*ratioh,187*ratiow,740*ratioh,192*ratiow,746*ratioh,199*ratiow,750*ratioh,209*ratiow,753*ratioh,218*ratiow,754*ratioh,219*ratiow,761*ratioh,226*ratiow,771*ratioh,235*ratiow,779*ratioh,243*ratiow,782*ratioh,256*ratiow,786*ratioh,270*ratiow,787*ratioh,278*ratiow,786*ratioh,279*ratiow,795*ratioh,280*ratiow,801*ratioh,275*ratiow,798*ratioh,272*ratiow,795*ratioh,264*ratiow,793*ratioh,251*ratiow,793*ratioh,238*ratiow,796*ratioh,227*ratiow,805*ratioh,222*ratiow,813*ratioh,217*ratiow,824*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(669*ratiow,442*ratioh,663*ratiow,441*ratioh,656*ratiow,437*ratioh,651*ratiow,431*ratioh,645*ratiow,427*ratioh,638*ratiow,424*ratioh,631*ratiow,423*ratioh,633*ratiow,426*ratioh,638*ratiow,431*ratioh,642*ratiow,438*ratioh,646*ratiow,446*ratioh,650*ratiow,455*ratioh,652*ratiow,469*ratioh,653*ratiow,476*ratioh,660*ratiow,482*ratioh,666*ratiow,484*ratioh,669*ratiow,484*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Cg1
selectWindow(name);
makePolygon(108*ratiow,175*ratioh,95*ratiow,130*ratioh,78*ratiow,77*ratioh,66*ratiow,37*ratioh,60*ratiow,16*ratioh,52*ratiow,18*ratioh,39*ratiow,23*ratioh,29*ratiow,29*ratioh,18*ratiow,38*ratioh,11*ratiow,47*ratioh,6*ratiow,56*ratioh,2*ratiow,70*ratioh,1*ratiow,78*ratioh,2*ratiow,146*ratioh,18*ratiow,151*ratioh,52*ratiow,164*ratioh,81*ratiow,174*ratioh,101*ratiow,181*ratioh,105*ratiow,178*ratioh);
data = analyze_pic(data);

//Cg2
selectWindow(name);
makePolygon(101*ratiow,181*ratioh,56*ratiow,166*ratioh,21*ratiow,152*ratioh,1*ratiow,145*ratioh,1*ratiow,270*ratioh,18*ratiow,268*ratioh,42*ratiow,262*ratioh,53*ratiow,258*ratioh,65*ratiow,247*ratioh,78*ratiow,233*ratioh,86*ratiow,215*ratioh,91*ratiow,199*ratioh,97*ratiow,188*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(383*ratiow,724*ratioh,385*ratiow,711*ratioh,373*ratiow,694*ratioh,357*ratiow,675*ratioh,345*ratiow,671*ratioh,322*ratiow,671*ratioh,339*ratiow,654*ratioh,364*ratiow,620*ratioh,376*ratiow,590*ratioh,380*ratiow,562*ratioh,380*ratiow,535*ratioh,373*ratiow,496*ratioh,362*ratiow,464*ratioh,350*ratiow,439*ratioh,337*ratiow,416*ratioh,327*ratiow,394*ratioh,332*ratiow,367*ratioh,332*ratiow,359*ratioh,328*ratiow,351*ratioh,322*ratiow,348*ratioh,313*ratiow,348*ratioh,304*ratiow,352*ratioh,298*ratiow,360*ratioh,295*ratiow,371*ratioh,293*ratiow,363*ratioh,289*ratiow,358*ratioh,291*ratiow,356*ratioh,291*ratiow,352*ratioh,287*ratiow,349*ratioh,282*ratiow,337*ratioh,279*ratiow,320*ratioh,281*ratiow,303*ratioh,287*ratiow,287*ratioh,292*ratiow,279*ratioh,294*ratiow,275*ratioh,289*ratiow,267*ratioh,282*ratiow,261*ratioh,293*ratiow,264*ratioh,321*ratiow,275*ratioh,345*ratiow,287*ratioh,374*ratiow,307*ratioh,400*ratiow,329*ratioh,421*ratiow,353*ratioh,437*ratiow,375*ratioh,450*ratiow,397*ratioh,463*ratiow,426*ratioh,470*ratiow,453*ratioh,482*ratiow,498*ratioh,485*ratiow,527*ratioh,484*ratiow,557*ratioh,479*ratiow,586*ratioh,470*ratiow,618*ratioh,458*ratiow,642*ratioh,440*ratiow,668*ratioh,421*ratiow,689*ratioh,407*ratiow,701*ratioh,398*ratiow,707*ratioh,393*ratiow,711*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(457*ratiow,854*ratioh,458*ratiow,880*ratioh,472*ratiow,874*ratioh,492*ratiow,862*ratioh,510*ratiow,847*ratioh,533*ratiow,827*ratioh,550*ratiow,808*ratioh,567*ratiow,788*ratioh,582*ratiow,767*ratioh,606*ratiow,725*ratioh,611*ratiow,713*ratioh,580*ratiow,706*ratioh,582*ratiow,709*ratioh,579*ratiow,718*ratioh,569*ratiow,735*ratioh,549*ratiow,760*ratioh,535*ratiow,776*ratioh,521*ratiow,795*ratioh,507*ratiow,812*ratioh,492*ratiow,829*ratioh,479*ratiow,841*ratioh,467*ratiow,848*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(456*ratiow,838*ratioh,457*ratiow,854*ratioh,468*ratiow,848*ratioh,484*ratiow,837*ratioh,497*ratiow,824*ratioh,511*ratiow,808*ratioh,525*ratiow,789*ratioh,537*ratiow,775*ratioh,554*ratiow,753*ratioh,567*ratiow,737*ratioh,578*ratiow,720*ratioh,582*ratiow,712*ratioh,581*ratiow,706*ratioh,576*ratiow,704*ratioh,570*ratiow,703*ratioh,561*ratiow,715*ratioh,545*ratiow,737*ratioh,533*ratiow,754*ratioh,502*ratiow,794*ratioh,484*ratiow,812*ratioh,471*ratiow,826*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(455*ratiow,838*ratioh,465*ratiow,831*ratioh,477*ratiow,818*ratioh,497*ratiow,799*ratioh,512*ratiow,782*ratioh,526*ratiow,762*ratioh,538*ratiow,746*ratioh,557*ratiow,721*ratioh,568*ratiow,707*ratioh,572*ratiow,703*ratioh,552*ratiow,696*ratioh,530*ratiow,686*ratioh,510*ratiow,676*ratioh,496*ratiow,667*ratioh,491*ratiow,663*ratioh,492*ratiow,675*ratioh,494*ratiow,689*ratioh,493*ratiow,706*ratioh,490*ratiow,724*ratioh,483*ratiow,740*ratioh,478*ratiow,746*ratioh,471*ratiow,750*ratioh,461*ratiow,753*ratioh,452*ratiow,754*ratioh,451*ratiow,761*ratioh,444*ratiow,771*ratioh,435*ratiow,779*ratioh,427*ratiow,782*ratioh,414*ratiow,786*ratioh,400*ratiow,787*ratioh,392*ratiow,786*ratioh,391*ratiow,795*ratioh,390*ratiow,801*ratioh,395*ratiow,798*ratioh,398*ratiow,795*ratioh,406*ratiow,793*ratioh,419*ratiow,793*ratioh,432*ratiow,796*ratioh,443*ratiow,805*ratioh,448*ratiow,813*ratioh,453*ratiow,824*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(1*ratiow,442*ratioh,7*ratiow,441*ratioh,14*ratiow,437*ratioh,19*ratiow,431*ratioh,25*ratiow,427*ratioh,32*ratiow,424*ratioh,39*ratiow,423*ratioh,37*ratiow,426*ratioh,32*ratiow,431*ratioh,28*ratiow,438*ratioh,24*ratiow,446*ratioh,20*ratiow,455*ratioh,18*ratiow,469*ratioh,17*ratiow,476*ratioh,10*ratiow,482*ratioh,4*ratiow,484*ratioh,1*ratiow,484*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile47(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 676;
var baseHeight = 893;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, PVA, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(626*ratiow,337*ratioh,631*ratiow,334*ratioh,634*ratiow,326*ratioh,632*ratiow,318*ratioh,625*ratiow,309*ratioh,617*ratiow,300*ratioh,607*ratiow,292*ratioh,593*ratiow,284*ratioh,576*ratiow,275*ratioh,563*ratiow,270*ratioh,549*ratiow,270*ratioh,533*ratiow,276*ratioh,527*ratiow,284*ratioh,526*ratiow,299*ratioh,529*ratiow,312*ratioh,533*ratiow,320*ratioh,545*ratiow,330*ratioh,555*ratiow,335*ratioh,565*ratiow,338*ratioh,578*ratiow,340*ratioh,593*ratiow,341*ratioh,611*ratiow,341*ratioh,623*ratiow,339*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(675*ratiow,440*ratioh,669*ratiow,440*ratioh,661*ratiow,437*ratioh,652*ratiow,431*ratioh,647*ratiow,428*ratioh,641*ratiow,426*ratioh,636*ratiow,428*ratioh,633*ratiow,431*ratioh,635*ratiow,440*ratioh,640*ratiow,446*ratioh,645*ratiow,453*ratioh,648*ratiow,458*ratioh,650*ratiow,467*ratioh,651*ratiow,480*ratioh,649*ratiow,487*ratioh,645*ratiow,494*ratioh,642*ratiow,496*ratioh,651*ratiow,495*ratioh,662*ratiow,494*ratioh,675*ratiow,494*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(240*ratiow,686*ratioh,288*ratiow,685*ratioh,302*ratiow,671*ratioh,316*ratiow,662*ratioh,328*ratiow,658*ratioh,316*ratiow,652*ratioh,301*ratiow,635*ratioh,285*ratiow,610*ratioh,282*ratiow,595*ratioh,282*ratiow,579*ratioh,286*ratiow,556*ratioh,293*ratiow,528*ratioh,301*ratiow,502*ratioh,318*ratiow,467*ratioh,329*ratiow,439*ratioh,340*ratiow,415*ratioh,344*ratiow,405*ratioh,344*ratiow,391*ratioh,348*ratiow,372*ratioh,357*ratiow,357*ratioh,368*ratiow,348*ratioh,373*ratiow,349*ratioh,377*ratiow,352*ratioh,381*ratiow,340*ratioh,386*ratiow,326*ratioh,386*ratiow,310*ratioh,380*ratiow,295*ratioh,373*ratiow,287*ratioh,359*ratiow,286*ratioh,343*ratiow,289*ratioh,325*ratiow,300*ratioh,302*ratiow,320*ratioh,285*ratiow,338*ratioh,268*ratiow,358*ratioh,253*ratiow,376*ratioh,240*ratiow,396*ratioh,225*ratiow,422*ratioh,212*ratiow,447*ratioh,206*ratiow,469*ratioh,202*ratiow,492*ratioh,199*ratiow,518*ratioh,199*ratiow,553*ratioh,199*ratiow,579*ratioh,202*ratiow,599*ratioh,210*ratiow,632*ratioh,217*ratiow,653*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(203*ratiow,865*ratioh,194*ratiow,886*ratioh,177*ratiow,879*ratioh,163*ratiow,869*ratioh,140*ratiow,842*ratioh,124*ratiow,820*ratioh,105*ratiow,793*ratioh,87*ratiow,767*ratioh,75*ratiow,745*ratioh,66*ratiow,724*ratioh,63*ratiow,716*ratioh,95*ratiow,708*ratioh,94*ratiow,713*ratioh,98*ratiow,728*ratioh,107*ratiow,744*ratioh,134*ratiow,781*ratioh,148*ratiow,797*ratioh,154*ratiow,809*ratioh,160*ratiow,827*ratioh,168*ratiow,842*ratioh,181*ratiow,855*ratioh,194*ratiow,862*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(205*ratiow,848*ratioh,203*ratiow,865*ratioh,189*ratiow,861*ratioh,173*ratiow,848*ratioh,160*ratiow,828*ratioh,154*ratiow,808*ratioh,148*ratiow,798*ratioh,132*ratiow,778*ratioh,115*ratiow,755*ratioh,100*ratiow,731*ratioh,97*ratiow,722*ratioh,95*ratiow,714*ratioh,94*ratiow,708*ratioh,105*ratiow,704*ratioh,113*ratiow,717*ratioh,125*ratiow,735*ratioh,147*ratiow,764*ratioh,155*ratiow,779*ratioh,162*ratiow,795*ratioh,170*ratiow,813*ratioh,180*ratiow,831*ratioh,190*ratiow,842*ratioh,199*ratiow,847*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(206*ratiow,848*ratioh,221*ratiow,781*ratioh,213*ratiow,771*ratioh,208*ratiow,761*ratioh,206*ratiow,753*ratioh,206*ratiow,746*ratioh,209*ratiow,734*ratioh,198*ratiow,737*ratioh,187*ratiow,739*ratioh,177*ratiow,733*ratioh,170*ratiow,722*ratioh,167*ratiow,709*ratioh,167*ratiow,692*ratioh,170*ratiow,680*ratioh,179*ratiow,665*ratioh,168*ratiow,671*ratioh,150*ratiow,682*ratioh,123*ratiow,697*ratioh,105*ratiow,704*ratioh,107*ratiow,710*ratioh,116*ratiow,721*ratioh,134*ratiow,748*ratioh,146*ratiow,763*ratioh,153*ratiow,774*ratioh,162*ratiow,795*ratioh,175*ratiow,823*ratioh,186*ratiow,838*ratioh,197*ratiow,846*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(50*ratiow,337*ratioh,45*ratiow,334*ratioh,42*ratiow,326*ratioh,44*ratiow,318*ratioh,51*ratiow,309*ratioh,59*ratiow,300*ratioh,69*ratiow,292*ratioh,83*ratiow,284*ratioh,100*ratiow,275*ratioh,113*ratiow,270*ratioh,127*ratiow,270*ratioh,143*ratiow,276*ratioh,149*ratiow,284*ratioh,150*ratiow,299*ratioh,147*ratiow,312*ratioh,143*ratiow,320*ratioh,131*ratiow,330*ratioh,121*ratiow,335*ratioh,111*ratiow,338*ratioh,98*ratiow,340*ratioh,83*ratiow,341*ratioh,65*ratiow,341*ratioh,53*ratiow,339*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(1*ratiow,440*ratioh,7*ratiow,440*ratioh,15*ratiow,437*ratioh,24*ratiow,431*ratioh,29*ratiow,428*ratioh,35*ratiow,426*ratioh,40*ratiow,428*ratioh,43*ratiow,431*ratioh,41*ratiow,440*ratioh,36*ratiow,446*ratioh,31*ratiow,453*ratioh,28*ratiow,458*ratioh,26*ratiow,467*ratioh,25*ratiow,480*ratioh,27*ratiow,487*ratioh,31*ratiow,494*ratioh,34*ratiow,496*ratioh,25*ratiow,495*ratioh,14*ratiow,494*ratioh,1*ratiow,494*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(436*ratiow,686*ratioh,388*ratiow,685*ratioh,374*ratiow,671*ratioh,360*ratiow,662*ratioh,348*ratiow,658*ratioh,360*ratiow,652*ratioh,375*ratiow,635*ratioh,391*ratiow,610*ratioh,394*ratiow,595*ratioh,394*ratiow,579*ratioh,390*ratiow,556*ratioh,383*ratiow,528*ratioh,375*ratiow,502*ratioh,358*ratiow,467*ratioh,347*ratiow,439*ratioh,336*ratiow,415*ratioh,332*ratiow,405*ratioh,332*ratiow,391*ratioh,328*ratiow,372*ratioh,319*ratiow,357*ratioh,308*ratiow,348*ratioh,303*ratiow,349*ratioh,299*ratiow,352*ratioh,295*ratiow,340*ratioh,290*ratiow,326*ratioh,290*ratiow,310*ratioh,296*ratiow,295*ratioh,303*ratiow,287*ratioh,317*ratiow,286*ratioh,333*ratiow,289*ratioh,351*ratiow,300*ratioh,374*ratiow,320*ratioh,391*ratiow,338*ratioh,408*ratiow,358*ratioh,423*ratiow,376*ratioh,436*ratiow,396*ratioh,451*ratiow,422*ratioh,464*ratiow,447*ratioh,470*ratiow,469*ratioh,474*ratiow,492*ratioh,477*ratiow,518*ratioh,477*ratiow,553*ratioh,477*ratiow,579*ratioh,474*ratiow,599*ratioh,466*ratiow,632*ratioh,459*ratiow,653*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(473*ratiow,865*ratioh,482*ratiow,886*ratioh,499*ratiow,879*ratioh,513*ratiow,869*ratioh,536*ratiow,842*ratioh,552*ratiow,820*ratioh,571*ratiow,793*ratioh,589*ratiow,767*ratioh,601*ratiow,745*ratioh,610*ratiow,724*ratioh,613*ratiow,716*ratioh,581*ratiow,708*ratioh,582*ratiow,713*ratioh,578*ratiow,728*ratioh,569*ratiow,744*ratioh,542*ratiow,781*ratioh,528*ratiow,797*ratioh,522*ratiow,809*ratioh,516*ratiow,827*ratioh,508*ratiow,842*ratioh,495*ratiow,855*ratioh,482*ratiow,862*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(471*ratiow,848*ratioh,473*ratiow,865*ratioh,487*ratiow,861*ratioh,503*ratiow,848*ratioh,516*ratiow,828*ratioh,522*ratiow,808*ratioh,528*ratiow,798*ratioh,544*ratiow,778*ratioh,561*ratiow,755*ratioh,576*ratiow,731*ratioh,579*ratiow,722*ratioh,581*ratiow,714*ratioh,582*ratiow,708*ratioh,571*ratiow,704*ratioh,563*ratiow,717*ratioh,551*ratiow,735*ratioh,529*ratiow,764*ratioh,521*ratiow,779*ratioh,514*ratiow,795*ratioh,506*ratiow,813*ratioh,496*ratiow,831*ratioh,486*ratiow,842*ratioh,477*ratiow,847*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(470*ratiow,848*ratioh,455*ratiow,781*ratioh,463*ratiow,771*ratioh,468*ratiow,761*ratioh,470*ratiow,753*ratioh,470*ratiow,746*ratioh,467*ratiow,734*ratioh,478*ratiow,737*ratioh,489*ratiow,739*ratioh,499*ratiow,733*ratioh,506*ratiow,722*ratioh,509*ratiow,709*ratioh,509*ratiow,692*ratioh,506*ratiow,680*ratioh,497*ratiow,665*ratioh,508*ratiow,671*ratioh,526*ratiow,682*ratioh,553*ratiow,697*ratioh,571*ratiow,704*ratioh,569*ratiow,710*ratioh,560*ratiow,721*ratioh,542*ratiow,748*ratioh,530*ratiow,763*ratioh,523*ratiow,774*ratioh,514*ratiow,795*ratioh,501*ratiow,823*ratioh,490*ratiow,838*ratioh,479*ratiow,846*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile48(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 663;
var baseHeight = 900;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, PVA, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(629*ratiow,316*ratioh,633*ratiow,325*ratioh,629*ratiow,336*ratioh,620*ratiow,342*ratioh,594*ratiow,344*ratioh,561*ratiow,340*ratioh,534*ratiow,334*ratioh,509*ratiow,320*ratioh,493*ratiow,303*ratioh,482*ratiow,286*ratioh,479*ratiow,275*ratioh,483*ratiow,265*ratioh,499*ratiow,256*ratioh,518*ratiow,254*ratioh,536*ratiow,256*ratioh,550*ratiow,263*ratioh,573*ratiow,278*ratioh,606*ratiow,301*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(662*ratiow,434*ratioh,657*ratiow,432*ratioh,644*ratiow,427*ratioh,638*ratiow,423*ratioh,635*ratiow,427*ratioh,635*ratiow,436*ratioh,638*ratiow,453*ratioh,639*ratiow,464*ratioh,639*ratiow,473*ratioh,642*ratiow,483*ratioh,646*ratiow,492*ratioh,656*ratiow,497*ratioh,662*ratiow,496*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(229*ratiow,674*ratioh,289*ratiow,674*ratioh,300*ratiow,669*ratioh,311*ratiow,667*ratioh,324*ratiow,666*ratioh,314*ratiow,658*ratioh,301*ratiow,647*ratioh,286*ratiow,625*ratioh,278*ratiow,603*ratioh,275*ratiow,583*ratioh,273*ratiow,550*ratioh,276*ratiow,515*ratioh,283*ratiow,484*ratioh,292*ratiow,463*ratioh,303*ratiow,442*ratioh,310*ratiow,430*ratioh,303*ratiow,418*ratioh,304*ratiow,408*ratioh,319*ratiow,376*ratioh,334*ratiow,352*ratioh,342*ratiow,346*ratioh,348*ratiow,347*ratioh,350*ratiow,352*ratioh,353*ratiow,346*ratioh,358*ratiow,323*ratioh,355*ratiow,304*ratioh,348*ratiow,292*ratioh,343*ratiow,287*ratioh,347*ratiow,280*ratioh,352*ratiow,274*ratioh,341*ratiow,277*ratioh,320*ratiow,284*ratioh,307*ratiow,292*ratioh,292*ratiow,303*ratioh,267*ratiow,323*ratioh,257*ratiow,331*ratioh,243*ratiow,345*ratioh,227*ratiow,367*ratioh,213*ratiow,394*ratioh,204*ratiow,419*ratioh,195*ratiow,448*ratioh,188*ratiow,480*ratioh,181*ratiow,515*ratioh,179*ratiow,545*ratioh,180*ratiow,571*ratioh,185*ratiow,601*ratioh,196*ratiow,628*ratioh,209*ratiow,649*ratioh,220*ratiow,662*ratioh,225*ratiow,665*ratioh,229*ratiow,671*ratioh,229*ratiow,675*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(270*ratiow,876*ratioh,272*ratiow,898*ratioh,259*ratiow,898*ratioh,235*ratiow,897*ratioh,209*ratiow,896*ratioh,196*ratiow,893*ratioh,179*ratiow,880*ratioh,154*ratiow,858*ratioh,134*ratiow,840*ratioh,109*ratiow,816*ratioh,89*ratiow,791*ratioh,73*ratiow,764*ratioh,56*ratiow,734*ratioh,45*ratiow,709*ratioh,42*ratiow,698*ratioh,65*ratiow,694*ratioh,83*ratiow,690*ratioh,78*ratiow,696*ratioh,80*ratiow,708*ratioh,87*ratiow,723*ratioh,97*ratiow,742*ratioh,109*ratiow,761*ratioh,120*ratiow,779*ratioh,133*ratiow,795*ratioh,148*ratiow,818*ratioh,165*ratiow,839*ratioh,182*ratiow,859*ratioh,196*ratiow,871*ratioh,204*ratiow,874*ratioh,222*ratiow,876*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(254*ratiow,849*ratioh,263*ratiow,853*ratioh,270*ratiow,863*ratioh,270*ratiow,876*ratioh,234*ratiow,876*ratioh,205*ratiow,874*ratioh,197*ratiow,871*ratioh,184*ratiow,860*ratioh,170*ratiow,844*ratioh,154*ratiow,824*ratioh,140*ratiow,806*ratioh,120*ratiow,778*ratioh,106*ratiow,756*ratioh,93*ratiow,736*ratioh,84*ratiow,716*ratioh,79*ratiow,703*ratioh,78*ratiow,695*ratioh,82*ratiow,690*ratioh,93*ratiow,688*ratioh,98*ratiow,695*ratioh,102*ratiow,707*ratioh,115*ratiow,735*ratioh,131*ratiow,757*ratioh,145*ratiow,777*ratioh,157*ratiow,792*ratioh,183*ratiow,823*ratioh,201*ratiow,836*ratioh,216*ratiow,844*ratioh,231*ratiow,848*ratioh,249*ratiow,849*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(266*ratiow,857*ratioh,259*ratiow,850*ratioh,246*ratiow,848*ratioh,225*ratiow,847*ratioh,203*ratiow,838*ratioh,183*ratiow,822*ratioh,164*ratiow,801*ratioh,152*ratiow,785*ratioh,138*ratiow,768*ratioh,122*ratiow,745*ratioh,112*ratiow,728*ratioh,104*ratiow,711*ratioh,100*ratiow,699*ratioh,96*ratiow,692*ratioh,91*ratiow,688*ratioh,114*ratiow,682*ratioh,146*ratiow,671*ratioh,161*ratiow,665*ratioh,176*ratiow,658*ratioh,178*ratiow,659*ratioh,174*ratiow,667*ratioh,163*ratiow,692*ratioh,158*ratiow,708*ratioh,158*ratiow,722*ratioh,163*ratiow,739*ratioh,168*ratiow,749*ratioh,175*ratiow,756*ratioh,186*ratiow,757*ratioh,196*ratiow,754*ratioh,197*ratiow,763*ratioh,203*ratiow,775*ratioh,211*ratiow,783*ratioh,217*ratiow,787*ratioh,227*ratiow,789*ratioh,239*ratiow,789*ratioh,247*ratiow,786*ratioh,248*ratiow,783*ratioh,254*ratiow,786*ratioh,259*ratiow,786*ratioh,265*ratiow,781*ratioh,264*ratiow,774*ratioh,259*ratiow,772*ratioh,254*ratiow,771*ratioh,247*ratiow,773*ratioh,244*ratiow,770*ratioh,250*ratiow,768*ratioh,258*ratiow,764*ratioh,264*ratiow,757*ratioh,268*ratiow,762*ratioh,274*ratiow,769*ratioh,282*ratiow,775*ratioh,294*ratiow,781*ratioh,298*ratiow,783*ratioh,290*ratiow,786*ratioh,284*ratiow,793*ratioh,281*ratiow,800*ratioh,281*ratiow,816*ratioh,284*ratiow,826*ratioh,290*ratiow,833*ratioh,274*ratiow,833*ratioh,266*ratiow,835*ratioh,263*ratiow,841*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(34*ratiow,316*ratioh,30*ratiow,325*ratioh,34*ratiow,336*ratioh,43*ratiow,342*ratioh,69*ratiow,344*ratioh,102*ratiow,340*ratioh,129*ratiow,334*ratioh,154*ratiow,320*ratioh,170*ratiow,303*ratioh,181*ratiow,286*ratioh,184*ratiow,275*ratioh,180*ratiow,265*ratioh,164*ratiow,256*ratioh,145*ratiow,254*ratioh,127*ratiow,256*ratioh,113*ratiow,263*ratioh,90*ratiow,278*ratioh,57*ratiow,301*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(1*ratiow,434*ratioh,6*ratiow,432*ratioh,19*ratiow,427*ratioh,25*ratiow,423*ratioh,28*ratiow,427*ratioh,28*ratiow,436*ratioh,25*ratiow,453*ratioh,24*ratiow,464*ratioh,24*ratiow,473*ratioh,21*ratiow,483*ratioh,17*ratiow,492*ratioh,7*ratiow,497*ratioh,1*ratiow,496*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(434*ratiow,674*ratioh,374*ratiow,674*ratioh,363*ratiow,669*ratioh,352*ratiow,667*ratioh,339*ratiow,666*ratioh,349*ratiow,658*ratioh,362*ratiow,647*ratioh,377*ratiow,625*ratioh,385*ratiow,603*ratioh,388*ratiow,583*ratioh,390*ratiow,550*ratioh,387*ratiow,515*ratioh,380*ratiow,484*ratioh,371*ratiow,463*ratioh,360*ratiow,442*ratioh,353*ratiow,430*ratioh,360*ratiow,418*ratioh,359*ratiow,408*ratioh,344*ratiow,376*ratioh,329*ratiow,352*ratioh,321*ratiow,346*ratioh,315*ratiow,347*ratioh,313*ratiow,352*ratioh,310*ratiow,346*ratioh,305*ratiow,323*ratioh,308*ratiow,304*ratioh,315*ratiow,292*ratioh,320*ratiow,287*ratioh,316*ratiow,280*ratioh,311*ratiow,274*ratioh,322*ratiow,277*ratioh,343*ratiow,284*ratioh,356*ratiow,292*ratioh,371*ratiow,303*ratioh,396*ratiow,323*ratioh,406*ratiow,331*ratioh,420*ratiow,345*ratioh,436*ratiow,367*ratioh,450*ratiow,394*ratioh,459*ratiow,419*ratioh,468*ratiow,448*ratioh,475*ratiow,480*ratioh,482*ratiow,515*ratioh,484*ratiow,545*ratioh,483*ratiow,571*ratioh,478*ratiow,601*ratioh,467*ratiow,628*ratioh,454*ratiow,649*ratioh,443*ratiow,662*ratioh,438*ratiow,665*ratioh,434*ratiow,671*ratioh,434*ratiow,675*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(393*ratiow,876*ratioh,391*ratiow,898*ratioh,404*ratiow,898*ratioh,428*ratiow,897*ratioh,454*ratiow,896*ratioh,467*ratiow,893*ratioh,484*ratiow,880*ratioh,509*ratiow,858*ratioh,529*ratiow,840*ratioh,554*ratiow,816*ratioh,574*ratiow,791*ratioh,590*ratiow,764*ratioh,607*ratiow,734*ratioh,618*ratiow,709*ratioh,621*ratiow,698*ratioh,598*ratiow,694*ratioh,580*ratiow,690*ratioh,585*ratiow,696*ratioh,583*ratiow,708*ratioh,576*ratiow,723*ratioh,566*ratiow,742*ratioh,554*ratiow,761*ratioh,543*ratiow,779*ratioh,530*ratiow,795*ratioh,515*ratiow,818*ratioh,498*ratiow,839*ratioh,481*ratiow,859*ratioh,467*ratiow,871*ratioh,459*ratiow,874*ratioh,441*ratiow,876*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(409*ratiow,849*ratioh,400*ratiow,853*ratioh,393*ratiow,863*ratioh,393*ratiow,876*ratioh,429*ratiow,876*ratioh,458*ratiow,874*ratioh,466*ratiow,871*ratioh,479*ratiow,860*ratioh,493*ratiow,844*ratioh,509*ratiow,824*ratioh,523*ratiow,806*ratioh,543*ratiow,778*ratioh,557*ratiow,756*ratioh,570*ratiow,736*ratioh,579*ratiow,716*ratioh,584*ratiow,703*ratioh,585*ratiow,695*ratioh,581*ratiow,690*ratioh,570*ratiow,688*ratioh,565*ratiow,695*ratioh,561*ratiow,707*ratioh,548*ratiow,735*ratioh,532*ratiow,757*ratioh,518*ratiow,777*ratioh,506*ratiow,792*ratioh,480*ratiow,823*ratioh,462*ratiow,836*ratioh,447*ratiow,844*ratioh,432*ratiow,848*ratioh,414*ratiow,849*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(397*ratiow,857*ratioh,404*ratiow,850*ratioh,417*ratiow,848*ratioh,438*ratiow,847*ratioh,460*ratiow,838*ratioh,480*ratiow,822*ratioh,499*ratiow,801*ratioh,511*ratiow,785*ratioh,525*ratiow,768*ratioh,541*ratiow,745*ratioh,551*ratiow,728*ratioh,559*ratiow,711*ratioh,563*ratiow,699*ratioh,567*ratiow,692*ratioh,572*ratiow,688*ratioh,549*ratiow,682*ratioh,517*ratiow,671*ratioh,502*ratiow,665*ratioh,487*ratiow,658*ratioh,485*ratiow,659*ratioh,489*ratiow,667*ratioh,500*ratiow,692*ratioh,505*ratiow,708*ratioh,505*ratiow,722*ratioh,500*ratiow,739*ratioh,495*ratiow,749*ratioh,488*ratiow,756*ratioh,477*ratiow,757*ratioh,467*ratiow,754*ratioh,466*ratiow,763*ratioh,460*ratiow,775*ratioh,452*ratiow,783*ratioh,446*ratiow,787*ratioh,436*ratiow,789*ratioh,424*ratiow,789*ratioh,416*ratiow,786*ratioh,415*ratiow,783*ratioh,409*ratiow,786*ratioh,404*ratiow,786*ratioh,398*ratiow,781*ratioh,399*ratiow,774*ratioh,404*ratiow,772*ratioh,409*ratiow,771*ratioh,416*ratiow,773*ratioh,419*ratiow,770*ratioh,413*ratiow,768*ratioh,405*ratiow,764*ratioh,399*ratiow,757*ratioh,395*ratiow,762*ratioh,389*ratiow,769*ratioh,381*ratiow,775*ratioh,369*ratiow,781*ratioh,365*ratiow,783*ratioh,373*ratiow,786*ratioh,379*ratiow,793*ratioh,382*ratiow,800*ratioh,382*ratiow,816*ratioh,379*ratiow,826*ratioh,373*ratiow,833*ratioh,389*ratiow,833*ratioh,397*ratiow,835*ratioh,400*ratiow,841*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile49(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 694;
var baseHeight = 903;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, PVA, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(676*ratiow,329*ratioh,667*ratiow,356*ratioh,657*ratiow,371*ratioh,647*ratiow,379*ratioh,627*ratiow,386*ratioh,604*ratiow,385*ratioh,587*ratiow,377*ratioh,582*ratiow,371*ratioh,582*ratiow,366*ratioh,597*ratiow,366*ratioh,602*ratiow,365*ratioh,603*ratiow,362*ratioh,598*ratiow,357*ratioh,581*ratiow,350*ratioh,546*ratiow,338*ratioh,524*ratiow,328*ratioh,500*ratiow,313*ratioh,483*ratiow,292*ratioh,480*ratiow,278*ratioh,483*ratiow,265*ratioh,491*ratiow,255*ratioh,501*ratiow,246*ratioh,517*ratiow,239*ratioh,532*ratiow,234*ratioh,545*ratiow,236*ratioh,566*ratiow,249*ratioh,582*ratiow,262*ratioh,598*ratiow,273*ratioh,614*ratiow,283*ratioh,638*ratiow,299*ratioh,654*ratiow,308*ratioh,667*ratiow,317*ratioh,671*ratiow,321*ratioh,672*ratiow,326*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(693*ratiow,432*ratioh,687*ratiow,432*ratioh,665*ratiow,427*ratioh,662*ratiow,427*ratioh,661*ratiow,432*ratioh,663*ratiow,447*ratioh,664*ratiow,459*ratioh,662*ratiow,467*ratioh,667*ratiow,473*ratioh,677*ratiow,476*ratioh,689*ratiow,478*ratioh,693*ratiow,477*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(217*ratiow,662*ratioh,318*ratiow,658*ratioh,320*ratiow,654*ratioh,319*ratiow,645*ratioh,304*ratiow,629*ratioh,293*ratiow,611*ratioh,287*ratiow,595*ratioh,284*ratiow,577*ratioh,285*ratiow,550*ratioh,293*ratiow,515*ratioh,304*ratiow,481*ratioh,315*ratiow,448*ratioh,321*ratiow,431*ratioh,321*ratiow,419*ratioh,327*ratiow,403*ratioh,341*ratiow,378*ratioh,345*ratiow,369*ratioh,346*ratiow,346*ratioh,346*ratiow,308*ratioh,344*ratiow,297*ratioh,339*ratiow,292*ratioh,332*ratiow,292*ratioh,321*ratiow,297*ratioh,312*ratiow,303*ratioh,302*ratiow,312*ratioh,282*ratiow,332*ratioh,266*ratiow,352*ratioh,252*ratiow,372*ratioh,237*ratiow,396*ratioh,212*ratiow,442*ratioh,199*ratiow,487*ratioh,193*ratiow,514*ratioh,189*ratiow,535*ratioh,188*ratiow,556*ratioh,189*ratiow,584*ratioh,195*ratiow,610*ratioh,201*ratiow,627*ratioh,207*ratiow,642*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(286*ratiow,875*ratioh,286*ratiow,899*ratioh,272*ratiow,901*ratioh,238*ratiow,902*ratioh,207*ratiow,901*ratioh,193*ratiow,898*ratioh,161*ratiow,884*ratioh,129*ratiow,860*ratioh,105*ratiow,837*ratioh,85*ratiow,814*ratioh,68*ratiow,781*ratioh,55*ratiow,751*ratioh,46*ratiow,728*ratioh,43*ratiow,719*ratioh,62*ratiow,718*ratioh,80*ratiow,715*ratioh,77*ratiow,720*ratioh,79*ratiow,730*ratioh,86*ratiow,748*ratioh,96*ratiow,769*ratioh,106*ratiow,786*ratioh,118*ratiow,805*ratioh,131*ratiow,820*ratioh,146*ratiow,837*ratioh,168*ratiow,858*ratioh,179*ratiow,868*ratioh,191*ratiow,875*ratioh,211*ratiow,879*ratioh,222*ratiow,880*ratioh,238*ratiow,884*ratioh,258*ratiow,885*ratioh,276*ratiow,881*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(293*ratiow,853*ratioh,296*ratiow,856*ratioh,297*ratiow,860*ratioh,295*ratiow,866*ratioh,287*ratiow,873*ratioh,273*ratiow,881*ratioh,261*ratiow,885*ratioh,240*ratiow,884*ratioh,217*ratiow,879*ratioh,199*ratiow,877*ratioh,183*ratiow,871*ratioh,166*ratiow,856*ratioh,145*ratiow,837*ratioh,125*ratiow,813*ratioh,110*ratiow,792*ratioh,95*ratiow,767*ratioh,82*ratiow,738*ratioh,77*ratiow,725*ratioh,77*ratiow,716*ratioh,84*ratiow,713*ratioh,91*ratiow,714*ratioh,96*ratiow,723*ratioh,106*ratiow,745*ratioh,117*ratiow,768*ratioh,131*ratiow,791*ratioh,151*ratiow,816*ratioh,169*ratiow,833*ratioh,185*ratiow,847*ratioh,201*ratiow,856*ratioh,218*ratiow,864*ratioh,236*ratiow,869*ratioh,248*ratiow,870*ratioh,267*ratiow,866*ratioh,283*ratiow,857*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(293*ratiow,839*ratioh,295*ratiow,854*ratioh,286*ratiow,855*ratioh,277*ratiow,861*ratioh,264*ratiow,867*ratioh,252*ratiow,869*ratioh,237*ratiow,869*ratioh,219*ratiow,864*ratioh,197*ratiow,855*ratioh,174*ratiow,839*ratioh,163*ratiow,828*ratioh,139*ratiow,803*ratioh,124*ratiow,779*ratioh,111*ratiow,755*ratioh,101*ratiow,735*ratioh,95*ratiow,721*ratioh,91*ratiow,714*ratioh,85*ratiow,713*ratioh,127*ratiow,701*ratioh,153*ratiow,687*ratioh,175*ratiow,673*ratioh,172*ratiow,677*ratioh,164*ratiow,691*ratioh,157*ratiow,705*ratioh,154*ratiow,716*ratioh,153*ratiow,730*ratioh,162*ratiow,746*ratioh,172*ratiow,755*ratioh,181*ratiow,760*ratioh,189*ratiow,762*ratioh,196*ratiow,761*ratioh,208*ratiow,754*ratioh,206*ratiow,759*ratioh,203*ratiow,768*ratioh,203*ratiow,780*ratioh,205*ratiow,788*ratioh,212*ratiow,796*ratioh,220*ratiow,801*ratioh,229*ratiow,804*ratioh,236*ratiow,803*ratioh,239*ratiow,813*ratioh,244*ratiow,821*ratioh,252*ratiow,825*ratioh,262*ratiow,822*ratioh,272*ratiow,814*ratioh,273*ratiow,824*ratioh,279*ratiow,831*ratioh,290*ratiow,838*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(18*ratiow,329*ratioh,27*ratiow,356*ratioh,37*ratiow,371*ratioh,47*ratiow,379*ratioh,67*ratiow,386*ratioh,90*ratiow,385*ratioh,107*ratiow,377*ratioh,112*ratiow,371*ratioh,112*ratiow,366*ratioh,97*ratiow,366*ratioh,92*ratiow,365*ratioh,91*ratiow,362*ratioh,96*ratiow,357*ratioh,113*ratiow,350*ratioh,148*ratiow,338*ratioh,170*ratiow,328*ratioh,194*ratiow,313*ratioh,211*ratiow,292*ratioh,214*ratiow,278*ratioh,211*ratiow,265*ratioh,203*ratiow,255*ratioh,193*ratiow,246*ratioh,177*ratiow,239*ratioh,162*ratiow,234*ratioh,149*ratiow,236*ratioh,128*ratiow,249*ratioh,112*ratiow,262*ratioh,96*ratiow,273*ratioh,80*ratiow,283*ratioh,56*ratiow,299*ratioh,40*ratiow,308*ratioh,27*ratiow,317*ratioh,23*ratiow,321*ratioh,22*ratiow,326*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(1*ratiow,432*ratioh,7*ratiow,432*ratioh,29*ratiow,427*ratioh,32*ratiow,427*ratioh,33*ratiow,432*ratioh,31*ratiow,447*ratioh,30*ratiow,459*ratioh,32*ratiow,467*ratioh,27*ratiow,473*ratioh,17*ratiow,476*ratioh,5*ratiow,478*ratioh,1*ratiow,477*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(477*ratiow,662*ratioh,376*ratiow,658*ratioh,374*ratiow,654*ratioh,375*ratiow,645*ratioh,390*ratiow,629*ratioh,401*ratiow,611*ratioh,407*ratiow,595*ratioh,410*ratiow,577*ratioh,409*ratiow,550*ratioh,401*ratiow,515*ratioh,390*ratiow,481*ratioh,379*ratiow,448*ratioh,373*ratiow,431*ratioh,373*ratiow,419*ratioh,367*ratiow,403*ratioh,353*ratiow,378*ratioh,349*ratiow,369*ratioh,348*ratiow,346*ratioh,348*ratiow,308*ratioh,350*ratiow,297*ratioh,355*ratiow,292*ratioh,362*ratiow,292*ratioh,373*ratiow,297*ratioh,382*ratiow,303*ratioh,392*ratiow,312*ratioh,412*ratiow,332*ratioh,428*ratiow,352*ratioh,442*ratiow,372*ratioh,457*ratiow,396*ratioh,482*ratiow,442*ratioh,495*ratiow,487*ratioh,501*ratiow,514*ratioh,505*ratiow,535*ratioh,506*ratiow,556*ratioh,505*ratiow,584*ratioh,499*ratiow,610*ratioh,493*ratiow,627*ratioh,487*ratiow,642*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(408*ratiow,875*ratioh,408*ratiow,899*ratioh,422*ratiow,901*ratioh,456*ratiow,902*ratioh,487*ratiow,901*ratioh,501*ratiow,898*ratioh,533*ratiow,884*ratioh,565*ratiow,860*ratioh,589*ratiow,837*ratioh,609*ratiow,814*ratioh,626*ratiow,781*ratioh,639*ratiow,751*ratioh,648*ratiow,728*ratioh,651*ratiow,719*ratioh,632*ratiow,718*ratioh,614*ratiow,715*ratioh,617*ratiow,720*ratioh,615*ratiow,730*ratioh,608*ratiow,748*ratioh,598*ratiow,769*ratioh,588*ratiow,786*ratioh,576*ratiow,805*ratioh,563*ratiow,820*ratioh,548*ratiow,837*ratioh,526*ratiow,858*ratioh,515*ratiow,868*ratioh,503*ratiow,875*ratioh,483*ratiow,879*ratioh,472*ratiow,880*ratioh,456*ratiow,884*ratioh,436*ratiow,885*ratioh,418*ratiow,881*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(401*ratiow,853*ratioh,398*ratiow,856*ratioh,397*ratiow,860*ratioh,399*ratiow,866*ratioh,407*ratiow,873*ratioh,421*ratiow,881*ratioh,433*ratiow,885*ratioh,454*ratiow,884*ratioh,477*ratiow,879*ratioh,495*ratiow,877*ratioh,511*ratiow,871*ratioh,528*ratiow,856*ratioh,549*ratiow,837*ratioh,569*ratiow,813*ratioh,584*ratiow,792*ratioh,599*ratiow,767*ratioh,612*ratiow,738*ratioh,617*ratiow,725*ratioh,617*ratiow,716*ratioh,610*ratiow,713*ratioh,603*ratiow,714*ratioh,598*ratiow,723*ratioh,588*ratiow,745*ratioh,577*ratiow,768*ratioh,563*ratiow,791*ratioh,543*ratiow,816*ratioh,525*ratiow,833*ratioh,509*ratiow,847*ratioh,493*ratiow,856*ratioh,476*ratiow,864*ratioh,458*ratiow,869*ratioh,446*ratiow,870*ratioh,427*ratiow,866*ratioh,411*ratiow,857*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(401*ratiow,839*ratioh,399*ratiow,854*ratioh,408*ratiow,855*ratioh,417*ratiow,861*ratioh,430*ratiow,867*ratioh,442*ratiow,869*ratioh,457*ratiow,869*ratioh,475*ratiow,864*ratioh,497*ratiow,855*ratioh,520*ratiow,839*ratioh,531*ratiow,828*ratioh,555*ratiow,803*ratioh,570*ratiow,779*ratioh,583*ratiow,755*ratioh,593*ratiow,735*ratioh,599*ratiow,721*ratioh,603*ratiow,714*ratioh,609*ratiow,713*ratioh,567*ratiow,701*ratioh,541*ratiow,687*ratioh,519*ratiow,673*ratioh,522*ratiow,677*ratioh,530*ratiow,691*ratioh,537*ratiow,705*ratioh,540*ratiow,716*ratioh,541*ratiow,730*ratioh,532*ratiow,746*ratioh,522*ratiow,755*ratioh,513*ratiow,760*ratioh,505*ratiow,762*ratioh,498*ratiow,761*ratioh,486*ratiow,754*ratioh,488*ratiow,759*ratioh,491*ratiow,768*ratioh,491*ratiow,780*ratioh,489*ratiow,788*ratioh,482*ratiow,796*ratioh,474*ratiow,801*ratioh,465*ratiow,804*ratioh,458*ratiow,803*ratioh,455*ratiow,813*ratioh,450*ratiow,821*ratioh,442*ratiow,825*ratioh,432*ratiow,822*ratioh,422*ratiow,814*ratioh,421*ratiow,824*ratioh,415*ratiow,831*ratioh,404*ratiow,838*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile50(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 651;
var baseHeight = 907;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, PVA, CPu, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(647*ratiow,306*ratioh,645*ratiow,315*ratioh,645*ratiow,333*ratioh,636*ratiow,344*ratioh,622*ratiow,362*ratioh,616*ratiow,369*ratioh,596*ratiow,370*ratioh,585*ratiow,370*ratioh,576*ratiow,374*ratioh,566*ratiow,369*ratioh,557*ratiow,365*ratioh,546*ratiow,362*ratioh,535*ratiow,359*ratioh,525*ratiow,353*ratioh,524*ratiow,351*ratioh,528*ratiow,349*ratioh,496*ratiow,339*ratioh,454*ratiow,316*ratioh,435*ratiow,296*ratioh,429*ratiow,278*ratioh,428*ratiow,258*ratioh,435*ratiow,247*ratioh,457*ratiow,231*ratioh,482*ratiow,220*ratioh,499*ratiow,216*ratioh,517*ratiow,219*ratioh,529*ratiow,224*ratioh,545*ratiow,238*ratioh,557*ratiow,250*ratioh,588*ratiow,274*ratioh,605*ratiow,284*ratioh,625*ratiow,297*ratioh,638*ratiow,303*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(650*ratiow,413*ratioh,635*ratiow,409*ratioh,630*ratiow,412*ratioh,627*ratiow,425*ratioh,628*ratiow,438*ratioh,632*ratiow,455*ratioh,636*ratiow,472*ratioh,641*ratiow,475*ratioh,650*ratiow,471*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(218*ratiow,655*ratioh,270*ratiow,650*ratioh,289*ratiow,644*ratioh,307*ratiow,640*ratioh,288*ratiow,624*ratioh,269*ratiow,603*ratioh,257*ratiow,581*ratioh,252*ratiow,564*ratioh,252*ratiow,541*ratioh,256*ratiow,515*ratioh,264*ratiow,487*ratioh,278*ratiow,454*ratioh,285*ratiow,440*ratioh,288*ratiow,414*ratioh,291*ratiow,393*ratioh,297*ratiow,376*ratioh,307*ratiow,362*ratioh,315*ratiow,355*ratioh,324*ratiow,353*ratioh,325*ratiow,332*ratioh,319*ratiow,313*ratioh,315*ratiow,296*ratioh,308*ratiow,285*ratioh,300*ratiow,282*ratioh,291*ratiow,286*ratioh,278*ratiow,296*ratioh,262*ratiow,313*ratioh,254*ratiow,321*ratioh,236*ratiow,345*ratioh,221*ratiow,370*ratioh,212*ratiow,390*ratioh,202*ratiow,421*ratioh,194*ratiow,460*ratioh,189*ratiow,493*ratioh,186*ratiow,530*ratioh,185*ratiow,571*ratioh,187*ratiow,603*ratioh,192*ratiow,625*ratioh,201*ratiow,638*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(288*ratiow,871*ratioh,291*ratiow,892*ratioh,271*ratiow,900*ratioh,258*ratiow,905*ratioh,227*ratiow,904*ratioh,205*ratiow,900*ratioh,165*ratiow,889*ratioh,134*ratiow,870*ratioh,112*ratiow,846*ratioh,97*ratiow,820*ratioh,81*ratiow,785*ratioh,70*ratiow,752*ratioh,58*ratiow,716*ratioh,55*ratiow,708*ratioh,84*ratiow,700*ratioh,82*ratiow,704*ratioh,83*ratiow,715*ratioh,87*ratiow,732*ratioh,92*ratiow,750*ratioh,98*ratiow,767*ratioh,107*ratiow,787*ratioh,116*ratiow,803*ratioh,125*ratiow,817*ratioh,139*ratiow,838*ratioh,150*ratiow,850*ratioh,162*ratiow,859*ratioh,174*ratiow,867*ratioh,186*ratiow,872*ratioh,211*ratiow,878*ratioh,230*ratiow,881*ratioh,245*ratiow,882*ratioh,267*ratiow,881*ratioh,282*ratiow,877*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(285*ratiow,867*ratioh,289*ratiow,870*ratioh,287*ratiow,874*ratioh,278*ratiow,878*ratioh,259*ratiow,882*ratioh,228*ratiow,881*ratioh,210*ratiow,878*ratioh,187*ratiow,872*ratioh,166*ratiow,863*ratioh,152*ratiow,852*ratioh,130*ratiow,825*ratioh,117*ratiow,804*ratioh,105*ratiow,783*ratioh,90*ratiow,744*ratioh,85*ratiow,722*ratioh,82*ratiow,708*ratioh,82*ratiow,701*ratioh,89*ratiow,698*ratioh,96*ratiow,705*ratioh,102*ratiow,720*ratioh,111*ratiow,741*ratioh,118*ratiow,759*ratioh,134*ratiow,794*ratioh,145*ratiow,814*ratioh,157*ratiow,828*ratioh,171*ratiow,841*ratioh,192*ratiow,847*ratioh,205*ratiow,847*ratioh,213*ratiow,849*ratioh,221*ratiow,856*ratioh,231*ratiow,864*ratioh,246*ratiow,869*ratioh,273*ratiow,869*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(287*ratiow,867*ratioh,279*ratiow,868*ratioh,255*ratiow,870*ratioh,239*ratiow,867*ratioh,229*ratiow,862*ratioh,217*ratiow,853*ratioh,210*ratiow,847*ratioh,191*ratiow,847*ratioh,175*ratiow,843*ratioh,165*ratiow,836*ratioh,147*ratiow,816*ratioh,137*ratiow,798*ratioh,128*ratiow,781*ratioh,106*ratiow,729*ratioh,100*ratiow,714*ratioh,95*ratiow,704*ratioh,89*ratiow,699*ratioh,112*ratiow,690*ratioh,126*ratiow,684*ratioh,140*ratiow,678*ratioh,135*ratiow,687*ratioh,133*ratiow,702*ratioh,134*ratiow,724*ratioh,138*ratiow,739*ratioh,145*ratiow,751*ratioh,152*ratiow,755*ratioh,159*ratiow,756*ratioh,168*ratiow,756*ratioh,177*ratiow,749*ratioh,178*ratiow,755*ratioh,180*ratiow,767*ratioh,187*ratiow,779*ratioh,198*ratiow,790*ratioh,209*ratiow,796*ratioh,220*ratiow,799*ratioh,225*ratiow,799*ratioh,227*ratiow,803*ratioh,234*ratiow,808*ratioh,241*ratiow,810*ratioh,250*ratiow,811*ratioh,262*ratiow,806*ratioh,262*ratiow,813*ratioh,265*ratiow,829*ratioh,274*ratiow,835*ratioh,286*ratiow,838*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(4*ratiow,306*ratioh,6*ratiow,315*ratioh,6*ratiow,333*ratioh,15*ratiow,344*ratioh,29*ratiow,362*ratioh,35*ratiow,369*ratioh,55*ratiow,370*ratioh,66*ratiow,370*ratioh,75*ratiow,374*ratioh,85*ratiow,369*ratioh,94*ratiow,365*ratioh,105*ratiow,362*ratioh,116*ratiow,359*ratioh,126*ratiow,353*ratioh,127*ratiow,351*ratioh,123*ratiow,349*ratioh,155*ratiow,339*ratioh,197*ratiow,316*ratioh,216*ratiow,296*ratioh,222*ratiow,278*ratioh,223*ratiow,258*ratioh,216*ratiow,247*ratioh,194*ratiow,231*ratioh,169*ratiow,220*ratioh,152*ratiow,216*ratioh,134*ratiow,219*ratioh,122*ratiow,224*ratioh,106*ratiow,238*ratioh,94*ratiow,250*ratioh,63*ratiow,274*ratioh,46*ratiow,284*ratioh,26*ratiow,297*ratioh,13*ratiow,303*ratioh);
data = analyze_pic(data);

//PVA
selectWindow(name);
makePolygon(1*ratiow,413*ratioh,16*ratiow,409*ratioh,21*ratiow,412*ratioh,24*ratiow,425*ratioh,23*ratiow,438*ratioh,19*ratiow,455*ratioh,15*ratiow,472*ratioh,10*ratiow,475*ratioh,1*ratiow,471*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(433*ratiow,655*ratioh,381*ratiow,650*ratioh,362*ratiow,644*ratioh,344*ratiow,640*ratioh,363*ratiow,624*ratioh,382*ratiow,603*ratioh,394*ratiow,581*ratioh,399*ratiow,564*ratioh,399*ratiow,541*ratioh,395*ratiow,515*ratioh,387*ratiow,487*ratioh,373*ratiow,454*ratioh,366*ratiow,440*ratioh,363*ratiow,414*ratioh,360*ratiow,393*ratioh,354*ratiow,376*ratioh,344*ratiow,362*ratioh,336*ratiow,355*ratioh,327*ratiow,353*ratioh,326*ratiow,332*ratioh,332*ratiow,313*ratioh,336*ratiow,296*ratioh,343*ratiow,285*ratioh,351*ratiow,282*ratioh,360*ratiow,286*ratioh,373*ratiow,296*ratioh,389*ratiow,313*ratioh,397*ratiow,321*ratioh,415*ratiow,345*ratioh,430*ratiow,370*ratioh,439*ratiow,390*ratioh,449*ratiow,421*ratioh,457*ratiow,460*ratioh,462*ratiow,493*ratioh,465*ratiow,530*ratioh,466*ratiow,571*ratioh,464*ratiow,603*ratioh,459*ratiow,625*ratioh,450*ratiow,638*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(363*ratiow,871*ratioh,360*ratiow,892*ratioh,380*ratiow,900*ratioh,393*ratiow,905*ratioh,424*ratiow,904*ratioh,446*ratiow,900*ratioh,486*ratiow,889*ratioh,517*ratiow,870*ratioh,539*ratiow,846*ratioh,554*ratiow,820*ratioh,570*ratiow,785*ratioh,581*ratiow,752*ratioh,593*ratiow,716*ratioh,596*ratiow,708*ratioh,567*ratiow,700*ratioh,569*ratiow,704*ratioh,568*ratiow,715*ratioh,564*ratiow,732*ratioh,559*ratiow,750*ratioh,553*ratiow,767*ratioh,544*ratiow,787*ratioh,535*ratiow,803*ratioh,526*ratiow,817*ratioh,512*ratiow,838*ratioh,501*ratiow,850*ratioh,489*ratiow,859*ratioh,477*ratiow,867*ratioh,465*ratiow,872*ratioh,440*ratiow,878*ratioh,421*ratiow,881*ratioh,406*ratiow,882*ratioh,384*ratiow,881*ratioh,369*ratiow,877*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(366*ratiow,867*ratioh,362*ratiow,870*ratioh,364*ratiow,874*ratioh,373*ratiow,878*ratioh,392*ratiow,882*ratioh,423*ratiow,881*ratioh,441*ratiow,878*ratioh,464*ratiow,872*ratioh,485*ratiow,863*ratioh,499*ratiow,852*ratioh,521*ratiow,825*ratioh,534*ratiow,804*ratioh,546*ratiow,783*ratioh,561*ratiow,744*ratioh,566*ratiow,722*ratioh,569*ratiow,708*ratioh,569*ratiow,701*ratioh,562*ratiow,698*ratioh,555*ratiow,705*ratioh,549*ratiow,720*ratioh,540*ratiow,741*ratioh,533*ratiow,759*ratioh,517*ratiow,794*ratioh,506*ratiow,814*ratioh,494*ratiow,828*ratioh,480*ratiow,841*ratioh,459*ratiow,847*ratioh,446*ratiow,847*ratioh,438*ratiow,849*ratioh,430*ratiow,856*ratioh,420*ratiow,864*ratioh,405*ratiow,869*ratioh,378*ratiow,869*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(364*ratiow,867*ratioh,372*ratiow,868*ratioh,396*ratiow,870*ratioh,412*ratiow,867*ratioh,422*ratiow,862*ratioh,434*ratiow,853*ratioh,441*ratiow,847*ratioh,460*ratiow,847*ratioh,476*ratiow,843*ratioh,486*ratiow,836*ratioh,504*ratiow,816*ratioh,514*ratiow,798*ratioh,523*ratiow,781*ratioh,545*ratiow,729*ratioh,551*ratiow,714*ratioh,556*ratiow,704*ratioh,562*ratiow,699*ratioh,539*ratiow,690*ratioh,525*ratiow,684*ratioh,511*ratiow,678*ratioh,516*ratiow,687*ratioh,518*ratiow,702*ratioh,517*ratiow,724*ratioh,513*ratiow,739*ratioh,506*ratiow,751*ratioh,499*ratiow,755*ratioh,492*ratiow,756*ratioh,483*ratiow,756*ratioh,474*ratiow,749*ratioh,473*ratiow,755*ratioh,471*ratiow,767*ratioh,464*ratiow,779*ratioh,453*ratiow,790*ratioh,442*ratiow,796*ratioh,431*ratiow,799*ratioh,426*ratiow,799*ratioh,424*ratiow,803*ratioh,417*ratiow,808*ratioh,410*ratiow,810*ratioh,401*ratiow,811*ratioh,389*ratiow,806*ratioh,389*ratiow,813*ratioh,386*ratiow,829*ratioh,377*ratiow,835*ratioh,365*ratiow,838*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile51(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 657;
var baseHeight = 870;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, CPu, Pir1, Pir2, Pir3, VPL";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(656*ratiow,309*ratioh,629*ratiow,297*ratioh,595*ratiow,279*ratioh,564*ratiow,256*ratioh,536*ratiow,232*ratioh,516*ratiow,219*ratioh,504*ratiow,215*ratioh,494*ratiow,213*ratioh,477*ratiow,216*ratioh,456*ratiow,224*ratioh,437*ratiow,234*ratioh,422*ratiow,248*ratioh,413*ratiow,261*ratioh,414*ratiow,276*ratioh,419*ratiow,287*ratioh,430*ratiow,298*ratioh,445*ratiow,309*ratioh,463*ratiow,318*ratioh,484*ratiow,326*ratioh,503*ratiow,334*ratioh,513*ratiow,336*ratioh,521*ratiow,340*ratioh,526*ratiow,343*ratioh,523*ratiow,346*ratioh,516*ratiow,350*ratioh,508*ratiow,353*ratioh,502*ratiow,356*ratioh,513*ratiow,363*ratioh,528*ratiow,373*ratioh,546*ratiow,379*ratioh,560*ratiow,382*ratioh,578*ratiow,384*ratioh,602*ratiow,386*ratioh,618*ratiow,382*ratioh,630*ratiow,373*ratioh,630*ratiow,297*ratioh,629*ratiow,297*ratioh,629*ratiow,296*ratioh,629*ratiow,297*ratioh,626*ratiow,291*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(239*ratiow,669*ratioh,244*ratiow,656*ratioh,251*ratiow,643*ratioh,264*ratiow,631*ratioh,277*ratiow,621*ratioh,287*ratiow,615*ratioh,278*ratiow,603*ratioh,267*ratiow,588*ratioh,259*ratiow,569*ratioh,254*ratiow,551*ratioh,255*ratiow,526*ratioh,258*ratiow,507*ratioh,267*ratiow,476*ratioh,272*ratiow,453*ratioh,274*ratiow,439*ratioh,274*ratiow,428*ratioh,266*ratiow,419*ratioh,262*ratiow,414*ratioh,263*ratiow,410*ratioh,268*ratiow,406*ratioh,276*ratiow,408*ratioh,278*ratiow,405*ratioh,277*ratiow,393*ratioh,274*ratiow,385*ratioh,273*ratiow,381*ratioh,274*ratiow,378*ratioh,278*ratiow,376*ratioh,282*ratiow,377*ratioh,285*ratiow,379*ratioh,287*ratiow,384*ratioh,289*ratiow,387*ratioh,293*ratiow,387*ratioh,295*ratiow,384*ratioh,295*ratiow,368*ratioh,296*ratiow,360*ratioh,299*ratiow,356*ratioh,302*ratiow,355*ratioh,306*ratiow,355*ratioh,312*ratiow,358*ratioh,317*ratiow,362*ratioh,319*ratiow,358*ratioh,322*ratiow,340*ratioh,322*ratiow,319*ratioh,320*ratiow,310*ratioh,318*ratiow,305*ratioh,313*ratiow,301*ratioh,309*ratiow,298*ratioh,305*ratiow,298*ratioh,298*ratiow,301*ratioh,286*ratiow,312*ratioh,274*ratiow,322*ratioh,257*ratiow,340*ratioh,246*ratiow,353*ratioh,231*ratiow,373*ratioh,215*ratiow,402*ratioh,204*ratiow,424*ratioh,194*ratiow,450*ratioh,186*ratiow,472*ratioh,183*ratiow,495*ratioh,179*ratiow,528*ratioh,179*ratiow,556*ratioh,181*ratiow,577*ratioh,185*ratiow,600*ratioh,188*ratiow,611*ratioh,196*ratiow,622*ratioh,210*ratiow,637*ratioh,220*ratiow,648*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(249*ratiow,851*ratioh,248*ratiow,868*ratioh,228*ratiow,869*ratioh,192*ratiow,867*ratioh,153*ratiow,856*ratioh,134*ratiow,845*ratioh,109*ratiow,822*ratioh,90*ratiow,798*ratioh,77*ratiow,779*ratioh,54*ratiow,733*ratioh,45*ratiow,707*ratioh,39*ratiow,686*ratioh,35*ratiow,667*ratioh,34*ratiow,652*ratioh,53*ratiow,652*ratioh,50*ratiow,657*ratioh,50*ratiow,666*ratioh,53*ratiow,679*ratioh,58*ratiow,693*ratioh,74*ratiow,733*ratioh,83*ratiow,750*ratioh,100*ratiow,780*ratioh,111*ratiow,797*ratioh,122*ratiow,809*ratioh,132*ratiow,819*ratioh,155*ratiow,834*ratioh,175*ratiow,842*ratioh,184*ratiow,844*ratioh,213*ratiow,850*ratioh,236*ratiow,852*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(245*ratiow,835*ratioh,250*ratiow,838*ratioh,250*ratiow,848*ratioh,247*ratiow,852*ratioh,221*ratiow,851*ratioh,195*ratiow,847*ratioh,179*ratiow,843*ratioh,153*ratiow,833*ratioh,141*ratiow,825*ratioh,122*ratiow,810*ratioh,112*ratiow,797*ratioh,96*ratiow,773*ratioh,88*ratiow,758*ratioh,68*ratiow,718*ratioh,62*ratiow,703*ratioh,54*ratiow,681*ratioh,50*ratiow,669*ratioh,50*ratiow,657*ratioh,52*ratiow,653*ratioh,57*ratiow,655*ratioh,63*ratiow,668*ratioh,70*ratiow,688*ratioh,81*ratiow,715*ratioh,102*ratiow,760*ratioh,109*ratiow,774*ratioh,123*ratiow,794*ratioh,133*ratiow,803*ratioh,147*ratiow,813*ratioh,167*ratiow,823*ratioh,184*ratiow,828*ratioh,209*ratiow,833*ratioh,223*ratiow,835*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(248*ratiow,835*ratioh,220*ratiow,835*ratioh,198*ratiow,831*ratioh,176*ratiow,826*ratioh,159*ratiow,820*ratioh,139*ratiow,809*ratioh,127*ratiow,798*ratioh,112*ratiow,780*ratioh,102*ratiow,761*ratioh,95*ratiow,748*ratioh,79*ratiow,710*ratioh,71*ratiow,690*ratioh,62*ratiow,665*ratioh,59*ratiow,658*ratioh,55*ratiow,654*ratioh,53*ratiow,652*ratioh,84*ratiow,652*ratioh,117*ratiow,650*ratioh,138*ratiow,647*ratioh,154*ratiow,643*ratioh,158*ratiow,641*ratioh,156*ratiow,645*ratioh,151*ratiow,654*ratioh,143*ratiow,667*ratioh,138*ratiow,680*ratioh,138*ratiow,696*ratioh,140*ratiow,705*ratioh,149*ratiow,717*ratioh,156*ratiow,722*ratioh,166*ratiow,722*ratioh,167*ratiow,723*ratioh,168*ratiow,737*ratioh,170*ratiow,747*ratioh,179*ratiow,760*ratioh,191*ratiow,765*ratioh,199*ratiow,765*ratioh,202*ratiow,775*ratioh,208*ratiow,785*ratioh,214*ratiow,790*ratioh,220*ratiow,792*ratioh,229*ratiow,792*ratioh,240*ratiow,788*ratioh,245*ratiow,781*ratioh,249*ratiow,772*ratioh,249*ratiow,776*ratioh,253*ratiow,792*ratioh,257*ratiow,802*ratioh,261*ratiow,808*ratioh,267*ratiow,812*ratioh,259*ratiow,818*ratioh,253*ratiow,823*ratioh,250*ratiow,829*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(447*ratiow,582*ratioh,452*ratiow,577*ratioh,452*ratiow,570*ratioh,449*ratiow,562*ratioh,444*ratiow,556*ratioh,439*ratiow,550*ratioh,435*ratiow,545*ratioh,430*ratiow,540*ratioh,425*ratiow,532*ratioh,421*ratiow,522*ratioh,415*ratiow,510*ratioh,409*ratiow,496*ratioh,405*ratiow,484*ratioh,402*ratiow,468*ratioh,400*ratiow,456*ratioh,399*ratiow,442*ratioh,399*ratiow,428*ratioh,399*ratiow,420*ratioh,396*ratiow,416*ratioh,387*ratiow,414*ratioh,379*ratiow,417*ratioh,372*ratiow,421*ratioh,365*ratiow,430*ratioh,361*ratiow,442*ratioh,357*ratiow,456*ratioh,355*ratiow,469*ratioh,355*ratiow,482*ratioh,358*ratiow,496*ratioh,361*ratiow,507*ratioh,370*ratiow,519*ratioh,379*ratiow,528*ratioh,390*ratiow,536*ratioh,401*ratiow,547*ratioh,414*ratiow,559*ratioh,426*ratiow,568*ratioh,437*ratiow,576*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(1*ratiow,309*ratioh,28*ratiow,297*ratioh,62*ratiow,279*ratioh,93*ratiow,256*ratioh,121*ratiow,232*ratioh,141*ratiow,219*ratioh,153*ratiow,215*ratioh,163*ratiow,213*ratioh,180*ratiow,216*ratioh,201*ratiow,224*ratioh,220*ratiow,234*ratioh,235*ratiow,248*ratioh,244*ratiow,261*ratioh,243*ratiow,276*ratioh,238*ratiow,287*ratioh,227*ratiow,298*ratioh,212*ratiow,309*ratioh,194*ratiow,318*ratioh,173*ratiow,326*ratioh,154*ratiow,334*ratioh,144*ratiow,336*ratioh,136*ratiow,340*ratioh,131*ratiow,343*ratioh,134*ratiow,346*ratioh,141*ratiow,350*ratioh,149*ratiow,353*ratioh,155*ratiow,356*ratioh,144*ratiow,363*ratioh,129*ratiow,373*ratioh,111*ratiow,379*ratioh,97*ratiow,382*ratioh,79*ratiow,384*ratioh,55*ratiow,386*ratioh,39*ratiow,382*ratioh,27*ratiow,373*ratioh,27*ratiow,297*ratioh,28*ratiow,297*ratioh,28*ratiow,296*ratioh,28*ratiow,297*ratioh,31*ratiow,291*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(418*ratiow,669*ratioh,413*ratiow,656*ratioh,406*ratiow,643*ratioh,393*ratiow,631*ratioh,380*ratiow,621*ratioh,370*ratiow,615*ratioh,379*ratiow,603*ratioh,390*ratiow,588*ratioh,398*ratiow,569*ratioh,403*ratiow,551*ratioh,402*ratiow,526*ratioh,399*ratiow,507*ratioh,390*ratiow,476*ratioh,385*ratiow,453*ratioh,383*ratiow,439*ratioh,383*ratiow,428*ratioh,391*ratiow,419*ratioh,395*ratiow,414*ratioh,394*ratiow,410*ratioh,389*ratiow,406*ratioh,381*ratiow,408*ratioh,379*ratiow,405*ratioh,380*ratiow,393*ratioh,383*ratiow,385*ratioh,384*ratiow,381*ratioh,383*ratiow,378*ratioh,379*ratiow,376*ratioh,375*ratiow,377*ratioh,372*ratiow,379*ratioh,370*ratiow,384*ratioh,368*ratiow,387*ratioh,364*ratiow,387*ratioh,362*ratiow,384*ratioh,362*ratiow,368*ratioh,361*ratiow,360*ratioh,358*ratiow,356*ratioh,355*ratiow,355*ratioh,351*ratiow,355*ratioh,345*ratiow,358*ratioh,340*ratiow,362*ratioh,338*ratiow,358*ratioh,335*ratiow,340*ratioh,335*ratiow,319*ratioh,337*ratiow,310*ratioh,339*ratiow,305*ratioh,344*ratiow,301*ratioh,348*ratiow,298*ratioh,352*ratiow,298*ratioh,359*ratiow,301*ratioh,371*ratiow,312*ratioh,383*ratiow,322*ratioh,400*ratiow,340*ratioh,411*ratiow,353*ratioh,426*ratiow,373*ratioh,442*ratiow,402*ratioh,453*ratiow,424*ratioh,463*ratiow,450*ratioh,471*ratiow,472*ratioh,474*ratiow,495*ratioh,478*ratiow,528*ratioh,478*ratiow,556*ratioh,476*ratiow,577*ratioh,472*ratiow,600*ratioh,469*ratiow,611*ratioh,461*ratiow,622*ratioh,447*ratiow,637*ratioh,437*ratiow,648*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(408*ratiow,851*ratioh,409*ratiow,868*ratioh,429*ratiow,869*ratioh,465*ratiow,867*ratioh,504*ratiow,856*ratioh,523*ratiow,845*ratioh,548*ratiow,822*ratioh,567*ratiow,798*ratioh,580*ratiow,779*ratioh,603*ratiow,733*ratioh,612*ratiow,707*ratioh,618*ratiow,686*ratioh,622*ratiow,667*ratioh,623*ratiow,652*ratioh,604*ratiow,652*ratioh,607*ratiow,657*ratioh,607*ratiow,666*ratioh,604*ratiow,679*ratioh,599*ratiow,693*ratioh,583*ratiow,733*ratioh,574*ratiow,750*ratioh,557*ratiow,780*ratioh,546*ratiow,797*ratioh,535*ratiow,809*ratioh,525*ratiow,819*ratioh,502*ratiow,834*ratioh,482*ratiow,842*ratioh,473*ratiow,844*ratioh,444*ratiow,850*ratioh,421*ratiow,852*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(412*ratiow,835*ratioh,407*ratiow,838*ratioh,407*ratiow,848*ratioh,410*ratiow,852*ratioh,436*ratiow,851*ratioh,462*ratiow,847*ratioh,478*ratiow,843*ratioh,504*ratiow,833*ratioh,516*ratiow,825*ratioh,535*ratiow,810*ratioh,545*ratiow,797*ratioh,561*ratiow,773*ratioh,569*ratiow,758*ratioh,589*ratiow,718*ratioh,595*ratiow,703*ratioh,603*ratiow,681*ratioh,607*ratiow,669*ratioh,607*ratiow,657*ratioh,605*ratiow,653*ratioh,600*ratiow,655*ratioh,594*ratiow,668*ratioh,587*ratiow,688*ratioh,576*ratiow,715*ratioh,555*ratiow,760*ratioh,548*ratiow,774*ratioh,534*ratiow,794*ratioh,524*ratiow,803*ratioh,510*ratiow,813*ratioh,490*ratiow,823*ratioh,473*ratiow,828*ratioh,448*ratiow,833*ratioh,434*ratiow,835*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(409*ratiow,835*ratioh,437*ratiow,835*ratioh,459*ratiow,831*ratioh,481*ratiow,826*ratioh,498*ratiow,820*ratioh,518*ratiow,809*ratioh,530*ratiow,798*ratioh,545*ratiow,780*ratioh,555*ratiow,761*ratioh,562*ratiow,748*ratioh,578*ratiow,710*ratioh,586*ratiow,690*ratioh,595*ratiow,665*ratioh,598*ratiow,658*ratioh,602*ratiow,654*ratioh,604*ratiow,652*ratioh,573*ratiow,652*ratioh,540*ratiow,650*ratioh,519*ratiow,647*ratioh,503*ratiow,643*ratioh,499*ratiow,641*ratioh,501*ratiow,645*ratioh,506*ratiow,654*ratioh,514*ratiow,667*ratioh,519*ratiow,680*ratioh,519*ratiow,696*ratioh,517*ratiow,705*ratioh,508*ratiow,717*ratioh,501*ratiow,722*ratioh,491*ratiow,722*ratioh,490*ratiow,723*ratioh,489*ratiow,737*ratioh,487*ratiow,747*ratioh,478*ratiow,760*ratioh,466*ratiow,765*ratioh,458*ratiow,765*ratioh,455*ratiow,775*ratioh,449*ratiow,785*ratioh,443*ratiow,790*ratioh,437*ratiow,792*ratioh,428*ratiow,792*ratioh,417*ratiow,788*ratioh,412*ratiow,781*ratioh,408*ratiow,772*ratioh,408*ratiow,776*ratioh,404*ratiow,792*ratioh,400*ratiow,802*ratioh,396*ratiow,808*ratioh,390*ratiow,812*ratioh,398*ratiow,818*ratioh,404*ratiow,823*ratioh,407*ratiow,829*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(210*ratiow,582*ratioh,205*ratiow,577*ratioh,205*ratiow,570*ratioh,208*ratiow,562*ratioh,213*ratiow,556*ratioh,218*ratiow,550*ratioh,222*ratiow,545*ratioh,227*ratiow,540*ratioh,232*ratiow,532*ratioh,236*ratiow,522*ratioh,242*ratiow,510*ratioh,248*ratiow,496*ratioh,252*ratiow,484*ratioh,255*ratiow,468*ratioh,257*ratiow,456*ratioh,258*ratiow,442*ratioh,258*ratiow,428*ratioh,258*ratiow,420*ratioh,261*ratiow,416*ratioh,270*ratiow,414*ratioh,278*ratiow,417*ratioh,285*ratiow,421*ratioh,292*ratiow,430*ratioh,296*ratiow,442*ratioh,300*ratiow,456*ratioh,302*ratiow,469*ratioh,302*ratiow,482*ratioh,299*ratiow,496*ratioh,296*ratiow,507*ratioh,287*ratiow,519*ratioh,278*ratiow,528*ratioh,267*ratiow,536*ratioh,256*ratiow,547*ratioh,243*ratiow,559*ratioh,231*ratiow,568*ratioh,220*ratiow,576*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile52(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 656;
var baseHeight = 869;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, CPu, Pir1, Pir2, Pir3, VPL";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(645*ratiow,302*ratioh,642*ratiow,310*ratioh,640*ratiow,326*ratioh,639*ratiow,338*ratioh,622*ratiow,352*ratioh,612*ratiow,361*ratioh,604*ratiow,361*ratioh,596*ratiow,359*ratioh,590*ratiow,359*ratioh,581*ratiow,361*ratioh,571*ratiow,364*ratioh,563*ratiow,364*ratioh,556*ratiow,359*ratioh,552*ratiow,356*ratioh,538*ratiow,353*ratioh,521*ratiow,347*ratioh,511*ratiow,342*ratioh,506*ratiow,340*ratioh,504*ratiow,336*ratioh,497*ratiow,330*ratioh,482*ratiow,324*ratioh,462*ratiow,319*ratioh,445*ratiow,311*ratioh,427*ratiow,302*ratioh,412*ratiow,291*ratioh,400*ratiow,275*ratioh,398*ratiow,260*ratioh,402*ratiow,250*ratioh,413*ratiow,238*ratioh,428*ratiow,225*ratioh,451*ratiow,213*ratioh,473*ratiow,205*ratioh,481*ratiow,203*ratioh,492*ratiow,203*ratioh,502*ratiow,206*ratioh,516*ratiow,211*ratioh,529*ratiow,220*ratioh,545*ratiow,232*ratioh,560*ratiow,245*ratioh,577*ratiow,258*ratioh,593*ratiow,269*ratioh,611*ratiow,280*ratioh,630*ratiow,290*ratioh,646*ratiow,296*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(244*ratiow,674*ratioh,240*ratiow,661*ratioh,241*ratiow,645*ratioh,251*ratiow,632*ratioh,267*ratiow,626*ratioh,281*ratiow,623*ratioh,294*ratiow,623*ratioh,285*ratiow,615*ratioh,269*ratiow,598*ratioh,260*ratiow,578*ratioh,253*ratiow,560*ratioh,252*ratiow,541*ratioh,258*ratiow,518*ratioh,272*ratiow,466*ratioh,276*ratiow,455*ratioh,277*ratiow,423*ratioh,282*ratiow,397*ratioh,291*ratiow,376*ratioh,299*ratiow,362*ratioh,306*ratiow,357*ratioh,316*ratiow,351*ratioh,318*ratiow,350*ratioh,317*ratiow,344*ratioh,316*ratiow,334*ratioh,316*ratiow,306*ratioh,314*ratiow,295*ratioh,312*ratiow,290*ratioh,304*ratiow,289*ratioh,294*ratiow,292*ratioh,281*ratiow,304*ratioh,255*ratiow,333*ratioh,233*ratiow,360*ratioh,213*ratiow,389*ratioh,197*ratiow,418*ratioh,188*ratiow,442*ratioh,178*ratiow,477*ratioh,172*ratiow,506*ratioh,168*ratiow,532*ratioh,166*ratiow,551*ratioh,168*ratiow,576*ratioh,174*ratiow,593*ratioh,185*ratiow,604*ratioh,202*ratiow,621*ratioh,216*ratiow,637*ratioh,222*ratiow,648*ratioh,240*ratiow,672*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(262*ratiow,849*ratioh,268*ratiow,866*ratioh,247*ratiow,868*ratioh,205*ratiow,868*ratioh,190*ratiow,866*ratioh,171*ratiow,863*ratioh,148*ratiow,853*ratioh,126*ratiow,837*ratioh,106*ratiow,817*ratioh,85*ratiow,790*ratioh,63*ratiow,758*ratioh,52*ratiow,734*ratioh,39*ratiow,704*ratioh,30*ratiow,671*ratioh,24*ratiow,639*ratioh,45*ratiow,637*ratioh,40*ratiow,641*ratioh,42*ratiow,653*ratioh,49*ratiow,671*ratioh,57*ratiow,691*ratioh,69*ratiow,722*ratioh,80*ratiow,742*ratioh,94*ratiow,768*ratioh,106*ratiow,786*ratioh,118*ratiow,801*ratioh,134*ratiow,821*ratioh,148*ratiow,833*ratioh,158*ratiow,839*ratioh,174*ratiow,844*ratioh,187*ratiow,847*ratioh,224*ratiow,855*ratioh,244*ratiow,858*ratioh,251*ratiow,857*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(258*ratiow,840*ratioh,263*ratiow,849*ratioh,255*ratiow,855*ratioh,246*ratiow,858*ratioh,233*ratiow,857*ratioh,216*ratiow,853*ratioh,180*ratiow,845*ratioh,162*ratiow,840*ratioh,149*ratiow,834*ratioh,130*ratiow,817*ratioh,117*ratiow,801*ratioh,103*ratiow,782*ratioh,75*ratiow,733*ratioh,64*ratiow,710*ratioh,57*ratiow,692*ratioh,44*ratiow,659*ratioh,41*ratiow,647*ratioh,41*ratiow,641*ratioh,44*ratiow,637*ratioh,48*ratiow,637*ratioh,52*ratiow,640*ratioh,57*ratiow,659*ratioh,66*ratiow,682*ratioh,81*ratiow,720*ratioh,98*ratiow,751*ratioh,113*ratiow,773*ratioh,126*ratiow,792*ratioh,138*ratiow,810*ratioh,148*ratiow,822*ratioh,155*ratiow,827*ratioh,171*ratiow,833*ratioh,189*ratiow,838*ratioh,217*ratiow,845*ratioh,231*ratiow,844*ratioh,250*ratiow,841*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(258*ratiow,840*ratioh,248*ratiow,841*ratioh,230*ratiow,844*ratioh,216*ratiow,844*ratioh,195*ratiow,840*ratioh,175*ratiow,834*ratioh,161*ratiow,829*ratioh,149*ratiow,823*ratioh,132*ratiow,801*ratioh,119*ratiow,782*ratioh,107*ratiow,764*ratioh,88*ratiow,735*ratioh,77*ratiow,708*ratioh,65*ratiow,680*ratioh,55*ratiow,652*ratioh,51*ratiow,640*ratioh,46*ratiow,636*ratioh,87*ratiow,631*ratioh,116*ratiow,625*ratioh,154*ratiow,615*ratioh,166*ratiow,610*ratioh,155*ratiow,622*ratioh,142*ratiow,649*ratioh,132*ratiow,673*ratioh,131*ratiow,689*ratioh,134*ratiow,702*ratioh,140*ratiow,713*ratioh,151*ratiow,721*ratioh,161*ratiow,725*ratioh,171*ratiow,725*ratioh,172*ratiow,741*ratioh,176*ratiow,754*ratioh,183*ratiow,765*ratioh,189*ratiow,772*ratioh,197*ratiow,776*ratioh,201*ratiow,778*ratioh,204*ratiow,789*ratioh,209*ratiow,797*ratioh,215*ratiow,801*ratioh,225*ratiow,806*ratioh,233*ratiow,808*ratioh,241*ratiow,807*ratioh,250*ratiow,799*ratioh,255*ratiow,793*ratioh,257*ratiow,797*ratioh,258*ratiow,802*ratioh,264*ratiow,807*ratioh,271*ratiow,811*ratioh,265*ratiow,812*ratioh,259*ratiow,819*ratioh,257*ratiow,830*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(465*ratiow,609*ratioh,445*ratiow,599*ratioh,422*ratiow,584*ratioh,403*ratiow,568*ratioh,387*ratiow,552*ratioh,372*ratiow,534*ratioh,352*ratiow,505*ratioh,345*ratiow,485*ratioh,344*ratiow,466*ratioh,349*ratiow,448*ratioh,357*ratiow,432*ratioh,368*ratiow,421*ratioh,388*ratiow,410*ratioh,396*ratiow,406*ratioh,402*ratiow,408*ratioh,409*ratiow,422*ratioh,412*ratiow,435*ratioh,412*ratiow,461*ratioh,414*ratiow,477*ratioh,423*ratiow,495*ratioh,444*ratiow,523*ratioh,459*ratiow,539*ratioh,472*ratiow,555*ratioh,480*ratiow,568*ratioh,485*ratiow,582*ratioh,485*ratiow,596*ratioh,473*ratiow,606*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(11*ratiow,302*ratioh,14*ratiow,310*ratioh,16*ratiow,326*ratioh,17*ratiow,338*ratioh,34*ratiow,352*ratioh,44*ratiow,361*ratioh,52*ratiow,361*ratioh,60*ratiow,359*ratioh,66*ratiow,359*ratioh,75*ratiow,361*ratioh,85*ratiow,364*ratioh,93*ratiow,364*ratioh,100*ratiow,359*ratioh,104*ratiow,356*ratioh,118*ratiow,353*ratioh,135*ratiow,347*ratioh,145*ratiow,342*ratioh,150*ratiow,340*ratioh,152*ratiow,336*ratioh,159*ratiow,330*ratioh,174*ratiow,324*ratioh,194*ratiow,319*ratioh,211*ratiow,311*ratioh,229*ratiow,302*ratioh,244*ratiow,291*ratioh,256*ratiow,275*ratioh,258*ratiow,260*ratioh,254*ratiow,250*ratioh,243*ratiow,238*ratioh,228*ratiow,225*ratioh,205*ratiow,213*ratioh,183*ratiow,205*ratioh,175*ratiow,203*ratioh,164*ratiow,203*ratioh,154*ratiow,206*ratioh,140*ratiow,211*ratioh,127*ratiow,220*ratioh,111*ratiow,232*ratioh,96*ratiow,245*ratioh,79*ratiow,258*ratioh,63*ratiow,269*ratioh,45*ratiow,280*ratioh,26*ratiow,290*ratioh,10*ratiow,296*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(412*ratiow,674*ratioh,416*ratiow,661*ratioh,415*ratiow,645*ratioh,405*ratiow,632*ratioh,389*ratiow,626*ratioh,375*ratiow,623*ratioh,362*ratiow,623*ratioh,371*ratiow,615*ratioh,387*ratiow,598*ratioh,396*ratiow,578*ratioh,403*ratiow,560*ratioh,404*ratiow,541*ratioh,398*ratiow,518*ratioh,384*ratiow,466*ratioh,380*ratiow,455*ratioh,379*ratiow,423*ratioh,374*ratiow,397*ratioh,365*ratiow,376*ratioh,357*ratiow,362*ratioh,350*ratiow,357*ratioh,340*ratiow,351*ratioh,338*ratiow,350*ratioh,339*ratiow,344*ratioh,340*ratiow,334*ratioh,340*ratiow,306*ratioh,342*ratiow,295*ratioh,344*ratiow,290*ratioh,352*ratiow,289*ratioh,362*ratiow,292*ratioh,375*ratiow,304*ratioh,401*ratiow,333*ratioh,423*ratiow,360*ratioh,443*ratiow,389*ratioh,459*ratiow,418*ratioh,468*ratiow,442*ratioh,478*ratiow,477*ratioh,484*ratiow,506*ratioh,488*ratiow,532*ratioh,490*ratiow,551*ratioh,488*ratiow,576*ratioh,482*ratiow,593*ratioh,471*ratiow,604*ratioh,454*ratiow,621*ratioh,440*ratiow,637*ratioh,434*ratiow,648*ratioh,416*ratiow,672*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(394*ratiow,849*ratioh,388*ratiow,866*ratioh,409*ratiow,868*ratioh,451*ratiow,868*ratioh,466*ratiow,866*ratioh,485*ratiow,863*ratioh,508*ratiow,853*ratioh,530*ratiow,837*ratioh,550*ratiow,817*ratioh,571*ratiow,790*ratioh,593*ratiow,758*ratioh,604*ratiow,734*ratioh,617*ratiow,704*ratioh,626*ratiow,671*ratioh,632*ratiow,639*ratioh,611*ratiow,637*ratioh,616*ratiow,641*ratioh,614*ratiow,653*ratioh,607*ratiow,671*ratioh,599*ratiow,691*ratioh,587*ratiow,722*ratioh,576*ratiow,742*ratioh,562*ratiow,768*ratioh,550*ratiow,786*ratioh,538*ratiow,801*ratioh,522*ratiow,821*ratioh,508*ratiow,833*ratioh,498*ratiow,839*ratioh,482*ratiow,844*ratioh,469*ratiow,847*ratioh,432*ratiow,855*ratioh,412*ratiow,858*ratioh,405*ratiow,857*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(398*ratiow,840*ratioh,393*ratiow,849*ratioh,401*ratiow,855*ratioh,410*ratiow,858*ratioh,423*ratiow,857*ratioh,440*ratiow,853*ratioh,476*ratiow,845*ratioh,494*ratiow,840*ratioh,507*ratiow,834*ratioh,526*ratiow,817*ratioh,539*ratiow,801*ratioh,553*ratiow,782*ratioh,581*ratiow,733*ratioh,592*ratiow,710*ratioh,599*ratiow,692*ratioh,612*ratiow,659*ratioh,615*ratiow,647*ratioh,615*ratiow,641*ratioh,612*ratiow,637*ratioh,608*ratiow,637*ratioh,604*ratiow,640*ratioh,599*ratiow,659*ratioh,590*ratiow,682*ratioh,575*ratiow,720*ratioh,558*ratiow,751*ratioh,543*ratiow,773*ratioh,530*ratiow,792*ratioh,518*ratiow,810*ratioh,508*ratiow,822*ratioh,501*ratiow,827*ratioh,485*ratiow,833*ratioh,467*ratiow,838*ratioh,439*ratiow,845*ratioh,425*ratiow,844*ratioh,406*ratiow,841*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(398*ratiow,840*ratioh,408*ratiow,841*ratioh,426*ratiow,844*ratioh,440*ratiow,844*ratioh,461*ratiow,840*ratioh,481*ratiow,834*ratioh,495*ratiow,829*ratioh,507*ratiow,823*ratioh,524*ratiow,801*ratioh,537*ratiow,782*ratioh,549*ratiow,764*ratioh,568*ratiow,735*ratioh,579*ratiow,708*ratioh,591*ratiow,680*ratioh,601*ratiow,652*ratioh,605*ratiow,640*ratioh,610*ratiow,636*ratioh,569*ratiow,631*ratioh,540*ratiow,625*ratioh,502*ratiow,615*ratioh,490*ratiow,610*ratioh,501*ratiow,622*ratioh,514*ratiow,649*ratioh,524*ratiow,673*ratioh,525*ratiow,689*ratioh,522*ratiow,702*ratioh,516*ratiow,713*ratioh,505*ratiow,721*ratioh,495*ratiow,725*ratioh,485*ratiow,725*ratioh,484*ratiow,741*ratioh,480*ratiow,754*ratioh,473*ratiow,765*ratioh,467*ratiow,772*ratioh,459*ratiow,776*ratioh,455*ratiow,778*ratioh,452*ratiow,789*ratioh,447*ratiow,797*ratioh,441*ratiow,801*ratioh,431*ratiow,806*ratioh,423*ratiow,808*ratioh,415*ratiow,807*ratioh,406*ratiow,799*ratioh,401*ratiow,793*ratioh,399*ratiow,797*ratioh,398*ratiow,802*ratioh,392*ratiow,807*ratioh,385*ratiow,811*ratioh,391*ratiow,812*ratioh,397*ratiow,819*ratioh,399*ratiow,830*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(191*ratiow,609*ratioh,211*ratiow,599*ratioh,234*ratiow,584*ratioh,253*ratiow,568*ratioh,269*ratiow,552*ratioh,284*ratiow,534*ratioh,304*ratiow,505*ratioh,311*ratiow,485*ratioh,312*ratiow,466*ratioh,307*ratiow,448*ratioh,299*ratiow,432*ratioh,288*ratiow,421*ratioh,268*ratiow,410*ratioh,260*ratiow,406*ratioh,254*ratiow,408*ratioh,247*ratiow,422*ratioh,244*ratiow,435*ratioh,244*ratiow,461*ratioh,242*ratiow,477*ratioh,233*ratiow,495*ratioh,212*ratiow,523*ratioh,197*ratiow,539*ratioh,184*ratiow,555*ratioh,176*ratiow,568*ratioh,171*ratiow,582*ratioh,171*ratiow,596*ratioh,183*ratiow,606*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile53(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 659;
var baseHeight = 882;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, CPu, Pir1, Pir2, Pir3, VPL";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(657*ratiow,297*ratioh,658*ratiow,351*ratioh,652*ratiow,360*ratioh,635*ratiow,370*ratioh,624*ratiow,375*ratioh,587*ratiow,378*ratioh,571*ratiow,380*ratioh,550*ratiow,380*ratioh,536*ratiow,376*ratioh,515*ratiow,365*ratioh,501*ratiow,355*ratioh,488*ratiow,346*ratioh,487*ratiow,345*ratioh,487*ratiow,340*ratioh,496*ratiow,335*ratioh,507*ratiow,332*ratioh,507*ratiow,330*ratioh,492*ratiow,325*ratioh,453*ratiow,316*ratioh,416*ratiow,300*ratioh,398*ratiow,290*ratioh,388*ratiow,281*ratioh,384*ratiow,270*ratioh,385*ratiow,254*ratioh,395*ratiow,240*ratioh,413*ratiow,225*ratioh,437*ratiow,210*ratioh,454*ratiow,201*ratioh,472*ratiow,195*ratioh,487*ratiow,193*ratioh,506*ratiow,194*ratioh,522*ratiow,202*ratioh,534*ratiow,211*ratioh,544*ratiow,222*ratioh,554*ratiow,232*ratioh,566*ratiow,243*ratioh,582*ratiow,255*ratioh,600*ratiow,266*ratioh,616*ratiow,274*ratioh,631*ratiow,282*ratioh,645*ratiow,291*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(233*ratiow,670*ratioh,237*ratiow,656*ratioh,248*ratiow,646*ratioh,260*ratiow,639*ratioh,275*ratiow,634*ratioh,285*ratiow,633*ratioh,295*ratiow,632*ratioh,309*ratiow,635*ratioh,302*ratiow,627*ratioh,290*ratiow,616*ratioh,276*ratiow,606*ratioh,267*ratiow,598*ratioh,258*ratiow,584*ratioh,252*ratiow,568*ratioh,249*ratiow,549*ratioh,249*ratiow,529*ratioh,251*ratiow,509*ratioh,254*ratiow,496*ratioh,260*ratiow,476*ratioh,262*ratiow,470*ratioh,260*ratiow,466*ratioh,261*ratiow,447*ratioh,259*ratiow,440*ratioh,257*ratiow,435*ratioh,258*ratiow,429*ratioh,264*ratiow,422*ratioh,264*ratiow,415*ratioh,260*ratiow,404*ratioh,264*ratiow,397*ratioh,271*ratiow,390*ratioh,271*ratiow,377*ratioh,269*ratiow,365*ratioh,269*ratiow,358*ratioh,273*ratiow,354*ratioh,277*ratiow,355*ratioh,282*ratiow,361*ratioh,285*ratiow,363*ratioh,289*ratiow,359*ratioh,290*ratiow,351*ratioh,290*ratiow,344*ratioh,292*ratiow,340*ratioh,294*ratiow,339*ratioh,298*ratiow,343*ratioh,302*ratiow,349*ratioh,305*ratiow,354*ratioh,306*ratiow,339*ratioh,304*ratiow,317*ratioh,302*ratiow,308*ratioh,299*ratiow,301*ratioh,295*ratiow,299*ratioh,288*ratiow,302*ratioh,272*ratiow,317*ratioh,264*ratiow,322*ratioh,253*ratiow,334*ratioh,243*ratiow,347*ratioh,232*ratiow,365*ratioh,222*ratiow,383*ratioh,210*ratiow,410*ratioh,198*ratiow,442*ratioh,192*ratiow,459*ratioh,185*ratiow,487*ratioh,179*ratiow,526*ratioh,177*ratiow,551*ratioh,177*ratiow,580*ratioh,179*ratiow,608*ratioh,187*ratiow,614*ratioh,205*ratiow,629*ratioh,216*ratiow,643*ratioh,219*ratiow,653*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(262*ratiow,851*ratioh,262*ratiow,877*ratioh,245*ratiow,880*ratioh,222*ratiow,881*ratioh,191*ratiow,878*ratioh,171*ratiow,873*ratioh,139*ratiow,857*ratioh,112*ratiow,835*ratioh,95*ratiow,812*ratioh,81*ratiow,787*ratioh,61*ratiow,751*ratioh,44*ratiow,704*ratioh,38*ratiow,676*ratioh,36*ratiow,653*ratioh,55*ratiow,652*ratioh,51*ratiow,657*ratioh,53*ratiow,672*ratioh,63*ratiow,696*ratioh,75*ratiow,723*ratioh,93*ratiow,759*ratioh,104*ratiow,781*ratioh,116*ratiow,803*ratioh,132*ratiow,822*ratioh,148*ratiow,838*ratioh,161*ratiow,846*ratioh,175*ratiow,852*ratioh,194*ratiow,858*ratioh,215*ratiow,859*ratioh,237*ratiow,858*ratioh,252*ratiow,855*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(262*ratiow,841*ratioh,262*ratiow,851*ratioh,250*ratiow,856*ratioh,228*ratiow,859*ratioh,208*ratiow,859*ratioh,193*ratiow,856*ratioh,177*ratiow,853*ratioh,156*ratiow,843*ratioh,139*ratiow,830*ratioh,129*ratiow,818*ratioh,112*ratiow,797*ratioh,101*ratiow,773*ratioh,90*ratiow,752*ratioh,78*ratiow,730*ratioh,58*ratiow,684*ratioh,51*ratiow,664*ratioh,51*ratiow,654*ratioh,53*ratiow,652*ratioh,57*ratiow,652*ratioh,61*ratiow,659*ratioh,68*ratiow,677*ratioh,77*ratiow,698*ratioh,92*ratiow,729*ratioh,112*ratiow,767*ratioh,120*ratiow,783*ratioh,137*ratiow,807*ratioh,150*ratiow,820*ratioh,169*ratiow,831*ratioh,197*ratiow,841*ratioh,225*ratiow,846*ratioh,248*ratiow,845*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(261*ratiow,841*ratioh,246*ratiow,845*ratioh,224*ratiow,846*ratioh,202*ratiow,842*ratioh,176*ratiow,834*ratioh,152*ratiow,822*ratioh,133*ratiow,803*ratioh,105*ratiow,754*ratioh,88*ratiow,720*ratioh,68*ratiow,678*ratioh,60*ratiow,657*ratioh,56*ratiow,652*ratioh,82*ratiow,647*ratioh,107*ratiow,642*ratioh,126*ratiow,637*ratioh,152*ratiow,628*ratioh,167*ratiow,621*ratioh,158*ratiow,635*ratioh,148*ratiow,652*ratioh,139*ratiow,668*ratioh,133*ratiow,679*ratioh,130*ratiow,699*ratioh,134*ratiow,719*ratioh,142*ratiow,730*ratioh,153*ratiow,735*ratioh,163*ratiow,733*ratioh,169*ratiow,730*ratioh,170*ratiow,746*ratioh,174*ratiow,762*ratioh,183*ratiow,775*ratioh,194*ratiow,783*ratioh,201*ratiow,785*ratioh,204*ratiow,795*ratioh,210*ratiow,805*ratioh,216*ratiow,811*ratioh,227*ratiow,815*ratioh,237*ratiow,815*ratioh,248*ratiow,808*ratioh,254*ratiow,798*ratioh,258*ratiow,790*ratioh,262*ratiow,797*ratioh,270*ratiow,804*ratioh,279*ratiow,809*ratioh,269*ratiow,813*ratioh,261*ratiow,819*ratioh,260*ratiow,827*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(458*ratiow,607*ratioh,428*ratiow,590*ratioh,396*ratiow,567*ratioh,373*ratiow,546*ratioh,356*ratiow,525*ratioh,347*ratiow,504*ratioh,342*ratiow,483*ratioh,342*ratiow,461*ratioh,346*ratiow,443*ratioh,353*ratiow,430*ratioh,363*ratiow,418*ratioh,373*ratiow,412*ratioh,385*ratiow,412*ratioh,391*ratiow,417*ratioh,397*ratiow,426*ratioh,398*ratiow,438*ratioh,398*ratiow,460*ratioh,408*ratiow,487*ratioh,420*ratiow,507*ratioh,433*ratiow,520*ratioh,447*ratiow,532*ratioh,459*ratiow,541*ratioh,476*ratiow,554*ratioh,492*ratiow,564*ratioh,503*ratiow,568*ratioh,494*ratiow,575*ratioh,483*ratiow,585*ratioh,472*ratiow,598*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(2*ratiow,297*ratioh,1*ratiow,351*ratioh,7*ratiow,360*ratioh,24*ratiow,370*ratioh,35*ratiow,375*ratioh,72*ratiow,378*ratioh,88*ratiow,380*ratioh,109*ratiow,380*ratioh,123*ratiow,376*ratioh,144*ratiow,365*ratioh,158*ratiow,355*ratioh,171*ratiow,346*ratioh,172*ratiow,345*ratioh,172*ratiow,340*ratioh,163*ratiow,335*ratioh,152*ratiow,332*ratioh,152*ratiow,330*ratioh,167*ratiow,325*ratioh,206*ratiow,316*ratioh,243*ratiow,300*ratioh,261*ratiow,290*ratioh,271*ratiow,281*ratioh,275*ratiow,270*ratioh,274*ratiow,254*ratioh,264*ratiow,240*ratioh,246*ratiow,225*ratioh,222*ratiow,210*ratioh,205*ratiow,201*ratioh,187*ratiow,195*ratioh,172*ratiow,193*ratioh,153*ratiow,194*ratioh,137*ratiow,202*ratioh,125*ratiow,211*ratioh,115*ratiow,222*ratioh,105*ratiow,232*ratioh,93*ratiow,243*ratioh,77*ratiow,255*ratioh,59*ratiow,266*ratioh,43*ratiow,274*ratioh,28*ratiow,282*ratioh,14*ratiow,291*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(426*ratiow,670*ratioh,422*ratiow,656*ratioh,411*ratiow,646*ratioh,399*ratiow,639*ratioh,384*ratiow,634*ratioh,374*ratiow,633*ratioh,364*ratiow,632*ratioh,350*ratiow,635*ratioh,357*ratiow,627*ratioh,369*ratiow,616*ratioh,383*ratiow,606*ratioh,392*ratiow,598*ratioh,401*ratiow,584*ratioh,407*ratiow,568*ratioh,410*ratiow,549*ratioh,410*ratiow,529*ratioh,408*ratiow,509*ratioh,405*ratiow,496*ratioh,399*ratiow,476*ratioh,397*ratiow,470*ratioh,399*ratiow,466*ratioh,398*ratiow,447*ratioh,400*ratiow,440*ratioh,402*ratiow,435*ratioh,401*ratiow,429*ratioh,395*ratiow,422*ratioh,395*ratiow,415*ratioh,399*ratiow,404*ratioh,395*ratiow,397*ratioh,388*ratiow,390*ratioh,388*ratiow,377*ratioh,390*ratiow,365*ratioh,390*ratiow,358*ratioh,386*ratiow,354*ratioh,382*ratiow,355*ratioh,377*ratiow,361*ratioh,374*ratiow,363*ratioh,370*ratiow,359*ratioh,369*ratiow,351*ratioh,369*ratiow,344*ratioh,367*ratiow,340*ratioh,365*ratiow,339*ratioh,361*ratiow,343*ratioh,357*ratiow,349*ratioh,354*ratiow,354*ratioh,353*ratiow,339*ratioh,355*ratiow,317*ratioh,357*ratiow,308*ratioh,360*ratiow,301*ratioh,364*ratiow,299*ratioh,371*ratiow,302*ratioh,387*ratiow,317*ratioh,395*ratiow,322*ratioh,406*ratiow,334*ratioh,416*ratiow,347*ratioh,427*ratiow,365*ratioh,437*ratiow,383*ratioh,449*ratiow,410*ratioh,461*ratiow,442*ratioh,467*ratiow,459*ratioh,474*ratiow,487*ratioh,480*ratiow,526*ratioh,482*ratiow,551*ratioh,482*ratiow,580*ratioh,480*ratiow,608*ratioh,472*ratiow,614*ratioh,454*ratiow,629*ratioh,443*ratiow,643*ratioh,440*ratiow,653*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(397*ratiow,851*ratioh,397*ratiow,877*ratioh,414*ratiow,880*ratioh,437*ratiow,881*ratioh,468*ratiow,878*ratioh,488*ratiow,873*ratioh,520*ratiow,857*ratioh,547*ratiow,835*ratioh,564*ratiow,812*ratioh,578*ratiow,787*ratioh,598*ratiow,751*ratioh,615*ratiow,704*ratioh,621*ratiow,676*ratioh,623*ratiow,653*ratioh,604*ratiow,652*ratioh,608*ratiow,657*ratioh,606*ratiow,672*ratioh,596*ratiow,696*ratioh,584*ratiow,723*ratioh,566*ratiow,759*ratioh,555*ratiow,781*ratioh,543*ratiow,803*ratioh,527*ratiow,822*ratioh,511*ratiow,838*ratioh,498*ratiow,846*ratioh,484*ratiow,852*ratioh,465*ratiow,858*ratioh,444*ratiow,859*ratioh,422*ratiow,858*ratioh,407*ratiow,855*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(397*ratiow,841*ratioh,397*ratiow,851*ratioh,409*ratiow,856*ratioh,431*ratiow,859*ratioh,451*ratiow,859*ratioh,466*ratiow,856*ratioh,482*ratiow,853*ratioh,503*ratiow,843*ratioh,520*ratiow,830*ratioh,530*ratiow,818*ratioh,547*ratiow,797*ratioh,558*ratiow,773*ratioh,569*ratiow,752*ratioh,581*ratiow,730*ratioh,601*ratiow,684*ratioh,608*ratiow,664*ratioh,608*ratiow,654*ratioh,606*ratiow,652*ratioh,602*ratiow,652*ratioh,598*ratiow,659*ratioh,591*ratiow,677*ratioh,582*ratiow,698*ratioh,567*ratiow,729*ratioh,547*ratiow,767*ratioh,539*ratiow,783*ratioh,522*ratiow,807*ratioh,509*ratiow,820*ratioh,490*ratiow,831*ratioh,462*ratiow,841*ratioh,434*ratiow,846*ratioh,411*ratiow,845*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(398*ratiow,841*ratioh,413*ratiow,845*ratioh,435*ratiow,846*ratioh,457*ratiow,842*ratioh,483*ratiow,834*ratioh,507*ratiow,822*ratioh,526*ratiow,803*ratioh,554*ratiow,754*ratioh,571*ratiow,720*ratioh,591*ratiow,678*ratioh,599*ratiow,657*ratioh,603*ratiow,652*ratioh,577*ratiow,647*ratioh,552*ratiow,642*ratioh,533*ratiow,637*ratioh,507*ratiow,628*ratioh,492*ratiow,621*ratioh,501*ratiow,635*ratioh,511*ratiow,652*ratioh,520*ratiow,668*ratioh,526*ratiow,679*ratioh,529*ratiow,699*ratioh,525*ratiow,719*ratioh,517*ratiow,730*ratioh,506*ratiow,735*ratioh,496*ratiow,733*ratioh,490*ratiow,730*ratioh,489*ratiow,746*ratioh,485*ratiow,762*ratioh,476*ratiow,775*ratioh,465*ratiow,783*ratioh,458*ratiow,785*ratioh,455*ratiow,795*ratioh,449*ratiow,805*ratioh,443*ratiow,811*ratioh,432*ratiow,815*ratioh,422*ratiow,815*ratioh,411*ratiow,808*ratioh,405*ratiow,798*ratioh,401*ratiow,790*ratioh,397*ratiow,797*ratioh,389*ratiow,804*ratioh,380*ratiow,809*ratioh,390*ratiow,813*ratioh,398*ratiow,819*ratioh,399*ratiow,827*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(201*ratiow,607*ratioh,231*ratiow,590*ratioh,263*ratiow,567*ratioh,286*ratiow,546*ratioh,303*ratiow,525*ratioh,312*ratiow,504*ratioh,317*ratiow,483*ratioh,317*ratiow,461*ratioh,313*ratiow,443*ratioh,306*ratiow,430*ratioh,296*ratiow,418*ratioh,286*ratiow,412*ratioh,274*ratiow,412*ratioh,268*ratiow,417*ratioh,262*ratiow,426*ratioh,261*ratiow,438*ratioh,261*ratiow,460*ratioh,251*ratiow,487*ratioh,239*ratiow,507*ratioh,226*ratiow,520*ratioh,212*ratiow,532*ratioh,200*ratiow,541*ratioh,183*ratiow,554*ratioh,167*ratiow,564*ratioh,156*ratiow,568*ratioh,165*ratiow,575*ratioh,176*ratiow,585*ratioh,187*ratiow,598*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile54(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 667;
var baseHeight = 866;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, CPu, Pir1, Pir2, Pir3, VPL";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(665*ratiow,287*ratioh,665*ratiow,314*ratioh,665*ratiow,350*ratioh,658*ratiow,361*ratioh,635*ratiow,370*ratioh,622*ratiow,373*ratioh,601*ratiow,371*ratioh,581*ratiow,374*ratioh,562*ratiow,375*ratioh,549*ratiow,373*ratioh,533*ratiow,363*ratioh,510*ratiow,348*ratioh,492*ratiow,337*ratioh,496*ratiow,331*ratioh,497*ratiow,325*ratioh,485*ratiow,320*ratioh,436*ratiow,310*ratioh,419*ratiow,306*ratioh,404*ratiow,301*ratioh,391*ratiow,291*ratioh,383*ratiow,277*ratioh,379*ratiow,262*ratioh,381*ratiow,253*ratioh,388*ratiow,241*ratioh,405*ratiow,224*ratioh,430*ratiow,207*ratioh,452*ratiow,198*ratioh,475*ratiow,192*ratioh,496*ratiow,191*ratioh,515*ratiow,192*ratioh,532*ratiow,197*ratioh,548*ratiow,209*ratioh,583*ratiow,243*ratioh,610*ratiow,267*ratioh,624*ratiow,275*ratioh,641*ratiow,283*ratioh,659*ratiow,287*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(205*ratiow,618*ratioh,259*ratiow,617*ratioh,269*ratiow,612*ratioh,284*ratiow,610*ratioh,298*ratiow,612*ratioh,303*ratiow,615*ratioh,301*ratiow,612*ratioh,287*ratiow,603*ratioh,277*ratiow,594*ratioh,265*ratiow,574*ratioh,255*ratiow,549*ratioh,249*ratiow,527*ratioh,248*ratiow,513*ratioh,257*ratiow,491*ratioh,263*ratiow,478*ratioh,271*ratiow,467*ratioh,267*ratiow,456*ratioh,266*ratiow,426*ratioh,264*ratiow,411*ratioh,257*ratiow,393*ratioh,258*ratiow,381*ratioh,265*ratiow,363*ratioh,275*ratiow,350*ratioh,285*ratiow,342*ratioh,294*ratiow,341*ratioh,301*ratiow,342*ratioh,304*ratiow,345*ratioh,305*ratiow,323*ratioh,305*ratiow,303*ratioh,305*ratiow,299*ratioh,297*ratiow,302*ratioh,280*ratiow,311*ratioh,258*ratiow,331*ratioh,241*ratiow,353*ratioh,224*ratiow,380*ratioh,215*ratiow,401*ratioh,204*ratiow,427*ratioh,193*ratiow,456*ratioh,180*ratiow,498*ratioh,176*ratiow,517*ratioh,174*ratiow,547*ratioh,174*ratiow,574*ratioh,176*ratiow,596*ratioh,183*ratiow,599*ratioh,191*ratiow,605*ratioh,200*ratiow,612*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(255*ratiow,849*ratioh,255*ratiow,863*ratioh,241*ratiow,864*ratioh,220*ratiow,864*ratioh,195*ratiow,858*ratioh,159*ratiow,846*ratioh,134*ratiow,834*ratioh,114*ratiow,817*ratioh,97*ratiow,795*ratioh,79*ratiow,762*ratioh,62*ratiow,724*ratioh,47*ratiow,685*ratioh,36*ratiow,656*ratioh,34*ratiow,649*ratioh,46*ratiow,647*ratioh,53*ratiow,655*ratioh,63*ratiow,673*ratioh,70*ratiow,687*ratioh,76*ratiow,703*ratioh,85*ratiow,730*ratioh,93*ratiow,752*ratioh,105*ratiow,777*ratioh,116*ratiow,794*ratioh,132*ratiow,810*ratioh,147*ratiow,822*ratioh,172*ratiow,836*ratioh,197*ratiow,845*ratioh,212*ratiow,849*ratioh,243*ratiow,849*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(254*ratiow,831*ratioh,255*ratiow,850*ratioh,232*ratiow,850*ratioh,211*ratiow,848*ratioh,189*ratiow,843*ratioh,151*ratiow,826*ratioh,124*ratiow,803*ratioh,110*ratiow,786*ratioh,100*ratiow,767*ratioh,88*ratiow,738*ratioh,80*ratiow,715*ratioh,71*ratiow,689*ratioh,57*ratiow,662*ratioh,51*ratiow,653*ratioh,46*ratiow,647*ratioh,61*ratiow,646*ratioh,67*ratiow,652*ratioh,74*ratiow,664*ratioh,82*ratiow,682*ratioh,89*ratiow,702*ratioh,100*ratiow,730*ratioh,112*ratiow,758*ratioh,133*ratiow,789*ratioh,148*ratiow,805*ratioh,170*ratiow,818*ratioh,192*ratiow,827*ratioh,212*ratiow,832*ratioh,231*ratiow,832*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(254*ratiow,831*ratioh,225*ratiow,832*ratioh,204*ratiow,830*ratioh,171*ratiow,819*ratioh,151*ratiow,807*ratioh,135*ratiow,791*ratioh,123*ratiow,776*ratioh,108*ratiow,750*ratioh,98*ratiow,727*ratioh,89*ratiow,701*ratioh,73*ratiow,660*ratioh,64*ratiow,648*ratioh,60*ratiow,645*ratioh,92*ratiow,640*ratioh,124*ratiow,633*ratioh,160*ratiow,621*ratioh,163*ratiow,620*ratioh,157*ratiow,631*ratioh,147*ratiow,645*ratioh,133*ratiow,673*ratioh,130*ratiow,689*ratioh,130*ratiow,710*ratioh,133*ratiow,720*ratioh,140*ratiow,723*ratioh,150*ratiow,722*ratioh,160*ratiow,717*ratioh,159*ratiow,731*ratioh,161*ratiow,750*ratioh,169*ratiow,761*ratioh,174*ratiow,765*ratioh,180*ratiow,766*ratioh,184*ratiow,759*ratioh,184*ratiow,757*ratioh,190*ratiow,759*ratioh,193*ratiow,772*ratioh,204*ratiow,785*ratioh,219*ratiow,794*ratioh,230*ratiow,798*ratioh,244*ratiow,797*ratioh,254*ratiow,785*ratioh,256*ratiow,783*ratioh,259*ratiow,786*ratioh,266*ratiow,789*ratioh,276*ratiow,793*ratioh,284*ratiow,795*ratioh,274*ratiow,798*ratioh,265*ratiow,803*ratioh,257*ratiow,808*ratioh,254*ratiow,820*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(442*ratiow,597*ratioh,415*ratiow,583*ratioh,391*ratiow,567*ratioh,375*ratiow,553*ratioh,362*ratiow,532*ratioh,353*ratiow,513*ratioh,347*ratiow,486*ratioh,341*ratiow,457*ratioh,341*ratiow,436*ratioh,343*ratiow,426*ratioh,355*ratiow,416*ratioh,371*ratiow,409*ratioh,382*ratiow,405*ratioh,396*ratiow,406*ratioh,405*ratiow,411*ratioh,409*ratiow,417*ratioh,407*ratiow,442*ratioh,405*ratiow,470*ratioh,406*ratiow,497*ratioh,412*ratiow,512*ratioh,420*ratiow,525*ratioh,430*ratiow,535*ratioh,440*ratiow,544*ratioh,450*ratiow,555*ratioh,457*ratiow,570*ratioh,460*ratiow,584*ratioh,460*ratiow,588*ratioh,449*ratiow,594*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(2*ratiow,287*ratioh,2*ratiow,314*ratioh,2*ratiow,350*ratioh,9*ratiow,361*ratioh,32*ratiow,370*ratioh,45*ratiow,373*ratioh,66*ratiow,371*ratioh,86*ratiow,374*ratioh,105*ratiow,375*ratioh,118*ratiow,373*ratioh,134*ratiow,363*ratioh,157*ratiow,348*ratioh,175*ratiow,337*ratioh,171*ratiow,331*ratioh,170*ratiow,325*ratioh,182*ratiow,320*ratioh,231*ratiow,310*ratioh,248*ratiow,306*ratioh,263*ratiow,301*ratioh,276*ratiow,291*ratioh,284*ratiow,277*ratioh,288*ratiow,262*ratioh,286*ratiow,253*ratioh,279*ratiow,241*ratioh,262*ratiow,224*ratioh,237*ratiow,207*ratioh,215*ratiow,198*ratioh,192*ratiow,192*ratioh,171*ratiow,191*ratioh,152*ratiow,192*ratioh,135*ratiow,197*ratioh,119*ratiow,209*ratioh,84*ratiow,243*ratioh,57*ratiow,267*ratioh,43*ratiow,275*ratioh,26*ratiow,283*ratioh,8*ratiow,287*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(462*ratiow,618*ratioh,408*ratiow,617*ratioh,398*ratiow,612*ratioh,383*ratiow,610*ratioh,369*ratiow,612*ratioh,364*ratiow,615*ratioh,366*ratiow,612*ratioh,380*ratiow,603*ratioh,390*ratiow,594*ratioh,402*ratiow,574*ratioh,412*ratiow,549*ratioh,418*ratiow,527*ratioh,419*ratiow,513*ratioh,410*ratiow,491*ratioh,404*ratiow,478*ratioh,396*ratiow,467*ratioh,400*ratiow,456*ratioh,401*ratiow,426*ratioh,403*ratiow,411*ratioh,410*ratiow,393*ratioh,409*ratiow,381*ratioh,402*ratiow,363*ratioh,392*ratiow,350*ratioh,382*ratiow,342*ratioh,373*ratiow,341*ratioh,366*ratiow,342*ratioh,363*ratiow,345*ratioh,362*ratiow,323*ratioh,362*ratiow,303*ratioh,362*ratiow,299*ratioh,370*ratiow,302*ratioh,387*ratiow,311*ratioh,409*ratiow,331*ratioh,426*ratiow,353*ratioh,443*ratiow,380*ratioh,452*ratiow,401*ratioh,463*ratiow,427*ratioh,474*ratiow,456*ratioh,487*ratiow,498*ratioh,491*ratiow,517*ratioh,493*ratiow,547*ratioh,493*ratiow,574*ratioh,491*ratiow,596*ratioh,484*ratiow,599*ratioh,476*ratiow,605*ratioh,467*ratiow,612*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(412*ratiow,849*ratioh,412*ratiow,863*ratioh,426*ratiow,864*ratioh,447*ratiow,864*ratioh,472*ratiow,858*ratioh,508*ratiow,846*ratioh,533*ratiow,834*ratioh,553*ratiow,817*ratioh,570*ratiow,795*ratioh,588*ratiow,762*ratioh,605*ratiow,724*ratioh,620*ratiow,685*ratioh,631*ratiow,656*ratioh,633*ratiow,649*ratioh,621*ratiow,647*ratioh,614*ratiow,655*ratioh,604*ratiow,673*ratioh,597*ratiow,687*ratioh,591*ratiow,703*ratioh,582*ratiow,730*ratioh,574*ratiow,752*ratioh,562*ratiow,777*ratioh,551*ratiow,794*ratioh,535*ratiow,810*ratioh,520*ratiow,822*ratioh,495*ratiow,836*ratioh,470*ratiow,845*ratioh,455*ratiow,849*ratioh,424*ratiow,849*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(413*ratiow,831*ratioh,412*ratiow,850*ratioh,435*ratiow,850*ratioh,456*ratiow,848*ratioh,478*ratiow,843*ratioh,516*ratiow,826*ratioh,543*ratiow,803*ratioh,557*ratiow,786*ratioh,567*ratiow,767*ratioh,579*ratiow,738*ratioh,587*ratiow,715*ratioh,596*ratiow,689*ratioh,610*ratiow,662*ratioh,616*ratiow,653*ratioh,621*ratiow,647*ratioh,606*ratiow,646*ratioh,600*ratiow,652*ratioh,593*ratiow,664*ratioh,585*ratiow,682*ratioh,578*ratiow,702*ratioh,567*ratiow,730*ratioh,555*ratiow,758*ratioh,534*ratiow,789*ratioh,519*ratiow,805*ratioh,497*ratiow,818*ratioh,475*ratiow,827*ratioh,455*ratiow,832*ratioh,436*ratiow,832*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(413*ratiow,831*ratioh,442*ratiow,832*ratioh,463*ratiow,830*ratioh,496*ratiow,819*ratioh,516*ratiow,807*ratioh,532*ratiow,791*ratioh,544*ratiow,776*ratioh,559*ratiow,750*ratioh,569*ratiow,727*ratioh,578*ratiow,701*ratioh,594*ratiow,660*ratioh,603*ratiow,648*ratioh,607*ratiow,645*ratioh,575*ratiow,640*ratioh,543*ratiow,633*ratioh,507*ratiow,621*ratioh,504*ratiow,620*ratioh,510*ratiow,631*ratioh,520*ratiow,645*ratioh,534*ratiow,673*ratioh,537*ratiow,689*ratioh,537*ratiow,710*ratioh,534*ratiow,720*ratioh,527*ratiow,723*ratioh,517*ratiow,722*ratioh,507*ratiow,717*ratioh,508*ratiow,731*ratioh,506*ratiow,750*ratioh,498*ratiow,761*ratioh,493*ratiow,765*ratioh,487*ratiow,766*ratioh,483*ratiow,759*ratioh,483*ratiow,757*ratioh,477*ratiow,759*ratioh,474*ratiow,772*ratioh,463*ratiow,785*ratioh,448*ratiow,794*ratioh,437*ratiow,798*ratioh,423*ratiow,797*ratioh,413*ratiow,785*ratioh,411*ratiow,783*ratioh,408*ratiow,786*ratioh,401*ratiow,789*ratioh,391*ratiow,793*ratioh,383*ratiow,795*ratioh,393*ratiow,798*ratioh,402*ratiow,803*ratioh,410*ratiow,808*ratioh,413*ratiow,820*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(225*ratiow,597*ratioh,252*ratiow,583*ratioh,276*ratiow,567*ratioh,292*ratiow,553*ratioh,305*ratiow,532*ratioh,314*ratiow,513*ratioh,320*ratiow,486*ratioh,326*ratiow,457*ratioh,326*ratiow,436*ratioh,324*ratiow,426*ratioh,312*ratiow,416*ratioh,296*ratiow,409*ratioh,285*ratiow,405*ratioh,271*ratiow,406*ratioh,262*ratiow,411*ratioh,258*ratiow,417*ratioh,260*ratiow,442*ratioh,262*ratiow,470*ratioh,261*ratiow,497*ratioh,255*ratiow,512*ratioh,247*ratiow,525*ratioh,237*ratiow,535*ratioh,227*ratiow,544*ratioh,217*ratiow,555*ratioh,210*ratiow,570*ratioh,207*ratiow,584*ratioh,207*ratiow,588*ratioh,218*ratiow,594*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile55(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 655;
var baseHeight = 876;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, CPu, Pir1, Pir2, Pir3, VPL";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(654*ratiow,298*ratioh,654*ratiow,361*ratioh,649*ratiow,368*ratioh,637*ratiow,376*ratioh,629*ratiow,380*ratioh,610*ratiow,380*ratioh,598*ratiow,380*ratioh,579*ratiow,383*ratioh,559*ratiow,386*ratioh,538*ratiow,382*ratioh,519*ratiow,373*ratioh,505*ratiow,365*ratioh,493*ratiow,355*ratioh,478*ratiow,346*ratioh,466*ratiow,340*ratioh,467*ratiow,338*ratioh,473*ratiow,334*ratioh,480*ratiow,331*ratioh,479*ratiow,327*ratioh,458*ratiow,323*ratioh,416*ratiow,316*ratioh,386*ratiow,310*ratioh,368*ratiow,301*ratioh,357*ratiow,286*ratioh,355*ratiow,269*ratioh,356*ratiow,257*ratioh,363*ratiow,243*ratioh,377*ratiow,228*ratioh,409*ratiow,209*ratioh,444*ratiow,194*ratioh,460*ratiow,189*ratioh,476*ratiow,187*ratioh,491*ratiow,187*ratioh,505*ratiow,191*ratioh,518*ratiow,196*ratioh,532*ratiow,206*ratioh,551*ratiow,227*ratioh,564*ratiow,244*ratioh,581*ratiow,260*ratioh,596*ratiow,272*ratioh,606*ratiow,280*ratioh,628*ratiow,289*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(200*ratiow,625*ratioh,291*ratiow,626*ratioh,279*ratiow,619*ratioh,267*ratiow,611*ratioh,256*ratiow,599*ratioh,249*ratiow,584*ratioh,243*ratiow,569*ratioh,239*ratiow,550*ratioh,239*ratiow,534*ratioh,243*ratiow,514*ratioh,249*ratiow,495*ratioh,251*ratiow,480*ratioh,251*ratiow,469*ratioh,242*ratiow,457*ratioh,232*ratiow,446*ratioh,225*ratiow,438*ratioh,225*ratiow,435*ratioh,227*ratiow,432*ratioh,231*ratiow,430*ratioh,239*ratiow,433*ratioh,245*ratiow,433*ratioh,251*ratiow,432*ratioh,254*ratiow,424*ratioh,253*ratiow,416*ratioh,244*ratiow,404*ratioh,243*ratiow,397*ratioh,244*ratiow,391*ratioh,257*ratiow,380*ratioh,257*ratiow,377*ratioh,253*ratiow,367*ratioh,253*ratiow,355*ratioh,256*ratiow,348*ratioh,260*ratiow,342*ratioh,264*ratiow,341*ratioh,269*ratiow,342*ratioh,273*ratiow,345*ratioh,274*ratiow,328*ratioh,277*ratiow,322*ratioh,280*ratiow,322*ratioh,283*ratiow,325*ratioh,286*ratiow,302*ratioh,287*ratiow,290*ratioh,279*ratiow,298*ratioh,266*ratiow,313*ratioh,254*ratiow,327*ratioh,241*ratiow,346*ratioh,228*ratiow,368*ratioh,215*ratiow,396*ratioh,203*ratiow,425*ratioh,197*ratiow,441*ratioh,184*ratiow,473*ratioh,177*ratiow,495*ratioh,173*ratiow,512*ratioh,169*ratiow,546*ratioh,169*ratiow,567*ratioh,173*ratiow,587*ratioh,179*ratiow,598*ratioh,190*ratiow,611*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(243*ratiow,862*ratioh,240*ratiow,875*ratioh,207*ratiow,874*ratioh,177*ratiow,871*ratioh,161*ratiow,865*ratioh,136*ratiow,849*ratioh,117*ratiow,832*ratioh,95*ratiow,806*ratioh,75*ratiow,773*ratioh,64*ratiow,748*ratioh,54*ratiow,719*ratioh,44*ratiow,685*ratioh,39*ratiow,658*ratioh,56*ratiow,658*ratioh,53*ratiow,662*ratioh,53*ratiow,674*ratioh,59*ratiow,692*ratioh,66*ratiow,714*ratioh,73*ratiow,734*ratioh,81*ratiow,751*ratioh,94*ratiow,776*ratioh,110*ratiow,801*ratioh,123*ratiow,817*ratioh,141*ratiow,833*ratioh,150*ratiow,840*ratioh,167*ratiow,851*ratioh,185*ratiow,858*ratioh,201*ratiow,861*ratioh,231*ratiow,862*ratioh,243*ratiow,862*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(246*ratiow,840*ratioh,243*ratiow,862*ratioh,213*ratiow,862*ratioh,187*ratiow,859*ratioh,164*ratiow,849*ratioh,141*ratiow,833*ratioh,125*ratiow,819*ratioh,105*ratiow,794*ratioh,90*ratiow,769*ratioh,76*ratiow,741*ratioh,68*ratiow,720*ratioh,57*ratiow,686*ratioh,52*ratiow,666*ratioh,54*ratiow,659*ratioh,59*ratiow,659*ratioh,63*ratiow,662*ratioh,66*ratiow,668*ratioh,71*ratiow,686*ratioh,79*ratiow,712*ratioh,89*ratiow,735*ratioh,103*ratiow,765*ratioh,116*ratiow,786*ratioh,136*ratiow,812*ratioh,156*ratiow,829*ratioh,174*ratiow,839*ratioh,190*ratiow,844*ratioh,209*ratiow,848*ratioh,222*ratiow,849*ratioh,236*ratiow,847*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(247*ratiow,840*ratioh,241*ratiow,845*ratioh,228*ratiow,849*ratioh,214*ratiow,849*ratioh,198*ratiow,846*ratioh,179*ratiow,841*ratioh,156*ratiow,829*ratioh,142*ratiow,817*ratioh,124*ratiow,797*ratioh,111*ratiow,779*ratioh,101*ratiow,762*ratioh,84*ratiow,725*ratioh,76*ratiow,700*ratioh,70*ratiow,679*ratioh,65*ratiow,665*ratioh,60*ratiow,659*ratioh,76*ratiow,657*ratioh,100*ratiow,653*ratioh,107*ratiow,651*ratioh,134*ratiow,642*ratioh,152*ratiow,633*ratioh,170*ratiow,622*ratioh,165*ratiow,632*ratioh,153*ratiow,651*ratioh,143*ratiow,672*ratioh,138*ratiow,689*ratioh,141*ratiow,710*ratioh,147*ratiow,723*ratioh,154*ratiow,733*ratioh,152*ratiow,736*ratioh,152*ratiow,751*ratioh,156*ratiow,762*ratioh,164*ratiow,772*ratioh,175*ratiow,778*ratioh,184*ratiow,781*ratioh,192*ratiow,780*ratioh,198*ratiow,776*ratioh,199*ratiow,786*ratioh,205*ratiow,799*ratioh,213*ratiow,810*ratioh,219*ratiow,815*ratioh,225*ratiow,817*ratioh,237*ratiow,816*ratioh,246*ratiow,812*ratioh,253*ratiow,805*ratioh,252*ratiow,811*ratioh,250*ratiow,823*ratioh,248*ratiow,837*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(429*ratiow,597*ratioh,404*ratiow,589*ratioh,380*ratiow,578*ratioh,371*ratiow,572*ratioh,354*ratiow,553*ratioh,337*ratiow,527*ratioh,329*ratiow,503*ratioh,325*ratiow,487*ratioh,327*ratiow,467*ratioh,331*ratiow,453*ratioh,336*ratiow,438*ratioh,347*ratiow,424*ratioh,360*ratiow,412*ratioh,366*ratiow,408*ratioh,372*ratiow,409*ratioh,379*ratiow,418*ratioh,383*ratiow,428*ratioh,383*ratiow,439*ratioh,380*ratiow,451*ratioh,374*ratiow,461*ratioh,369*ratiow,464*ratioh,370*ratiow,473*ratioh,384*ratiow,499*ratioh,396*ratiow,514*ratioh,414*ratiow,542*ratioh,427*ratiow,560*ratioh,440*ratiow,575*ratioh,452*ratiow,585*ratioh,448*ratiow,590*ratioh,441*ratiow,595*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(1*ratiow,298*ratioh,1*ratiow,361*ratioh,6*ratiow,368*ratioh,18*ratiow,376*ratioh,26*ratiow,380*ratioh,45*ratiow,380*ratioh,57*ratiow,380*ratioh,76*ratiow,383*ratioh,96*ratiow,386*ratioh,117*ratiow,382*ratioh,136*ratiow,373*ratioh,150*ratiow,365*ratioh,162*ratiow,355*ratioh,177*ratiow,346*ratioh,189*ratiow,340*ratioh,188*ratiow,338*ratioh,182*ratiow,334*ratioh,175*ratiow,331*ratioh,176*ratiow,327*ratioh,197*ratiow,323*ratioh,239*ratiow,316*ratioh,269*ratiow,310*ratioh,287*ratiow,301*ratioh,298*ratiow,286*ratioh,300*ratiow,269*ratioh,299*ratiow,257*ratioh,292*ratiow,243*ratioh,278*ratiow,228*ratioh,246*ratiow,209*ratioh,211*ratiow,194*ratioh,195*ratiow,189*ratioh,179*ratiow,187*ratioh,164*ratiow,187*ratioh,150*ratiow,191*ratioh,137*ratiow,196*ratioh,123*ratiow,206*ratioh,104*ratiow,227*ratioh,91*ratiow,244*ratioh,74*ratiow,260*ratioh,59*ratiow,272*ratioh,49*ratiow,280*ratioh,27*ratiow,289*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(455*ratiow,625*ratioh,364*ratiow,626*ratioh,376*ratiow,619*ratioh,388*ratiow,611*ratioh,399*ratiow,599*ratioh,406*ratiow,584*ratioh,412*ratiow,569*ratioh,416*ratiow,550*ratioh,416*ratiow,534*ratioh,412*ratiow,514*ratioh,406*ratiow,495*ratioh,404*ratiow,480*ratioh,404*ratiow,469*ratioh,413*ratiow,457*ratioh,423*ratiow,446*ratioh,430*ratiow,438*ratioh,430*ratiow,435*ratioh,428*ratiow,432*ratioh,424*ratiow,430*ratioh,416*ratiow,433*ratioh,410*ratiow,433*ratioh,404*ratiow,432*ratioh,401*ratiow,424*ratioh,402*ratiow,416*ratioh,411*ratiow,404*ratioh,412*ratiow,397*ratioh,411*ratiow,391*ratioh,398*ratiow,380*ratioh,398*ratiow,377*ratioh,402*ratiow,367*ratioh,402*ratiow,355*ratioh,399*ratiow,348*ratioh,395*ratiow,342*ratioh,391*ratiow,341*ratioh,386*ratiow,342*ratioh,382*ratiow,345*ratioh,381*ratiow,328*ratioh,378*ratiow,322*ratioh,375*ratiow,322*ratioh,372*ratiow,325*ratioh,369*ratiow,302*ratioh,368*ratiow,290*ratioh,376*ratiow,298*ratioh,389*ratiow,313*ratioh,401*ratiow,327*ratioh,414*ratiow,346*ratioh,427*ratiow,368*ratioh,440*ratiow,396*ratioh,452*ratiow,425*ratioh,458*ratiow,441*ratioh,471*ratiow,473*ratioh,478*ratiow,495*ratioh,482*ratiow,512*ratioh,486*ratiow,546*ratioh,486*ratiow,567*ratioh,482*ratiow,587*ratioh,476*ratiow,598*ratioh,465*ratiow,611*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(412*ratiow,862*ratioh,415*ratiow,875*ratioh,448*ratiow,874*ratioh,478*ratiow,871*ratioh,494*ratiow,865*ratioh,519*ratiow,849*ratioh,538*ratiow,832*ratioh,560*ratiow,806*ratioh,580*ratiow,773*ratioh,591*ratiow,748*ratioh,601*ratiow,719*ratioh,611*ratiow,685*ratioh,616*ratiow,658*ratioh,599*ratiow,658*ratioh,602*ratiow,662*ratioh,602*ratiow,674*ratioh,596*ratiow,692*ratioh,589*ratiow,714*ratioh,582*ratiow,734*ratioh,574*ratiow,751*ratioh,561*ratiow,776*ratioh,545*ratiow,801*ratioh,532*ratiow,817*ratioh,514*ratiow,833*ratioh,505*ratiow,840*ratioh,488*ratiow,851*ratioh,470*ratiow,858*ratioh,454*ratiow,861*ratioh,424*ratiow,862*ratioh,412*ratiow,862*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(409*ratiow,840*ratioh,412*ratiow,862*ratioh,442*ratiow,862*ratioh,468*ratiow,859*ratioh,491*ratiow,849*ratioh,514*ratiow,833*ratioh,530*ratiow,819*ratioh,550*ratiow,794*ratioh,565*ratiow,769*ratioh,579*ratiow,741*ratioh,587*ratiow,720*ratioh,598*ratiow,686*ratioh,603*ratiow,666*ratioh,601*ratiow,659*ratioh,596*ratiow,659*ratioh,592*ratiow,662*ratioh,589*ratiow,668*ratioh,584*ratiow,686*ratioh,576*ratiow,712*ratioh,566*ratiow,735*ratioh,552*ratiow,765*ratioh,539*ratiow,786*ratioh,519*ratiow,812*ratioh,499*ratiow,829*ratioh,481*ratiow,839*ratioh,465*ratiow,844*ratioh,446*ratiow,848*ratioh,433*ratiow,849*ratioh,419*ratiow,847*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(408*ratiow,840*ratioh,414*ratiow,845*ratioh,427*ratiow,849*ratioh,441*ratiow,849*ratioh,457*ratiow,846*ratioh,476*ratiow,841*ratioh,499*ratiow,829*ratioh,513*ratiow,817*ratioh,531*ratiow,797*ratioh,544*ratiow,779*ratioh,554*ratiow,762*ratioh,571*ratiow,725*ratioh,579*ratiow,700*ratioh,585*ratiow,679*ratioh,590*ratiow,665*ratioh,595*ratiow,659*ratioh,579*ratiow,657*ratioh,555*ratiow,653*ratioh,548*ratiow,651*ratioh,521*ratiow,642*ratioh,503*ratiow,633*ratioh,485*ratiow,622*ratioh,490*ratiow,632*ratioh,502*ratiow,651*ratioh,512*ratiow,672*ratioh,517*ratiow,689*ratioh,514*ratiow,710*ratioh,508*ratiow,723*ratioh,501*ratiow,733*ratioh,503*ratiow,736*ratioh,503*ratiow,751*ratioh,499*ratiow,762*ratioh,491*ratiow,772*ratioh,480*ratiow,778*ratioh,471*ratiow,781*ratioh,463*ratiow,780*ratioh,457*ratiow,776*ratioh,456*ratiow,786*ratioh,450*ratiow,799*ratioh,442*ratiow,810*ratioh,436*ratiow,815*ratioh,430*ratiow,817*ratioh,418*ratiow,816*ratioh,409*ratiow,812*ratioh,402*ratiow,805*ratioh,403*ratiow,811*ratioh,405*ratiow,823*ratioh,407*ratiow,837*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(226*ratiow,597*ratioh,251*ratiow,589*ratioh,275*ratiow,578*ratioh,284*ratiow,572*ratioh,301*ratiow,553*ratioh,318*ratiow,527*ratioh,326*ratiow,503*ratioh,330*ratiow,487*ratioh,328*ratiow,467*ratioh,324*ratiow,453*ratioh,319*ratiow,438*ratioh,308*ratiow,424*ratioh,295*ratiow,412*ratioh,289*ratiow,408*ratioh,283*ratiow,409*ratioh,276*ratiow,418*ratioh,272*ratiow,428*ratioh,272*ratiow,439*ratioh,275*ratiow,451*ratioh,281*ratiow,461*ratioh,286*ratiow,464*ratioh,285*ratiow,473*ratioh,271*ratiow,499*ratioh,259*ratiow,514*ratioh,241*ratiow,542*ratioh,228*ratiow,560*ratioh,215*ratiow,575*ratioh,203*ratiow,585*ratioh,207*ratiow,590*ratioh,214*ratiow,595*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile56(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 639;
var baseHeight = 881;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, CPu, Pir1, Pir2, Pir3, VPL";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(638*ratiow,287*ratioh,638*ratiow,351*ratioh,632*ratiow,359*ratioh,622*ratiow,365*ratioh,616*ratiow,366*ratioh,609*ratiow,370*ratioh,600*ratiow,372*ratioh,575*ratiow,372*ratioh,558*ratiow,374*ratioh,545*ratiow,376*ratioh,525*ratiow,373*ratioh,512*ratiow,368*ratioh,497*ratiow,358*ratioh,478*ratiow,345*ratioh,465*ratiow,337*ratioh,454*ratiow,333*ratioh,452*ratiow,331*ratioh,460*ratiow,320*ratioh,446*ratiow,320*ratioh,408*ratiow,318*ratioh,374*ratiow,316*ratioh,350*ratiow,310*ratioh,333*ratiow,303*ratioh,325*ratiow,297*ratioh,319*ratiow,283*ratioh,321*ratiow,262*ratioh,327*ratiow,246*ratioh,337*ratiow,233*ratioh,353*ratiow,221*ratioh,371*ratiow,213*ratioh,390*ratiow,205*ratioh,418*ratiow,194*ratioh,448*ratiow,185*ratioh,467*ratiow,184*ratioh,486*ratiow,186*ratioh,503*ratiow,193*ratioh,517*ratiow,201*ratioh,534*ratiow,219*ratioh,550*ratiow,239*ratioh,565*ratiow,256*ratioh,587*ratiow,271*ratioh,610*ratiow,282*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(189*ratiow,613*ratioh,291*ratiow,620*ratioh,291*ratiow,611*ratioh,273*ratiow,601*ratioh,251*ratiow,587*ratioh,242*ratiow,568*ratioh,239*ratiow,549*ratioh,238*ratiow,515*ratioh,241*ratiow,494*ratioh,244*ratiow,467*ratioh,243*ratiow,444*ratioh,244*ratiow,401*ratioh,242*ratiow,379*ratioh,242*ratiow,368*ratioh,247*ratiow,361*ratioh,253*ratiow,360*ratioh,261*ratiow,362*ratioh,264*ratiow,364*ratioh,262*ratiow,352*ratioh,262*ratiow,346*ratioh,265*ratiow,337*ratioh,265*ratiow,326*ratioh,263*ratiow,318*ratioh,268*ratiow,302*ratioh,277*ratiow,280*ratioh,281*ratiow,269*ratioh,270*ratiow,280*ratioh,257*ratiow,295*ratioh,239*ratiow,318*ratioh,214*ratiow,359*ratioh,197*ratiow,391*ratioh,187*ratiow,414*ratioh,180*ratiow,434*ratioh,173*ratiow,461*ratioh,162*ratiow,507*ratioh,157*ratiow,537*ratioh,157*ratiow,580*ratioh,157*ratiow,592*ratioh,168*ratiow,599*ratioh,178*ratiow,605*ratioh,187*ratiow,610*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(255*ratiow,861*ratioh,255*ratiow,880*ratioh,224*ratiow,880*ratioh,186*ratiow,875*ratioh,163*ratiow,867*ratioh,139*ratiow,857*ratioh,115*ratiow,841*ratioh,97*ratiow,823*ratioh,76*ratiow,794*ratioh,61*ratiow,765*ratioh,46*ratiow,729*ratioh,37*ratiow,696*ratioh,34*ratiow,682*ratioh,56*ratiow,678*ratioh,53*ratiow,684*ratioh,54*ratiow,695*ratioh,62*ratiow,715*ratioh,70*ratiow,737*ratioh,84*ratiow,767*ratioh,95*ratiow,786*ratioh,107*ratiow,803*ratioh,127*ratiow,828*ratioh,140*ratiow,839*ratioh,158*ratiow,848*ratioh,179*ratiow,855*ratioh,207*ratiow,863*ratioh,225*ratiow,864*ratioh,242*ratiow,863*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(254*ratiow,844*ratioh,255*ratiow,861*ratioh,233*ratiow,863*ratioh,217*ratiow,864*ratioh,198*ratiow,861*ratioh,176*ratiow,854*ratioh,151*ratiow,845*ratioh,134*ratiow,834*ratioh,118*ratiow,818*ratioh,104*ratiow,799*ratioh,93*ratiow,782*ratioh,80*ratiow,759*ratioh,70*ratiow,738*ratioh,56*ratiow,700*ratioh,53*ratiow,687*ratioh,53*ratiow,679*ratioh,57*ratiow,678*ratioh,60*ratiow,681*ratioh,65*ratiow,690*ratioh,72*ratiow,705*ratioh,84*ratiow,736*ratioh,99*ratiow,766*ratioh,113*ratiow,788*ratioh,124*ratiow,803*ratioh,139*ratiow,817*ratioh,159*ratiow,832*ratioh,183*ratiow,841*ratioh,197*ratiow,844*ratioh,218*ratiow,847*ratioh,244*ratiow,846*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(254*ratiow,844*ratioh,237*ratiow,847*ratioh,210*ratiow,846*ratioh,188*ratiow,843*ratioh,166*ratiow,835*ratioh,149*ratiow,826*ratioh,128*ratiow,808*ratioh,109*ratiow,783*ratioh,93*ratiow,755*ratioh,74*ratiow,711*ratioh,63*ratiow,686*ratioh,56*ratiow,678*ratioh,82*ratiow,671*ratioh,106*ratiow,663*ratioh,125*ratiow,655*ratioh,147*ratiow,644*ratioh,151*ratiow,642*ratioh,144*ratiow,655*ratioh,137*ratiow,671*ratioh,130*ratiow,689*ratioh,125*ratiow,705*ratioh,124*ratiow,719*ratioh,127*ratiow,733*ratioh,130*ratiow,739*ratioh,137*ratiow,746*ratioh,146*ratiow,748*ratioh,151*ratiow,758*ratioh,164*ratiow,773*ratioh,180*ratiow,783*ratioh,189*ratiow,786*ratioh,197*ratiow,787*ratioh,205*ratiow,802*ratioh,215*ratiow,812*ratioh,227*ratiow,816*ratioh,239*ratiow,812*ratioh,247*ratiow,803*ratioh,250*ratiow,798*ratioh,252*ratiow,803*ratioh,252*ratiow,824*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(445*ratiow,592*ratioh,426*ratiow,592*ratioh,401*ratiow,586*ratioh,378*ratiow,576*ratioh,357*ratiow,554*ratioh,344*ratiow,533*ratioh,333*ratiow,513*ratioh,325*ratiow,489*ratioh,321*ratiow,468*ratioh,321*ratiow,447*ratioh,325*ratiow,432*ratioh,340*ratiow,415*ratioh,355*ratiow,403*ratioh,361*ratiow,399*ratioh,365*ratiow,406*ratioh,364*ratiow,415*ratioh,359*ratiow,428*ratioh,358*ratiow,460*ratioh,363*ratiow,476*ratioh,374*ratiow,501*ratioh,388*ratiow,527*ratioh,401*ratiow,542*ratioh,421*ratiow,562*ratioh,442*ratiow,583*ratioh,449*ratiow,592*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(1*ratiow,287*ratioh,1*ratiow,351*ratioh,7*ratiow,359*ratioh,17*ratiow,365*ratioh,23*ratiow,366*ratioh,30*ratiow,370*ratioh,39*ratiow,372*ratioh,64*ratiow,372*ratioh,81*ratiow,374*ratioh,94*ratiow,376*ratioh,114*ratiow,373*ratioh,127*ratiow,368*ratioh,142*ratiow,358*ratioh,161*ratiow,345*ratioh,174*ratiow,337*ratioh,185*ratiow,333*ratioh,187*ratiow,331*ratioh,179*ratiow,320*ratioh,193*ratiow,320*ratioh,231*ratiow,318*ratioh,265*ratiow,316*ratioh,289*ratiow,310*ratioh,306*ratiow,303*ratioh,314*ratiow,297*ratioh,320*ratiow,283*ratioh,318*ratiow,262*ratioh,312*ratiow,246*ratioh,302*ratiow,233*ratioh,286*ratiow,221*ratioh,268*ratiow,213*ratioh,249*ratiow,205*ratioh,221*ratiow,194*ratioh,191*ratiow,185*ratioh,172*ratiow,184*ratioh,153*ratiow,186*ratioh,136*ratiow,193*ratioh,122*ratiow,201*ratioh,105*ratiow,219*ratioh,89*ratiow,239*ratioh,74*ratiow,256*ratioh,52*ratiow,271*ratioh,29*ratiow,282*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(450*ratiow,613*ratioh,348*ratiow,620*ratioh,348*ratiow,611*ratioh,366*ratiow,601*ratioh,388*ratiow,587*ratioh,397*ratiow,568*ratioh,400*ratiow,549*ratioh,401*ratiow,515*ratioh,398*ratiow,494*ratioh,395*ratiow,467*ratioh,396*ratiow,444*ratioh,395*ratiow,401*ratioh,397*ratiow,379*ratioh,397*ratiow,368*ratioh,392*ratiow,361*ratioh,386*ratiow,360*ratioh,378*ratiow,362*ratioh,375*ratiow,364*ratioh,377*ratiow,352*ratioh,377*ratiow,346*ratioh,374*ratiow,337*ratioh,374*ratiow,326*ratioh,376*ratiow,318*ratioh,371*ratiow,302*ratioh,362*ratiow,280*ratioh,358*ratiow,269*ratioh,369*ratiow,280*ratioh,382*ratiow,295*ratioh,400*ratiow,318*ratioh,425*ratiow,359*ratioh,442*ratiow,391*ratioh,452*ratiow,414*ratioh,459*ratiow,434*ratioh,466*ratiow,461*ratioh,477*ratiow,507*ratioh,482*ratiow,537*ratioh,482*ratiow,580*ratioh,482*ratiow,592*ratioh,471*ratiow,599*ratioh,461*ratiow,605*ratioh,452*ratiow,610*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(384*ratiow,861*ratioh,384*ratiow,880*ratioh,415*ratiow,880*ratioh,453*ratiow,875*ratioh,476*ratiow,867*ratioh,500*ratiow,857*ratioh,524*ratiow,841*ratioh,542*ratiow,823*ratioh,563*ratiow,794*ratioh,578*ratiow,765*ratioh,593*ratiow,729*ratioh,602*ratiow,696*ratioh,605*ratiow,682*ratioh,583*ratiow,678*ratioh,586*ratiow,684*ratioh,585*ratiow,695*ratioh,577*ratiow,715*ratioh,569*ratiow,737*ratioh,555*ratiow,767*ratioh,544*ratiow,786*ratioh,532*ratiow,803*ratioh,512*ratiow,828*ratioh,499*ratiow,839*ratioh,481*ratiow,848*ratioh,460*ratiow,855*ratioh,432*ratiow,863*ratioh,414*ratiow,864*ratioh,397*ratiow,863*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(385*ratiow,844*ratioh,384*ratiow,861*ratioh,406*ratiow,863*ratioh,422*ratiow,864*ratioh,441*ratiow,861*ratioh,463*ratiow,854*ratioh,488*ratiow,845*ratioh,505*ratiow,834*ratioh,521*ratiow,818*ratioh,535*ratiow,799*ratioh,546*ratiow,782*ratioh,559*ratiow,759*ratioh,569*ratiow,738*ratioh,583*ratiow,700*ratioh,586*ratiow,687*ratioh,586*ratiow,679*ratioh,582*ratiow,678*ratioh,579*ratiow,681*ratioh,574*ratiow,690*ratioh,567*ratiow,705*ratioh,555*ratiow,736*ratioh,540*ratiow,766*ratioh,526*ratiow,788*ratioh,515*ratiow,803*ratioh,500*ratiow,817*ratioh,480*ratiow,832*ratioh,456*ratiow,841*ratioh,442*ratiow,844*ratioh,421*ratiow,847*ratioh,395*ratiow,846*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(385*ratiow,844*ratioh,402*ratiow,847*ratioh,429*ratiow,846*ratioh,451*ratiow,843*ratioh,473*ratiow,835*ratioh,490*ratiow,826*ratioh,511*ratiow,808*ratioh,530*ratiow,783*ratioh,546*ratiow,755*ratioh,565*ratiow,711*ratioh,576*ratiow,686*ratioh,583*ratiow,678*ratioh,557*ratiow,671*ratioh,533*ratiow,663*ratioh,514*ratiow,655*ratioh,492*ratiow,644*ratioh,488*ratiow,642*ratioh,495*ratiow,655*ratioh,502*ratiow,671*ratioh,509*ratiow,689*ratioh,514*ratiow,705*ratioh,515*ratiow,719*ratioh,512*ratiow,733*ratioh,509*ratiow,739*ratioh,502*ratiow,746*ratioh,493*ratiow,748*ratioh,488*ratiow,758*ratioh,475*ratiow,773*ratioh,459*ratiow,783*ratioh,450*ratiow,786*ratioh,442*ratiow,787*ratioh,434*ratiow,802*ratioh,424*ratiow,812*ratioh,412*ratiow,816*ratioh,400*ratiow,812*ratioh,392*ratiow,803*ratioh,389*ratiow,798*ratioh,387*ratiow,803*ratioh,387*ratiow,824*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(194*ratiow,592*ratioh,213*ratiow,592*ratioh,238*ratiow,586*ratioh,261*ratiow,576*ratioh,282*ratiow,554*ratioh,295*ratiow,533*ratioh,306*ratiow,513*ratioh,314*ratiow,489*ratioh,318*ratiow,468*ratioh,318*ratiow,447*ratioh,314*ratiow,432*ratioh,299*ratiow,415*ratioh,284*ratiow,403*ratioh,278*ratiow,399*ratioh,274*ratiow,406*ratioh,275*ratiow,415*ratioh,280*ratiow,428*ratioh,281*ratiow,460*ratioh,276*ratiow,476*ratioh,265*ratiow,501*ratioh,251*ratiow,527*ratioh,238*ratiow,542*ratioh,218*ratiow,562*ratioh,197*ratiow,583*ratioh,190*ratiow,592*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile57(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 640;
var baseHeight = 842;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, CPu, Pir1, Pir2, Pir3, VPL";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(639*ratiow,347*ratioh,634*ratiow,354*ratioh,621*ratiow,362*ratioh,585*ratiow,369*ratioh,543*ratiow,371*ratioh,526*ratiow,368*ratioh,496*ratiow,353*ratioh,465*ratiow,334*ratioh,446*ratiow,324*ratioh,434*ratiow,321*ratioh,445*ratiow,312*ratioh,445*ratiow,308*ratioh,427*ratiow,308*ratioh,370*ratiow,310*ratioh,334*ratiow,309*ratioh,322*ratiow,304*ratioh,310*ratiow,294*ratioh,300*ratiow,282*ratioh,297*ratiow,270*ratioh,298*ratiow,256*ratioh,305*ratiow,242*ratioh,315*ratiow,231*ratioh,333*ratiow,218*ratioh,352*ratiow,208*ratioh,394*ratiow,191*ratioh,428*ratiow,181*ratioh,445*ratiow,177*ratioh,461*ratiow,177*ratioh,480*ratiow,179*ratioh,489*ratiow,181*ratioh,498*ratiow,184*ratioh,509*ratiow,190*ratioh,518*ratiow,197*ratioh,527*ratiow,207*ratioh,539*ratiow,223*ratioh,552*ratiow,239*ratioh,563*ratiow,251*ratioh,579*ratiow,264*ratioh,595*ratiow,273*ratioh,619*ratiow,282*ratioh,637*ratiow,285*ratioh,639*ratiow,285*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(177*ratiow,596*ratioh,262*ratiow,580*ratioh,247*ratiow,579*ratioh,232*ratiow,572*ratioh,225*ratiow,565*ratioh,216*ratiow,532*ratioh,211*ratiow,499*ratioh,215*ratiow,472*ratioh,216*ratiow,461*ratioh,214*ratiow,438*ratioh,214*ratiow,422*ratioh,228*ratiow,384*ratioh,236*ratiow,359*ratioh,238*ratiow,347*ratioh,238*ratiow,336*ratioh,235*ratiow,324*ratioh,230*ratiow,317*ratioh,213*ratiow,337*ratioh,204*ratiow,353*ratioh,190*ratiow,385*ratioh,179*ratiow,412*ratioh,160*ratiow,473*ratioh,154*ratiow,495*ratioh,152*ratiow,508*ratioh,151*ratiow,574*ratioh,167*ratiow,587*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(174*ratiow,837*ratioh,153*ratiow,832*ratioh,123*ratiow,816*ratioh,100*ratiow,796*ratioh,77*ratiow,769*ratioh,57*ratiow,737*ratioh,43*ratiow,701*ratioh,30*ratiow,663*ratioh,26*ratiow,647*ratioh,45*ratiow,644*ratioh,42*ratiow,649*ratioh,47*ratiow,665*ratioh,59*ratiow,688*ratioh,71*ratiow,714*ratioh,84*ratiow,738*ratioh,97*ratiow,760*ratioh,111*ratiow,776*ratioh,127*ratiow,791*ratioh,146*ratiow,804*ratioh,172*ratiow,817*ratioh,176*ratiow,818*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(175*ratiow,817*ratioh,163*ratiow,813*ratioh,138*ratiow,799*ratioh,114*ratiow,780*ratioh,95*ratiow,757*ratioh,75*ratiow,722*ratioh,60*ratiow,691*ratioh,47*ratiow,663*ratioh,42*ratiow,651*ratioh,42*ratiow,645*ratioh,48*ratiow,644*ratioh,54*ratiow,657*ratioh,68*ratiow,685*ratioh,82*ratiow,710*ratioh,100*ratiow,740*ratioh,121*ratiow,768*ratioh,144*ratiow,789*ratioh,167*ratiow,802*ratioh,177*ratiow,806*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(176*ratiow,806*ratioh,159*ratiow,798*ratioh,142*ratiow,787*ratioh,121*ratiow,767*ratioh,100*ratiow,740*ratioh,75*ratiow,697*ratioh,58*ratiow,665*ratioh,49*ratiow,646*ratioh,47*ratiow,643*ratioh,83*ratiow,635*ratioh,125*ratiow,621*ratioh,143*ratiow,612*ratioh,135*ratiow,629*ratioh,128*ratiow,653*ratioh,126*ratiow,672*ratioh,131*ratiow,694*ratioh,137*ratiow,708*ratioh,143*ratiow,714*ratioh,145*ratiow,727*ratioh,151*ratiow,736*ratioh,160*ratiow,746*ratioh,172*ratiow,752*ratioh,175*ratiow,752*ratioh,178*ratiow,757*ratioh,179*ratiow,765*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(419*ratiow,573*ratioh,406*ratiow,574*ratioh,382*ratiow,569*ratioh,359*ratiow,561*ratioh,333*ratiow,544*ratioh,312*ratiow,517*ratioh,297*ratiow,485*ratioh,295*ratiow,467*ratioh,301*ratiow,447*ratioh,309*ratiow,432*ratioh,322*ratiow,413*ratioh,322*ratiow,434*ratioh,324*ratiow,452*ratioh,336*ratiow,470*ratioh,348*ratiow,485*ratioh,362*ratiow,501*ratioh,379*ratiow,526*ratioh,393*ratiow,543*ratioh,402*ratiow,556*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(1*ratiow,347*ratioh,6*ratiow,354*ratioh,19*ratiow,362*ratioh,55*ratiow,369*ratioh,97*ratiow,371*ratioh,114*ratiow,368*ratioh,144*ratiow,353*ratioh,175*ratiow,334*ratioh,194*ratiow,324*ratioh,206*ratiow,321*ratioh,195*ratiow,312*ratioh,195*ratiow,308*ratioh,213*ratiow,308*ratioh,270*ratiow,310*ratioh,306*ratiow,309*ratioh,318*ratiow,304*ratioh,330*ratiow,294*ratioh,340*ratiow,282*ratioh,343*ratiow,270*ratioh,342*ratiow,256*ratioh,335*ratiow,242*ratioh,325*ratiow,231*ratioh,307*ratiow,218*ratioh,288*ratiow,208*ratioh,246*ratiow,191*ratioh,212*ratiow,181*ratioh,195*ratiow,177*ratioh,179*ratiow,177*ratioh,160*ratiow,179*ratioh,151*ratiow,181*ratioh,142*ratiow,184*ratioh,131*ratiow,190*ratioh,122*ratiow,197*ratioh,113*ratiow,207*ratioh,101*ratiow,223*ratioh,88*ratiow,239*ratioh,77*ratiow,251*ratioh,61*ratiow,264*ratioh,45*ratiow,273*ratioh,21*ratiow,282*ratioh,3*ratiow,285*ratioh,1*ratiow,285*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(463*ratiow,596*ratioh,378*ratiow,580*ratioh,393*ratiow,579*ratioh,408*ratiow,572*ratioh,415*ratiow,565*ratioh,424*ratiow,532*ratioh,429*ratiow,499*ratioh,425*ratiow,472*ratioh,424*ratiow,461*ratioh,426*ratiow,438*ratioh,426*ratiow,422*ratioh,412*ratiow,384*ratioh,404*ratiow,359*ratioh,402*ratiow,347*ratioh,402*ratiow,336*ratioh,405*ratiow,324*ratioh,410*ratiow,317*ratioh,427*ratiow,337*ratioh,436*ratiow,353*ratioh,450*ratiow,385*ratioh,461*ratiow,412*ratioh,480*ratiow,473*ratioh,486*ratiow,495*ratioh,488*ratiow,508*ratioh,489*ratiow,574*ratioh,473*ratiow,587*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(466*ratiow,837*ratioh,487*ratiow,832*ratioh,517*ratiow,816*ratioh,540*ratiow,796*ratioh,563*ratiow,769*ratioh,583*ratiow,737*ratioh,597*ratiow,701*ratioh,610*ratiow,663*ratioh,614*ratiow,647*ratioh,595*ratiow,644*ratioh,598*ratiow,649*ratioh,593*ratiow,665*ratioh,581*ratiow,688*ratioh,569*ratiow,714*ratioh,556*ratiow,738*ratioh,543*ratiow,760*ratioh,529*ratiow,776*ratioh,513*ratiow,791*ratioh,494*ratiow,804*ratioh,468*ratiow,817*ratioh,464*ratiow,818*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(465*ratiow,817*ratioh,477*ratiow,813*ratioh,502*ratiow,799*ratioh,526*ratiow,780*ratioh,545*ratiow,757*ratioh,565*ratiow,722*ratioh,580*ratiow,691*ratioh,593*ratiow,663*ratioh,598*ratiow,651*ratioh,598*ratiow,645*ratioh,592*ratiow,644*ratioh,586*ratiow,657*ratioh,572*ratiow,685*ratioh,558*ratiow,710*ratioh,540*ratiow,740*ratioh,519*ratiow,768*ratioh,496*ratiow,789*ratioh,473*ratiow,802*ratioh,463*ratiow,806*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(464*ratiow,806*ratioh,481*ratiow,798*ratioh,498*ratiow,787*ratioh,519*ratiow,767*ratioh,540*ratiow,740*ratioh,565*ratiow,697*ratioh,582*ratiow,665*ratioh,591*ratiow,646*ratioh,593*ratiow,643*ratioh,557*ratiow,635*ratioh,515*ratiow,621*ratioh,497*ratiow,612*ratioh,505*ratiow,629*ratioh,512*ratiow,653*ratioh,514*ratiow,672*ratioh,509*ratiow,694*ratioh,503*ratiow,708*ratioh,497*ratiow,714*ratioh,495*ratiow,727*ratioh,489*ratiow,736*ratioh,480*ratiow,746*ratioh,468*ratiow,752*ratioh,465*ratiow,752*ratioh,462*ratiow,757*ratioh,461*ratiow,765*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(221*ratiow,573*ratioh,234*ratiow,574*ratioh,258*ratiow,569*ratioh,281*ratiow,561*ratioh,307*ratiow,544*ratioh,328*ratiow,517*ratioh,343*ratiow,485*ratioh,345*ratiow,467*ratioh,339*ratiow,447*ratioh,331*ratiow,432*ratioh,318*ratiow,413*ratioh,318*ratiow,434*ratioh,316*ratiow,452*ratioh,304*ratiow,470*ratioh,292*ratiow,485*ratioh,278*ratiow,501*ratioh,261*ratiow,526*ratioh,247*ratiow,543*ratioh,238*ratiow,556*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile58(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 638;
var baseHeight = 866;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, CPu, Pir1, Pir2, Pir3, VPL, PVP";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(637*ratiow,333*ratioh,634*ratiow,341*ratioh,628*ratiow,348*ratioh,616*ratiow,357*ratioh,599*ratiow,363*ratioh,584*ratiow,366*ratioh,561*ratiow,368*ratioh,538*ratiow,366*ratioh,515*ratiow,359*ratioh,485*ratiow,346*ratioh,460*ratiow,334*ratioh,436*ratiow,324*ratioh,421*ratiow,319*ratioh,409*ratiow,318*ratioh,430*ratiow,321*ratioh,430*ratiow,315*ratioh,437*ratiow,310*ratioh,440*ratiow,308*ratioh,440*ratiow,306*ratioh,422*ratiow,308*ratioh,393*ratiow,312*ratioh,366*ratiow,314*ratioh,340*ratiow,311*ratioh,331*ratiow,309*ratioh,321*ratiow,304*ratioh,314*ratiow,298*ratioh,309*ratiow,286*ratioh,306*ratiow,274*ratioh,305*ratiow,263*ratioh,308*ratiow,250*ratioh,316*ratiow,235*ratioh,329*ratiow,220*ratioh,343*ratiow,209*ratioh,366*ratiow,197*ratioh,409*ratiow,182*ratioh,438*ratiow,175*ratioh,462*ratiow,170*ratioh,480*ratiow,171*ratioh,500*ratiow,178*ratioh,515*ratiow,187*ratioh,531*ratiow,204*ratioh,547*ratiow,225*ratioh,562*ratiow,242*ratioh,577*ratiow,257*ratioh,596*ratiow,267*ratioh,616*ratiow,274*ratioh,633*ratiow,278*ratioh,637*ratiow,278*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(201*ratiow,618*ratioh,280*ratiow,617*ratioh,278*ratiow,611*ratioh,273*ratiow,603*ratioh,263*ratiow,596*ratioh,252*ratiow,585*ratioh,247*ratiow,578*ratioh,247*ratiow,574*ratioh,251*ratiow,571*ratioh,243*ratiow,568*ratioh,236*ratiow,562*ratioh,229*ratiow,552*ratioh,223*ratiow,535*ratioh,220*ratiow,513*ratioh,221*ratiow,491*ratioh,221*ratiow,482*ratioh,214*ratiow,477*ratioh,206*ratiow,474*ratioh,203*ratiow,469*ratioh,203*ratiow,464*ratioh,207*ratiow,463*ratioh,213*ratiow,464*ratioh,220*ratiow,465*ratioh,223*ratiow,464*ratioh,223*ratiow,454*ratioh,219*ratiow,447*ratioh,210*ratiow,441*ratioh,207*ratiow,435*ratioh,207*ratiow,408*ratioh,209*ratiow,377*ratioh,211*ratiow,373*ratioh,213*ratiow,373*ratioh,217*ratiow,374*ratioh,225*ratiow,388*ratioh,228*ratiow,388*ratioh,234*ratiow,379*ratioh,234*ratiow,365*ratioh,233*ratiow,336*ratioh,234*ratiow,317*ratioh,230*ratiow,321*ratioh,220*ratiow,335*ratioh,208*ratiow,353*ratioh,195*ratiow,379*ratioh,184*ratiow,405*ratioh,172*ratiow,438*ratioh,166*ratiow,468*ratioh,161*ratiow,511*ratioh,161*ratiow,562*ratioh,161*ratiow,580*ratioh,163*ratiow,581*ratioh,173*ratiow,591*ratioh,192*ratiow,612*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(180*ratiow,843*ratioh,177*ratiow,859*ratioh,161*ratiow,853*ratioh,142*ratiow,842*ratioh,123*ratiow,824*ratioh,105*ratiow,804*ratioh,82*ratiow,770*ratioh,69*ratiow,738*ratioh,50*ratiow,692*ratioh,43*ratiow,670*ratioh,62*ratiow,666*ratioh,61*ratiow,671*ratioh,64*ratiow,678*ratioh,71*ratiow,692*ratioh,80*ratiow,710*ratioh,88*ratiow,728*ratioh,96*ratiow,748*ratioh,107*ratiow,771*ratioh,115*ratiow,788*ratioh,127*ratiow,804*ratioh,143*ratiow,820*ratioh,159*ratiow,833*ratioh,173*ratiow,841*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(184*ratiow,826*ratioh,180*ratiow,843*ratioh,169*ratiow,839*ratioh,152*ratiow,828*ratioh,131*ratiow,809*ratioh,116*ratiow,790*ratioh,101*ratiow,761*ratioh,91*ratiow,734*ratioh,81*ratiow,712*ratioh,70*ratiow,689*ratioh,60*ratiow,666*ratioh,73*ratiow,663*ratioh,78*ratiow,674*ratioh,87*ratiow,694*ratioh,98*ratiow,714*ratioh,109*ratiow,737*ratioh,122*ratiow,763*ratioh,137*ratiow,788*ratioh,153*ratiow,809*ratioh,171*ratiow,822*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(184*ratiow,826*ratioh,172*ratiow,823*ratioh,154*ratiow,809*ratioh,140*ratiow,791*ratioh,125*ratiow,769*ratioh,112*ratiow,743*ratioh,100*ratiow,719*ratioh,80*ratiow,679*ratioh,72*ratiow,663*ratioh,100*ratiow,654*ratioh,123*ratiow,645*ratioh,145*ratiow,636*ratioh,155*ratiow,630*ratioh,154*ratiow,641*ratioh,150*ratiow,647*ratioh,144*ratiow,659*ratioh,140*ratiow,670*ratioh,138*ratiow,686*ratioh,137*ratiow,703*ratioh,138*ratiow,717*ratioh,140*ratiow,724*ratioh,143*ratiow,729*ratioh,149*ratiow,732*ratioh,149*ratiow,739*ratioh,151*ratiow,749*ratioh,154*ratiow,760*ratioh,164*ratiow,769*ratioh,175*ratiow,770*ratioh,181*ratiow,769*ratioh,188*ratiow,765*ratioh,194*ratiow,773*ratioh,191*ratiow,791*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(426*ratiow,587*ratioh,411*ratiow,588*ratioh,391*ratiow,586*ratioh,373*ratiow,578*ratioh,356*ratiow,565*ratioh,340*ratiow,551*ratioh,335*ratiow,546*ratioh,329*ratiow,532*ratioh,322*ratiow,505*ratioh,314*ratiow,485*ratioh,312*ratiow,471*ratioh,312*ratiow,456*ratioh,320*ratiow,438*ratioh,333*ratiow,419*ratioh,336*ratiow,425*ratioh,343*ratiow,443*ratioh,352*ratiow,465*ratioh,362*ratiow,486*ratioh,373*ratiow,512*ratioh,385*ratiow,532*ratioh,399*ratiow,551*ratioh,411*ratiow,567*ratioh,421*ratiow,577*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(637*ratiow,405*ratioh,625*ratiow,403*ratioh,614*ratiow,397*ratioh,610*ratiow,396*ratioh,608*ratiow,399*ratioh,605*ratiow,403*ratioh,606*ratiow,412*ratioh,614*ratiow,429*ratioh,623*ratiow,451*ratioh,628*ratiow,462*ratioh,636*ratiow,467*ratioh,637*ratiow,466*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(1*ratiow,333*ratioh,4*ratiow,341*ratioh,10*ratiow,348*ratioh,22*ratiow,357*ratioh,39*ratiow,363*ratioh,54*ratiow,366*ratioh,77*ratiow,368*ratioh,100*ratiow,366*ratioh,123*ratiow,359*ratioh,153*ratiow,346*ratioh,178*ratiow,334*ratioh,202*ratiow,324*ratioh,217*ratiow,319*ratioh,229*ratiow,318*ratioh,208*ratiow,321*ratioh,208*ratiow,315*ratioh,201*ratiow,310*ratioh,198*ratiow,308*ratioh,198*ratiow,306*ratioh,216*ratiow,308*ratioh,245*ratiow,312*ratioh,272*ratiow,314*ratioh,298*ratiow,311*ratioh,307*ratiow,309*ratioh,317*ratiow,304*ratioh,324*ratiow,298*ratioh,329*ratiow,286*ratioh,332*ratiow,274*ratioh,333*ratiow,263*ratioh,330*ratiow,250*ratioh,322*ratiow,235*ratioh,309*ratiow,220*ratioh,295*ratiow,209*ratioh,272*ratiow,197*ratioh,229*ratiow,182*ratioh,200*ratiow,175*ratioh,176*ratiow,170*ratioh,158*ratiow,171*ratioh,138*ratiow,178*ratioh,123*ratiow,187*ratioh,107*ratiow,204*ratioh,91*ratiow,225*ratioh,76*ratiow,242*ratioh,61*ratiow,257*ratioh,42*ratiow,267*ratioh,22*ratiow,274*ratioh,5*ratiow,278*ratioh,1*ratiow,278*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(437*ratiow,618*ratioh,358*ratiow,617*ratioh,360*ratiow,611*ratioh,365*ratiow,603*ratioh,375*ratiow,596*ratioh,386*ratiow,585*ratioh,391*ratiow,578*ratioh,391*ratiow,574*ratioh,387*ratiow,571*ratioh,395*ratiow,568*ratioh,402*ratiow,562*ratioh,409*ratiow,552*ratioh,415*ratiow,535*ratioh,418*ratiow,513*ratioh,417*ratiow,491*ratioh,417*ratiow,482*ratioh,424*ratiow,477*ratioh,432*ratiow,474*ratioh,435*ratiow,469*ratioh,435*ratiow,464*ratioh,431*ratiow,463*ratioh,425*ratiow,464*ratioh,418*ratiow,465*ratioh,415*ratiow,464*ratioh,415*ratiow,454*ratioh,419*ratiow,447*ratioh,428*ratiow,441*ratioh,431*ratiow,435*ratioh,431*ratiow,408*ratioh,429*ratiow,377*ratioh,427*ratiow,373*ratioh,425*ratiow,373*ratioh,421*ratiow,374*ratioh,413*ratiow,388*ratioh,410*ratiow,388*ratioh,404*ratiow,379*ratioh,404*ratiow,365*ratioh,405*ratiow,336*ratioh,404*ratiow,317*ratioh,408*ratiow,321*ratioh,418*ratiow,335*ratioh,430*ratiow,353*ratioh,443*ratiow,379*ratioh,454*ratiow,405*ratioh,466*ratiow,438*ratioh,472*ratiow,468*ratioh,477*ratiow,511*ratioh,477*ratiow,562*ratioh,477*ratiow,580*ratioh,475*ratiow,581*ratioh,465*ratiow,591*ratioh,446*ratiow,612*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(458*ratiow,843*ratioh,461*ratiow,859*ratioh,477*ratiow,853*ratioh,496*ratiow,842*ratioh,515*ratiow,824*ratioh,533*ratiow,804*ratioh,556*ratiow,770*ratioh,569*ratiow,738*ratioh,588*ratiow,692*ratioh,595*ratiow,670*ratioh,576*ratiow,666*ratioh,577*ratiow,671*ratioh,574*ratiow,678*ratioh,567*ratiow,692*ratioh,558*ratiow,710*ratioh,550*ratiow,728*ratioh,542*ratiow,748*ratioh,531*ratiow,771*ratioh,523*ratiow,788*ratioh,511*ratiow,804*ratioh,495*ratiow,820*ratioh,479*ratiow,833*ratioh,465*ratiow,841*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(454*ratiow,826*ratioh,458*ratiow,843*ratioh,469*ratiow,839*ratioh,486*ratiow,828*ratioh,507*ratiow,809*ratioh,522*ratiow,790*ratioh,537*ratiow,761*ratioh,547*ratiow,734*ratioh,557*ratiow,712*ratioh,568*ratiow,689*ratioh,578*ratiow,666*ratioh,565*ratiow,663*ratioh,560*ratiow,674*ratioh,551*ratiow,694*ratioh,540*ratiow,714*ratioh,529*ratiow,737*ratioh,516*ratiow,763*ratioh,501*ratiow,788*ratioh,485*ratiow,809*ratioh,467*ratiow,822*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(454*ratiow,826*ratioh,466*ratiow,823*ratioh,484*ratiow,809*ratioh,498*ratiow,791*ratioh,513*ratiow,769*ratioh,526*ratiow,743*ratioh,538*ratiow,719*ratioh,558*ratiow,679*ratioh,566*ratiow,663*ratioh,538*ratiow,654*ratioh,515*ratiow,645*ratioh,493*ratiow,636*ratioh,483*ratiow,630*ratioh,484*ratiow,641*ratioh,488*ratiow,647*ratioh,494*ratiow,659*ratioh,498*ratiow,670*ratioh,500*ratiow,686*ratioh,501*ratiow,703*ratioh,500*ratiow,717*ratioh,498*ratiow,724*ratioh,495*ratiow,729*ratioh,489*ratiow,732*ratioh,489*ratiow,739*ratioh,487*ratiow,749*ratioh,484*ratiow,760*ratioh,474*ratiow,769*ratioh,463*ratiow,770*ratioh,457*ratiow,769*ratioh,450*ratiow,765*ratioh,444*ratiow,773*ratioh,447*ratiow,791*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(212*ratiow,587*ratioh,227*ratiow,588*ratioh,247*ratiow,586*ratioh,265*ratiow,578*ratioh,282*ratiow,565*ratioh,298*ratiow,551*ratioh,303*ratiow,546*ratioh,309*ratiow,532*ratioh,316*ratiow,505*ratioh,324*ratiow,485*ratioh,326*ratiow,471*ratioh,326*ratiow,456*ratioh,318*ratiow,438*ratioh,305*ratiow,419*ratioh,302*ratiow,425*ratioh,295*ratiow,443*ratioh,286*ratiow,465*ratioh,276*ratiow,486*ratioh,265*ratiow,512*ratioh,253*ratiow,532*ratioh,239*ratiow,551*ratioh,227*ratiow,567*ratioh,217*ratiow,577*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(1*ratiow,405*ratioh,13*ratiow,403*ratioh,24*ratiow,397*ratioh,28*ratiow,396*ratioh,30*ratiow,399*ratioh,33*ratiow,403*ratioh,32*ratiow,412*ratioh,24*ratiow,429*ratioh,15*ratiow,451*ratioh,10*ratiow,462*ratioh,2*ratiow,467*ratioh,1*ratiow,466*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile59(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 667;
var baseHeight = 887;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, CPu, Pir1, Pir2, Pir3, VPL, PVP";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(666*ratiow,303*ratioh,666*ratiow,323*ratioh,660*ratiow,337*ratioh,654*ratiow,345*ratioh,649*ratiow,346*ratioh,644*ratiow,351*ratioh,640*ratiow,358*ratioh,635*ratiow,364*ratioh,614*ratiow,373*ratioh,602*ratiow,378*ratioh,580*ratiow,380*ratioh,549*ratiow,377*ratioh,519*ratiow,362*ratioh,491*ratiow,345*ratioh,450*ratiow,328*ratioh,436*ratiow,323*ratioh,437*ratiow,320*ratioh,443*ratiow,317*ratioh,446*ratiow,311*ratioh,448*ratiow,309*ratioh,448*ratiow,305*ratioh,446*ratiow,305*ratioh,440*ratiow,308*ratioh,416*ratiow,318*ratioh,390*ratiow,323*ratioh,367*ratiow,325*ratioh,328*ratiow,321*ratioh,315*ratiow,313*ratioh,301*ratiow,300*ratioh,295*ratiow,285*ratioh,295*ratiow,273*ratioh,299*ratiow,261*ratioh,311*ratiow,242*ratioh,322*ratiow,229*ratioh,337*ratiow,216*ratioh,361*ratiow,202*ratioh,381*ratiow,194*ratioh,400*ratiow,187*ratioh,438*ratiow,177*ratioh,456*ratiow,173*ratioh,472*ratiow,173*ratioh,490*ratiow,173*ratioh,506*ratiow,178*ratioh,521*ratiow,183*ratioh,534*ratiow,194*ratioh,552*ratiow,212*ratioh,577*ratiow,242*ratioh,589*ratiow,254*ratioh,608*ratiow,269*ratioh,622*ratiow,277*ratioh,639*ratiow,283*ratioh,655*ratiow,288*ratioh,666*ratiow,289*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(199*ratiow,637*ratioh,255*ratiow,635*ratioh,266*ratiow,636*ratioh,271*ratiow,639*ratioh,269*ratiow,625*ratioh,262*ratiow,609*ratioh,251*ratiow,598*ratioh,246*ratiow,593*ratioh,245*ratiow,589*ratioh,245*ratiow,583*ratioh,251*ratiow,576*ratioh,253*ratiow,576*ratioh,247*ratiow,569*ratioh,242*ratiow,555*ratioh,238*ratiow,538*ratioh,236*ratiow,527*ratioh,236*ratiow,520*ratioh,228*ratiow,510*ratioh,220*ratiow,493*ratioh,218*ratiow,466*ratioh,221*ratiow,424*ratioh,225*ratiow,400*ratioh,230*ratiow,376*ratioh,233*ratiow,357*ratioh,236*ratiow,345*ratioh,238*ratiow,337*ratioh,235*ratiow,338*ratioh,228*ratiow,345*ratioh,216*ratiow,361*ratioh,206*ratiow,378*ratioh,196*ratiow,396*ratioh,187*ratiow,417*ratioh,180*ratiow,435*ratioh,173*ratiow,450*ratioh,165*ratiow,465*ratioh,158*ratiow,487*ratioh,153*ratiow,511*ratioh,151*ratiow,536*ratioh,150*ratiow,568*ratioh,150*ratiow,592*ratioh,165*ratiow,608*ratioh,181*ratiow,623*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(161*ratiow,857*ratioh,157*ratiow,874*ratioh,141*ratiow,867*ratioh,131*ratiow,862*ratioh,119*ratiow,854*ratioh,106*ratiow,843*ratioh,91*ratiow,826*ratioh,80*ratiow,809*ratioh,71*ratiow,793*ratioh,64*ratiow,778*ratioh,54*ratiow,753*ratioh,36*ratiow,702*ratioh,32*ratiow,686*ratioh,28*ratiow,671*ratioh,45*ratiow,670*ratioh,51*ratiow,689*ratioh,57*ratiow,709*ratioh,62*ratiow,729*ratioh,67*ratiow,746*ratioh,75*ratiow,768*ratioh,80*ratiow,781*ratioh,94*ratiow,806*ratioh,108*ratiow,824*ratioh,116*ratiow,831*ratioh,137*ratiow,844*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(164*ratiow,844*ratioh,161*ratiow,857*ratioh,148*ratiow,850*ratioh,131*ratiow,840*ratioh,114*ratiow,829*ratioh,100*ratiow,816*ratioh,82*ratiow,784*ratioh,73*ratiow,765*ratioh,65*ratiow,741*ratioh,57*ratiow,707*ratioh,44*ratiow,670*ratioh,53*ratiow,669*ratioh,59*ratiow,683*ratioh,64*ratiow,698*ratioh,74*ratiow,733*ratioh,87*ratiow,770*ratioh,91*ratiow,780*ratioh,103*ratiow,801*ratioh,119*ratiow,819*ratioh,145*ratiow,836*ratioh,158*ratiow,844*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(163*ratiow,844*ratioh,155*ratiow,842*ratioh,140*ratiow,833*ratioh,124*ratiow,823*ratioh,109*ratiow,809*ratioh,94*ratiow,785*ratioh,81*ratiow,755*ratioh,75*ratiow,738*ratioh,66*ratiow,707*ratioh,59*ratiow,686*ratioh,55*ratiow,674*ratioh,52*ratiow,669*ratioh,86*ratiow,665*ratioh,128*ratiow,660*ratioh,145*ratiow,658*ratioh,145*ratiow,665*ratioh,141*ratiow,672*ratioh,136*ratiow,683*ratioh,130*ratiow,702*ratioh,124*ratiow,728*ratioh,123*ratiow,742*ratioh,124*ratiow,753*ratioh,129*ratiow,759*ratioh,136*ratiow,760*ratioh,147*ratiow,756*ratioh,159*ratiow,744*ratioh,160*ratiow,752*ratioh,166*ratiow,767*ratioh,175*ratiow,776*ratioh,176*ratiow,792*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(419*ratiow,603*ratioh,400*ratiow,598*ratioh,376*ratiow,586*ratioh,354*ratiow,575*ratioh,344*ratiow,567*ratioh,330*ratiow,544*ratioh,320*ratiow,524*ratioh,315*ratiow,506*ratioh,313*ratiow,480*ratioh,315*ratiow,465*ratioh,328*ratiow,442*ratioh,340*ratiow,477*ratioh,358*ratiow,511*ratioh,373*ratiow,533*ratioh,393*ratiow,563*ratioh,419*ratiow,601*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(666*ratiow,422*ratioh,660*ratiow,420*ratioh,653*ratiow,416*ratioh,644*ratiow,415*ratioh,638*ratiow,417*ratioh,627*ratiow,425*ratioh,625*ratiow,430*ratioh,632*ratiow,440*ratioh,640*ratiow,448*ratioh,646*ratiow,459*ratioh,654*ratiow,463*ratioh,661*ratiow,463*ratioh,666*ratiow,463*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(1*ratiow,303*ratioh,1*ratiow,323*ratioh,7*ratiow,337*ratioh,13*ratiow,345*ratioh,18*ratiow,346*ratioh,23*ratiow,351*ratioh,27*ratiow,358*ratioh,32*ratiow,364*ratioh,53*ratiow,373*ratioh,65*ratiow,378*ratioh,87*ratiow,380*ratioh,118*ratiow,377*ratioh,148*ratiow,362*ratioh,176*ratiow,345*ratioh,217*ratiow,328*ratioh,231*ratiow,323*ratioh,230*ratiow,320*ratioh,224*ratiow,317*ratioh,221*ratiow,311*ratioh,219*ratiow,309*ratioh,219*ratiow,305*ratioh,221*ratiow,305*ratioh,227*ratiow,308*ratioh,251*ratiow,318*ratioh,277*ratiow,323*ratioh,300*ratiow,325*ratioh,339*ratiow,321*ratioh,352*ratiow,313*ratioh,366*ratiow,300*ratioh,372*ratiow,285*ratioh,372*ratiow,273*ratioh,368*ratiow,261*ratioh,356*ratiow,242*ratioh,345*ratiow,229*ratioh,330*ratiow,216*ratioh,306*ratiow,202*ratioh,286*ratiow,194*ratioh,267*ratiow,187*ratioh,229*ratiow,177*ratioh,211*ratiow,173*ratioh,195*ratiow,173*ratioh,177*ratiow,173*ratioh,161*ratiow,178*ratioh,146*ratiow,183*ratioh,133*ratiow,194*ratioh,115*ratiow,212*ratioh,90*ratiow,242*ratioh,78*ratiow,254*ratioh,59*ratiow,269*ratioh,45*ratiow,277*ratioh,28*ratiow,283*ratioh,12*ratiow,288*ratioh,1*ratiow,289*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(468*ratiow,637*ratioh,412*ratiow,635*ratioh,401*ratiow,636*ratioh,396*ratiow,639*ratioh,398*ratiow,625*ratioh,405*ratiow,609*ratioh,416*ratiow,598*ratioh,421*ratiow,593*ratioh,422*ratiow,589*ratioh,422*ratiow,583*ratioh,416*ratiow,576*ratioh,414*ratiow,576*ratioh,420*ratiow,569*ratioh,425*ratiow,555*ratioh,429*ratiow,538*ratioh,431*ratiow,527*ratioh,431*ratiow,520*ratioh,439*ratiow,510*ratioh,447*ratiow,493*ratioh,449*ratiow,466*ratioh,446*ratiow,424*ratioh,442*ratiow,400*ratioh,437*ratiow,376*ratioh,434*ratiow,357*ratioh,431*ratiow,345*ratioh,429*ratiow,337*ratioh,432*ratiow,338*ratioh,439*ratiow,345*ratioh,451*ratiow,361*ratioh,461*ratiow,378*ratioh,471*ratiow,396*ratioh,480*ratiow,417*ratioh,487*ratiow,435*ratioh,494*ratiow,450*ratioh,502*ratiow,465*ratioh,509*ratiow,487*ratioh,514*ratiow,511*ratioh,516*ratiow,536*ratioh,517*ratiow,568*ratioh,517*ratiow,592*ratioh,502*ratiow,608*ratioh,486*ratiow,623*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(506*ratiow,857*ratioh,510*ratiow,874*ratioh,526*ratiow,867*ratioh,536*ratiow,862*ratioh,548*ratiow,854*ratioh,561*ratiow,843*ratioh,576*ratiow,826*ratioh,587*ratiow,809*ratioh,596*ratiow,793*ratioh,603*ratiow,778*ratioh,613*ratiow,753*ratioh,631*ratiow,702*ratioh,635*ratiow,686*ratioh,639*ratiow,671*ratioh,622*ratiow,670*ratioh,616*ratiow,689*ratioh,610*ratiow,709*ratioh,605*ratiow,729*ratioh,600*ratiow,746*ratioh,592*ratiow,768*ratioh,587*ratiow,781*ratioh,573*ratiow,806*ratioh,559*ratiow,824*ratioh,551*ratiow,831*ratioh,530*ratiow,844*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(503*ratiow,844*ratioh,506*ratiow,857*ratioh,519*ratiow,850*ratioh,536*ratiow,840*ratioh,553*ratiow,829*ratioh,567*ratiow,816*ratioh,585*ratiow,784*ratioh,594*ratiow,765*ratioh,602*ratiow,741*ratioh,610*ratiow,707*ratioh,623*ratiow,670*ratioh,614*ratiow,669*ratioh,608*ratiow,683*ratioh,603*ratiow,698*ratioh,593*ratiow,733*ratioh,580*ratiow,770*ratioh,576*ratiow,780*ratioh,564*ratiow,801*ratioh,548*ratiow,819*ratioh,522*ratiow,836*ratioh,509*ratiow,844*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(504*ratiow,844*ratioh,512*ratiow,842*ratioh,527*ratiow,833*ratioh,543*ratiow,823*ratioh,558*ratiow,809*ratioh,573*ratiow,785*ratioh,586*ratiow,755*ratioh,592*ratiow,738*ratioh,601*ratiow,707*ratioh,608*ratiow,686*ratioh,612*ratiow,674*ratioh,615*ratiow,669*ratioh,581*ratiow,665*ratioh,539*ratiow,660*ratioh,522*ratiow,658*ratioh,522*ratiow,665*ratioh,526*ratiow,672*ratioh,531*ratiow,683*ratioh,537*ratiow,702*ratioh,543*ratiow,728*ratioh,544*ratiow,742*ratioh,543*ratiow,753*ratioh,538*ratiow,759*ratioh,531*ratiow,760*ratioh,520*ratiow,756*ratioh,508*ratiow,744*ratioh,507*ratiow,752*ratioh,501*ratiow,767*ratioh,492*ratiow,776*ratioh,491*ratiow,792*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(248*ratiow,603*ratioh,267*ratiow,598*ratioh,291*ratiow,586*ratioh,313*ratiow,575*ratioh,323*ratiow,567*ratioh,337*ratiow,544*ratioh,347*ratiow,524*ratioh,352*ratiow,506*ratioh,354*ratiow,480*ratioh,352*ratiow,465*ratioh,339*ratiow,442*ratioh,327*ratiow,477*ratioh,309*ratiow,511*ratioh,294*ratiow,533*ratioh,274*ratiow,563*ratioh,248*ratiow,601*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(1*ratiow,422*ratioh,7*ratiow,420*ratioh,14*ratiow,416*ratioh,23*ratiow,415*ratioh,29*ratiow,417*ratioh,40*ratiow,425*ratioh,42*ratiow,430*ratioh,35*ratiow,440*ratioh,27*ratiow,448*ratioh,21*ratiow,459*ratioh,13*ratiow,463*ratioh,6*ratiow,463*ratioh,1*ratiow,463*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile60(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 669;
var baseHeight = 888;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, CPu, Pir1, Pir2, Pir3, VPL, PVP";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(668*ratiow,304*ratioh,667*ratiow,317*ratioh,663*ratiow,330*ratioh,654*ratiow,334*ratioh,634*ratiow,340*ratioh,637*ratiow,345*ratioh,636*ratiow,350*ratioh,631*ratiow,357*ratioh,618*ratiow,365*ratioh,603*ratiow,372*ratioh,589*ratiow,377*ratioh,568*ratiow,377*ratioh,543*ratiow,368*ratioh,527*ratiow,359*ratioh,499*ratiow,343*ratioh,476*ratiow,335*ratioh,452*ratiow,327*ratioh,433*ratiow,322*ratioh,433*ratiow,319*ratioh,439*ratiow,311*ratioh,421*ratiow,314*ratioh,388*ratiow,319*ratioh,352*ratiow,323*ratioh,323*ratiow,324*ratioh,304*ratiow,322*ratioh,297*ratiow,317*ratioh,293*ratiow,309*ratioh,290*ratiow,299*ratioh,290*ratiow,278*ratioh,294*ratiow,261*ratioh,307*ratiow,243*ratioh,321*ratiow,228*ratioh,335*ratiow,217*ratioh,364*ratiow,200*ratioh,386*ratiow,190*ratioh,403*ratiow,183*ratioh,446*ratiow,172*ratioh,470*ratiow,169*ratioh,493*ratiow,170*ratioh,513*ratiow,176*ratioh,529*ratiow,185*ratioh,537*ratiow,192*ratioh,558*ratiow,217*ratioh,574*ratiow,235*ratioh,587*ratiow,250*ratioh,599*ratiow,262*ratioh,612*ratiow,275*ratioh,624*ratiow,280*ratioh,645*ratiow,279*ratioh,668*ratiow,278*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(215*ratiow,649*ratioh,278*ratiow,647*ratioh,275*ratiow,633*ratioh,269*ratiow,616*ratioh,259*ratiow,600*ratioh,250*ratiow,584*ratioh,248*ratiow,576*ratioh,249*ratiow,570*ratioh,255*ratiow,567*ratioh,249*ratiow,560*ratioh,239*ratiow,544*ratioh,231*ratiow,524*ratioh,227*ratiow,507*ratioh,225*ratiow,494*ratioh,223*ratiow,478*ratioh,222*ratiow,467*ratioh,218*ratiow,451*ratioh,216*ratiow,431*ratioh,213*ratiow,414*ratioh,208*ratiow,406*ratioh,204*ratiow,409*ratioh,197*ratiow,421*ratioh,190*ratiow,444*ratioh,181*ratiow,472*ratioh,175*ratiow,504*ratioh,169*ratiow,538*ratioh,166*ratiow,576*ratioh,185*ratiow,605*ratioh,199*ratiow,626*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(158*ratiow,854*ratioh,153*ratiow,873*ratioh,140*ratiow,867*ratioh,121*ratiow,854*ratioh,103*ratiow,837*ratioh,83*ratiow,814*ratioh,69*ratiow,793*ratioh,58*ratiow,771*ratioh,45*ratiow,744*ratioh,32*ratiow,709*ratioh,25*ratiow,679*ratioh,24*ratiow,672*ratioh,47*ratiow,669*ratioh,45*ratiow,672*ratioh,52*ratiow,699*ratioh,63*ratiow,731*ratioh,76*ratiow,765*ratioh,89*ratiow,789*ratioh,103*ratiow,810*ratioh,125*ratiow,832*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(161*ratiow,843*ratioh,159*ratiow,854*ratioh,147*ratiow,847*ratioh,127*ratiow,833*ratioh,109*ratiow,817*ratioh,96*ratiow,800*ratioh,79*ratiow,770*ratioh,64*ratiow,734*ratioh,58*ratiow,718*ratioh,46*ratiow,680*ratioh,45*ratiow,672*ratioh,46*ratiow,669*ratioh,51*ratiow,669*ratioh,56*ratiow,678*ratioh,63*ratiow,696*ratioh,79*ratiow,738*ratioh,89*ratiow,762*ratioh,107*ratiow,792*ratioh,124*ratiow,813*ratioh,145*ratiow,834*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(161*ratiow,843*ratioh,152*ratiow,838*ratioh,138*ratiow,827*ratioh,120*ratiow,808*ratioh,107*ratiow,791*ratioh,91*ratiow,765*ratioh,80*ratiow,740*ratioh,69*ratiow,713*ratioh,61*ratiow,690*ratioh,55*ratiow,674*ratioh,51*ratiow,669*ratioh,83*ratiow,664*ratioh,102*ratiow,662*ratioh,146*ratiow,656*ratioh,154*ratiow,655*ratioh,146*ratiow,661*ratioh,135*ratiow,673*ratioh,128*ratiow,687*ratioh,124*ratiow,702*ratioh,121*ratiow,722*ratioh,121*ratiow,738*ratioh,124*ratiow,746*ratioh,130*ratiow,750*ratioh,137*ratiow,753*ratioh,142*ratiow,754*ratioh,149*ratiow,752*ratioh,153*ratiow,746*ratioh,157*ratiow,761*ratioh,162*ratiow,770*ratioh,170*ratiow,775*ratioh,180*ratiow,777*ratioh,176*ratiow,792*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(420*ratiow,588*ratioh,400*ratiow,584*ratioh,375*ratiow,575*ratioh,364*ratiow,568*ratioh,341*ratiow,544*ratioh,329*ratiow,526*ratioh,322*ratiow,506*ratioh,320*ratiow,476*ratioh,322*ratiow,467*ratioh,331*ratiow,452*ratioh,342*ratiow,434*ratioh,342*ratiow,445*ratioh,343*ratiow,458*ratioh,350*ratiow,475*ratioh,353*ratiow,484*ratioh,359*ratiow,499*ratioh,369*ratiow,516*ratioh,383*ratiow,538*ratioh,404*ratiow,567*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(668*ratiow,457*ratioh,655*ratiow,456*ratioh,644*ratiow,449*ratioh,628*ratiow,429*ratioh,623*ratiow,421*ratioh,632*ratiow,414*ratioh,646*ratiow,409*ratioh,653*ratiow,409*ratioh,662*ratiow,416*ratioh,668*ratiow,419*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(1*ratiow,304*ratioh,2*ratiow,317*ratioh,6*ratiow,330*ratioh,15*ratiow,334*ratioh,35*ratiow,340*ratioh,32*ratiow,345*ratioh,33*ratiow,350*ratioh,38*ratiow,357*ratioh,51*ratiow,365*ratioh,66*ratiow,372*ratioh,80*ratiow,377*ratioh,101*ratiow,377*ratioh,126*ratiow,368*ratioh,142*ratiow,359*ratioh,170*ratiow,343*ratioh,193*ratiow,335*ratioh,217*ratiow,327*ratioh,236*ratiow,322*ratioh,236*ratiow,319*ratioh,230*ratiow,311*ratioh,248*ratiow,314*ratioh,281*ratiow,319*ratioh,317*ratiow,323*ratioh,346*ratiow,324*ratioh,365*ratiow,322*ratioh,372*ratiow,317*ratioh,376*ratiow,309*ratioh,379*ratiow,299*ratioh,379*ratiow,278*ratioh,375*ratiow,261*ratioh,362*ratiow,243*ratioh,348*ratiow,228*ratioh,334*ratiow,217*ratioh,305*ratiow,200*ratioh,283*ratiow,190*ratioh,266*ratiow,183*ratioh,223*ratiow,172*ratioh,199*ratiow,169*ratioh,176*ratiow,170*ratioh,156*ratiow,176*ratioh,140*ratiow,185*ratioh,132*ratiow,192*ratioh,111*ratiow,217*ratioh,95*ratiow,235*ratioh,82*ratiow,250*ratioh,70*ratiow,262*ratioh,57*ratiow,275*ratioh,45*ratiow,280*ratioh,24*ratiow,279*ratioh,1*ratiow,278*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(454*ratiow,649*ratioh,391*ratiow,647*ratioh,394*ratiow,633*ratioh,400*ratiow,616*ratioh,410*ratiow,600*ratioh,419*ratiow,584*ratioh,421*ratiow,576*ratioh,420*ratiow,570*ratioh,414*ratiow,567*ratioh,420*ratiow,560*ratioh,430*ratiow,544*ratioh,438*ratiow,524*ratioh,442*ratiow,507*ratioh,444*ratiow,494*ratioh,446*ratiow,478*ratioh,447*ratiow,467*ratioh,451*ratiow,451*ratioh,453*ratiow,431*ratioh,456*ratiow,414*ratioh,461*ratiow,406*ratioh,465*ratiow,409*ratioh,472*ratiow,421*ratioh,479*ratiow,444*ratioh,488*ratiow,472*ratioh,494*ratiow,504*ratioh,500*ratiow,538*ratioh,503*ratiow,576*ratioh,484*ratiow,605*ratioh,470*ratiow,626*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(511*ratiow,854*ratioh,516*ratiow,873*ratioh,529*ratiow,867*ratioh,548*ratiow,854*ratioh,566*ratiow,837*ratioh,586*ratiow,814*ratioh,600*ratiow,793*ratioh,611*ratiow,771*ratioh,624*ratiow,744*ratioh,637*ratiow,709*ratioh,644*ratiow,679*ratioh,645*ratiow,672*ratioh,622*ratiow,669*ratioh,624*ratiow,672*ratioh,617*ratiow,699*ratioh,606*ratiow,731*ratioh,593*ratiow,765*ratioh,580*ratiow,789*ratioh,566*ratiow,810*ratioh,544*ratiow,832*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(508*ratiow,843*ratioh,510*ratiow,854*ratioh,522*ratiow,847*ratioh,542*ratiow,833*ratioh,560*ratiow,817*ratioh,573*ratiow,800*ratioh,590*ratiow,770*ratioh,605*ratiow,734*ratioh,611*ratiow,718*ratioh,623*ratiow,680*ratioh,624*ratiow,672*ratioh,623*ratiow,669*ratioh,618*ratiow,669*ratioh,613*ratiow,678*ratioh,606*ratiow,696*ratioh,590*ratiow,738*ratioh,580*ratiow,762*ratioh,562*ratiow,792*ratioh,545*ratiow,813*ratioh,524*ratiow,834*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(508*ratiow,843*ratioh,517*ratiow,838*ratioh,531*ratiow,827*ratioh,549*ratiow,808*ratioh,562*ratiow,791*ratioh,578*ratiow,765*ratioh,589*ratiow,740*ratioh,600*ratiow,713*ratioh,608*ratiow,690*ratioh,614*ratiow,674*ratioh,618*ratiow,669*ratioh,586*ratiow,664*ratioh,567*ratiow,662*ratioh,523*ratiow,656*ratioh,515*ratiow,655*ratioh,523*ratiow,661*ratioh,534*ratiow,673*ratioh,541*ratiow,687*ratioh,545*ratiow,702*ratioh,548*ratiow,722*ratioh,548*ratiow,738*ratioh,545*ratiow,746*ratioh,539*ratiow,750*ratioh,532*ratiow,753*ratioh,527*ratiow,754*ratioh,520*ratiow,752*ratioh,516*ratiow,746*ratioh,512*ratiow,761*ratioh,507*ratiow,770*ratioh,499*ratiow,775*ratioh,489*ratiow,777*ratioh,493*ratiow,792*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(249*ratiow,588*ratioh,269*ratiow,584*ratioh,294*ratiow,575*ratioh,305*ratiow,568*ratioh,328*ratiow,544*ratioh,340*ratiow,526*ratioh,347*ratiow,506*ratioh,349*ratiow,476*ratioh,347*ratiow,467*ratioh,338*ratiow,452*ratioh,327*ratiow,434*ratioh,327*ratiow,445*ratioh,326*ratiow,458*ratioh,319*ratiow,475*ratioh,316*ratiow,484*ratioh,310*ratiow,499*ratioh,300*ratiow,516*ratioh,286*ratiow,538*ratioh,265*ratiow,567*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(1*ratiow,457*ratioh,14*ratiow,456*ratioh,25*ratiow,449*ratioh,41*ratiow,429*ratioh,46*ratiow,421*ratioh,37*ratiow,414*ratioh,23*ratiow,409*ratioh,16*ratiow,409*ratioh,7*ratiow,416*ratioh,1*ratiow,419*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile61(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 677;
var baseHeight = 874;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, CPu, Pir1, Pir2, Pir3, VPL, PVP";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(676*ratiow,316*ratioh,670*ratiow,325*ratioh,660*ratiow,334*ratioh,650*ratiow,340*ratioh,643*ratiow,342*ratioh,646*ratiow,342*ratioh,647*ratiow,346*ratioh,642*ratiow,352*ratioh,627*ratiow,362*ratioh,611*ratiow,369*ratioh,594*ratiow,374*ratioh,576*ratiow,375*ratioh,564*ratiow,373*ratioh,543*ratiow,363*ratioh,526*ratiow,351*ratioh,511*ratiow,342*ratioh,491*ratiow,334*ratioh,467*ratiow,328*ratioh,446*ratiow,322*ratioh,436*ratiow,320*ratioh,436*ratiow,314*ratioh,440*ratiow,309*ratioh,441*ratiow,308*ratioh,439*ratiow,307*ratioh,433*ratiow,309*ratioh,410*ratiow,315*ratioh,383*ratiow,321*ratioh,367*ratiow,325*ratioh,337*ratiow,329*ratioh,317*ratiow,327*ratioh,298*ratiow,322*ratioh,284*ratiow,314*ratioh,279*ratiow,306*ratioh,279*ratiow,295*ratioh,282*ratiow,278*ratioh,288*ratiow,260*ratioh,301*ratiow,239*ratioh,313*ratiow,225*ratioh,328*ratiow,212*ratioh,347*ratiow,199*ratioh,366*ratiow,191*ratioh,387*ratiow,184*ratioh,398*ratiow,182*ratioh,419*ratiow,176*ratioh,445*ratiow,170*ratioh,462*ratiow,167*ratioh,482*ratiow,166*ratioh,502*ratiow,167*ratioh,521*ratiow,172*ratioh,528*ratiow,175*ratioh,541*ratiow,184*ratioh,559*ratiow,202*ratioh,573*ratiow,219*ratioh,601*ratiow,247*ratioh,614*ratiow,259*ratioh,628*ratiow,270*ratioh,636*ratiow,274*ratioh,647*ratiow,277*ratioh,659*ratiow,277*ratioh,669*ratiow,280*ratioh,676*ratiow,282*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(222*ratiow,638*ratioh,275*ratiow,624*ratioh,267*ratiow,612*ratioh,255*ratiow,595*ratioh,248*ratiow,575*ratioh,246*ratiow,565*ratioh,246*ratiow,561*ratioh,239*ratiow,553*ratioh,229*ratiow,535*ratioh,222*ratiow,518*ratioh,214*ratiow,492*ratioh,211*ratiow,463*ratioh,211*ratiow,438*ratioh,214*ratiow,407*ratioh,218*ratiow,383*ratioh,223*ratiow,363*ratioh,224*ratiow,355*ratioh,223*ratiow,354*ratioh,219*ratiow,357*ratioh,209*ratiow,369*ratioh,199*ratiow,388*ratioh,180*ratiow,435*ratioh,172*ratiow,465*ratioh,165*ratiow,500*ratioh,165*ratiow,520*ratioh,166*ratiow,567*ratioh,178*ratiow,582*ratioh,191*ratiow,599*ratioh,200*ratiow,615*ratioh,212*ratiow,631*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(161*ratiow,836*ratioh,157*ratiow,851*ratioh,142*ratiow,841*ratioh,121*ratiow,823*ratioh,103*ratiow,802*ratioh,87*ratiow,774*ratioh,74*ratiow,741*ratioh,56*ratiow,697*ratioh,48*ratiow,677*ratioh,69*ratiow,672*ratioh,68*ratiow,677*ratioh,72*ratiow,693*ratioh,80*ratiow,717*ratioh,90*ratiow,744*ratioh,100*ratiow,769*ratioh,112*ratiow,788*ratioh,127*ratiow,807*ratioh,145*ratiow,826*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(166*ratiow,821*ratioh,161*ratiow,836*ratioh,152*ratiow,830*ratioh,137*ratiow,818*ratioh,118*ratiow,797*ratioh,106*ratiow,779*ratioh,94*ratiow,756*ratioh,78*ratiow,711*ratioh,69*ratiow,681*ratioh,68*ratiow,674*ratioh,70*ratiow,672*ratioh,76*ratiow,671*ratioh,81*ratiow,676*ratioh,90*ratiow,698*ratioh,102*ratiow,734*ratioh,112*ratiow,758*ratioh,126*ratiow,782*ratioh,139*ratiow,799*ratioh,158*ratiow,816*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(166*ratiow,821*ratioh,155*ratiow,815*ratioh,140*ratiow,800*ratioh,120*ratiow,773*ratioh,107*ratiow,747*ratioh,92*ratiow,705*ratioh,84*ratiow,683*ratioh,80*ratiow,674*ratioh,76*ratiow,670*ratioh,110*ratiow,663*ratioh,140*ratiow,655*ratioh,165*ratiow,649*ratioh,163*ratiow,659*ratioh,155*ratiow,687*ratioh,149*ratiow,713*ratioh,151*ratiow,741*ratioh,157*ratiow,756*ratioh,167*ratiow,762*ratioh,172*ratiow,762*ratioh,181*ratiow,752*ratioh,186*ratiow,761*ratioh,190*ratiow,762*ratioh,192*ratiow,776*ratioh,182*ratiow,792*ratioh,170*ratiow,812*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(421*ratiow,583*ratioh,406*ratiow,580*ratioh,381*ratiow,569*ratioh,365*ratiow,555*ratioh,352*ratiow,539*ratioh,337*ratiow,518*ratioh,331*ratiow,499*ratioh,329*ratiow,480*ratioh,331*ratiow,464*ratioh,338*ratiow,447*ratioh,341*ratiow,442*ratioh,347*ratiow,463*ratioh,359*ratiow,490*ratioh,387*ratiow,537*ratioh,406*ratiow,563*ratioh,422*ratiow,583*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(676*ratiow,464*ratioh,666*ratiow,462*ratioh,659*ratiow,457*ratioh,656*ratiow,446*ratioh,652*ratiow,440*ratioh,644*ratiow,433*ratioh,641*ratiow,427*ratioh,642*ratiow,423*ratioh,663*ratiow,409*ratioh,668*ratiow,413*ratioh,669*ratiow,418*ratioh,674*ratiow,424*ratioh,676*ratiow,424*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(1*ratiow,316*ratioh,7*ratiow,325*ratioh,17*ratiow,334*ratioh,27*ratiow,340*ratioh,34*ratiow,342*ratioh,31*ratiow,342*ratioh,30*ratiow,346*ratioh,35*ratiow,352*ratioh,50*ratiow,362*ratioh,66*ratiow,369*ratioh,83*ratiow,374*ratioh,101*ratiow,375*ratioh,113*ratiow,373*ratioh,134*ratiow,363*ratioh,151*ratiow,351*ratioh,166*ratiow,342*ratioh,186*ratiow,334*ratioh,210*ratiow,328*ratioh,231*ratiow,322*ratioh,241*ratiow,320*ratioh,241*ratiow,314*ratioh,237*ratiow,309*ratioh,236*ratiow,308*ratioh,238*ratiow,307*ratioh,244*ratiow,309*ratioh,267*ratiow,315*ratioh,294*ratiow,321*ratioh,310*ratiow,325*ratioh,340*ratiow,329*ratioh,360*ratiow,327*ratioh,379*ratiow,322*ratioh,393*ratiow,314*ratioh,398*ratiow,306*ratioh,398*ratiow,295*ratioh,395*ratiow,278*ratioh,389*ratiow,260*ratioh,376*ratiow,239*ratioh,364*ratiow,225*ratioh,349*ratiow,212*ratioh,330*ratiow,199*ratioh,311*ratiow,191*ratioh,290*ratiow,184*ratioh,279*ratiow,182*ratioh,258*ratiow,176*ratioh,232*ratiow,170*ratioh,215*ratiow,167*ratioh,195*ratiow,166*ratioh,175*ratiow,167*ratioh,156*ratiow,172*ratioh,149*ratiow,175*ratioh,136*ratiow,184*ratioh,118*ratiow,202*ratioh,104*ratiow,219*ratioh,76*ratiow,247*ratioh,63*ratiow,259*ratioh,49*ratiow,270*ratioh,41*ratiow,274*ratioh,30*ratiow,277*ratioh,18*ratiow,277*ratioh,8*ratiow,280*ratioh,1*ratiow,282*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(455*ratiow,638*ratioh,402*ratiow,624*ratioh,410*ratiow,612*ratioh,422*ratiow,595*ratioh,429*ratiow,575*ratioh,431*ratiow,565*ratioh,431*ratiow,561*ratioh,438*ratiow,553*ratioh,448*ratiow,535*ratioh,455*ratiow,518*ratioh,463*ratiow,492*ratioh,466*ratiow,463*ratioh,466*ratiow,438*ratioh,463*ratiow,407*ratioh,459*ratiow,383*ratioh,454*ratiow,363*ratioh,453*ratiow,355*ratioh,454*ratiow,354*ratioh,458*ratiow,357*ratioh,468*ratiow,369*ratioh,478*ratiow,388*ratioh,497*ratiow,435*ratioh,505*ratiow,465*ratioh,512*ratiow,500*ratioh,512*ratiow,520*ratioh,511*ratiow,567*ratioh,499*ratiow,582*ratioh,486*ratiow,599*ratioh,477*ratiow,615*ratioh,465*ratiow,631*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(516*ratiow,836*ratioh,520*ratiow,851*ratioh,535*ratiow,841*ratioh,556*ratiow,823*ratioh,574*ratiow,802*ratioh,590*ratiow,774*ratioh,603*ratiow,741*ratioh,621*ratiow,697*ratioh,629*ratiow,677*ratioh,608*ratiow,672*ratioh,609*ratiow,677*ratioh,605*ratiow,693*ratioh,597*ratiow,717*ratioh,587*ratiow,744*ratioh,577*ratiow,769*ratioh,565*ratiow,788*ratioh,550*ratiow,807*ratioh,532*ratiow,826*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(511*ratiow,821*ratioh,516*ratiow,836*ratioh,525*ratiow,830*ratioh,540*ratiow,818*ratioh,559*ratiow,797*ratioh,571*ratiow,779*ratioh,583*ratiow,756*ratioh,599*ratiow,711*ratioh,608*ratiow,681*ratioh,609*ratiow,674*ratioh,607*ratiow,672*ratioh,601*ratiow,671*ratioh,596*ratiow,676*ratioh,587*ratiow,698*ratioh,575*ratiow,734*ratioh,565*ratiow,758*ratioh,551*ratiow,782*ratioh,538*ratiow,799*ratioh,519*ratiow,816*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(511*ratiow,821*ratioh,522*ratiow,815*ratioh,537*ratiow,800*ratioh,557*ratiow,773*ratioh,570*ratiow,747*ratioh,585*ratiow,705*ratioh,593*ratiow,683*ratioh,597*ratiow,674*ratioh,601*ratiow,670*ratioh,567*ratiow,663*ratioh,537*ratiow,655*ratioh,512*ratiow,649*ratioh,514*ratiow,659*ratioh,522*ratiow,687*ratioh,528*ratiow,713*ratioh,526*ratiow,741*ratioh,520*ratiow,756*ratioh,510*ratiow,762*ratioh,505*ratiow,762*ratioh,496*ratiow,752*ratioh,491*ratiow,761*ratioh,487*ratiow,762*ratioh,485*ratiow,776*ratioh,495*ratiow,792*ratioh,507*ratiow,812*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(256*ratiow,583*ratioh,271*ratiow,580*ratioh,296*ratiow,569*ratioh,312*ratiow,555*ratioh,325*ratiow,539*ratioh,340*ratiow,518*ratioh,346*ratiow,499*ratioh,348*ratiow,480*ratioh,346*ratiow,464*ratioh,339*ratiow,447*ratioh,336*ratiow,442*ratioh,330*ratiow,463*ratioh,318*ratiow,490*ratioh,290*ratiow,537*ratioh,271*ratiow,563*ratioh,255*ratiow,583*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(1*ratiow,464*ratioh,11*ratiow,462*ratioh,18*ratiow,457*ratioh,21*ratiow,446*ratioh,25*ratiow,440*ratioh,33*ratiow,433*ratioh,36*ratiow,427*ratioh,35*ratiow,423*ratioh,14*ratiow,409*ratioh,9*ratiow,413*ratioh,8*ratiow,418*ratioh,3*ratiow,424*ratioh,1*ratiow,424*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile62(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 656;
var baseHeight = 872;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, CPu, Pir1, Pir2, Pir3, VPL, PVP";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(655*ratiow,317*ratioh,649*ratiow,325*ratioh,634*ratiow,334*ratioh,618*ratiow,346*ratioh,612*ratiow,353*ratioh,598*ratiow,358*ratioh,579*ratiow,366*ratioh,567*ratiow,371*ratioh,554*ratiow,372*ratioh,533*ratiow,365*ratioh,502*ratiow,350*ratioh,478*ratiow,335*ratioh,455*ratiow,327*ratioh,435*ratiow,322*ratioh,416*ratiow,319*ratioh,416*ratiow,316*ratioh,418*ratiow,311*ratioh,420*ratiow,308*ratioh,423*ratiow,304*ratioh,411*ratiow,308*ratioh,385*ratiow,316*ratioh,359*ratiow,323*ratioh,334*ratiow,329*ratioh,308*ratiow,334*ratioh,285*ratiow,337*ratioh,276*ratiow,336*ratioh,270*ratiow,334*ratioh,259*ratiow,323*ratioh,252*ratiow,312*ratioh,252*ratiow,305*ratioh,253*ratiow,294*ratioh,257*ratiow,281*ratioh,264*ratiow,267*ratioh,275*ratiow,251*ratioh,291*ratiow,233*ratioh,309*ratiow,216*ratioh,328*ratiow,203*ratioh,347*ratiow,193*ratioh,363*ratiow,187*ratioh,378*ratiow,182*ratioh,402*ratiow,176*ratioh,427*ratiow,172*ratioh,450*ratiow,169*ratioh,468*ratiow,167*ratioh,491*ratiow,171*ratioh,512*ratiow,178*ratioh,529*ratiow,189*ratioh,546*ratiow,210*ratioh,560*ratiow,227*ratioh,574*ratiow,245*ratioh,588*ratiow,259*ratioh,603*ratiow,268*ratioh,622*ratiow,274*ratioh,651*ratiow,276*ratioh,655*ratiow,276*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(222*ratiow,640*ratioh,205*ratiow,629*ratioh,184*ratiow,613*ratioh,167*ratiow,597*ratioh,160*ratiow,585*ratioh,159*ratiow,563*ratioh,156*ratiow,525*ratioh,158*ratiow,502*ratioh,162*ratiow,481*ratioh,176*ratiow,428*ratioh,185*ratiow,395*ratioh,192*ratiow,372*ratioh,193*ratiow,377*ratioh,193*ratiow,415*ratioh,191*ratiow,440*ratioh,190*ratiow,464*ratioh,191*ratiow,490*ratioh,193*ratiow,501*ratioh,207*ratiow,530*ratioh,222*ratiow,552*ratioh,231*ratiow,565*ratioh,236*ratiow,579*ratioh,237*ratiow,615*ratioh,225*ratiow,634*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(143*ratiow,849*ratioh,141*ratiow,863*ratioh,131*ratiow,859*ratioh,114*ratiow,847*ratioh,97*ratiow,827*ratioh,82*ratiow,806*ratioh,71*ratiow,782*ratioh,50*ratiow,727*ratioh,42*ratiow,701*ratioh,37*ratiow,681*ratioh,53*ratiow,677*ratioh,51*ratiow,683*ratioh,58*ratiow,698*ratioh,68*ratiow,719*ratioh,74*ratiow,733*ratioh,81*ratiow,755*ratioh,90*ratiow,785*ratioh,97*ratiow,803*ratioh,107*ratiow,821*ratioh,126*ratiow,839*ratioh,137*ratiow,847*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(145*ratiow,835*ratioh,143*ratiow,850*ratioh,133*ratiow,844*ratioh,115*ratiow,830*ratioh,100*ratiow,809*ratioh,92*ratiow,791*ratioh,86*ratiow,772*ratioh,72*ratiow,726*ratioh,62*ratiow,706*ratioh,51*ratiow,684*ratioh,51*ratiow,677*ratioh,56*ratiow,676*ratioh,61*ratiow,679*ratioh,68*ratiow,687*ratioh,79*ratiow,710*ratioh,84*ratiow,723*ratioh,86*ratiow,739*ratioh,95*ratiow,761*ratioh,100*ratiow,775*ratioh,110*ratiow,800*ratioh,121*ratiow,819*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(145*ratiow,836*ratioh,132*ratiow,827*ratioh,118*ratiow,816*ratioh,109*ratiow,795*ratioh,91*ratiow,751*ratioh,84*ratiow,728*ratioh,82*ratiow,717*ratioh,73*ratiow,698*ratioh,64*ratiow,682*ratioh,55*ratiow,676*ratioh,97*ratiow,666*ratioh,139*ratiow,656*ratioh,136*ratiow,663*ratioh,130*ratiow,675*ratioh,125*ratiow,693*ratioh,123*ratiow,705*ratioh,124*ratiow,724*ratioh,127*ratiow,740*ratioh,134*ratiow,752*ratioh,142*ratiow,756*ratioh,148*ratiow,756*ratioh,154*ratiow,753*ratioh,160*ratiow,741*ratioh,161*ratiow,755*ratioh,162*ratiow,770*ratioh,166*ratiow,775*ratioh,156*ratiow,802*ratioh,147*ratiow,831*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(411*ratiow,583*ratioh,391*ratiow,575*ratioh,357*ratiow,558*ratioh,338*ratiow,542*ratioh,329*ratiow,528*ratioh,322*ratiow,507*ratioh,320*ratiow,488*ratioh,322*ratiow,465*ratioh,328*ratiow,448*ratioh,341*ratiow,428*ratioh,342*ratiow,433*ratioh,343*ratiow,448*ratioh,348*ratiow,470*ratioh,356*ratiow,494*ratioh,369*ratiow,523*ratioh,381*ratiow,542*ratioh,390*ratiow,552*ratioh,399*ratiow,563*ratioh,407*ratiow,575*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(655*ratiow,424*ratioh,651*ratiow,420*ratioh,647*ratiow,415*ratioh,641*ratiow,413*ratioh,633*ratiow,415*ratioh,619*ratiow,423*ratioh,610*ratiow,430*ratioh,605*ratiow,437*ratioh,606*ratiow,444*ratioh,614*ratiow,450*ratioh,619*ratiow,451*ratioh,635*ratiow,451*ratioh,642*ratiow,449*ratioh,646*ratiow,447*ratioh,649*ratiow,447*ratioh,653*ratiow,444*ratioh,655*ratiow,443*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(1*ratiow,317*ratioh,7*ratiow,325*ratioh,22*ratiow,334*ratioh,38*ratiow,346*ratioh,44*ratiow,353*ratioh,58*ratiow,358*ratioh,77*ratiow,366*ratioh,89*ratiow,371*ratioh,102*ratiow,372*ratioh,123*ratiow,365*ratioh,154*ratiow,350*ratioh,178*ratiow,335*ratioh,201*ratiow,327*ratioh,221*ratiow,322*ratioh,240*ratiow,319*ratioh,240*ratiow,316*ratioh,238*ratiow,311*ratioh,236*ratiow,308*ratioh,233*ratiow,304*ratioh,245*ratiow,308*ratioh,271*ratiow,316*ratioh,297*ratiow,323*ratioh,322*ratiow,329*ratioh,348*ratiow,334*ratioh,371*ratiow,337*ratioh,380*ratiow,336*ratioh,386*ratiow,334*ratioh,397*ratiow,323*ratioh,404*ratiow,312*ratioh,404*ratiow,305*ratioh,403*ratiow,294*ratioh,399*ratiow,281*ratioh,392*ratiow,267*ratioh,381*ratiow,251*ratioh,365*ratiow,233*ratioh,347*ratiow,216*ratioh,328*ratiow,203*ratioh,309*ratiow,193*ratioh,293*ratiow,187*ratioh,278*ratiow,182*ratioh,254*ratiow,176*ratioh,229*ratiow,172*ratioh,206*ratiow,169*ratioh,188*ratiow,167*ratioh,165*ratiow,171*ratioh,144*ratiow,178*ratioh,127*ratiow,189*ratioh,110*ratiow,210*ratioh,96*ratiow,227*ratioh,82*ratiow,245*ratioh,68*ratiow,259*ratioh,53*ratiow,268*ratioh,34*ratiow,274*ratioh,5*ratiow,276*ratioh,1*ratiow,276*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(434*ratiow,640*ratioh,451*ratiow,629*ratioh,472*ratiow,613*ratioh,489*ratiow,597*ratioh,496*ratiow,585*ratioh,497*ratiow,563*ratioh,500*ratiow,525*ratioh,498*ratiow,502*ratioh,494*ratiow,481*ratioh,480*ratiow,428*ratioh,471*ratiow,395*ratioh,464*ratiow,372*ratioh,463*ratiow,377*ratioh,463*ratiow,415*ratioh,465*ratiow,440*ratioh,466*ratiow,464*ratioh,465*ratiow,490*ratioh,463*ratiow,501*ratioh,449*ratiow,530*ratioh,434*ratiow,552*ratioh,425*ratiow,565*ratioh,420*ratiow,579*ratioh,419*ratiow,615*ratioh,431*ratiow,634*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(513*ratiow,849*ratioh,515*ratiow,863*ratioh,525*ratiow,859*ratioh,542*ratiow,847*ratioh,559*ratiow,827*ratioh,574*ratiow,806*ratioh,585*ratiow,782*ratioh,606*ratiow,727*ratioh,614*ratiow,701*ratioh,619*ratiow,681*ratioh,603*ratiow,677*ratioh,605*ratiow,683*ratioh,598*ratiow,698*ratioh,588*ratiow,719*ratioh,582*ratiow,733*ratioh,575*ratiow,755*ratioh,566*ratiow,785*ratioh,559*ratiow,803*ratioh,549*ratiow,821*ratioh,530*ratiow,839*ratioh,519*ratiow,847*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(511*ratiow,835*ratioh,513*ratiow,850*ratioh,523*ratiow,844*ratioh,541*ratiow,830*ratioh,556*ratiow,809*ratioh,564*ratiow,791*ratioh,570*ratiow,772*ratioh,584*ratiow,726*ratioh,594*ratiow,706*ratioh,605*ratiow,684*ratioh,605*ratiow,677*ratioh,600*ratiow,676*ratioh,595*ratiow,679*ratioh,588*ratiow,687*ratioh,577*ratiow,710*ratioh,572*ratiow,723*ratioh,570*ratiow,739*ratioh,561*ratiow,761*ratioh,556*ratiow,775*ratioh,546*ratiow,800*ratioh,535*ratiow,819*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(511*ratiow,836*ratioh,524*ratiow,827*ratioh,538*ratiow,816*ratioh,547*ratiow,795*ratioh,565*ratiow,751*ratioh,572*ratiow,728*ratioh,574*ratiow,717*ratioh,583*ratiow,698*ratioh,592*ratiow,682*ratioh,601*ratiow,676*ratioh,559*ratiow,666*ratioh,517*ratiow,656*ratioh,520*ratiow,663*ratioh,526*ratiow,675*ratioh,531*ratiow,693*ratioh,533*ratiow,705*ratioh,532*ratiow,724*ratioh,529*ratiow,740*ratioh,522*ratiow,752*ratioh,514*ratiow,756*ratioh,508*ratiow,756*ratioh,502*ratiow,753*ratioh,496*ratiow,741*ratioh,495*ratiow,755*ratioh,494*ratiow,770*ratioh,490*ratiow,775*ratioh,500*ratiow,802*ratioh,509*ratiow,831*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(245*ratiow,583*ratioh,265*ratiow,575*ratioh,299*ratiow,558*ratioh,318*ratiow,542*ratioh,327*ratiow,528*ratioh,334*ratiow,507*ratioh,336*ratiow,488*ratioh,334*ratiow,465*ratioh,328*ratiow,448*ratioh,315*ratiow,428*ratioh,314*ratiow,433*ratioh,313*ratiow,448*ratioh,308*ratiow,470*ratioh,300*ratiow,494*ratioh,287*ratiow,523*ratioh,275*ratiow,542*ratioh,266*ratiow,552*ratioh,257*ratiow,563*ratioh,249*ratiow,575*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(1*ratiow,424*ratioh,5*ratiow,420*ratioh,9*ratiow,415*ratioh,15*ratiow,413*ratioh,23*ratiow,415*ratioh,37*ratiow,423*ratioh,46*ratiow,430*ratioh,51*ratiow,437*ratioh,50*ratiow,444*ratioh,42*ratiow,450*ratioh,37*ratiow,451*ratioh,21*ratiow,451*ratioh,14*ratiow,449*ratioh,10*ratiow,447*ratioh,7*ratiow,447*ratioh,3*ratiow,444*ratioh,1*ratiow,443*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile63(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 684;
var baseHeight = 873;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, CPu, Pir1, Pir2, Pir3, VPL, PVP";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(683*ratiow,315*ratioh,680*ratiow,322*ratioh,670*ratiow,328*ratioh,655*ratiow,343*ratioh,651*ratiow,350*ratioh,645*ratiow,355*ratioh,634*ratiow,358*ratioh,622*ratiow,360*ratioh,617*ratiow,361*ratioh,608*ratiow,365*ratioh,593*ratiow,371*ratioh,576*ratiow,371*ratioh,556*ratiow,362*ratioh,532*ratiow,346*ratioh,505*ratiow,329*ratioh,482*ratiow,322*ratioh,455*ratiow,318*ratioh,433*ratiow,318*ratioh,428*ratiow,313*ratioh,429*ratiow,304*ratioh,424*ratiow,305*ratioh,410*ratiow,311*ratioh,365*ratiow,323*ratioh,320*ratiow,336*ratioh,304*ratiow,338*ratioh,288*ratiow,337*ratioh,275*ratiow,331*ratioh,267*ratiow,323*ratioh,262*ratiow,312*ratioh,262*ratiow,291*ratioh,265*ratiow,275*ratioh,272*ratiow,262*ratioh,287*ratiow,239*ratioh,313*ratiow,210*ratioh,328*ratiow,200*ratioh,360*ratiow,184*ratioh,409*ratiow,168*ratioh,437*ratiow,161*ratioh,465*ratiow,159*ratioh,495*ratiow,160*ratioh,512*ratiow,161*ratioh,528*ratiow,166*ratioh,547*ratiow,176*ratioh,558*ratiow,187*ratioh,573*ratiow,204*ratioh,595*ratiow,231*ratioh,622*ratiow,262*ratioh,633*ratiow,272*ratioh,645*ratiow,275*ratioh,659*ratiow,277*ratioh,677*ratiow,280*ratioh,683*ratiow,280*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(216*ratiow,626*ratioh,196*ratiow,602*ratioh,171*ratiow,568*ratioh,161*ratiow,548*ratioh,161*ratiow,497*ratioh,165*ratiow,460*ratioh,167*ratiow,451*ratioh,174*ratiow,431*ratioh,181*ratiow,407*ratioh,191*ratiow,384*ratioh,195*ratiow,371*ratioh,198*ratiow,371*ratioh,201*ratiow,376*ratioh,202*ratiow,383*ratioh,198*ratiow,398*ratioh,197*ratiow,421*ratioh,195*ratiow,450*ratioh,198*ratiow,480*ratioh,203*ratiow,492*ratioh,207*ratiow,501*ratioh,218*ratiow,514*ratioh,230*ratiow,524*ratioh,230*ratiow,535*ratioh,232*ratiow,557*ratioh,231*ratiow,568*ratioh,225*ratiow,581*ratioh,219*ratiow,596*ratioh,217*ratiow,610*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(172*ratiow,840*ratioh,171*ratiow,851*ratioh,154*ratiow,846*ratioh,129*ratiow,832*ratioh,110*ratiow,815*ratioh,96*ratiow,792*ratioh,79*ratiow,747*ratioh,69*ratiow,725*ratioh,59*ratiow,706*ratioh,49*ratiow,685*ratioh,41*ratiow,661*ratioh,61*ratiow,661*ratioh,61*ratiow,668*ratioh,65*ratiow,677*ratioh,72*ratiow,691*ratioh,82*ratiow,709*ratioh,89*ratiow,728*ratioh,99*ratiow,762*ratioh,106*ratiow,786*ratioh,115*ratiow,802*ratioh,132*ratiow,819*ratioh,148*ratiow,833*ratioh,161*ratiow,838*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(174*ratiow,828*ratioh,173*ratiow,841*ratioh,153*ratiow,835*ratioh,141*ratiow,829*ratioh,124*ratiow,812*ratioh,108*ratiow,790*ratioh,98*ratiow,759*ratioh,87*ratiow,724*ratioh,79*ratiow,703*ratioh,68*ratiow,684*ratioh,61*ratiow,668*ratioh,61*ratiow,660*ratioh,72*ratiow,660*ratioh,79*ratiow,673*ratioh,88*ratiow,695*ratioh,100*ratiow,723*ratioh,106*ratiow,741*ratioh,116*ratiow,766*ratioh,124*ratiow,785*ratioh,134*ratiow,803*ratioh,145*ratiow,818*ratioh,155*ratiow,825*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(175*ratiow,828*ratioh,154*ratiow,824*ratioh,144*ratiow,817*ratioh,132*ratiow,801*ratioh,118*ratiow,772*ratioh,108*ratiow,750*ratioh,101*ratiow,723*ratioh,86*ratiow,689*ratioh,72*ratiow,660*ratioh,106*ratiow,658*ratioh,141*ratiow,655*ratioh,157*ratiow,651*ratioh,154*ratiow,663*ratioh,149*ratiow,681*ratioh,147*ratiow,702*ratioh,147*ratiow,722*ratioh,150*ratiow,737*ratioh,157*ratiow,749*ratioh,162*ratiow,753*ratioh,172*ratiow,754*ratioh,182*ratiow,751*ratioh,182*ratiow,768*ratioh,179*ratiow,781*ratioh,176*ratiow,801*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(414*ratiow,570*ratioh,404*ratiow,567*ratioh,375*ratiow,550*ratioh,360*ratiow,533*ratioh,346*ratiow,507*ratioh,341*ratiow,483*ratioh,341*ratiow,469*ratioh,344*ratiow,453*ratioh,352*ratiow,437*ratioh,359*ratiow,431*ratioh,359*ratiow,450*ratioh,365*ratiow,474*ratioh,373*ratiow,501*ratioh,382*ratiow,523*ratioh,396*ratiow,540*ratioh,410*ratiow,558*ratioh,415*ratiow,567*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(683*ratiow,448*ratioh,677*ratiow,453*ratioh,668*ratiow,464*ratioh,654*ratiow,468*ratioh,633*ratiow,466*ratioh,626*ratiow,462*ratioh,622*ratiow,456*ratioh,622*ratiow,450*ratioh,625*ratiow,445*ratioh,632*ratiow,441*ratioh,643*ratiow,433*ratioh,656*ratiow,423*ratioh,662*ratiow,419*ratioh,672*ratiow,419*ratioh,680*ratiow,425*ratioh,683*ratiow,426*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(1*ratiow,315*ratioh,4*ratiow,322*ratioh,14*ratiow,328*ratioh,29*ratiow,343*ratioh,33*ratiow,350*ratioh,39*ratiow,355*ratioh,50*ratiow,358*ratioh,62*ratiow,360*ratioh,67*ratiow,361*ratioh,76*ratiow,365*ratioh,91*ratiow,371*ratioh,108*ratiow,371*ratioh,128*ratiow,362*ratioh,152*ratiow,346*ratioh,179*ratiow,329*ratioh,202*ratiow,322*ratioh,229*ratiow,318*ratioh,251*ratiow,318*ratioh,256*ratiow,313*ratioh,255*ratiow,304*ratioh,260*ratiow,305*ratioh,274*ratiow,311*ratioh,319*ratiow,323*ratioh,364*ratiow,336*ratioh,380*ratiow,338*ratioh,396*ratiow,337*ratioh,409*ratiow,331*ratioh,417*ratiow,323*ratioh,422*ratiow,312*ratioh,422*ratiow,291*ratioh,419*ratiow,275*ratioh,412*ratiow,262*ratioh,397*ratiow,239*ratioh,371*ratiow,210*ratioh,356*ratiow,200*ratioh,324*ratiow,184*ratioh,275*ratiow,168*ratioh,247*ratiow,161*ratioh,219*ratiow,159*ratioh,189*ratiow,160*ratioh,172*ratiow,161*ratioh,156*ratiow,166*ratioh,137*ratiow,176*ratioh,126*ratiow,187*ratioh,111*ratiow,204*ratioh,89*ratiow,231*ratioh,62*ratiow,262*ratioh,51*ratiow,272*ratioh,39*ratiow,275*ratioh,25*ratiow,277*ratioh,7*ratiow,280*ratioh,1*ratiow,280*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(468*ratiow,626*ratioh,488*ratiow,602*ratioh,513*ratiow,568*ratioh,523*ratiow,548*ratioh,523*ratiow,497*ratioh,519*ratiow,460*ratioh,517*ratiow,451*ratioh,510*ratiow,431*ratioh,503*ratiow,407*ratioh,493*ratiow,384*ratioh,489*ratiow,371*ratioh,486*ratiow,371*ratioh,483*ratiow,376*ratioh,482*ratiow,383*ratioh,486*ratiow,398*ratioh,487*ratiow,421*ratioh,489*ratiow,450*ratioh,486*ratiow,480*ratioh,481*ratiow,492*ratioh,477*ratiow,501*ratioh,466*ratiow,514*ratioh,454*ratiow,524*ratioh,454*ratiow,535*ratioh,452*ratiow,557*ratioh,453*ratiow,568*ratioh,459*ratiow,581*ratioh,465*ratiow,596*ratioh,467*ratiow,610*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(512*ratiow,840*ratioh,513*ratiow,851*ratioh,530*ratiow,846*ratioh,555*ratiow,832*ratioh,574*ratiow,815*ratioh,588*ratiow,792*ratioh,605*ratiow,747*ratioh,615*ratiow,725*ratioh,625*ratiow,706*ratioh,635*ratiow,685*ratioh,643*ratiow,661*ratioh,623*ratiow,661*ratioh,623*ratiow,668*ratioh,619*ratiow,677*ratioh,612*ratiow,691*ratioh,602*ratiow,709*ratioh,595*ratiow,728*ratioh,585*ratiow,762*ratioh,578*ratiow,786*ratioh,569*ratiow,802*ratioh,552*ratiow,819*ratioh,536*ratiow,833*ratioh,523*ratiow,838*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(510*ratiow,828*ratioh,511*ratiow,841*ratioh,531*ratiow,835*ratioh,543*ratiow,829*ratioh,560*ratiow,812*ratioh,576*ratiow,790*ratioh,586*ratiow,759*ratioh,597*ratiow,724*ratioh,605*ratiow,703*ratioh,616*ratiow,684*ratioh,623*ratiow,668*ratioh,623*ratiow,660*ratioh,612*ratiow,660*ratioh,605*ratiow,673*ratioh,596*ratiow,695*ratioh,584*ratiow,723*ratioh,578*ratiow,741*ratioh,568*ratiow,766*ratioh,560*ratiow,785*ratioh,550*ratiow,803*ratioh,539*ratiow,818*ratioh,529*ratiow,825*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(509*ratiow,828*ratioh,530*ratiow,824*ratioh,540*ratiow,817*ratioh,552*ratiow,801*ratioh,566*ratiow,772*ratioh,576*ratiow,750*ratioh,583*ratiow,723*ratioh,598*ratiow,689*ratioh,612*ratiow,660*ratioh,578*ratiow,658*ratioh,543*ratiow,655*ratioh,527*ratiow,651*ratioh,530*ratiow,663*ratioh,535*ratiow,681*ratioh,537*ratiow,702*ratioh,537*ratiow,722*ratioh,534*ratiow,737*ratioh,527*ratiow,749*ratioh,522*ratiow,753*ratioh,512*ratiow,754*ratioh,502*ratiow,751*ratioh,502*ratiow,768*ratioh,505*ratiow,781*ratioh,508*ratiow,801*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(270*ratiow,570*ratioh,280*ratiow,567*ratioh,309*ratiow,550*ratioh,324*ratiow,533*ratioh,338*ratiow,507*ratioh,343*ratiow,483*ratioh,343*ratiow,469*ratioh,340*ratiow,453*ratioh,332*ratiow,437*ratioh,325*ratiow,431*ratioh,325*ratiow,450*ratioh,319*ratiow,474*ratioh,311*ratiow,501*ratioh,302*ratiow,523*ratioh,288*ratiow,540*ratioh,274*ratiow,558*ratioh,269*ratiow,567*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(1*ratiow,448*ratioh,7*ratiow,453*ratioh,16*ratiow,464*ratioh,30*ratiow,468*ratioh,51*ratiow,466*ratioh,58*ratiow,462*ratioh,62*ratiow,456*ratioh,62*ratiow,450*ratioh,59*ratiow,445*ratioh,52*ratiow,441*ratioh,41*ratiow,433*ratioh,28*ratiow,423*ratioh,22*ratiow,419*ratioh,12*ratiow,419*ratioh,4*ratiow,425*ratioh,1*ratiow,426*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile64(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 665;
var baseHeight = 871;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, CPu, Pir1, Pir2, Pir3, VPL, PVP";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(664*ratiow,288*ratioh,661*ratiow,303*ratioh,649*ratiow,323*ratioh,631*ratiow,345*ratioh,622*ratiow,353*ratioh,606*ratiow,359*ratioh,591*ratiow,360*ratioh,584*ratiow,363*ratioh,572*ratiow,371*ratioh,559*ratiow,372*ratioh,549*ratiow,368*ratioh,530*ratiow,355*ratioh,510*ratiow,343*ratioh,483*ratiow,330*ratioh,470*ratiow,326*ratioh,443*ratiow,325*ratioh,425*ratiow,324*ratioh,420*ratiow,320*ratioh,420*ratiow,315*ratioh,402*ratiow,320*ratioh,370*ratiow,331*ratioh,315*ratiow,351*ratioh,296*ratiow,356*ratioh,285*ratiow,355*ratioh,272*ratiow,346*ratioh,265*ratiow,334*ratioh,263*ratiow,312*ratioh,265*ratiow,292*ratioh,274*ratiow,273*ratioh,289*ratiow,250*ratioh,307*ratiow,227*ratioh,334*ratiow,206*ratioh,356*ratiow,192*ratioh,384*ratiow,181*ratioh,420*ratiow,169*ratioh,455*ratiow,159*ratioh,484*ratiow,156*ratioh,499*ratiow,157*ratioh,520*ratiow,165*ratioh,538*ratiow,179*ratioh,557*ratiow,200*ratioh,581*ratiow,230*ratioh,600*ratiow,252*ratioh,610*ratiow,264*ratioh,620*ratiow,269*ratioh,648*ratiow,270*ratioh,664*ratiow,270*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(163*ratiow,576*ratioh,173*ratiow,565*ratioh,176*ratiow,563*ratioh,180*ratiow,564*ratioh,181*ratiow,566*ratioh,185*ratiow,560*ratioh,194*ratiow,550*ratioh,202*ratiow,539*ratioh,207*ratiow,525*ratioh,205*ratiow,504*ratioh,203*ratiow,494*ratioh,197*ratiow,476*ratioh,195*ratiow,457*ratioh,196*ratiow,439*ratioh,196*ratiow,432*ratioh,192*ratiow,432*ratioh,186*ratiow,447*ratioh,179*ratiow,475*ratioh,171*ratiow,499*ratioh,165*ratiow,523*ratioh,161*ratiow,542*ratioh,162*ratiow,568*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(180*ratiow,840*ratioh,178*ratiow,860*ratioh,155*ratiow,854*ratioh,134*ratiow,846*ratioh,118*ratiow,837*ratioh,98*ratiow,820*ratioh,79*ratiow,795*ratioh,63*ratiow,762*ratioh,50*ratiow,728*ratioh,42*ratiow,695*ratioh,37*ratiow,667*ratioh,55*ratiow,665*ratioh,52*ratiow,669*ratioh,55*ratiow,690*ratioh,63*ratiow,717*ratioh,71*ratiow,743*ratioh,82*ratiow,773*ratioh,92*ratiow,792*ratioh,105*ratiow,808*ratioh,115*ratiow,816*ratioh,135*ratiow,827*ratioh,153*ratiow,836*ratioh,172*ratiow,840*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(180*ratiow,827*ratioh,180*ratiow,839*ratioh,169*ratiow,840*ratioh,151*ratiow,834*ratioh,126*ratiow,823*ratioh,105*ratiow,809*ratioh,91*ratiow,790*ratioh,80*ratiow,769*ratioh,73*ratiow,749*ratioh,58*ratiow,700*ratioh,52*ratiow,676*ratioh,52*ratiow,666*ratioh,60*ratiow,664*ratioh,66*ratiow,676*ratioh,71*ratiow,694*ratioh,79*ratiow,731*ratioh,84*ratiow,746*ratioh,94*ratiow,772*ratioh,105*ratiow,790*ratioh,117*ratiow,804*ratioh,138*ratiow,817*ratioh,154*ratiow,825*ratioh,171*ratiow,828*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(180*ratiow,827*ratioh,170*ratiow,828*ratioh,147*ratiow,823*ratioh,124*ratiow,808*ratioh,106*ratiow,792*ratioh,96*ratiow,775*ratioh,87*ratiow,756*ratioh,80*ratiow,735*ratioh,73*ratiow,704*ratioh,68*ratiow,682*ratioh,64*ratiow,671*ratioh,57*ratiow,665*ratioh,112*ratiow,657*ratioh,148*ratiow,652*ratioh,145*ratiow,656*ratioh,135*ratiow,669*ratioh,127*ratiow,689*ratioh,124*ratiow,703*ratioh,123*ratiow,718*ratioh,128*ratiow,735*ratioh,141*ratiow,748*ratioh,146*ratiow,749*ratioh,152*ratiow,748*ratioh,165*ratiow,738*ratioh,163*ratiow,747*ratioh,163*ratiow,751*ratioh,170*ratiow,755*ratioh,167*ratiow,765*ratioh,167*ratiow,777*ratioh,174*ratiow,795*ratioh,179*ratiow,812*ratioh,181*ratiow,821*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(425*ratiow,575*ratioh,396*ratiow,562*ratioh,377*ratiow,549*ratioh,360*ratiow,532*ratioh,351*ratiow,513*ratioh,346*ratiow,496*ratioh,347*ratiow,483*ratioh,351*ratiow,464*ratioh,358*ratiow,441*ratioh,365*ratiow,427*ratioh,370*ratiow,421*ratioh,372*ratiow,452*ratioh,375*ratiow,481*ratioh,381*ratiow,504*ratioh,393*ratiow,526*ratioh,408*ratiow,549*ratioh,424*ratiow,571*ratioh,426*ratiow,574*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(663*ratiow,434*ratioh,658*ratiow,439*ratioh,656*ratiow,449*ratioh,653*ratiow,462*ratioh,646*ratiow,474*ratioh,639*ratiow,478*ratioh,631*ratiow,478*ratioh,625*ratiow,473*ratioh,621*ratiow,466*ratioh,620*ratiow,461*ratioh,620*ratiow,448*ratioh,624*ratiow,442*ratioh,630*ratiow,432*ratioh,637*ratiow,422*ratioh,642*ratiow,419*ratioh,647*ratiow,419*ratioh,650*ratiow,420*ratioh,656*ratiow,423*ratioh,661*ratiow,425*ratioh,664*ratiow,425*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(1*ratiow,288*ratioh,4*ratiow,303*ratioh,16*ratiow,323*ratioh,34*ratiow,345*ratioh,43*ratiow,353*ratioh,59*ratiow,359*ratioh,74*ratiow,360*ratioh,81*ratiow,363*ratioh,93*ratiow,371*ratioh,106*ratiow,372*ratioh,116*ratiow,368*ratioh,135*ratiow,355*ratioh,155*ratiow,343*ratioh,182*ratiow,330*ratioh,195*ratiow,326*ratioh,222*ratiow,325*ratioh,240*ratiow,324*ratioh,245*ratiow,320*ratioh,245*ratiow,315*ratioh,263*ratiow,320*ratioh,295*ratiow,331*ratioh,350*ratiow,351*ratioh,369*ratiow,356*ratioh,380*ratiow,355*ratioh,393*ratiow,346*ratioh,400*ratiow,334*ratioh,402*ratiow,312*ratioh,400*ratiow,292*ratioh,391*ratiow,273*ratioh,376*ratiow,250*ratioh,358*ratiow,227*ratioh,331*ratiow,206*ratioh,309*ratiow,192*ratioh,281*ratiow,181*ratioh,245*ratiow,169*ratioh,210*ratiow,159*ratioh,181*ratiow,156*ratioh,166*ratiow,157*ratioh,145*ratiow,165*ratioh,127*ratiow,179*ratioh,108*ratiow,200*ratioh,84*ratiow,230*ratioh,65*ratiow,252*ratioh,55*ratiow,264*ratioh,45*ratiow,269*ratioh,17*ratiow,270*ratioh,1*ratiow,270*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(502*ratiow,576*ratioh,492*ratiow,565*ratioh,489*ratiow,563*ratioh,485*ratiow,564*ratioh,484*ratiow,566*ratioh,480*ratiow,560*ratioh,471*ratiow,550*ratioh,463*ratiow,539*ratioh,458*ratiow,525*ratioh,460*ratiow,504*ratioh,462*ratiow,494*ratioh,468*ratiow,476*ratioh,470*ratiow,457*ratioh,469*ratiow,439*ratioh,469*ratiow,432*ratioh,473*ratiow,432*ratioh,479*ratiow,447*ratioh,486*ratiow,475*ratioh,494*ratiow,499*ratioh,500*ratiow,523*ratioh,504*ratiow,542*ratioh,503*ratiow,568*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(485*ratiow,840*ratioh,487*ratiow,860*ratioh,510*ratiow,854*ratioh,531*ratiow,846*ratioh,547*ratiow,837*ratioh,567*ratiow,820*ratioh,586*ratiow,795*ratioh,602*ratiow,762*ratioh,615*ratiow,728*ratioh,623*ratiow,695*ratioh,628*ratiow,667*ratioh,610*ratiow,665*ratioh,613*ratiow,669*ratioh,610*ratiow,690*ratioh,602*ratiow,717*ratioh,594*ratiow,743*ratioh,583*ratiow,773*ratioh,573*ratiow,792*ratioh,560*ratiow,808*ratioh,550*ratiow,816*ratioh,530*ratiow,827*ratioh,512*ratiow,836*ratioh,493*ratiow,840*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(485*ratiow,827*ratioh,485*ratiow,839*ratioh,496*ratiow,840*ratioh,514*ratiow,834*ratioh,539*ratiow,823*ratioh,560*ratiow,809*ratioh,574*ratiow,790*ratioh,585*ratiow,769*ratioh,592*ratiow,749*ratioh,607*ratiow,700*ratioh,613*ratiow,676*ratioh,613*ratiow,666*ratioh,605*ratiow,664*ratioh,599*ratiow,676*ratioh,594*ratiow,694*ratioh,586*ratiow,731*ratioh,581*ratiow,746*ratioh,571*ratiow,772*ratioh,560*ratiow,790*ratioh,548*ratiow,804*ratioh,527*ratiow,817*ratioh,511*ratiow,825*ratioh,494*ratiow,828*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(485*ratiow,827*ratioh,495*ratiow,828*ratioh,518*ratiow,823*ratioh,541*ratiow,808*ratioh,559*ratiow,792*ratioh,569*ratiow,775*ratioh,578*ratiow,756*ratioh,585*ratiow,735*ratioh,592*ratiow,704*ratioh,597*ratiow,682*ratioh,601*ratiow,671*ratioh,608*ratiow,665*ratioh,553*ratiow,657*ratioh,517*ratiow,652*ratioh,520*ratiow,656*ratioh,530*ratiow,669*ratioh,538*ratiow,689*ratioh,541*ratiow,703*ratioh,542*ratiow,718*ratioh,537*ratiow,735*ratioh,524*ratiow,748*ratioh,519*ratiow,749*ratioh,513*ratiow,748*ratioh,500*ratiow,738*ratioh,502*ratiow,747*ratioh,502*ratiow,751*ratioh,495*ratiow,755*ratioh,498*ratiow,765*ratioh,498*ratiow,777*ratioh,491*ratiow,795*ratioh,486*ratiow,812*ratioh,484*ratiow,821*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(240*ratiow,575*ratioh,269*ratiow,562*ratioh,288*ratiow,549*ratioh,305*ratiow,532*ratioh,314*ratiow,513*ratioh,319*ratiow,496*ratioh,318*ratiow,483*ratioh,314*ratiow,464*ratioh,307*ratiow,441*ratioh,300*ratiow,427*ratioh,295*ratiow,421*ratioh,293*ratiow,452*ratioh,290*ratiow,481*ratioh,284*ratiow,504*ratioh,272*ratiow,526*ratioh,257*ratiow,549*ratioh,241*ratiow,571*ratioh,239*ratiow,574*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(2*ratiow,434*ratioh,7*ratiow,439*ratioh,9*ratiow,449*ratioh,12*ratiow,462*ratioh,19*ratiow,474*ratioh,26*ratiow,478*ratioh,34*ratiow,478*ratioh,40*ratiow,473*ratioh,44*ratiow,466*ratioh,45*ratiow,461*ratioh,45*ratiow,448*ratioh,41*ratiow,442*ratioh,35*ratiow,432*ratioh,28*ratiow,422*ratioh,23*ratiow,419*ratioh,18*ratiow,419*ratioh,15*ratiow,420*ratioh,9*ratiow,423*ratioh,4*ratiow,425*ratioh,1*ratiow,425*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile65(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 665;
var baseHeight = 893;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, CPu, Pir1, Pir2, Pir3, VPL, PVP";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(663*ratiow,307*ratioh,654*ratiow,323*ratioh,644*ratiow,341*ratioh,631*ratiow,355*ratioh,618*ratiow,364*ratioh,602*ratiow,369*ratioh,592*ratiow,371*ratioh,586*ratiow,370*ratioh,572*ratiow,359*ratioh,570*ratiow,357*ratioh,566*ratiow,362*ratioh,561*ratiow,365*ratioh,555*ratiow,367*ratioh,544*ratiow,367*ratioh,531*ratiow,363*ratioh,516*ratiow,353*ratioh,497*ratiow,341*ratioh,486*ratiow,336*ratioh,457*ratiow,329*ratioh,440*ratiow,327*ratioh,408*ratiow,325*ratioh,408*ratiow,318*ratioh,398*ratiow,319*ratioh,381*ratiow,325*ratioh,369*ratiow,330*ratioh,350*ratiow,340*ratioh,335*ratiow,354*ratioh,320*ratiow,368*ratioh,309*ratiow,375*ratioh,297*ratiow,379*ratioh,284*ratiow,380*ratioh,275*ratiow,379*ratioh,265*ratiow,371*ratioh,257*ratiow,355*ratioh,254*ratiow,338*ratioh,254*ratiow,320*ratioh,258*ratiow,306*ratioh,267*ratiow,289*ratioh,279*ratiow,270*ratioh,296*ratiow,248*ratioh,321*ratiow,223*ratioh,337*ratiow,210*ratioh,358*ratiow,194*ratioh,374*ratiow,186*ratioh,403*ratiow,176*ratioh,429*ratiow,169*ratioh,451*ratiow,163*ratioh,486*ratiow,161*ratioh,501*ratiow,162*ratioh,513*ratiow,166*ratioh,526*ratiow,174*ratioh,536*ratiow,182*ratioh,542*ratiow,188*ratioh,552*ratiow,202*ratioh,562*ratiow,218*ratioh,578*ratiow,240*ratioh,591*ratiow,255*ratioh,605*ratiow,268*ratioh,618*ratiow,275*ratioh,631*ratiow,278*ratioh,648*ratiow,280*ratioh,664*ratiow,280*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(176*ratiow,596*ratioh,171*ratiow,593*ratioh,166*ratiow,596*ratioh,164*ratiow,567*ratioh,166*ratiow,528*ratioh,173*ratiow,484*ratioh,179*ratiow,456*ratioh,184*ratiow,438*ratioh,189*ratiow,429*ratioh,192*ratiow,429*ratioh,192*ratiow,433*ratioh,188*ratiow,446*ratioh,185*ratiow,458*ratioh,186*ratiow,473*ratioh,191*ratiow,494*ratioh,192*ratiow,519*ratioh,191*ratiow,536*ratioh,183*ratiow,550*ratioh,178*ratiow,567*ratioh,177*ratiow,584*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(189*ratiow,870*ratioh,189*ratiow,887*ratioh,162*ratiow,879*ratioh,140*ratiow,867*ratioh,121*ratiow,850*ratioh,101*ratiow,828*ratioh,92*ratiow,814*ratioh,87*ratiow,796*ratioh,77*ratiow,773*ratioh,62*ratiow,735*ratioh,53*ratiow,707*ratioh,43*ratiow,678*ratioh,60*ratiow,678*ratioh,56*ratiow,681*ratioh,60*ratiow,694*ratioh,70*ratiow,719*ratioh,99*ratiow,789*ratioh,111*ratiow,811*ratioh,124*ratiow,828*ratioh,142*ratiow,850*ratioh,169*ratiow,865*ratioh,184*ratiow,870*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(185*ratiow,856*ratioh,190*ratiow,871*ratioh,177*ratiow,869*ratioh,152*ratiow,857*ratioh,131*ratiow,838*ratioh,114*ratiow,815*ratioh,103*ratiow,800*ratioh,87*ratiow,760*ratioh,77*ratiow,737*ratioh,59*ratiow,692*ratioh,57*ratiow,684*ratioh,58*ratiow,678*ratioh,63*ratiow,678*ratioh,67*ratiow,684*ratioh,75*ratiow,701*ratioh,85*ratiow,723*ratioh,95*ratiow,750*ratioh,107*ratiow,775*ratioh,125*ratiow,805*ratioh,142*ratiow,828*ratioh,160*ratiow,846*ratioh,172*ratiow,853*ratioh,182*ratiow,856*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(186*ratiow,857*ratioh,175*ratiow,854*ratioh,158*ratiow,845*ratioh,128*ratiow,810*ratioh,111*ratiow,782*ratioh,91*ratiow,740*ratioh,75*ratiow,699*ratioh,66*ratiow,680*ratioh,63*ratiow,677*ratioh,109*ratiow,674*ratioh,154*ratiow,670*ratioh,149*ratiow,689*ratioh,143*ratiow,709*ratioh,142*ratiow,726*ratioh,144*ratiow,745*ratioh,154*ratiow,763*ratioh,161*ratiow,769*ratioh,171*ratiow,771*ratioh,183*ratiow,766*ratioh,181*ratiow,772*ratioh,179*ratiow,779*ratioh,180*ratiow,784*ratioh,178*ratiow,795*ratioh,179*ratiow,818*ratioh,182*ratiow,829*ratioh,182*ratiow,845*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(450*ratiow,587*ratioh,411*ratiow,576*ratioh,389*ratiow,564*ratioh,368*ratiow,537*ratioh,359*ratiow,515*ratioh,357*ratiow,484*ratioh,359*ratiow,463*ratioh,364*ratiow,449*ratioh,371*ratiow,437*ratioh,372*ratiow,438*ratioh,375*ratiow,465*ratioh,382*ratiow,491*ratioh,392*ratiow,515*ratioh,408*ratiow,545*ratioh,424*ratiow,565*ratioh,441*ratiow,580*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(663*ratiow,442*ratioh,657*ratiow,451*ratioh,654*ratiow,464*ratioh,650*ratiow,474*ratioh,646*ratiow,483*ratioh,637*ratiow,490*ratioh,631*ratiow,491*ratioh,624*ratiow,487*ratioh,621*ratiow,482*ratioh,620*ratiow,468*ratioh,621*ratiow,454*ratioh,623*ratiow,444*ratioh,633*ratiow,434*ratioh,641*ratiow,430*ratioh,651*ratiow,431*ratioh,659*ratiow,437*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(2*ratiow,307*ratioh,11*ratiow,323*ratioh,21*ratiow,341*ratioh,34*ratiow,355*ratioh,47*ratiow,364*ratioh,63*ratiow,369*ratioh,73*ratiow,371*ratioh,79*ratiow,370*ratioh,93*ratiow,359*ratioh,95*ratiow,357*ratioh,99*ratiow,362*ratioh,104*ratiow,365*ratioh,110*ratiow,367*ratioh,121*ratiow,367*ratioh,134*ratiow,363*ratioh,149*ratiow,353*ratioh,168*ratiow,341*ratioh,179*ratiow,336*ratioh,208*ratiow,329*ratioh,225*ratiow,327*ratioh,257*ratiow,325*ratioh,257*ratiow,318*ratioh,267*ratiow,319*ratioh,284*ratiow,325*ratioh,296*ratiow,330*ratioh,315*ratiow,340*ratioh,330*ratiow,354*ratioh,345*ratiow,368*ratioh,356*ratiow,375*ratioh,368*ratiow,379*ratioh,381*ratiow,380*ratioh,390*ratiow,379*ratioh,400*ratiow,371*ratioh,408*ratiow,355*ratioh,411*ratiow,338*ratioh,411*ratiow,320*ratioh,407*ratiow,306*ratioh,398*ratiow,289*ratioh,386*ratiow,270*ratioh,369*ratiow,248*ratioh,344*ratiow,223*ratioh,328*ratiow,210*ratioh,307*ratiow,194*ratioh,291*ratiow,186*ratioh,262*ratiow,176*ratioh,236*ratiow,169*ratioh,214*ratiow,163*ratioh,179*ratiow,161*ratioh,164*ratiow,162*ratioh,152*ratiow,166*ratioh,139*ratiow,174*ratioh,129*ratiow,182*ratioh,123*ratiow,188*ratioh,113*ratiow,202*ratioh,103*ratiow,218*ratioh,87*ratiow,240*ratioh,74*ratiow,255*ratioh,60*ratiow,268*ratioh,47*ratiow,275*ratioh,34*ratiow,278*ratioh,17*ratiow,280*ratioh,1*ratiow,280*ratioh);
data = analyze_pic(data);

//CPu
selectWindow(name);
makePolygon(489*ratiow,596*ratioh,494*ratiow,593*ratioh,499*ratiow,596*ratioh,501*ratiow,567*ratioh,499*ratiow,528*ratioh,492*ratiow,484*ratioh,486*ratiow,456*ratioh,481*ratiow,438*ratioh,476*ratiow,429*ratioh,473*ratiow,429*ratioh,473*ratiow,433*ratioh,477*ratiow,446*ratioh,480*ratiow,458*ratioh,479*ratiow,473*ratioh,474*ratiow,494*ratioh,473*ratiow,519*ratioh,474*ratiow,536*ratioh,482*ratiow,550*ratioh,487*ratiow,567*ratioh,488*ratiow,584*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(476*ratiow,870*ratioh,476*ratiow,887*ratioh,503*ratiow,879*ratioh,525*ratiow,867*ratioh,544*ratiow,850*ratioh,564*ratiow,828*ratioh,573*ratiow,814*ratioh,578*ratiow,796*ratioh,588*ratiow,773*ratioh,603*ratiow,735*ratioh,612*ratiow,707*ratioh,622*ratiow,678*ratioh,605*ratiow,678*ratioh,609*ratiow,681*ratioh,605*ratiow,694*ratioh,595*ratiow,719*ratioh,566*ratiow,789*ratioh,554*ratiow,811*ratioh,541*ratiow,828*ratioh,523*ratiow,850*ratioh,496*ratiow,865*ratioh,481*ratiow,870*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(480*ratiow,856*ratioh,475*ratiow,871*ratioh,488*ratiow,869*ratioh,513*ratiow,857*ratioh,534*ratiow,838*ratioh,551*ratiow,815*ratioh,562*ratiow,800*ratioh,578*ratiow,760*ratioh,588*ratiow,737*ratioh,606*ratiow,692*ratioh,608*ratiow,684*ratioh,607*ratiow,678*ratioh,602*ratiow,678*ratioh,598*ratiow,684*ratioh,590*ratiow,701*ratioh,580*ratiow,723*ratioh,570*ratiow,750*ratioh,558*ratiow,775*ratioh,540*ratiow,805*ratioh,523*ratiow,828*ratioh,505*ratiow,846*ratioh,493*ratiow,853*ratioh,483*ratiow,856*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(479*ratiow,857*ratioh,490*ratiow,854*ratioh,507*ratiow,845*ratioh,537*ratiow,810*ratioh,554*ratiow,782*ratioh,574*ratiow,740*ratioh,590*ratiow,699*ratioh,599*ratiow,680*ratioh,602*ratiow,677*ratioh,556*ratiow,674*ratioh,511*ratiow,670*ratioh,516*ratiow,689*ratioh,522*ratiow,709*ratioh,523*ratiow,726*ratioh,521*ratiow,745*ratioh,511*ratiow,763*ratioh,504*ratiow,769*ratioh,494*ratiow,771*ratioh,482*ratiow,766*ratioh,484*ratiow,772*ratioh,486*ratiow,779*ratioh,485*ratiow,784*ratioh,487*ratiow,795*ratioh,486*ratiow,818*ratioh,483*ratiow,829*ratioh,483*ratiow,845*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(215*ratiow,587*ratioh,254*ratiow,576*ratioh,276*ratiow,564*ratioh,297*ratiow,537*ratioh,306*ratiow,515*ratioh,308*ratiow,484*ratioh,306*ratiow,463*ratioh,301*ratiow,449*ratioh,294*ratiow,437*ratioh,293*ratiow,438*ratioh,290*ratiow,465*ratioh,283*ratiow,491*ratioh,273*ratiow,515*ratioh,257*ratiow,545*ratioh,241*ratiow,565*ratioh,224*ratiow,580*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(2*ratiow,442*ratioh,8*ratiow,451*ratioh,11*ratiow,464*ratioh,15*ratiow,474*ratioh,19*ratiow,483*ratioh,28*ratiow,490*ratioh,34*ratiow,491*ratioh,41*ratiow,487*ratioh,44*ratiow,482*ratioh,45*ratiow,468*ratioh,44*ratiow,454*ratioh,42*ratiow,444*ratioh,32*ratiow,434*ratioh,24*ratiow,430*ratioh,14*ratiow,431*ratioh,6*ratiow,437*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile66(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 667;
var baseHeight = 878;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, Pir1, Pir2, Pir3, VPL, PVP";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(666*ratiow,300*ratioh,662*ratiow,313*ratioh,648*ratiow,333*ratioh,639*ratiow,344*ratioh,630*ratiow,355*ratioh,613*ratiow,364*ratioh,584*ratiow,368*ratioh,571*ratiow,370*ratioh,558*ratiow,368*ratioh,537*ratiow,359*ratioh,518*ratiow,349*ratioh,497*ratiow,341*ratioh,470*ratiow,332*ratioh,446*ratiow,326*ratioh,431*ratiow,327*ratioh,415*ratiow,329*ratioh,396*ratiow,326*ratioh,391*ratiow,327*ratioh,392*ratiow,318*ratioh,386*ratiow,317*ratioh,374*ratiow,322*ratioh,355*ratiow,331*ratioh,335*ratiow,345*ratioh,294*ratiow,370*ratioh,271*ratiow,381*ratioh,265*ratiow,382*ratioh,260*ratiow,382*ratioh,249*ratiow,373*ratioh,241*ratiow,355*ratioh,237*ratiow,338*ratioh,237*ratiow,311*ratioh,245*ratiow,291*ratioh,263*ratiow,264*ratioh,275*ratiow,249*ratioh,298*ratiow,226*ratioh,325*ratiow,205*ratioh,352*ratiow,190*ratioh,375*ratiow,182*ratioh,408*ratiow,171*ratioh,429*ratiow,165*ratioh,455*ratiow,161*ratioh,482*ratiow,160*ratioh,501*ratiow,162*ratioh,518*ratiow,168*ratioh,533*ratiow,181*ratioh,551*ratiow,206*ratioh,572*ratiow,235*ratioh,583*ratiow,247*ratioh,591*ratiow,259*ratioh,596*ratiow,267*ratioh,604*ratiow,270*ratioh,619*ratiow,273*ratioh,642*ratiow,274*ratioh,666*ratiow,275*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(172*ratiow,849*ratioh,167*ratiow,868*ratioh,145*ratiow,861*ratioh,120*ratiow,847*ratioh,99*ratiow,822*ratioh,73*ratiow,782*ratioh,63*ratiow,755*ratioh,54*ratiow,721*ratioh,45*ratiow,691*ratioh,43*ratiow,680*ratioh,62*ratiow,675*ratioh,58*ratiow,681*ratioh,60*ratiow,691*ratioh,66*ratiow,705*ratioh,73*ratiow,718*ratioh,76*ratiow,734*ratioh,78*ratiow,753*ratioh,83*ratiow,772*ratioh,93*ratiow,790*ratioh,104*ratiow,806*ratioh,121*ratiow,823*ratioh,131*ratiow,833*ratioh,157*ratiow,846*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(173*ratiow,837*ratioh,172*ratiow,849*ratioh,165*ratiow,848*ratioh,146*ratiow,841*ratioh,121*ratiow,824*ratioh,98*ratiow,797*ratioh,86*ratiow,778*ratioh,78*ratiow,756*ratioh,75*ratiow,727*ratioh,71*ratiow,714*ratioh,62*ratiow,697*ratioh,59*ratiow,687*ratioh,58*ratiow,681*ratioh,60*ratiow,675*ratioh,66*ratiow,675*ratioh,69*ratiow,679*ratioh,71*ratiow,691*ratioh,78*ratiow,707*ratioh,82*ratiow,718*ratioh,85*ratiow,733*ratioh,87*ratiow,749*ratioh,93*ratiow,769*ratioh,106*ratiow,792*ratioh,123*ratiow,812*ratioh,140*ratiow,825*ratioh,152*ratiow,831*ratioh,165*ratiow,837*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(173*ratiow,837*ratioh,159*ratiow,835*ratioh,136*ratiow,823*ratioh,121*ratiow,809*ratioh,101*ratiow,785*ratioh,90*ratiow,761*ratioh,85*ratiow,740*ratioh,84*ratiow,728*ratioh,80*ratiow,709*ratioh,73*ratiow,696*ratioh,69*ratiow,682*ratioh,67*ratiow,676*ratioh,65*ratiow,674*ratioh,101*ratiow,666*ratioh,136*ratiow,658*ratioh,150*ratiow,654*ratioh,144*ratiow,666*ratioh,137*ratiow,688*ratioh,134*ratiow,708*ratioh,139*ratiow,733*ratioh,149*ratiow,751*ratioh,156*ratiow,757*ratioh,164*ratiow,757*ratioh,175*ratiow,749*ratioh,176*ratiow,758*ratioh,183*ratiow,765*ratioh,176*ratiow,776*ratioh,172*ratiow,792*ratioh,172*ratiow,815*ratioh,174*ratiow,832*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(405*ratiow,555*ratioh,376*ratiow,547*ratioh,359*ratiow,527*ratioh,349*ratiow,508*ratioh,347*ratiow,485*ratioh,352*ratiow,459*ratioh,359*ratiow,443*ratioh,365*ratiow,435*ratioh,367*ratiow,441*ratioh,369*ratiow,460*ratioh,373*ratiow,482*ratioh,380*ratiow,507*ratioh,391*ratiow,534*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(642*ratiow,423*ratioh,651*ratiow,428*ratioh,657*ratiow,436*ratioh,660*ratiow,444*ratioh,656*ratiow,455*ratioh,647*ratiow,468*ratioh,640*ratiow,474*ratioh,637*ratiow,475*ratioh,633*ratiow,472*ratioh,629*ratiow,465*ratioh,627*ratiow,452*ratioh,626*ratiow,437*ratioh,634*ratiow,429*ratioh,639*ratiow,427*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(1*ratiow,300*ratioh,5*ratiow,313*ratioh,19*ratiow,333*ratioh,28*ratiow,344*ratioh,37*ratiow,355*ratioh,54*ratiow,364*ratioh,83*ratiow,368*ratioh,96*ratiow,370*ratioh,109*ratiow,368*ratioh,130*ratiow,359*ratioh,149*ratiow,349*ratioh,170*ratiow,341*ratioh,197*ratiow,332*ratioh,221*ratiow,326*ratioh,236*ratiow,327*ratioh,252*ratiow,329*ratioh,271*ratiow,326*ratioh,276*ratiow,327*ratioh,275*ratiow,318*ratioh,281*ratiow,317*ratioh,293*ratiow,322*ratioh,312*ratiow,331*ratioh,332*ratiow,345*ratioh,373*ratiow,370*ratioh,396*ratiow,381*ratioh,402*ratiow,382*ratioh,407*ratiow,382*ratioh,418*ratiow,373*ratioh,426*ratiow,355*ratioh,430*ratiow,338*ratioh,430*ratiow,311*ratioh,422*ratiow,291*ratioh,404*ratiow,264*ratioh,392*ratiow,249*ratioh,369*ratiow,226*ratioh,342*ratiow,205*ratioh,315*ratiow,190*ratioh,292*ratiow,182*ratioh,259*ratiow,171*ratioh,238*ratiow,165*ratioh,212*ratiow,161*ratioh,185*ratiow,160*ratioh,166*ratiow,162*ratioh,149*ratiow,168*ratioh,134*ratiow,181*ratioh,116*ratiow,206*ratioh,95*ratiow,235*ratioh,84*ratiow,247*ratioh,76*ratiow,259*ratioh,71*ratiow,267*ratioh,63*ratiow,270*ratioh,48*ratiow,273*ratioh,25*ratiow,274*ratioh,1*ratiow,275*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(495*ratiow,849*ratioh,500*ratiow,868*ratioh,522*ratiow,861*ratioh,547*ratiow,847*ratioh,568*ratiow,822*ratioh,594*ratiow,782*ratioh,604*ratiow,755*ratioh,613*ratiow,721*ratioh,622*ratiow,691*ratioh,624*ratiow,680*ratioh,605*ratiow,675*ratioh,609*ratiow,681*ratioh,607*ratiow,691*ratioh,601*ratiow,705*ratioh,594*ratiow,718*ratioh,591*ratiow,734*ratioh,589*ratiow,753*ratioh,584*ratiow,772*ratioh,574*ratiow,790*ratioh,563*ratiow,806*ratioh,546*ratiow,823*ratioh,536*ratiow,833*ratioh,510*ratiow,846*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(494*ratiow,837*ratioh,495*ratiow,849*ratioh,502*ratiow,848*ratioh,521*ratiow,841*ratioh,546*ratiow,824*ratioh,569*ratiow,797*ratioh,581*ratiow,778*ratioh,589*ratiow,756*ratioh,592*ratiow,727*ratioh,596*ratiow,714*ratioh,605*ratiow,697*ratioh,608*ratiow,687*ratioh,609*ratiow,681*ratioh,607*ratiow,675*ratioh,601*ratiow,675*ratioh,598*ratiow,679*ratioh,596*ratiow,691*ratioh,589*ratiow,707*ratioh,585*ratiow,718*ratioh,582*ratiow,733*ratioh,580*ratiow,749*ratioh,574*ratiow,769*ratioh,561*ratiow,792*ratioh,544*ratiow,812*ratioh,527*ratiow,825*ratioh,515*ratiow,831*ratioh,502*ratiow,837*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(494*ratiow,837*ratioh,508*ratiow,835*ratioh,531*ratiow,823*ratioh,546*ratiow,809*ratioh,566*ratiow,785*ratioh,577*ratiow,761*ratioh,582*ratiow,740*ratioh,583*ratiow,728*ratioh,587*ratiow,709*ratioh,594*ratiow,696*ratioh,598*ratiow,682*ratioh,600*ratiow,676*ratioh,602*ratiow,674*ratioh,566*ratiow,666*ratioh,531*ratiow,658*ratioh,517*ratiow,654*ratioh,523*ratiow,666*ratioh,530*ratiow,688*ratioh,533*ratiow,708*ratioh,528*ratiow,733*ratioh,518*ratiow,751*ratioh,511*ratiow,757*ratioh,503*ratiow,757*ratioh,492*ratiow,749*ratioh,491*ratiow,758*ratioh,484*ratiow,765*ratioh,491*ratiow,776*ratioh,495*ratiow,792*ratioh,495*ratiow,815*ratioh,493*ratiow,832*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(262*ratiow,555*ratioh,291*ratiow,547*ratioh,308*ratiow,527*ratioh,318*ratiow,508*ratioh,320*ratiow,485*ratioh,315*ratiow,459*ratioh,308*ratiow,443*ratioh,302*ratiow,435*ratioh,300*ratiow,441*ratioh,298*ratiow,460*ratioh,294*ratiow,482*ratioh,287*ratiow,507*ratioh,276*ratiow,534*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(25*ratiow,423*ratioh,16*ratiow,428*ratioh,10*ratiow,436*ratioh,7*ratiow,444*ratioh,11*ratiow,455*ratioh,20*ratiow,468*ratioh,27*ratiow,474*ratioh,30*ratiow,475*ratioh,34*ratiow,472*ratioh,38*ratiow,465*ratioh,40*ratiow,452*ratioh,41*ratiow,437*ratioh,33*ratiow,429*ratioh,28*ratiow,427*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile67(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 664;
var baseHeight = 861;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, Pir1, Pir2, Pir3, VPL, PVP";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(663*ratiow,305*ratioh,660*ratiow,314*ratioh,646*ratiow,331*ratioh,629*ratiow,354*ratioh,609*ratiow,367*ratioh,595*ratiow,370*ratioh,585*ratiow,370*ratioh,566*ratiow,363*ratioh,548*ratiow,348*ratioh,535*ratiow,329*ratioh,533*ratiow,336*ratioh,524*ratiow,340*ratioh,509*ratiow,339*ratioh,497*ratiow,335*ratioh,474*ratiow,325*ratioh,457*ratiow,320*ratioh,429*ratiow,313*ratioh,400*ratiow,311*ratioh,385*ratiow,309*ratioh,374*ratiow,306*ratioh,366*ratiow,308*ratioh,362*ratiow,307*ratioh,344*ratiow,317*ratioh,331*ratiow,326*ratioh,319*ratiow,337*ratioh,301*ratiow,353*ratioh,287*ratiow,365*ratioh,272*ratiow,373*ratioh,255*ratiow,377*ratioh,246*ratiow,375*ratioh,237*ratiow,370*ratioh,232*ratiow,361*ratioh,228*ratiow,348*ratioh,227*ratiow,336*ratioh,227*ratiow,311*ratioh,230*ratiow,297*ratioh,236*ratiow,284*ratioh,246*ratiow,267*ratioh,256*ratiow,253*ratioh,272*ratiow,234*ratioh,287*ratiow,217*ratioh,301*ratiow,204*ratioh,324*ratiow,188*ratioh,330*ratiow,185*ratioh,350*ratiow,175*ratioh,375*ratiow,167*ratioh,421*ratiow,155*ratioh,448*ratiow,148*ratioh,473*ratiow,148*ratioh,488*ratiow,151*ratioh,509*ratiow,156*ratioh,525*ratiow,164*ratioh,532*ratiow,171*ratioh,544*ratiow,188*ratioh,571*ratiow,229*ratioh,586*ratiow,251*ratioh,598*ratiow,267*ratioh,604*ratiow,272*ratioh,614*ratiow,276*ratioh,634*ratiow,279*ratioh,657*ratiow,279*ratioh,663*ratiow,279*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(147*ratiow,835*ratioh,144*ratiow,852*ratioh,130*ratiow,847*ratioh,111*ratiow,833*ratioh,88*ratiow,814*ratioh,70*ratiow,792*ratioh,55*ratiow,763*ratioh,44*ratiow,736*ratioh,34*ratiow,700*ratioh,28*ratiow,669*ratioh,26*ratiow,650*ratioh,42*ratiow,648*ratioh,38*ratiow,651*ratioh,38*ratiow,668*ratioh,46*ratiow,687*ratioh,55*ratiow,710*ratioh,63*ratiow,727*ratioh,66*ratiow,733*ratioh,67*ratiow,746*ratioh,72*ratiow,762*ratioh,80*ratiow,780*ratioh,88*ratiow,796*ratioh,104*ratiow,813*ratioh,118*ratiow,824*ratioh,129*ratiow,831*ratioh,137*ratiow,834*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(148*ratiow,822*ratioh,147*ratiow,836*ratioh,138*ratiow,835*ratioh,120*ratiow,825*ratioh,102*ratiow,811*ratioh,90*ratiow,798*ratioh,82*ratiow,784*ratioh,74*ratiow,767*ratioh,69*ratiow,753*ratioh,66*ratiow,734*ratioh,58*ratiow,716*ratioh,46*ratiow,690*ratioh,40*ratiow,672*ratioh,37*ratiow,663*ratioh,38*ratiow,649*ratioh,47*ratiow,648*ratioh,50*ratiow,661*ratioh,56*ratiow,679*ratioh,63*ratiow,699*ratioh,73*ratiow,726*ratioh,84*ratiow,753*ratioh,101*ratiow,785*ratioh,119*ratiow,808*ratioh,130*ratiow,818*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(148*ratiow,821*ratioh,137*ratiow,820*ratioh,125*ratiow,814*ratioh,109*ratiow,797*ratioh,92*ratiow,769*ratioh,80*ratiow,743*ratioh,70*ratiow,717*ratioh,58*ratiow,685*ratioh,51*ratiow,661*ratioh,48*ratiow,651*ratioh,43*ratiow,648*ratioh,82*ratiow,643*ratioh,111*ratiow,640*ratioh,142*ratiow,636*ratioh,142*ratiow,644*ratioh,138*ratiow,659*ratioh,135*ratiow,676*ratioh,135*ratiow,703*ratioh,140*ratiow,728*ratioh,145*ratiow,740*ratioh,151*ratiow,746*ratioh,156*ratiow,747*ratioh,162*ratiow,745*ratioh,166*ratiow,743*ratioh,166*ratiow,746*ratioh,161*ratiow,755*ratioh,159*ratiow,767*ratioh,161*ratiow,774*ratioh,154*ratiow,779*ratioh,151*ratiow,786*ratioh,149*ratiow,795*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(385*ratiow,548*ratioh,372*ratiow,544*ratioh,353*ratiow,526*ratioh,344*ratiow,507*ratioh,339*ratiow,487*ratioh,338*ratiow,472*ratioh,339*ratiow,456*ratioh,343*ratiow,443*ratioh,347*ratiow,434*ratioh,352*ratiow,443*ratioh,360*ratiow,465*ratioh,364*ratiow,485*ratioh,368*ratiow,505*ratioh,378*ratiow,533*ratioh,385*ratiow,548*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(658*ratiow,485*ratioh,651*ratiow,470*ratioh,645*ratiow,460*ratioh,641*ratiow,453*ratioh,636*ratiow,441*ratioh,634*ratiow,434*ratioh,639*ratiow,433*ratioh,648*ratiow,436*ratioh,656*ratiow,444*ratioh,660*ratiow,453*ratioh,662*ratiow,463*ratioh,662*ratiow,474*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(1*ratiow,305*ratioh,4*ratiow,314*ratioh,18*ratiow,331*ratioh,35*ratiow,354*ratioh,55*ratiow,367*ratioh,69*ratiow,370*ratioh,79*ratiow,370*ratioh,98*ratiow,363*ratioh,116*ratiow,348*ratioh,129*ratiow,329*ratioh,131*ratiow,336*ratioh,140*ratiow,340*ratioh,155*ratiow,339*ratioh,167*ratiow,335*ratioh,190*ratiow,325*ratioh,207*ratiow,320*ratioh,235*ratiow,313*ratioh,264*ratiow,311*ratioh,279*ratiow,309*ratioh,290*ratiow,306*ratioh,298*ratiow,308*ratioh,302*ratiow,307*ratioh,320*ratiow,317*ratioh,333*ratiow,326*ratioh,345*ratiow,337*ratioh,363*ratiow,353*ratioh,377*ratiow,365*ratioh,392*ratiow,373*ratioh,409*ratiow,377*ratioh,418*ratiow,375*ratioh,427*ratiow,370*ratioh,432*ratiow,361*ratioh,436*ratiow,348*ratioh,437*ratiow,336*ratioh,437*ratiow,311*ratioh,434*ratiow,297*ratioh,428*ratiow,284*ratioh,418*ratiow,267*ratioh,408*ratiow,253*ratioh,392*ratiow,234*ratioh,377*ratiow,217*ratioh,363*ratiow,204*ratioh,340*ratiow,188*ratioh,334*ratiow,185*ratioh,314*ratiow,175*ratioh,289*ratiow,167*ratioh,243*ratiow,155*ratioh,216*ratiow,148*ratioh,191*ratiow,148*ratioh,176*ratiow,151*ratioh,155*ratiow,156*ratioh,139*ratiow,164*ratioh,132*ratiow,171*ratioh,120*ratiow,188*ratioh,93*ratiow,229*ratioh,78*ratiow,251*ratioh,66*ratiow,267*ratioh,60*ratiow,272*ratioh,50*ratiow,276*ratioh,30*ratiow,279*ratioh,7*ratiow,279*ratioh,1*ratiow,279*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(517*ratiow,835*ratioh,520*ratiow,852*ratioh,534*ratiow,847*ratioh,553*ratiow,833*ratioh,576*ratiow,814*ratioh,594*ratiow,792*ratioh,609*ratiow,763*ratioh,620*ratiow,736*ratioh,630*ratiow,700*ratioh,636*ratiow,669*ratioh,638*ratiow,650*ratioh,622*ratiow,648*ratioh,626*ratiow,651*ratioh,626*ratiow,668*ratioh,618*ratiow,687*ratioh,609*ratiow,710*ratioh,601*ratiow,727*ratioh,598*ratiow,733*ratioh,597*ratiow,746*ratioh,592*ratiow,762*ratioh,584*ratiow,780*ratioh,576*ratiow,796*ratioh,560*ratiow,813*ratioh,546*ratiow,824*ratioh,535*ratiow,831*ratioh,527*ratiow,834*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(516*ratiow,822*ratioh,517*ratiow,836*ratioh,526*ratiow,835*ratioh,544*ratiow,825*ratioh,562*ratiow,811*ratioh,574*ratiow,798*ratioh,582*ratiow,784*ratioh,590*ratiow,767*ratioh,595*ratiow,753*ratioh,598*ratiow,734*ratioh,606*ratiow,716*ratioh,618*ratiow,690*ratioh,624*ratiow,672*ratioh,627*ratiow,663*ratioh,626*ratiow,649*ratioh,617*ratiow,648*ratioh,614*ratiow,661*ratioh,608*ratiow,679*ratioh,601*ratiow,699*ratioh,591*ratiow,726*ratioh,580*ratiow,753*ratioh,563*ratiow,785*ratioh,545*ratiow,808*ratioh,534*ratiow,818*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(516*ratiow,821*ratioh,527*ratiow,820*ratioh,539*ratiow,814*ratioh,555*ratiow,797*ratioh,572*ratiow,769*ratioh,584*ratiow,743*ratioh,594*ratiow,717*ratioh,606*ratiow,685*ratioh,613*ratiow,661*ratioh,616*ratiow,651*ratioh,621*ratiow,648*ratioh,582*ratiow,643*ratioh,553*ratiow,640*ratioh,522*ratiow,636*ratioh,522*ratiow,644*ratioh,526*ratiow,659*ratioh,529*ratiow,676*ratioh,529*ratiow,703*ratioh,524*ratiow,728*ratioh,519*ratiow,740*ratioh,513*ratiow,746*ratioh,508*ratiow,747*ratioh,502*ratiow,745*ratioh,498*ratiow,743*ratioh,498*ratiow,746*ratioh,503*ratiow,755*ratioh,505*ratiow,767*ratioh,503*ratiow,774*ratioh,510*ratiow,779*ratioh,513*ratiow,786*ratioh,515*ratiow,795*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(279*ratiow,548*ratioh,292*ratiow,544*ratioh,311*ratiow,526*ratioh,320*ratiow,507*ratioh,325*ratiow,487*ratioh,326*ratiow,472*ratioh,325*ratiow,456*ratioh,321*ratiow,443*ratioh,317*ratiow,434*ratioh,312*ratiow,443*ratioh,304*ratiow,465*ratioh,300*ratiow,485*ratioh,296*ratiow,505*ratioh,286*ratiow,533*ratioh,279*ratiow,548*ratioh);
data = analyze_pic(data);

//PVP
selectWindow(name);
makePolygon(6*ratiow,485*ratioh,13*ratiow,470*ratioh,19*ratiow,460*ratioh,23*ratiow,453*ratioh,28*ratiow,441*ratioh,30*ratiow,434*ratioh,25*ratiow,433*ratioh,16*ratiow,436*ratioh,8*ratiow,444*ratioh,4*ratiow,453*ratioh,2*ratiow,463*ratioh,2*ratiow,474*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile68(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 676;
var baseHeight = 876;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, Pir1, Pir2, Pir3, VPL";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(675*ratiow,296*ratioh,666*ratiow,313*ratioh,644*ratiow,342*ratioh,625*ratiow,360*ratioh,603*ratiow,371*ratioh,572*ratiow,369*ratioh,553*ratiow,359*ratioh,510*ratiow,334*ratioh,489*ratiow,329*ratioh,467*ratiow,324*ratioh,457*ratiow,320*ratioh,433*ratiow,318*ratioh,416*ratiow,320*ratioh,394*ratiow,320*ratioh,380*ratiow,319*ratioh,362*ratiow,325*ratioh,350*ratiow,334*ratioh,334*ratiow,346*ratioh,319*ratiow,363*ratioh,303*ratiow,386*ratioh,294*ratiow,400*ratioh,284*ratiow,409*ratioh,275*ratiow,414*ratioh,262*ratiow,413*ratioh,251*ratiow,405*ratioh,245*ratiow,391*ratioh,239*ratiow,371*ratioh,233*ratiow,343*ratioh,234*ratiow,316*ratioh,239*ratiow,297*ratioh,251*ratiow,275*ratioh,271*ratiow,246*ratioh,291*ratiow,225*ratioh,312*ratiow,208*ratioh,338*ratiow,193*ratioh,358*ratiow,184*ratioh,374*ratiow,178*ratioh,399*ratiow,170*ratioh,417*ratiow,164*ratioh,437*ratiow,159*ratioh,456*ratiow,155*ratioh,473*ratiow,153*ratioh,484*ratiow,153*ratioh,500*ratiow,157*ratioh,517*ratiow,165*ratioh,537*ratiow,184*ratioh,567*ratiow,229*ratioh,590*ratiow,255*ratioh,608*ratiow,273*ratioh,621*ratiow,279*ratioh,638*ratiow,280*ratioh,653*ratiow,277*ratioh,675*ratiow,278*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(163*ratiow,837*ratioh,152*ratiow,852*ratioh,137*ratiow,843*ratioh,113*ratiow,822*ratioh,94*ratiow,802*ratioh,78*ratiow,780*ratioh,67*ratiow,757*ratioh,58*ratiow,734*ratioh,51*ratiow,710*ratioh,46*ratiow,688*ratioh,62*ratiow,685*ratioh,69*ratiow,694*ratioh,74*ratiow,704*ratioh,79*ratiow,717*ratioh,82*ratiow,731*ratioh,85*ratiow,750*ratioh,93*ratiow,770*ratioh,102*ratiow,784*ratioh,117*ratiow,797*ratioh,130*ratiow,808*ratioh,139*ratiow,824*ratioh,152*ratiow,833*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(169*ratiow,826*ratioh,162*ratiow,837*ratioh,153*ratiow,834*ratioh,141*ratiow,826*ratioh,133*ratiow,814*ratioh,126*ratiow,805*ratioh,108*ratiow,790*ratioh,97*ratiow,777*ratioh,86*ratiow,755*ratioh,83*ratiow,735*ratioh,79*ratiow,715*ratioh,71*ratiow,699*ratioh,63*ratiow,687*ratioh,60*ratiow,684*ratioh,76*ratiow,680*ratioh,77*ratiow,683*ratioh,86*ratiow,692*ratioh,94*ratiow,708*ratioh,98*ratiow,727*ratioh,102*ratiow,749*ratioh,109*ratiow,768*ratioh,124*ratiow,788*ratioh,143*ratiow,809*ratioh,158*ratiow,821*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(169*ratiow,827*ratioh,162*ratiow,823*ratioh,143*ratiow,809*ratioh,124*ratiow,788*ratioh,110*ratiow,768*ratioh,105*ratiow,757*ratioh,102*ratiow,744*ratioh,99*ratiow,728*ratioh,95*ratiow,709*ratioh,88*ratiow,695*ratioh,79*ratiow,685*ratioh,73*ratiow,681*ratioh,122*ratiow,668*ratioh,155*ratiow,659*ratioh,164*ratiow,656*ratioh,165*ratiow,662*ratioh,166*ratiow,692*ratioh,168*ratiow,729*ratioh,171*ratiow,739*ratioh,181*ratiow,750*ratioh,186*ratiow,754*ratioh,192*ratiow,755*ratioh,199*ratiow,752*ratioh,205*ratiow,745*ratioh,206*ratiow,735*ratioh,211*ratiow,738*ratioh,221*ratiow,740*ratioh,215*ratiow,744*ratioh,211*ratiow,750*ratioh,212*ratiow,760*ratioh,208*ratiow,761*ratioh,200*ratiow,766*ratioh,191*ratiow,778*ratioh,183*ratiow,794*ratioh,176*ratiow,812*ratioh,174*ratiow,820*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(420*ratiow,555*ratioh,394*ratiow,532*ratioh,375*ratiow,506*ratioh,367*ratiow,479*ratioh,369*ratiow,458*ratioh,378*ratiow,437*ratioh,380*ratiow,434*ratioh,385*ratiow,444*ratioh,392*ratiow,461*ratioh,399*ratiow,498*ratioh,408*ratiow,522*ratioh,420*ratiow,545*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(1*ratiow,296*ratioh,10*ratiow,313*ratioh,32*ratiow,342*ratioh,51*ratiow,360*ratioh,73*ratiow,371*ratioh,104*ratiow,369*ratioh,123*ratiow,359*ratioh,166*ratiow,334*ratioh,187*ratiow,329*ratioh,209*ratiow,324*ratioh,219*ratiow,320*ratioh,243*ratiow,318*ratioh,260*ratiow,320*ratioh,282*ratiow,320*ratioh,296*ratiow,319*ratioh,314*ratiow,325*ratioh,326*ratiow,334*ratioh,342*ratiow,346*ratioh,357*ratiow,363*ratioh,373*ratiow,386*ratioh,382*ratiow,400*ratioh,392*ratiow,409*ratioh,401*ratiow,414*ratioh,414*ratiow,413*ratioh,425*ratiow,405*ratioh,431*ratiow,391*ratioh,437*ratiow,371*ratioh,443*ratiow,343*ratioh,442*ratiow,316*ratioh,437*ratiow,297*ratioh,425*ratiow,275*ratioh,405*ratiow,246*ratioh,385*ratiow,225*ratioh,364*ratiow,208*ratioh,338*ratiow,193*ratioh,318*ratiow,184*ratioh,302*ratiow,178*ratioh,277*ratiow,170*ratioh,259*ratiow,164*ratioh,239*ratiow,159*ratioh,220*ratiow,155*ratioh,203*ratiow,153*ratioh,192*ratiow,153*ratioh,176*ratiow,157*ratioh,159*ratiow,165*ratioh,139*ratiow,184*ratioh,109*ratiow,229*ratioh,86*ratiow,255*ratioh,68*ratiow,273*ratioh,55*ratiow,279*ratioh,38*ratiow,280*ratioh,23*ratiow,277*ratioh,1*ratiow,278*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(513*ratiow,837*ratioh,524*ratiow,852*ratioh,539*ratiow,843*ratioh,563*ratiow,822*ratioh,582*ratiow,802*ratioh,598*ratiow,780*ratioh,609*ratiow,757*ratioh,618*ratiow,734*ratioh,625*ratiow,710*ratioh,630*ratiow,688*ratioh,614*ratiow,685*ratioh,607*ratiow,694*ratioh,602*ratiow,704*ratioh,597*ratiow,717*ratioh,594*ratiow,731*ratioh,591*ratiow,750*ratioh,583*ratiow,770*ratioh,574*ratiow,784*ratioh,559*ratiow,797*ratioh,546*ratiow,808*ratioh,537*ratiow,824*ratioh,524*ratiow,833*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(507*ratiow,826*ratioh,514*ratiow,837*ratioh,523*ratiow,834*ratioh,535*ratiow,826*ratioh,543*ratiow,814*ratioh,550*ratiow,805*ratioh,568*ratiow,790*ratioh,579*ratiow,777*ratioh,590*ratiow,755*ratioh,593*ratiow,735*ratioh,597*ratiow,715*ratioh,605*ratiow,699*ratioh,613*ratiow,687*ratioh,616*ratiow,684*ratioh,600*ratiow,680*ratioh,599*ratiow,683*ratioh,590*ratiow,692*ratioh,582*ratiow,708*ratioh,578*ratiow,727*ratioh,574*ratiow,749*ratioh,567*ratiow,768*ratioh,552*ratiow,788*ratioh,533*ratiow,809*ratioh,518*ratiow,821*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(507*ratiow,827*ratioh,514*ratiow,823*ratioh,533*ratiow,809*ratioh,552*ratiow,788*ratioh,566*ratiow,768*ratioh,571*ratiow,757*ratioh,574*ratiow,744*ratioh,577*ratiow,728*ratioh,581*ratiow,709*ratioh,588*ratiow,695*ratioh,597*ratiow,685*ratioh,603*ratiow,681*ratioh,554*ratiow,668*ratioh,521*ratiow,659*ratioh,512*ratiow,656*ratioh,511*ratiow,662*ratioh,510*ratiow,692*ratioh,508*ratiow,729*ratioh,505*ratiow,739*ratioh,495*ratiow,750*ratioh,490*ratiow,754*ratioh,484*ratiow,755*ratioh,477*ratiow,752*ratioh,471*ratiow,745*ratioh,470*ratiow,735*ratioh,465*ratiow,738*ratioh,455*ratiow,740*ratioh,461*ratiow,744*ratioh,465*ratiow,750*ratioh,464*ratiow,760*ratioh,468*ratiow,761*ratioh,476*ratiow,766*ratioh,485*ratiow,778*ratioh,493*ratiow,794*ratioh,500*ratiow,812*ratioh,502*ratiow,820*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(256*ratiow,555*ratioh,282*ratiow,532*ratioh,301*ratiow,506*ratioh,309*ratiow,479*ratioh,307*ratiow,458*ratioh,298*ratiow,437*ratioh,296*ratiow,434*ratioh,291*ratiow,444*ratioh,284*ratiow,461*ratioh,277*ratiow,498*ratioh,268*ratiow,522*ratioh,256*ratiow,545*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile69(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 651;
var baseHeight = 856;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, Pir1, Pir2, Pir3, VPL";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(650*ratiow,305*ratioh,638*ratiow,319*ratioh,619*ratiow,343*ratioh,611*ratiow,354*ratioh,599*ratiow,364*ratioh,588*ratiow,368*ratioh,574*ratiow,368*ratioh,547*ratiow,362*ratioh,533*ratiow,354*ratioh,518*ratiow,343*ratioh,500*ratiow,339*ratioh,477*ratiow,332*ratioh,448*ratiow,318*ratioh,432*ratiow,312*ratioh,414*ratiow,311*ratioh,378*ratiow,313*ratioh,362*ratiow,314*ratioh,338*ratiow,324*ratioh,316*ratiow,344*ratioh,298*ratiow,367*ratioh,283*ratiow,392*ratioh,264*ratiow,402*ratioh,253*ratiow,413*ratioh,244*ratiow,417*ratioh,237*ratiow,419*ratioh,231*ratiow,419*ratioh,220*ratiow,409*ratioh,212*ratiow,382*ratioh,207*ratiow,341*ratioh,213*ratiow,300*ratioh,220*ratiow,279*ratioh,245*ratiow,247*ratioh,278*ratiow,217*ratioh,298*ratiow,203*ratioh,313*ratiow,192*ratioh,338*ratiow,180*ratioh,369*ratiow,168*ratioh,401*ratiow,159*ratioh,423*ratiow,153*ratioh,449*ratiow,151*ratioh,472*ratiow,154*ratioh,494*ratiow,162*ratioh,503*ratiow,170*ratioh,515*ratiow,184*ratioh,533*ratiow,213*ratioh,545*ratiow,233*ratioh,563*ratiow,250*ratioh,581*ratiow,261*ratioh,606*ratiow,273*ratioh,634*ratiow,281*ratioh,650*ratiow,283*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(452*ratiow,690*ratioh,452*ratiow,695*ratioh,447*ratiow,701*ratioh,438*ratiow,701*ratioh,430*ratiow,698*ratioh,423*ratiow,688*ratioh,417*ratiow,672*ratioh,411*ratiow,650*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(88*ratiow,770*ratioh,73*ratiow,784*ratioh,64*ratiow,773*ratioh,47*ratiow,749*ratioh,34*ratiow,721*ratioh,24*ratiow,692*ratioh,14*ratiow,653*ratioh,12*ratiow,641*ratioh,37*ratiow,638*ratioh,32*ratiow,642*ratioh,36*ratiow,654*ratioh,43*ratiow,673*ratioh,48*ratiow,694*ratioh,57*ratiow,731*ratioh,69*ratiow,753*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(88*ratiow,770*ratioh,78*ratiow,763*ratioh,65*ratiow,746*ratioh,57*ratiow,729*ratioh,50*ratiow,704*ratioh,44*ratiow,679*ratioh,35*ratiow,652*ratioh,33*ratiow,645*ratioh,32*ratiow,640*ratioh,37*ratiow,638*ratioh,41*ratiow,639*ratioh,45*ratiow,647*ratioh,52*ratiow,668*ratioh,58*ratiow,695*ratioh,64*ratiow,718*ratioh,72*ratiow,735*ratioh,86*ratiow,754*ratioh,94*ratiow,759*ratioh,109*ratiow,760*ratioh,109*ratiow,762*ratioh,100*ratiow,764*ratioh,93*ratiow,766*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(111*ratiow,760*ratioh,97*ratiow,759*ratioh,85*ratiow,754*ratioh,74*ratiow,737*ratioh,64*ratiow,719*ratioh,60*ratiow,704*ratioh,53*ratiow,672*ratioh,48*ratiow,652*ratioh,42*ratiow,640*ratioh,39*ratiow,638*ratioh,57*ratiow,636*ratioh,96*ratiow,633*ratioh,128*ratiow,629*ratioh,126*ratiow,634*ratioh,122*ratiow,646*ratioh,120*ratiow,661*ratioh,120*ratiow,679*ratioh,123*ratiow,697*ratioh,128*ratiow,707*ratioh,136*ratiow,712*ratioh,145*ratiow,713*ratioh,151*ratiow,711*ratioh,156*ratiow,705*ratioh,157*ratiow,697*ratioh,151*ratiow,678*ratioh,146*ratiow,661*ratioh,161*ratiow,682*ratioh,171*ratiow,692*ratioh,189*ratiow,705*ratioh,201*ratiow,712*ratioh,188*ratiow,710*ratioh,179*ratiow,710*ratioh,170*ratiow,718*ratioh,146*ratiow,742*ratioh,131*ratiow,756*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(394*ratiow,551*ratioh,373*ratiow,534*ratioh,356*ratiow,516*ratioh,347*ratiow,496*ratioh,346*ratiow,476*ratioh,350*ratiow,458*ratioh,358*ratiow,441*ratioh,364*ratiow,433*ratioh,365*ratiow,447*ratioh,368*ratiow,472*ratioh,373*ratiow,491*ratioh,389*ratiow,524*ratioh,395*ratiow,539*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(1*ratiow,305*ratioh,13*ratiow,319*ratioh,32*ratiow,343*ratioh,40*ratiow,354*ratioh,52*ratiow,364*ratioh,63*ratiow,368*ratioh,77*ratiow,368*ratioh,104*ratiow,362*ratioh,118*ratiow,354*ratioh,133*ratiow,343*ratioh,151*ratiow,339*ratioh,174*ratiow,332*ratioh,203*ratiow,318*ratioh,219*ratiow,312*ratioh,237*ratiow,311*ratioh,273*ratiow,313*ratioh,289*ratiow,314*ratioh,313*ratiow,324*ratioh,335*ratiow,344*ratioh,353*ratiow,367*ratioh,368*ratiow,392*ratioh,387*ratiow,402*ratioh,398*ratiow,413*ratioh,407*ratiow,417*ratioh,414*ratiow,419*ratioh,420*ratiow,419*ratioh,431*ratiow,409*ratioh,439*ratiow,382*ratioh,444*ratiow,341*ratioh,438*ratiow,300*ratioh,431*ratiow,279*ratioh,406*ratiow,247*ratioh,373*ratiow,217*ratioh,353*ratiow,203*ratioh,338*ratiow,192*ratioh,313*ratiow,180*ratioh,282*ratiow,168*ratioh,250*ratiow,159*ratioh,228*ratiow,153*ratioh,202*ratiow,151*ratioh,179*ratiow,154*ratioh,157*ratiow,162*ratioh,148*ratiow,170*ratioh,136*ratiow,184*ratioh,118*ratiow,213*ratioh,106*ratiow,233*ratioh,88*ratiow,250*ratioh,70*ratiow,261*ratioh,45*ratiow,273*ratioh,17*ratiow,281*ratioh,1*ratiow,283*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(199*ratiow,690*ratioh,199*ratiow,695*ratioh,204*ratiow,701*ratioh,213*ratiow,701*ratioh,221*ratiow,698*ratioh,228*ratiow,688*ratioh,234*ratiow,672*ratioh,240*ratiow,650*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(563*ratiow,770*ratioh,578*ratiow,784*ratioh,587*ratiow,773*ratioh,604*ratiow,749*ratioh,617*ratiow,721*ratioh,627*ratiow,692*ratioh,637*ratiow,653*ratioh,639*ratiow,641*ratioh,614*ratiow,638*ratioh,619*ratiow,642*ratioh,615*ratiow,654*ratioh,608*ratiow,673*ratioh,603*ratiow,694*ratioh,594*ratiow,731*ratioh,582*ratiow,753*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(563*ratiow,770*ratioh,573*ratiow,763*ratioh,586*ratiow,746*ratioh,594*ratiow,729*ratioh,601*ratiow,704*ratioh,607*ratiow,679*ratioh,616*ratiow,652*ratioh,618*ratiow,645*ratioh,619*ratiow,640*ratioh,614*ratiow,638*ratioh,610*ratiow,639*ratioh,606*ratiow,647*ratioh,599*ratiow,668*ratioh,593*ratiow,695*ratioh,587*ratiow,718*ratioh,579*ratiow,735*ratioh,565*ratiow,754*ratioh,557*ratiow,759*ratioh,542*ratiow,760*ratioh,542*ratiow,762*ratioh,551*ratiow,764*ratioh,558*ratiow,766*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(540*ratiow,760*ratioh,554*ratiow,759*ratioh,566*ratiow,754*ratioh,577*ratiow,737*ratioh,587*ratiow,719*ratioh,591*ratiow,704*ratioh,598*ratiow,672*ratioh,603*ratiow,652*ratioh,609*ratiow,640*ratioh,612*ratiow,638*ratioh,594*ratiow,636*ratioh,555*ratiow,633*ratioh,523*ratiow,629*ratioh,525*ratiow,634*ratioh,529*ratiow,646*ratioh,531*ratiow,661*ratioh,531*ratiow,679*ratioh,528*ratiow,697*ratioh,523*ratiow,707*ratioh,515*ratiow,712*ratioh,506*ratiow,713*ratioh,500*ratiow,711*ratioh,495*ratiow,705*ratioh,494*ratiow,697*ratioh,500*ratiow,678*ratioh,505*ratiow,661*ratioh,490*ratiow,682*ratioh,480*ratiow,692*ratioh,462*ratiow,705*ratioh,450*ratiow,712*ratioh,463*ratiow,710*ratioh,472*ratiow,710*ratioh,481*ratiow,718*ratioh,505*ratiow,742*ratioh,520*ratiow,756*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(257*ratiow,551*ratioh,278*ratiow,534*ratioh,295*ratiow,516*ratioh,304*ratiow,496*ratioh,305*ratiow,476*ratioh,301*ratiow,458*ratioh,293*ratiow,441*ratioh,287*ratiow,433*ratioh,286*ratiow,447*ratioh,283*ratiow,472*ratioh,278*ratiow,491*ratioh,262*ratiow,524*ratioh,256*ratiow,539*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile70(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 665;
var baseHeight = 863;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, Pir1, Pir2, Pir3, VPL";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(664*ratiow,300*ratioh,662*ratiow,306*ratioh,652*ratiow,318*ratioh,639*ratiow,332*ratioh,631*ratiow,342*ratioh,627*ratiow,349*ratioh,621*ratiow,356*ratioh,611*ratiow,362*ratioh,604*ratiow,365*ratioh,593*ratiow,366*ratioh,578*ratiow,365*ratioh,552*ratiow,353*ratioh,521*ratiow,333*ratioh,500*ratiow,316*ratioh,492*ratiow,305*ratioh,492*ratiow,315*ratioh,491*ratiow,322*ratioh,487*ratiow,326*ratioh,483*ratiow,327*ratioh,474*ratiow,328*ratioh,453*ratiow,323*ratioh,437*ratiow,320*ratioh,406*ratiow,318*ratioh,370*ratiow,322*ratioh,350*ratiow,329*ratioh,333*ratiow,341*ratioh,320*ratiow,355*ratioh,308*ratiow,371*ratioh,294*ratiow,393*ratioh,281*ratiow,425*ratioh,273*ratiow,457*ratioh,269*ratiow,484*ratioh,276*ratiow,516*ratioh,286*ratiow,541*ratioh,305*ratiow,574*ratioh,317*ratiow,600*ratioh,322*ratiow,609*ratioh,337*ratiow,631*ratioh,367*ratiow,660*ratioh,392*ratiow,685*ratioh,413*ratiow,707*ratioh,431*ratiow,731*ratioh,440*ratiow,740*ratioh,446*ratiow,743*ratioh,450*ratiow,749*ratioh,453*ratiow,761*ratioh,452*ratiow,774*ratioh,446*ratiow,784*ratioh,438*ratiow,792*ratioh,428*ratiow,797*ratioh,419*ratiow,800*ratioh,410*ratiow,798*ratioh,410*ratiow,790*ratioh,406*ratiow,782*ratioh,394*ratiow,776*ratioh,378*ratiow,769*ratioh,370*ratiow,767*ratioh,366*ratiow,763*ratioh,356*ratiow,757*ratioh,337*ratiow,754*ratioh,314*ratiow,749*ratioh,239*ratiow,713*ratioh,218*ratiow,701*ratioh,204*ratiow,691*ratioh,193*ratiow,677*ratioh,185*ratiow,662*ratioh,181*ratiow,642*ratioh,180*ratiow,602*ratioh,181*ratiow,581*ratioh,185*ratiow,554*ratioh,190*ratiow,530*ratioh,198*ratiow,504*ratioh,204*ratiow,482*ratioh,205*ratiow,465*ratioh,205*ratiow,450*ratioh,201*ratiow,428*ratioh,197*ratiow,400*ratioh,197*ratiow,374*ratioh,199*ratiow,354*ratioh,203*ratiow,329*ratioh,210*ratiow,306*ratioh,221*ratiow,284*ratioh,238*ratiow,262*ratioh,260*ratiow,238*ratioh,278*ratiow,223*ratioh,303*ratiow,206*ratioh,331*ratiow,193*ratioh,367*ratiow,178*ratioh,401*ratiow,168*ratioh,434*ratiow,160*ratioh,457*ratiow,158*ratioh,487*ratiow,160*ratioh,504*ratiow,167*ratioh,518*ratiow,180*ratioh,533*ratiow,201*ratioh,547*ratiow,223*ratioh,557*ratiow,249*ratioh,567*ratiow,269*ratioh,574*ratiow,276*ratioh,581*ratiow,279*ratioh,598*ratiow,279*ratioh,621*ratiow,275*ratioh,639*ratiow,278*ratioh,659*ratiow,282*ratioh,664*ratiow,283*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(471*ratiow,684*ratioh,475*ratiow,694*ratioh,476*ratiow,709*ratioh,474*ratiow,718*ratioh,467*ratiow,720*ratioh,457*ratiow,717*ratioh,442*ratiow,704*ratioh,426*ratiow,681*ratioh,400*ratiow,645*ratioh,388*ratiow,630*ratioh,384*ratiow,625*ratioh,384*ratiow,619*ratioh,389*ratiow,615*ratioh,395*ratiow,616*ratioh,409*ratiow,627*ratioh,426*ratiow,642*ratioh,444*ratiow,658*ratioh,464*ratiow,677*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(129*ratiow,807*ratioh,116*ratiow,822*ratioh,103*ratiow,812*ratioh,79*ratiow,792*ratioh,57*ratiow,767*ratioh,40*ratiow,742*ratioh,25*ratiow,700*ratioh,20*ratiow,675*ratioh,19*ratiow,662*ratioh,39*ratiow,660*ratioh,36*ratiow,664*ratioh,39*ratiow,680*ratioh,49*ratiow,706*ratioh,62*ratiow,734*ratioh,77*ratiow,763*ratioh,93*ratiow,785*ratioh,108*ratiow,799*ratioh,119*ratiow,806*ratioh,127*ratiow,808*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(128*ratiow,793*ratioh,127*ratiow,798*ratioh,129*ratiow,804*ratioh,130*ratiow,808*ratioh,124*ratiow,807*ratioh,116*ratiow,805*ratioh,103*ratiow,795*ratioh,84*ratiow,773*ratioh,68*ratiow,746*ratioh,53*ratiow,715*ratioh,41*ratiow,685*ratioh,36*ratiow,668*ratioh,36*ratiow,661*ratioh,38*ratiow,660*ratioh,42*ratiow,660*ratioh,46*ratiow,665*ratioh,53*ratiow,685*ratioh,64*ratiow,708*ratioh,76*ratiow,732*ratioh,91*ratiow,757*ratioh,105*ratiow,775*ratioh,116*ratiow,785*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(128*ratiow,793*ratioh,113*ratiow,782*ratioh,97*ratiow,766*ratioh,81*ratiow,740*ratioh,64*ratiow,709*ratioh,52*ratiow,682*ratioh,44*ratiow,663*ratioh,41*ratiow,660*ratioh,73*ratiow,656*ratioh,102*ratiow,653*ratioh,125*ratiow,650*ratioh,146*ratiow,648*ratioh,148*ratiow,654*ratioh,145*ratiow,658*ratioh,142*ratiow,666*ratioh,139*ratiow,680*ratioh,139*ratiow,700*ratioh,141*ratiow,711*ratioh,146*ratiow,720*ratioh,156*ratiow,727*ratioh,172*ratiow,738*ratioh,178*ratiow,739*ratioh,182*ratiow,738*ratioh,184*ratiow,734*ratioh,185*ratiow,727*ratioh,181*ratiow,715*ratioh,180*ratiow,705*ratioh,186*ratiow,711*ratioh,196*ratiow,717*ratioh,212*ratiow,725*ratioh,223*ratiow,729*ratioh,232*ratiow,732*ratioh,224*ratiow,732*ratioh,216*ratiow,734*ratioh,211*ratiow,738*ratioh,206*ratiow,737*ratioh,198*ratiow,738*ratioh,190*ratiow,742*ratioh,177*ratiow,752*ratioh,163*ratiow,764*ratioh,153*ratiow,773*ratioh,145*ratiow,778*ratioh,135*ratiow,785*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(380*ratiow,532*ratioh,373*ratiow,525*ratioh,363*ratiow,506*ratioh,355*ratiow,487*ratioh,355*ratiow,470*ratioh,361*ratiow,453*ratioh,370*ratiow,443*ratioh,372*ratiow,450*ratioh,373*ratiow,460*ratioh,374*ratiow,470*ratioh,375*ratiow,496*ratioh,376*ratiow,506*ratioh,382*ratiow,521*ratioh,383*ratiow,529*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(1*ratiow,300*ratioh,3*ratiow,306*ratioh,13*ratiow,318*ratioh,26*ratiow,332*ratioh,34*ratiow,342*ratioh,38*ratiow,349*ratioh,44*ratiow,356*ratioh,54*ratiow,362*ratioh,61*ratiow,365*ratioh,72*ratiow,366*ratioh,87*ratiow,365*ratioh,113*ratiow,353*ratioh,144*ratiow,333*ratioh,165*ratiow,316*ratioh,173*ratiow,305*ratioh,173*ratiow,315*ratioh,174*ratiow,322*ratioh,178*ratiow,326*ratioh,182*ratiow,327*ratioh,191*ratiow,328*ratioh,212*ratiow,323*ratioh,228*ratiow,320*ratioh,259*ratiow,318*ratioh,295*ratiow,322*ratioh,315*ratiow,329*ratioh,332*ratiow,341*ratioh,345*ratiow,355*ratioh,357*ratiow,371*ratioh,371*ratiow,393*ratioh,384*ratiow,425*ratioh,392*ratiow,457*ratioh,396*ratiow,484*ratioh,389*ratiow,516*ratioh,379*ratiow,541*ratioh,360*ratiow,574*ratioh,348*ratiow,600*ratioh,343*ratiow,609*ratioh,328*ratiow,631*ratioh,298*ratiow,660*ratioh,273*ratiow,685*ratioh,252*ratiow,707*ratioh,234*ratiow,731*ratioh,225*ratiow,740*ratioh,219*ratiow,743*ratioh,215*ratiow,749*ratioh,212*ratiow,761*ratioh,213*ratiow,774*ratioh,219*ratiow,784*ratioh,227*ratiow,792*ratioh,237*ratiow,797*ratioh,246*ratiow,800*ratioh,255*ratiow,798*ratioh,255*ratiow,790*ratioh,259*ratiow,782*ratioh,271*ratiow,776*ratioh,287*ratiow,769*ratioh,295*ratiow,767*ratioh,299*ratiow,763*ratioh,309*ratiow,757*ratioh,328*ratiow,754*ratioh,351*ratiow,749*ratioh,426*ratiow,713*ratioh,447*ratiow,701*ratioh,461*ratiow,691*ratioh,472*ratiow,677*ratioh,480*ratiow,662*ratioh,484*ratiow,642*ratioh,485*ratiow,602*ratioh,484*ratiow,581*ratioh,480*ratiow,554*ratioh,475*ratiow,530*ratioh,467*ratiow,504*ratioh,461*ratiow,482*ratioh,460*ratiow,465*ratioh,460*ratiow,450*ratioh,464*ratiow,428*ratioh,468*ratiow,400*ratioh,468*ratiow,374*ratioh,466*ratiow,354*ratioh,462*ratiow,329*ratioh,455*ratiow,306*ratioh,444*ratiow,284*ratioh,427*ratiow,262*ratioh,405*ratiow,238*ratioh,387*ratiow,223*ratioh,362*ratiow,206*ratioh,334*ratiow,193*ratioh,298*ratiow,178*ratioh,264*ratiow,168*ratioh,231*ratiow,160*ratioh,208*ratiow,158*ratioh,178*ratiow,160*ratioh,161*ratiow,167*ratioh,147*ratiow,180*ratioh,132*ratiow,201*ratioh,118*ratiow,223*ratioh,108*ratiow,249*ratioh,98*ratiow,269*ratioh,91*ratiow,276*ratioh,84*ratiow,279*ratioh,67*ratiow,279*ratioh,44*ratiow,275*ratioh,26*ratiow,278*ratioh,6*ratiow,282*ratioh,1*ratiow,283*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(194*ratiow,684*ratioh,190*ratiow,694*ratioh,189*ratiow,709*ratioh,191*ratiow,718*ratioh,198*ratiow,720*ratioh,208*ratiow,717*ratioh,223*ratiow,704*ratioh,239*ratiow,681*ratioh,265*ratiow,645*ratioh,277*ratiow,630*ratioh,281*ratiow,625*ratioh,281*ratiow,619*ratioh,276*ratiow,615*ratioh,270*ratiow,616*ratioh,256*ratiow,627*ratioh,239*ratiow,642*ratioh,221*ratiow,658*ratioh,201*ratiow,677*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(536*ratiow,807*ratioh,549*ratiow,822*ratioh,562*ratiow,812*ratioh,586*ratiow,792*ratioh,608*ratiow,767*ratioh,625*ratiow,742*ratioh,640*ratiow,700*ratioh,645*ratiow,675*ratioh,646*ratiow,662*ratioh,626*ratiow,660*ratioh,629*ratiow,664*ratioh,626*ratiow,680*ratioh,616*ratiow,706*ratioh,603*ratiow,734*ratioh,588*ratiow,763*ratioh,572*ratiow,785*ratioh,557*ratiow,799*ratioh,546*ratiow,806*ratioh,538*ratiow,808*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(537*ratiow,793*ratioh,538*ratiow,798*ratioh,536*ratiow,804*ratioh,535*ratiow,808*ratioh,541*ratiow,807*ratioh,549*ratiow,805*ratioh,562*ratiow,795*ratioh,581*ratiow,773*ratioh,597*ratiow,746*ratioh,612*ratiow,715*ratioh,624*ratiow,685*ratioh,629*ratiow,668*ratioh,629*ratiow,661*ratioh,627*ratiow,660*ratioh,623*ratiow,660*ratioh,619*ratiow,665*ratioh,612*ratiow,685*ratioh,601*ratiow,708*ratioh,589*ratiow,732*ratioh,574*ratiow,757*ratioh,560*ratiow,775*ratioh,549*ratiow,785*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(537*ratiow,793*ratioh,552*ratiow,782*ratioh,568*ratiow,766*ratioh,584*ratiow,740*ratioh,601*ratiow,709*ratioh,613*ratiow,682*ratioh,621*ratiow,663*ratioh,624*ratiow,660*ratioh,592*ratiow,656*ratioh,563*ratiow,653*ratioh,540*ratiow,650*ratioh,519*ratiow,648*ratioh,517*ratiow,654*ratioh,520*ratiow,658*ratioh,523*ratiow,666*ratioh,526*ratiow,680*ratioh,526*ratiow,700*ratioh,524*ratiow,711*ratioh,519*ratiow,720*ratioh,509*ratiow,727*ratioh,493*ratiow,738*ratioh,487*ratiow,739*ratioh,483*ratiow,738*ratioh,481*ratiow,734*ratioh,480*ratiow,727*ratioh,484*ratiow,715*ratioh,485*ratiow,705*ratioh,479*ratiow,711*ratioh,469*ratiow,717*ratioh,453*ratiow,725*ratioh,442*ratiow,729*ratioh,433*ratiow,732*ratioh,441*ratiow,732*ratioh,449*ratiow,734*ratioh,454*ratiow,738*ratioh,459*ratiow,737*ratioh,467*ratiow,738*ratioh,475*ratiow,742*ratioh,488*ratiow,752*ratioh,502*ratiow,764*ratioh,512*ratiow,773*ratioh,520*ratiow,778*ratioh,530*ratiow,785*ratioh);
data = analyze_pic(data);

//VPL
selectWindow(name);
makePolygon(285*ratiow,532*ratioh,292*ratiow,525*ratioh,302*ratiow,506*ratioh,310*ratiow,487*ratioh,310*ratiow,470*ratioh,304*ratiow,453*ratioh,295*ratiow,443*ratioh,293*ratiow,450*ratioh,292*ratiow,460*ratioh,291*ratiow,470*ratioh,290*ratiow,496*ratioh,289*ratiow,506*ratioh,283*ratiow,521*ratioh,282*ratiow,529*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile71(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 680;
var baseHeight = 868;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(671*ratiow,304*ratioh,666*ratiow,314*ratioh,655*ratiow,331*ratioh,635*ratiow,351*ratioh,619*ratiow,361*ratioh,599*ratiow,365*ratioh,575*ratiow,358*ratioh,548*ratiow,346*ratioh,519*ratiow,334*ratioh,503*ratiow,330*ratioh,479*ratiow,326*ratioh,455*ratiow,323*ratioh,439*ratiow,323*ratioh,403*ratiow,328*ratioh,378*ratiow,331*ratioh,362*ratiow,337*ratioh,341*ratiow,349*ratioh,325*ratiow,363*ratioh,309*ratiow,392*ratioh,294*ratiow,425*ratioh,285*ratiow,459*ratioh,281*ratiow,484*ratioh,284*ratiow,509*ratioh,296*ratiow,543*ratioh,318*ratiow,585*ratioh,334*ratiow,612*ratioh,343*ratiow,622*ratioh,357*ratiow,635*ratioh,363*ratiow,643*ratioh,373*ratiow,659*ratioh,379*ratiow,665*ratioh,388*ratiow,673*ratioh,401*ratiow,694*ratioh,419*ratiow,720*ratioh,432*ratiow,740*ratioh,444*ratiow,754*ratioh,447*ratiow,756*ratioh,445*ratiow,774*ratioh,442*ratiow,781*ratioh,431*ratiow,795*ratioh,419*ratiow,810*ratioh,411*ratiow,816*ratioh,393*ratiow,825*ratioh,371*ratiow,808*ratioh,378*ratiow,807*ratioh,401*ratiow,807*ratioh,416*ratiow,803*ratioh,422*ratiow,795*ratioh,421*ratiow,785*ratioh,419*ratiow,779*ratioh,408*ratiow,777*ratioh,400*ratiow,775*ratioh,384*ratiow,778*ratioh,378*ratiow,770*ratioh,361*ratiow,764*ratioh,332*ratiow,756*ratioh,284*ratiow,742*ratioh,242*ratiow,724*ratioh,210*ratiow,710*ratioh,194*ratiow,696*ratioh,181*ratiow,677*ratioh,172*ratiow,659*ratioh,168*ratiow,615*ratioh,168*ratiow,572*ratioh,173*ratiow,550*ratioh,187*ratiow,517*ratioh,197*ratiow,494*ratioh,202*ratiow,467*ratioh,204*ratiow,431*ratioh,204*ratiow,399*ratioh,205*ratiow,375*ratioh,209*ratiow,355*ratioh,219*ratiow,328*ratioh,233*ratiow,298*ratioh,248*ratiow,276*ratioh,272*ratiow,249*ratioh,292*ratiow,230*ratioh,312*ratiow,215*ratioh,329*ratiow,207*ratioh,347*ratiow,199*ratioh,367*ratiow,192*ratioh,383*ratiow,187*ratioh,418*ratiow,176*ratioh,446*ratiow,167*ratioh,462*ratiow,163*ratioh,471*ratiow,162*ratioh,495*ratiow,163*ratioh,515*ratiow,169*ratioh,523*ratiow,174*ratioh,530*ratiow,183*ratioh,542*ratiow,205*ratioh,550*ratiow,223*ratioh,566*ratiow,262*ratioh,571*ratiow,276*ratioh,576*ratiow,283*ratioh,581*ratiow,288*ratioh,588*ratiow,290*ratioh,604*ratiow,288*ratioh,623*ratiow,282*ratioh,628*ratiow,280*ratioh,650*ratiow,282*ratioh,666*ratiow,284*ratioh,679*ratiow,284*ratioh,679*ratiow,296*ratioh,675*ratiow,301*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(503*ratiow,756*ratioh,492*ratiow,753*ratioh,465*ratiow,736*ratioh,429*ratiow,703*ratioh,413*ratiow,683*ratioh,408*ratiow,674*ratioh,410*ratiow,652*ratioh,417*ratiow,645*ratioh,425*ratiow,643*ratioh,431*ratiow,645*ratioh,436*ratiow,649*ratioh,454*ratiow,670*ratioh,464*ratiow,684*ratioh,478*ratiow,697*ratioh,500*ratiow,711*ratioh,513*ratiow,719*ratioh,520*ratiow,722*ratioh,520*ratiow,736*ratioh,517*ratiow,746*ratioh,514*ratiow,753*ratioh,507*ratiow,757*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(95*ratiow,784*ratioh,78*ratiow,798*ratioh,60*ratiow,774*ratioh,38*ratiow,736*ratioh,25*ratiow,702*ratioh,16*ratiow,670*ratioh,15*ratiow,646*ratioh,43*ratiow,642*ratioh,37*ratiow,645*ratioh,36*ratiow,657*ratioh,41*ratiow,685*ratioh,50*ratiow,717*ratioh,66*ratiow,750*ratioh,84*ratiow,775*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(102*ratiow,776*ratioh,94*ratiow,784*ratioh,84*ratiow,774*ratioh,71*ratiow,758*ratioh,57*ratiow,734*ratioh,46*ratiow,707*ratioh,37*ratiow,666*ratioh,36*ratiow,647*ratioh,40*ratiow,642*ratioh,47*ratiow,642*ratioh,49*ratiow,648*ratioh,53*ratiow,667*ratioh,58*ratiow,695*ratioh,67*ratiow,723*ratioh,77*ratiow,744*ratioh,95*ratiow,768*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(102*ratiow,776*ratioh,91*ratiow,763*ratioh,78*ratiow,746*ratioh,68*ratiow,724*ratioh,59*ratiow,697*ratioh,52*ratiow,663*ratioh,49*ratiow,646*ratioh,45*ratiow,642*ratioh,75*ratiow,638*ratioh,114*ratiow,633*ratioh,147*ratiow,629*ratioh,149*ratiow,643*ratioh,153*ratiow,659*ratioh,166*ratiow,685*ratioh,178*ratiow,707*ratioh,185*ratiow,719*ratioh,182*ratiow,725*ratioh,177*ratiow,731*ratioh,167*ratiow,740*ratioh,152*ratiow,748*ratioh,133*ratiow,755*ratioh,109*ratiow,771*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(9*ratiow,304*ratioh,14*ratiow,314*ratioh,25*ratiow,331*ratioh,45*ratiow,351*ratioh,61*ratiow,361*ratioh,81*ratiow,365*ratioh,105*ratiow,358*ratioh,132*ratiow,346*ratioh,161*ratiow,334*ratioh,177*ratiow,330*ratioh,201*ratiow,326*ratioh,225*ratiow,323*ratioh,241*ratiow,323*ratioh,277*ratiow,328*ratioh,302*ratiow,331*ratioh,318*ratiow,337*ratioh,339*ratiow,349*ratioh,355*ratiow,363*ratioh,371*ratiow,392*ratioh,386*ratiow,425*ratioh,395*ratiow,459*ratioh,399*ratiow,484*ratioh,396*ratiow,509*ratioh,384*ratiow,543*ratioh,362*ratiow,585*ratioh,346*ratiow,612*ratioh,337*ratiow,622*ratioh,323*ratiow,635*ratioh,317*ratiow,643*ratioh,307*ratiow,659*ratioh,301*ratiow,665*ratioh,292*ratiow,673*ratioh,279*ratiow,694*ratioh,261*ratiow,720*ratioh,248*ratiow,740*ratioh,236*ratiow,754*ratioh,233*ratiow,756*ratioh,235*ratiow,774*ratioh,238*ratiow,781*ratioh,249*ratiow,795*ratioh,261*ratiow,810*ratioh,269*ratiow,816*ratioh,287*ratiow,825*ratioh,309*ratiow,808*ratioh,302*ratiow,807*ratioh,279*ratiow,807*ratioh,264*ratiow,803*ratioh,258*ratiow,795*ratioh,259*ratiow,785*ratioh,261*ratiow,779*ratioh,272*ratiow,777*ratioh,280*ratiow,775*ratioh,296*ratiow,778*ratioh,302*ratiow,770*ratioh,319*ratiow,764*ratioh,348*ratiow,756*ratioh,396*ratiow,742*ratioh,438*ratiow,724*ratioh,470*ratiow,710*ratioh,486*ratiow,696*ratioh,499*ratiow,677*ratioh,508*ratiow,659*ratioh,512*ratiow,615*ratioh,512*ratiow,572*ratioh,507*ratiow,550*ratioh,493*ratiow,517*ratioh,483*ratiow,494*ratioh,478*ratiow,467*ratioh,476*ratiow,431*ratioh,476*ratiow,399*ratioh,475*ratiow,375*ratioh,471*ratiow,355*ratioh,461*ratiow,328*ratioh,447*ratiow,298*ratioh,432*ratiow,276*ratioh,408*ratiow,249*ratioh,388*ratiow,230*ratioh,368*ratiow,215*ratioh,351*ratiow,207*ratioh,333*ratiow,199*ratioh,313*ratiow,192*ratioh,297*ratiow,187*ratioh,262*ratiow,176*ratioh,234*ratiow,167*ratioh,218*ratiow,163*ratioh,209*ratiow,162*ratioh,185*ratiow,163*ratioh,165*ratiow,169*ratioh,157*ratiow,174*ratioh,150*ratiow,183*ratioh,138*ratiow,205*ratioh,130*ratiow,223*ratioh,114*ratiow,262*ratioh,109*ratiow,276*ratioh,104*ratiow,283*ratioh,99*ratiow,288*ratioh,92*ratiow,290*ratioh,76*ratiow,288*ratioh,57*ratiow,282*ratioh,52*ratiow,280*ratioh,30*ratiow,282*ratioh,14*ratiow,284*ratioh,1*ratiow,284*ratioh,1*ratiow,296*ratioh,5*ratiow,301*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(177*ratiow,756*ratioh,188*ratiow,753*ratioh,215*ratiow,736*ratioh,251*ratiow,703*ratioh,267*ratiow,683*ratioh,272*ratiow,674*ratioh,270*ratiow,652*ratioh,263*ratiow,645*ratioh,255*ratiow,643*ratioh,249*ratiow,645*ratioh,244*ratiow,649*ratioh,226*ratiow,670*ratioh,216*ratiow,684*ratioh,202*ratiow,697*ratioh,180*ratiow,711*ratioh,167*ratiow,719*ratioh,160*ratiow,722*ratioh,160*ratiow,736*ratioh,163*ratiow,746*ratioh,166*ratiow,753*ratioh,173*ratiow,757*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(585*ratiow,784*ratioh,602*ratiow,798*ratioh,620*ratiow,774*ratioh,642*ratiow,736*ratioh,655*ratiow,702*ratioh,664*ratiow,670*ratioh,665*ratiow,646*ratioh,637*ratiow,642*ratioh,643*ratiow,645*ratioh,644*ratiow,657*ratioh,639*ratiow,685*ratioh,630*ratiow,717*ratioh,614*ratiow,750*ratioh,596*ratiow,775*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(578*ratiow,776*ratioh,586*ratiow,784*ratioh,596*ratiow,774*ratioh,609*ratiow,758*ratioh,623*ratiow,734*ratioh,634*ratiow,707*ratioh,643*ratiow,666*ratioh,644*ratiow,647*ratioh,640*ratiow,642*ratioh,633*ratiow,642*ratioh,631*ratiow,648*ratioh,627*ratiow,667*ratioh,622*ratiow,695*ratioh,613*ratiow,723*ratioh,603*ratiow,744*ratioh,585*ratiow,768*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(578*ratiow,776*ratioh,589*ratiow,763*ratioh,602*ratiow,746*ratioh,612*ratiow,724*ratioh,621*ratiow,697*ratioh,628*ratiow,663*ratioh,631*ratiow,646*ratioh,635*ratiow,642*ratioh,605*ratiow,638*ratioh,566*ratiow,633*ratioh,533*ratiow,629*ratioh,531*ratiow,643*ratioh,527*ratiow,659*ratioh,514*ratiow,685*ratioh,502*ratiow,707*ratioh,495*ratiow,719*ratioh,498*ratiow,725*ratioh,503*ratiow,731*ratioh,513*ratiow,740*ratioh,528*ratiow,748*ratioh,547*ratiow,755*ratioh,571*ratiow,771*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile72(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 661;
var baseHeight = 877;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(659*ratiow,298*ratioh,651*ratiow,308*ratioh,639*ratiow,325*ratioh,625*ratiow,342*ratioh,615*ratiow,350*ratioh,600*ratiow,354*ratioh,587*ratiow,355*ratioh,568*ratiow,351*ratioh,537*ratiow,337*ratioh,517*ratiow,329*ratioh,485*ratiow,323*ratioh,455*ratiow,318*ratioh,426*ratiow,318*ratioh,386*ratiow,323*ratioh,356*ratiow,329*ratioh,340*ratiow,339*ratioh,326*ratiow,355*ratioh,309*ratiow,380*ratioh,296*ratiow,408*ratioh,286*ratiow,437*ratioh,280*ratiow,469*ratioh,280*ratiow,502*ratioh,286*ratiow,523*ratioh,298*ratiow,550*ratioh,321*ratiow,590*ratioh,335*ratiow,616*ratioh,365*ratiow,650*ratioh,389*ratiow,677*ratioh,406*ratiow,699*ratioh,420*ratiow,719*ratioh,441*ratiow,748*ratioh,444*ratiow,759*ratioh,443*ratiow,770*ratioh,441*ratiow,776*ratioh,437*ratiow,778*ratioh,430*ratiow,779*ratioh,424*ratiow,784*ratioh,423*ratiow,793*ratioh,420*ratiow,808*ratioh,412*ratiow,819*ratioh,402*ratiow,816*ratioh,396*ratiow,807*ratioh,380*ratiow,793*ratioh,365*ratiow,786*ratioh,358*ratiow,783*ratioh,359*ratiow,779*ratioh,350*ratiow,774*ratioh,320*ratiow,768*ratioh,278*ratiow,758*ratioh,250*ratiow,746*ratioh,216*ratiow,726*ratioh,196*ratiow,710*ratioh,183*ratiow,693*ratioh,172*ratiow,669*ratioh,167*ratiow,642*ratioh,166*ratiow,572*ratioh,169*ratiow,543*ratioh,177*ratiow,512*ratioh,186*ratiow,487*ratioh,187*ratiow,458*ratioh,191*ratiow,394*ratioh,197*ratiow,357*ratioh,206*ratiow,322*ratioh,213*ratiow,302*ratioh,226*ratiow,279*ratioh,245*ratiow,255*ratioh,263*ratiow,237*ratioh,285*ratiow,220*ratioh,312*ratiow,204*ratioh,335*ratiow,193*ratioh,376*ratiow,176*ratioh,405*ratiow,165*ratioh,425*ratiow,159*ratioh,446*ratiow,157*ratioh,465*ratiow,158*ratioh,485*ratiow,163*ratioh,500*ratiow,172*ratioh,507*ratiow,180*ratioh,514*ratiow,194*ratioh,522*ratiow,213*ratioh,530*ratiow,236*ratioh,538*ratiow,257*ratioh,546*ratiow,271*ratioh,552*ratiow,277*ratioh,561*ratiow,281*ratioh,573*ratiow,284*ratioh,595*ratiow,282*ratioh,611*ratiow,280*ratioh,644*ratiow,281*ratioh,660*ratiow,281*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(498*ratiow,753*ratioh,473*ratiow,742*ratioh,444*ratiow,722*ratioh,425*ratiow,703*ratioh,398*ratiow,669*ratioh,387*ratiow,656*ratioh,395*ratiow,646*ratioh,408*ratiow,640*ratioh,422*ratiow,637*ratioh,435*ratiow,637*ratioh,458*ratiow,663*ratioh,479*ratiow,688*ratioh,500*ratiow,711*ratioh,510*ratiow,727*ratioh,515*ratiow,738*ratioh,515*ratiow,748*ratioh,510*ratiow,753*ratioh,502*ratiow,754*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(110*ratiow,787*ratioh,94*ratiow,797*ratioh,81*ratiow,778*ratioh,56*ratiow,734*ratioh,43*ratiow,702*ratioh,41*ratiow,691*ratioh,64*ratiow,688*ratioh,60*ratiow,691*ratioh,58*ratiow,701*ratioh,67*ratiow,723*ratioh,82*ratiow,749*ratioh,102*ratiow,776*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(110*ratiow,787*ratioh,100*ratiow,774*ratioh,83*ratiow,749*ratioh,68*ratiow,726*ratioh,60*ratiow,704*ratioh,58*ratiow,696*ratioh,61*ratiow,689*ratioh,67*ratiow,688*ratioh,72*ratiow,692*ratioh,82*ratiow,717*ratioh,95*ratiow,742*ratioh,108*ratiow,763*ratioh,117*ratiow,774*ratioh,119*ratiow,779*ratioh,118*ratiow,784*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(117*ratiow,784*ratioh,119*ratiow,777*ratioh,108*ratiow,762*ratioh,92*ratiow,737*ratioh,81*ratiow,714*ratioh,75*ratiow,699*ratioh,72*ratiow,692*ratioh,68*ratiow,688*ratioh,100*ratiow,683*ratioh,131*ratiow,679*ratioh,161*ratiow,674*ratioh,168*ratiow,692*ratioh,182*ratiow,712*ratioh,194*ratiow,724*ratioh,214*ratiow,738*ratioh,230*ratiow,747*ratioh,234*ratiow,749*ratioh,224*ratiow,750*ratioh,212*ratiow,752*ratioh,202*ratiow,760*ratioh,189*ratiow,769*ratioh,177*ratiow,774*ratioh,155*ratiow,776*ratioh,142*ratiow,777*ratioh,128*ratiow,781*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(2*ratiow,298*ratioh,10*ratiow,308*ratioh,22*ratiow,325*ratioh,36*ratiow,342*ratioh,46*ratiow,350*ratioh,61*ratiow,354*ratioh,74*ratiow,355*ratioh,93*ratiow,351*ratioh,124*ratiow,337*ratioh,144*ratiow,329*ratioh,176*ratiow,323*ratioh,206*ratiow,318*ratioh,235*ratiow,318*ratioh,275*ratiow,323*ratioh,305*ratiow,329*ratioh,321*ratiow,339*ratioh,335*ratiow,355*ratioh,352*ratiow,380*ratioh,365*ratiow,408*ratioh,375*ratiow,437*ratioh,381*ratiow,469*ratioh,381*ratiow,502*ratioh,375*ratiow,523*ratioh,363*ratiow,550*ratioh,340*ratiow,590*ratioh,326*ratiow,616*ratioh,296*ratiow,650*ratioh,272*ratiow,677*ratioh,255*ratiow,699*ratioh,241*ratiow,719*ratioh,220*ratiow,748*ratioh,217*ratiow,759*ratioh,218*ratiow,770*ratioh,220*ratiow,776*ratioh,224*ratiow,778*ratioh,231*ratiow,779*ratioh,237*ratiow,784*ratioh,238*ratiow,793*ratioh,241*ratiow,808*ratioh,249*ratiow,819*ratioh,259*ratiow,816*ratioh,265*ratiow,807*ratioh,281*ratiow,793*ratioh,296*ratiow,786*ratioh,303*ratiow,783*ratioh,302*ratiow,779*ratioh,311*ratiow,774*ratioh,341*ratiow,768*ratioh,383*ratiow,758*ratioh,411*ratiow,746*ratioh,445*ratiow,726*ratioh,465*ratiow,710*ratioh,478*ratiow,693*ratioh,489*ratiow,669*ratioh,494*ratiow,642*ratioh,495*ratiow,572*ratioh,492*ratiow,543*ratioh,484*ratiow,512*ratioh,475*ratiow,487*ratioh,474*ratiow,458*ratioh,470*ratiow,394*ratioh,464*ratiow,357*ratioh,455*ratiow,322*ratioh,448*ratiow,302*ratioh,435*ratiow,279*ratioh,416*ratiow,255*ratioh,398*ratiow,237*ratioh,376*ratiow,220*ratioh,349*ratiow,204*ratioh,326*ratiow,193*ratioh,285*ratiow,176*ratioh,256*ratiow,165*ratioh,236*ratiow,159*ratioh,215*ratiow,157*ratioh,196*ratiow,158*ratioh,176*ratiow,163*ratioh,161*ratiow,172*ratioh,154*ratiow,180*ratioh,147*ratiow,194*ratioh,139*ratiow,213*ratioh,131*ratiow,236*ratioh,123*ratiow,257*ratioh,115*ratiow,271*ratioh,109*ratiow,277*ratioh,100*ratiow,281*ratioh,88*ratiow,284*ratioh,66*ratiow,282*ratioh,50*ratiow,280*ratioh,17*ratiow,281*ratioh,1*ratiow,281*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(163*ratiow,753*ratioh,188*ratiow,742*ratioh,217*ratiow,722*ratioh,236*ratiow,703*ratioh,263*ratiow,669*ratioh,274*ratiow,656*ratioh,266*ratiow,646*ratioh,253*ratiow,640*ratioh,239*ratiow,637*ratioh,226*ratiow,637*ratioh,203*ratiow,663*ratioh,182*ratiow,688*ratioh,161*ratiow,711*ratioh,151*ratiow,727*ratioh,146*ratiow,738*ratioh,146*ratiow,748*ratioh,151*ratiow,753*ratioh,159*ratiow,754*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(551*ratiow,787*ratioh,567*ratiow,797*ratioh,580*ratiow,778*ratioh,605*ratiow,734*ratioh,618*ratiow,702*ratioh,620*ratiow,691*ratioh,597*ratiow,688*ratioh,601*ratiow,691*ratioh,603*ratiow,701*ratioh,594*ratiow,723*ratioh,579*ratiow,749*ratioh,559*ratiow,776*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(551*ratiow,787*ratioh,561*ratiow,774*ratioh,578*ratiow,749*ratioh,593*ratiow,726*ratioh,601*ratiow,704*ratioh,603*ratiow,696*ratioh,600*ratiow,689*ratioh,594*ratiow,688*ratioh,589*ratiow,692*ratioh,579*ratiow,717*ratioh,566*ratiow,742*ratioh,553*ratiow,763*ratioh,544*ratiow,774*ratioh,542*ratiow,779*ratioh,543*ratiow,784*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(544*ratiow,784*ratioh,542*ratiow,777*ratioh,553*ratiow,762*ratioh,569*ratiow,737*ratioh,580*ratiow,714*ratioh,586*ratiow,699*ratioh,589*ratiow,692*ratioh,593*ratiow,688*ratioh,561*ratiow,683*ratioh,530*ratiow,679*ratioh,500*ratiow,674*ratioh,493*ratiow,692*ratioh,479*ratiow,712*ratioh,467*ratiow,724*ratioh,447*ratiow,738*ratioh,431*ratiow,747*ratioh,427*ratiow,749*ratioh,437*ratiow,750*ratioh,449*ratiow,752*ratioh,459*ratiow,760*ratioh,472*ratiow,769*ratioh,484*ratiow,774*ratioh,506*ratiow,776*ratioh,519*ratiow,777*ratioh,533*ratiow,781*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile73(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 664;
var baseHeight = 860;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(663*ratiow,294*ratioh,650*ratiow,307*ratioh,634*ratiow,324*ratioh,614*ratiow,337*ratioh,597*ratiow,346*ratioh,589*ratiow,348*ratioh,577*ratiow,345*ratioh,548*ratiow,334*ratioh,516*ratiow,325*ratioh,483*ratiow,318*ratioh,457*ratiow,314*ratioh,433*ratiow,312*ratioh,408*ratiow,313*ratioh,384*ratiow,317*ratioh,359*ratiow,320*ratioh,349*ratiow,324*ratioh,339*ratiow,333*ratioh,324*ratiow,350*ratioh,312*ratiow,368*ratioh,299*ratiow,392*ratioh,289*ratiow,420*ratioh,283*ratiow,450*ratioh,281*ratiow,480*ratioh,287*ratiow,513*ratioh,293*ratiow,542*ratioh,305*ratiow,563*ratioh,318*ratiow,582*ratioh,328*ratiow,589*ratioh,333*ratiow,604*ratioh,348*ratiow,624*ratioh,355*ratiow,638*ratioh,375*ratiow,665*ratioh,401*ratiow,703*ratioh,415*ratiow,722*ratioh,425*ratiow,739*ratioh,430*ratiow,751*ratioh,431*ratiow,763*ratioh,429*ratiow,772*ratioh,424*ratiow,775*ratioh,419*ratiow,777*ratioh,417*ratiow,785*ratioh,412*ratiow,802*ratioh,402*ratiow,817*ratioh,389*ratiow,825*ratioh,378*ratiow,829*ratioh,378*ratiow,817*ratioh,376*ratiow,809*ratioh,370*ratiow,803*ratioh,358*ratiow,793*ratioh,351*ratiow,788*ratioh,352*ratiow,783*ratioh,343*ratiow,776*ratioh,320*ratiow,768*ratioh,278*ratiow,754*ratioh,252*ratiow,742*ratioh,224*ratiow,729*ratioh,207*ratiow,721*ratioh,196*ratiow,714*ratioh,186*ratiow,701*ratioh,173*ratiow,680*ratioh,163*ratiow,655*ratioh,151*ratiow,610*ratioh,146*ratiow,573*ratioh,149*ratiow,537*ratioh,157*ratiow,506*ratioh,167*ratiow,479*ratioh,177*ratiow,449*ratioh,182*ratiow,417*ratioh,189*ratiow,378*ratioh,199*ratiow,332*ratioh,209*ratiow,304*ratioh,222*ratiow,280*ratioh,243*ratiow,251*ratioh,266*ratiow,226*ratioh,290*ratiow,207*ratioh,312*ratiow,194*ratioh,338*ratiow,183*ratioh,367*ratiow,173*ratioh,417*ratiow,158*ratioh,456*ratiow,151*ratioh,471*ratiow,149*ratioh,485*ratiow,153*ratioh,501*ratiow,163*ratioh,509*ratiow,174*ratioh,514*ratiow,186*ratioh,521*ratiow,217*ratioh,527*ratiow,244*ratioh,535*ratiow,262*ratioh,541*ratiow,268*ratioh,562*ratiow,278*ratioh,579*ratiow,282*ratioh,587*ratiow,282*ratioh,607*ratiow,276*ratioh,634*ratiow,280*ratioh,663*ratiow,283*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(506*ratiow,760*ratioh,484*ratiow,754*ratioh,463*ratiow,743*ratioh,437*ratiow,721*ratioh,411*ratiow,692*ratioh,393*ratiow,665*ratioh,386*ratiow,649*ratioh,391*ratiow,636*ratioh,402*ratiow,628*ratioh,416*ratiow,625*ratioh,425*ratiow,624*ratioh,429*ratiow,632*ratioh,445*ratiow,649*ratioh,476*ratiow,684*ratioh,482*ratiow,690*ratioh,490*ratiow,695*ratioh,500*ratiow,701*ratioh,507*ratiow,709*ratioh,518*ratiow,726*ratioh,531*ratiow,749*ratioh,525*ratiow,750*ratioh,520*ratiow,755*ratioh,514*ratiow,759*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(91*ratiow,768*ratioh,74*ratiow,778*ratioh,60*ratiow,756*ratioh,47*ratiow,732*ratioh,36*ratiow,710*ratioh,30*ratiow,686*ratioh,29*ratiow,668*ratioh,45*ratiow,664*ratioh,47*ratiow,675*ratioh,54*ratiow,694*ratioh,65*ratiow,722*ratioh,76*ratiow,749*ratioh,81*ratiow,761*ratioh,86*ratiow,767*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(93*ratiow,767*ratioh,89*ratiow,768*ratioh,85*ratiow,766*ratioh,80*ratiow,760*ratioh,73*ratiow,741*ratioh,63*ratiow,718*ratioh,53*ratiow,690*ratioh,45*ratiow,669*ratioh,44*ratiow,664*ratioh,56*ratiow,662*ratioh,57*ratiow,668*ratioh,60*ratiow,683*ratioh,70*ratiow,707*ratioh,79*ratiow,728*ratioh,87*ratiow,746*ratioh,93*ratiow,759*ratioh,94*ratiow,762*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(93*ratiow,767*ratioh,93*ratiow,760*ratioh,88*ratiow,747*ratioh,76*ratiow,721*ratioh,67*ratiow,699*ratioh,60*ratiow,680*ratioh,56*ratiow,666*ratioh,55*ratiow,662*ratioh,146*ratiow,637*ratioh,149*ratiow,641*ratioh,160*ratiow,674*ratioh,171*ratiow,693*ratioh,183*ratiow,711*ratioh,193*ratiow,721*ratioh,213*ratiow,732*ratioh,230*ratiow,740*ratioh,229*ratiow,741*ratioh,204*ratiow,732*ratioh,195*ratiow,730*ratioh,195*ratiow,727*ratioh,190*ratiow,724*ratioh,182*ratiow,721*ratioh,175*ratiow,721*ratioh,168*ratiow,724*ratioh,165*ratiow,729*ratioh,165*ratiow,735*ratioh,173*ratiow,737*ratioh,160*ratiow,740*ratioh,135*ratiow,746*ratioh,112*ratiow,754*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(1*ratiow,294*ratioh,14*ratiow,307*ratioh,30*ratiow,324*ratioh,50*ratiow,337*ratioh,67*ratiow,346*ratioh,75*ratiow,348*ratioh,87*ratiow,345*ratioh,116*ratiow,334*ratioh,148*ratiow,325*ratioh,181*ratiow,318*ratioh,207*ratiow,314*ratioh,231*ratiow,312*ratioh,256*ratiow,313*ratioh,280*ratiow,317*ratioh,305*ratiow,320*ratioh,315*ratiow,324*ratioh,325*ratiow,333*ratioh,340*ratiow,350*ratioh,352*ratiow,368*ratioh,365*ratiow,392*ratioh,375*ratiow,420*ratioh,381*ratiow,450*ratioh,383*ratiow,480*ratioh,377*ratiow,513*ratioh,371*ratiow,542*ratioh,359*ratiow,563*ratioh,346*ratiow,582*ratioh,336*ratiow,589*ratioh,331*ratiow,604*ratioh,316*ratiow,624*ratioh,309*ratiow,638*ratioh,289*ratiow,665*ratioh,263*ratiow,703*ratioh,249*ratiow,722*ratioh,239*ratiow,739*ratioh,234*ratiow,751*ratioh,233*ratiow,763*ratioh,235*ratiow,772*ratioh,240*ratiow,775*ratioh,245*ratiow,777*ratioh,247*ratiow,785*ratioh,252*ratiow,802*ratioh,262*ratiow,817*ratioh,275*ratiow,825*ratioh,286*ratiow,829*ratioh,286*ratiow,817*ratioh,288*ratiow,809*ratioh,294*ratiow,803*ratioh,306*ratiow,793*ratioh,313*ratiow,788*ratioh,312*ratiow,783*ratioh,321*ratiow,776*ratioh,344*ratiow,768*ratioh,386*ratiow,754*ratioh,412*ratiow,742*ratioh,440*ratiow,729*ratioh,457*ratiow,721*ratioh,468*ratiow,714*ratioh,478*ratiow,701*ratioh,491*ratiow,680*ratioh,501*ratiow,655*ratioh,513*ratiow,610*ratioh,518*ratiow,573*ratioh,515*ratiow,537*ratioh,507*ratiow,506*ratioh,497*ratiow,479*ratioh,487*ratiow,449*ratioh,482*ratiow,417*ratioh,475*ratiow,378*ratioh,465*ratiow,332*ratioh,455*ratiow,304*ratioh,442*ratiow,280*ratioh,421*ratiow,251*ratioh,398*ratiow,226*ratioh,374*ratiow,207*ratioh,352*ratiow,194*ratioh,326*ratiow,183*ratioh,297*ratiow,173*ratioh,247*ratiow,158*ratioh,208*ratiow,151*ratioh,193*ratiow,149*ratioh,179*ratiow,153*ratioh,163*ratiow,163*ratioh,155*ratiow,174*ratioh,150*ratiow,186*ratioh,143*ratiow,217*ratioh,137*ratiow,244*ratioh,129*ratiow,262*ratioh,123*ratiow,268*ratioh,102*ratiow,278*ratioh,85*ratiow,282*ratioh,77*ratiow,282*ratioh,57*ratiow,276*ratioh,30*ratiow,280*ratioh,1*ratiow,283*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(158*ratiow,760*ratioh,180*ratiow,754*ratioh,201*ratiow,743*ratioh,227*ratiow,721*ratioh,253*ratiow,692*ratioh,271*ratiow,665*ratioh,278*ratiow,649*ratioh,273*ratiow,636*ratioh,262*ratiow,628*ratioh,248*ratiow,625*ratioh,239*ratiow,624*ratioh,235*ratiow,632*ratioh,219*ratiow,649*ratioh,188*ratiow,684*ratioh,182*ratiow,690*ratioh,174*ratiow,695*ratioh,164*ratiow,701*ratioh,157*ratiow,709*ratioh,146*ratiow,726*ratioh,133*ratiow,749*ratioh,139*ratiow,750*ratioh,144*ratiow,755*ratioh,150*ratiow,759*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(573*ratiow,768*ratioh,590*ratiow,778*ratioh,604*ratiow,756*ratioh,617*ratiow,732*ratioh,628*ratiow,710*ratioh,634*ratiow,686*ratioh,635*ratiow,668*ratioh,619*ratiow,664*ratioh,617*ratiow,675*ratioh,610*ratiow,694*ratioh,599*ratiow,722*ratioh,588*ratiow,749*ratioh,583*ratiow,761*ratioh,578*ratiow,767*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(571*ratiow,767*ratioh,575*ratiow,768*ratioh,579*ratiow,766*ratioh,584*ratiow,760*ratioh,591*ratiow,741*ratioh,601*ratiow,718*ratioh,611*ratiow,690*ratioh,619*ratiow,669*ratioh,620*ratiow,664*ratioh,608*ratiow,662*ratioh,607*ratiow,668*ratioh,604*ratiow,683*ratioh,594*ratiow,707*ratioh,585*ratiow,728*ratioh,577*ratiow,746*ratioh,571*ratiow,759*ratioh,570*ratiow,762*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(571*ratiow,767*ratioh,571*ratiow,760*ratioh,576*ratiow,747*ratioh,588*ratiow,721*ratioh,597*ratiow,699*ratioh,604*ratiow,680*ratioh,608*ratiow,666*ratioh,609*ratiow,662*ratioh,518*ratiow,637*ratioh,515*ratiow,641*ratioh,504*ratiow,674*ratioh,493*ratiow,693*ratioh,481*ratiow,711*ratioh,471*ratiow,721*ratioh,451*ratiow,732*ratioh,434*ratiow,740*ratioh,435*ratiow,741*ratioh,460*ratiow,732*ratioh,469*ratiow,730*ratioh,469*ratiow,727*ratioh,474*ratiow,724*ratioh,482*ratiow,721*ratioh,489*ratiow,721*ratioh,496*ratiow,724*ratioh,499*ratiow,729*ratioh,499*ratiow,735*ratioh,491*ratiow,737*ratioh,504*ratiow,740*ratioh,529*ratiow,746*ratioh,552*ratiow,754*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile74(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 675;
var baseHeight = 853;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, Pir1, Pir2, Pir3";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(674*ratiow,314*ratioh,667*ratiow,313*ratioh,662*ratiow,310*ratioh,648*ratiow,320*ratioh,635*ratiow,330*ratioh,624*ratiow,340*ratioh,616*ratiow,343*ratioh,594*ratiow,344*ratioh,572*ratiow,337*ratioh,539*ratiow,328*ratioh,515*ratiow,322*ratioh,508*ratiow,320*ratioh,493*ratiow,318*ratioh,487*ratiow,318*ratioh,476*ratiow,321*ratioh,464*ratiow,322*ratioh,451*ratiow,323*ratioh,429*ratiow,323*ratioh,414*ratiow,326*ratioh,384*ratiow,333*ratioh,363*ratiow,338*ratioh,356*ratiow,338*ratioh,351*ratiow,335*ratioh,342*ratiow,341*ratioh,323*ratiow,358*ratioh,307*ratiow,383*ratioh,298*ratiow,411*ratioh,293*ratiow,427*ratioh,288*ratiow,461*ratioh,288*ratiow,500*ratioh,291*ratiow,524*ratioh,300*ratiow,549*ratioh,312*ratiow,570*ratioh,328*ratiow,587*ratioh,352*ratiow,620*ratioh,373*ratiow,653*ratioh,405*ratiow,694*ratioh,433*ratiow,729*ratioh,437*ratiow,734*ratioh,438*ratiow,746*ratioh,437*ratiow,754*ratioh,433*ratiow,762*ratioh,424*ratiow,780*ratioh,412*ratiow,805*ratioh,396*ratiow,817*ratioh,394*ratiow,806*ratioh,390*ratiow,794*ratioh,385*ratiow,788*ratioh,373*ratiow,783*ratioh,347*ratiow,774*ratioh,316*ratiow,764*ratioh,262*ratiow,747*ratioh,230*ratiow,734*ratioh,205*ratiow,719*ratioh,188*ratiow,707*ratioh,171*ratiow,685*ratioh,161*ratiow,664*ratioh,152*ratiow,632*ratioh,146*ratiow,600*ratioh,145*ratiow,563*ratioh,149*ratiow,513*ratioh,153*ratiow,490*ratioh,162*ratiow,458*ratioh,168*ratiow,435*ratioh,175*ratiow,404*ratioh,180*ratiow,372*ratioh,185*ratiow,344*ratioh,192*ratiow,318*ratioh,202*ratiow,296*ratioh,215*ratiow,276*ratioh,232*ratiow,257*ratioh,255*ratiow,237*ratioh,281*ratiow,219*ratioh,307*ratiow,204*ratioh,335*ratiow,192*ratioh,361*ratiow,182*ratioh,386*ratiow,174*ratioh,412*ratiow,169*ratioh,443*ratiow,167*ratioh,476*ratiow,170*ratioh,492*ratiow,176*ratioh,497*ratiow,181*ratioh,502*ratiow,191*ratioh,510*ratiow,214*ratioh,513*ratiow,225*ratioh,510*ratiow,235*ratioh,508*ratiow,250*ratioh,512*ratiow,268*ratioh,520*ratiow,279*ratioh,533*ratiow,288*ratioh,545*ratiow,293*ratioh,579*ratiow,295*ratioh,593*ratiow,293*ratioh,598*ratiow,289*ratioh,596*ratiow,284*ratioh,587*ratiow,281*ratioh,580*ratiow,280*ratioh,630*ratiow,280*ratioh,666*ratiow,283*ratioh,674*ratiow,283*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(547*ratiow,729*ratioh,540*ratiow,740*ratioh,529*ratiow,746*ratioh,514*ratiow,748*ratioh,493*ratiow,745*ratioh,472*ratiow,736*ratioh,446*ratiow,715*ratioh,417*ratiow,685*ratioh,388*ratiow,646*ratioh,385*ratiow,640*ratioh,397*ratiow,627*ratioh,411*ratiow,619*ratioh,425*ratiow,617*ratioh,431*ratiow,622*ratioh,454*ratiow,646*ratioh,469*ratiow,660*ratioh,484*ratiow,675*ratioh,513*ratiow,693*ratioh,527*ratiow,703*ratioh,535*ratiow,712*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(77*ratiow,736*ratioh,65*ratiow,741*ratioh,58*ratiow,726*ratioh,50*ratiow,706*ratioh,44*ratiow,688*ratioh,41*ratiow,669*ratioh,60*ratiow,664*ratioh,55*ratiow,669*ratioh,57*ratiow,683*ratioh,64*ratiow,705*ratioh,71*ratiow,724*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(77*ratiow,736*ratioh,71*ratiow,724*ratioh,64*ratiow,704*ratioh,58*ratiow,684*ratioh,55*ratiow,670*ratioh,56*ratiow,665*ratioh,62*ratiow,664*ratioh,65*ratiow,668*ratioh,72*ratiow,687*ratioh,78*ratiow,710*ratioh,83*ratiow,729*ratioh,80*ratiow,735*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(81*ratiow,734*ratioh,83*ratiow,727*ratioh,77*ratiow,707*ratioh,72*ratiow,688*ratioh,68*ratiow,673*ratioh,66*ratiow,668*ratioh,60*ratiow,663*ratioh,108*ratiow,651*ratioh,145*ratiow,641*ratioh,150*ratiow,656*ratioh,157*ratiow,672*ratioh,171*ratiow,696*ratioh,186*ratiow,713*ratioh,205*ratiow,726*ratioh,193*ratiow,723*ratioh,185*ratiow,722*ratioh,181*ratiow,726*ratioh,182*ratiow,731*ratioh,191*ratiow,737*ratioh,181*ratiow,739*ratioh,155*ratiow,743*ratioh,131*ratiow,743*ratioh,106*ratiow,737*ratioh,90*ratiow,734*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(1*ratiow,314*ratioh,8*ratiow,313*ratioh,13*ratiow,310*ratioh,27*ratiow,320*ratioh,40*ratiow,330*ratioh,51*ratiow,340*ratioh,59*ratiow,343*ratioh,81*ratiow,344*ratioh,103*ratiow,337*ratioh,136*ratiow,328*ratioh,160*ratiow,322*ratioh,167*ratiow,320*ratioh,182*ratiow,318*ratioh,188*ratiow,318*ratioh,199*ratiow,321*ratioh,211*ratiow,322*ratioh,224*ratiow,323*ratioh,246*ratiow,323*ratioh,261*ratiow,326*ratioh,291*ratiow,333*ratioh,312*ratiow,338*ratioh,319*ratiow,338*ratioh,324*ratiow,335*ratioh,333*ratiow,341*ratioh,352*ratiow,358*ratioh,368*ratiow,383*ratioh,377*ratiow,411*ratioh,382*ratiow,427*ratioh,387*ratiow,461*ratioh,387*ratiow,500*ratioh,384*ratiow,524*ratioh,375*ratiow,549*ratioh,363*ratiow,570*ratioh,347*ratiow,587*ratioh,323*ratiow,620*ratioh,302*ratiow,653*ratioh,270*ratiow,694*ratioh,242*ratiow,729*ratioh,238*ratiow,734*ratioh,237*ratiow,746*ratioh,238*ratiow,754*ratioh,242*ratiow,762*ratioh,251*ratiow,780*ratioh,263*ratiow,805*ratioh,279*ratiow,817*ratioh,281*ratiow,806*ratioh,285*ratiow,794*ratioh,290*ratiow,788*ratioh,302*ratiow,783*ratioh,328*ratiow,774*ratioh,359*ratiow,764*ratioh,413*ratiow,747*ratioh,445*ratiow,734*ratioh,470*ratiow,719*ratioh,487*ratiow,707*ratioh,504*ratiow,685*ratioh,514*ratiow,664*ratioh,523*ratiow,632*ratioh,529*ratiow,600*ratioh,530*ratiow,563*ratioh,526*ratiow,513*ratioh,522*ratiow,490*ratioh,513*ratiow,458*ratioh,507*ratiow,435*ratioh,500*ratiow,404*ratioh,495*ratiow,372*ratioh,490*ratiow,344*ratioh,483*ratiow,318*ratioh,473*ratiow,296*ratioh,460*ratiow,276*ratioh,443*ratiow,257*ratioh,420*ratiow,237*ratioh,394*ratiow,219*ratioh,368*ratiow,204*ratioh,340*ratiow,192*ratioh,314*ratiow,182*ratioh,289*ratiow,174*ratioh,263*ratiow,169*ratioh,232*ratiow,167*ratioh,199*ratiow,170*ratioh,183*ratiow,176*ratioh,178*ratiow,181*ratioh,173*ratiow,191*ratioh,165*ratiow,214*ratioh,162*ratiow,225*ratioh,165*ratiow,235*ratioh,167*ratiow,250*ratioh,163*ratiow,268*ratioh,155*ratiow,279*ratioh,142*ratiow,288*ratioh,130*ratiow,293*ratioh,96*ratiow,295*ratioh,82*ratiow,293*ratioh,77*ratiow,289*ratioh,79*ratiow,284*ratioh,88*ratiow,281*ratioh,95*ratiow,280*ratioh,45*ratiow,280*ratioh,9*ratiow,283*ratioh,1*ratiow,283*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(128*ratiow,729*ratioh,135*ratiow,740*ratioh,146*ratiow,746*ratioh,161*ratiow,748*ratioh,182*ratiow,745*ratioh,203*ratiow,736*ratioh,229*ratiow,715*ratioh,258*ratiow,685*ratioh,287*ratiow,646*ratioh,290*ratiow,640*ratioh,278*ratiow,627*ratioh,264*ratiow,619*ratioh,250*ratiow,617*ratioh,244*ratiow,622*ratioh,221*ratiow,646*ratioh,206*ratiow,660*ratioh,191*ratiow,675*ratioh,162*ratiow,693*ratioh,148*ratiow,703*ratioh,140*ratiow,712*ratioh);
data = analyze_pic(data);

//Pir1
selectWindow(name);
makePolygon(598*ratiow,736*ratioh,610*ratiow,741*ratioh,617*ratiow,726*ratioh,625*ratiow,706*ratioh,631*ratiow,688*ratioh,634*ratiow,669*ratioh,615*ratiow,664*ratioh,620*ratiow,669*ratioh,618*ratiow,683*ratioh,611*ratiow,705*ratioh,604*ratiow,724*ratioh);
data = analyze_pic(data);

//Pir2
selectWindow(name);
makePolygon(598*ratiow,736*ratioh,604*ratiow,724*ratioh,611*ratiow,704*ratioh,617*ratiow,684*ratioh,620*ratiow,670*ratioh,619*ratiow,665*ratioh,613*ratiow,664*ratioh,610*ratiow,668*ratioh,603*ratiow,687*ratioh,597*ratiow,710*ratioh,592*ratiow,729*ratioh,595*ratiow,735*ratioh);
data = analyze_pic(data);

//Pir3
selectWindow(name);
makePolygon(594*ratiow,734*ratioh,592*ratiow,727*ratioh,598*ratiow,707*ratioh,603*ratiow,688*ratioh,607*ratiow,673*ratioh,609*ratiow,668*ratioh,615*ratiow,663*ratioh,567*ratiow,651*ratioh,530*ratiow,641*ratioh,525*ratiow,656*ratioh,518*ratiow,672*ratioh,504*ratiow,696*ratioh,489*ratiow,713*ratioh,470*ratiow,726*ratioh,482*ratiow,723*ratioh,490*ratiow,722*ratioh,494*ratiow,726*ratioh,493*ratiow,731*ratioh,484*ratiow,737*ratioh,494*ratiow,739*ratioh,520*ratiow,743*ratioh,544*ratiow,743*ratioh,569*ratiow,737*ratioh,585*ratiow,734*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile75(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 675;
var baseHeight = 865;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(664*ratiow,288*ratioh,667*ratiow,295*ratioh,668*ratiow,306*ratioh,663*ratiow,319*ratioh,651*ratiow,331*ratioh,635*ratiow,338*ratioh,618*ratiow,345*ratioh,605*ratiow,346*ratioh,576*ratiow,340*ratioh,536*ratiow,331*ratioh,513*ratiow,328*ratioh,499*ratiow,326*ratioh,480*ratiow,329*ratioh,463*ratiow,332*ratioh,431*ratiow,332*ratioh,416*ratiow,335*ratioh,401*ratiow,339*ratioh,389*ratiow,348*ratioh,374*ratiow,354*ratioh,357*ratiow,356*ratioh,346*ratiow,360*ratioh,337*ratiow,367*ratioh,328*ratiow,381*ratioh,321*ratiow,391*ratioh,315*ratiow,399*ratioh,306*ratiow,431*ratioh,301*ratiow,461*ratioh,299*ratiow,509*ratioh,299*ratiow,533*ratioh,306*ratiow,554*ratioh,314*ratiow,572*ratioh,322*ratiow,580*ratioh,329*ratiow,586*ratioh,336*ratiow,594*ratioh,346*ratiow,615*ratioh,356*ratiow,633*ratioh,370*ratiow,652*ratioh,394*ratiow,684*ratioh,408*ratiow,705*ratioh,424*ratiow,725*ratioh,439*ratiow,743*ratioh,446*ratiow,751*ratioh,447*ratiow,758*ratioh,444*ratiow,770*ratioh,439*ratiow,779*ratioh,433*ratiow,785*ratioh,429*ratiow,787*ratioh,423*ratiow,792*ratioh,417*ratiow,800*ratioh,411*ratiow,803*ratioh,407*ratiow,813*ratioh,397*ratiow,823*ratioh,391*ratiow,826*ratioh,382*ratiow,819*ratioh,377*ratiow,809*ratioh,371*ratiow,799*ratioh,358*ratiow,789*ratioh,334*ratiow,780*ratioh,305*ratiow,774*ratioh,267*ratiow,757*ratioh,245*ratiow,748*ratioh,219*ratiow,738*ratioh,191*ratiow,720*ratioh,175*ratiow,705*ratioh,163*ratiow,686*ratioh,153*ratiow,657*ratioh,148*ratiow,639*ratioh,143*ratiow,580*ratioh,144*ratiow,535*ratioh,147*ratiow,509*ratioh,154*ratiow,477*ratioh,165*ratiow,442*ratioh,172*ratiow,406*ratioh,184*ratiow,365*ratioh,200*ratiow,330*ratioh,213*ratiow,308*ratioh,223*ratiow,293*ratioh,239*ratiow,274*ratioh,261*ratiow,253*ratioh,289*ratiow,233*ratioh,334*ratiow,210*ratioh,366*ratiow,197*ratioh,395*ratiow,187*ratioh,428*ratiow,178*ratioh,450*ratiow,176*ratioh,482*ratiow,181*ratioh,495*ratiow,186*ratioh,504*ratiow,193*ratioh,510*ratiow,203*ratioh,512*ratiow,216*ratioh,514*ratiow,238*ratioh,519*ratiow,255*ratioh,527*ratiow,265*ratioh,536*ratiow,271*ratioh,550*ratiow,275*ratioh,572*ratiow,279*ratioh,606*ratiow,283*ratioh,659*ratiow,287*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(554*ratiow,753*ratioh,552*ratiow,758*ratioh,544*ratiow,764*ratioh,533*ratiow,766*ratioh,498*ratiow,758*ratioh,466*ratiow,746*ratioh,439*ratiow,725*ratioh,414*ratiow,695*ratioh,398*ratiow,667*ratioh,397*ratiow,659*ratioh,405*ratiow,646*ratioh,421*ratiow,637*ratioh,438*ratiow,634*ratioh,443*ratiow,636*ratioh,455*ratiow,649*ratioh,478*ratiow,674*ratioh,492*ratiow,687*ratioh,508*ratiow,697*ratioh,527*ratiow,708*ratioh,545*ratiow,724*ratioh,553*ratiow,733*ratioh,553*ratiow,741*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(11*ratiow,288*ratioh,8*ratiow,295*ratioh,7*ratiow,306*ratioh,12*ratiow,319*ratioh,24*ratiow,331*ratioh,40*ratiow,338*ratioh,57*ratiow,345*ratioh,70*ratiow,346*ratioh,99*ratiow,340*ratioh,139*ratiow,331*ratioh,162*ratiow,328*ratioh,176*ratiow,326*ratioh,195*ratiow,329*ratioh,212*ratiow,332*ratioh,244*ratiow,332*ratioh,259*ratiow,335*ratioh,274*ratiow,339*ratioh,286*ratiow,348*ratioh,301*ratiow,354*ratioh,318*ratiow,356*ratioh,329*ratiow,360*ratioh,338*ratiow,367*ratioh,347*ratiow,381*ratioh,354*ratiow,391*ratioh,360*ratiow,399*ratioh,369*ratiow,431*ratioh,374*ratiow,461*ratioh,376*ratiow,509*ratioh,376*ratiow,533*ratioh,369*ratiow,554*ratioh,361*ratiow,572*ratioh,353*ratiow,580*ratioh,346*ratiow,586*ratioh,339*ratiow,594*ratioh,329*ratiow,615*ratioh,319*ratiow,633*ratioh,305*ratiow,652*ratioh,281*ratiow,684*ratioh,267*ratiow,705*ratioh,251*ratiow,725*ratioh,236*ratiow,743*ratioh,229*ratiow,751*ratioh,228*ratiow,758*ratioh,231*ratiow,770*ratioh,236*ratiow,779*ratioh,242*ratiow,785*ratioh,246*ratiow,787*ratioh,252*ratiow,792*ratioh,258*ratiow,800*ratioh,264*ratiow,803*ratioh,268*ratiow,813*ratioh,278*ratiow,823*ratioh,284*ratiow,826*ratioh,293*ratiow,819*ratioh,298*ratiow,809*ratioh,304*ratiow,799*ratioh,317*ratiow,789*ratioh,341*ratiow,780*ratioh,370*ratiow,774*ratioh,408*ratiow,757*ratioh,430*ratiow,748*ratioh,456*ratiow,738*ratioh,484*ratiow,720*ratioh,500*ratiow,705*ratioh,512*ratiow,686*ratioh,522*ratiow,657*ratioh,527*ratiow,639*ratioh,532*ratiow,580*ratioh,531*ratiow,535*ratioh,528*ratiow,509*ratioh,521*ratiow,477*ratioh,510*ratiow,442*ratioh,503*ratiow,406*ratioh,491*ratiow,365*ratioh,475*ratiow,330*ratioh,462*ratiow,308*ratioh,452*ratiow,293*ratioh,436*ratiow,274*ratioh,414*ratiow,253*ratioh,386*ratiow,233*ratioh,341*ratiow,210*ratioh,309*ratiow,197*ratioh,280*ratiow,187*ratioh,247*ratiow,178*ratioh,225*ratiow,176*ratioh,193*ratiow,181*ratioh,180*ratiow,186*ratioh,171*ratiow,193*ratioh,165*ratiow,203*ratioh,163*ratiow,216*ratioh,161*ratiow,238*ratioh,156*ratiow,255*ratioh,148*ratiow,265*ratioh,139*ratiow,271*ratioh,125*ratiow,275*ratioh,103*ratiow,279*ratioh,69*ratiow,283*ratioh,16*ratiow,287*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(121*ratiow,753*ratioh,123*ratiow,758*ratioh,131*ratiow,764*ratioh,142*ratiow,766*ratioh,177*ratiow,758*ratioh,209*ratiow,746*ratioh,236*ratiow,725*ratioh,261*ratiow,695*ratioh,277*ratiow,667*ratioh,278*ratiow,659*ratioh,270*ratiow,646*ratioh,254*ratiow,637*ratioh,237*ratiow,634*ratioh,232*ratiow,636*ratioh,220*ratiow,649*ratioh,197*ratiow,674*ratioh,183*ratiow,687*ratioh,167*ratiow,697*ratioh,148*ratiow,708*ratioh,130*ratiow,724*ratioh,122*ratiow,733*ratioh,122*ratiow,741*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile76(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 667;
var baseHeight = 871;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, PAG";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(653*ratiow,281*ratioh,649*ratiow,291*ratioh,642*ratiow,302*ratioh,631*ratiow,313*ratioh,616*ratiow,322*ratioh,596*ratiow,329*ratioh,586*ratiow,329*ratioh,576*ratiow,326*ratioh,530*ratiow,326*ratioh,501*ratiow,324*ratioh,482*ratiow,324*ratioh,463*ratiow,328*ratioh,454*ratiow,331*ratioh,447*ratiow,337*ratioh,433*ratiow,337*ratioh,413*ratiow,341*ratioh,391*ratiow,348*ratioh,369*ratiow,359*ratioh,346*ratiow,367*ratioh,327*ratiow,378*ratioh,320*ratiow,385*ratioh,312*ratiow,396*ratioh,305*ratiow,412*ratioh,298*ratiow,434*ratioh,293*ratiow,460*ratioh,292*ratiow,482*ratioh,296*ratiow,513*ratioh,299*ratiow,541*ratioh,302*ratiow,563*ratioh,312*ratiow,579*ratioh,324*ratiow,597*ratioh,335*ratiow,617*ratioh,342*ratiow,635*ratioh,367*ratiow,674*ratioh,382*ratiow,696*ratioh,400*ratiow,718*ratioh,411*ratiow,732*ratioh,410*ratiow,735*ratioh,411*ratiow,739*ratioh,415*ratiow,746*ratioh,425*ratiow,755*ratioh,425*ratiow,767*ratioh,424*ratiow,773*ratioh,421*ratiow,776*ratioh,417*ratiow,780*ratioh,406*ratiow,780*ratioh,403*ratiow,779*ratioh,406*ratiow,788*ratioh,407*ratiow,800*ratioh,404*ratiow,816*ratioh,397*ratiow,828*ratioh,385*ratiow,838*ratioh,369*ratiow,844*ratioh,359*ratiow,846*ratioh,356*ratiow,834*ratioh,355*ratiow,825*ratioh,346*ratiow,815*ratioh,334*ratiow,806*ratioh,324*ratiow,801*ratioh,322*ratiow,799*ratioh,323*ratiow,796*ratioh,314*ratiow,792*ratioh,289*ratiow,786*ratioh,257*ratiow,776*ratioh,225*ratiow,764*ratioh,202*ratiow,752*ratioh,175*ratiow,735*ratioh,159*ratiow,720*ratioh,147*ratiow,698*ratioh,138*ratiow,672*ratioh,128*ratiow,627*ratioh,124*ratiow,583*ratioh,124*ratiow,549*ratioh,126*ratiow,520*ratioh,131*ratiow,481*ratioh,141*ratiow,438*ratioh,147*ratiow,416*ratioh,159*ratiow,378*ratioh,171*ratiow,344*ratioh,183*ratiow,321*ratioh,197*ratiow,296*ratioh,216*ratiow,272*ratioh,238*ratiow,252*ratioh,265*ratiow,232*ratioh,305*ratiow,214*ratioh,332*ratiow,202*ratioh,364*ratiow,191*ratioh,392*ratiow,183*ratioh,409*ratiow,180*ratioh,434*ratiow,180*ratioh,448*ratiow,182*ratioh,465*ratiow,190*ratioh,473*ratiow,196*ratioh,482*ratiow,212*ratioh,475*ratiow,230*ratioh,472*ratiow,247*ratioh,475*ratiow,270*ratioh,480*ratiow,286*ratioh,495*ratiow,300*ratioh,509*ratiow,307*ratioh,531*ratiow,309*ratioh,565*ratiow,310*ratioh,595*ratiow,307*ratioh,612*ratiow,302*ratioh,626*ratiow,291*ratioh,636*ratiow,280*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(554*ratiow,763*ratioh,547*ratiow,767*ratioh,534*ratiow,769*ratioh,514*ratiow,768*ratioh,484*ratiow,760*ratioh,450*ratiow,744*ratioh,431*ratiow,730*ratioh,414*ratiow,712*ratioh,390*ratiow,680*ratioh,378*ratiow,656*ratioh,377*ratiow,647*ratioh,381*ratiow,643*ratioh,395*ratiow,639*ratioh,414*ratiow,635*ratioh,431*ratiow,638*ratioh,460*ratiow,663*ratioh,488*ratiow,683*ratioh,514*ratiow,704*ratioh,531*ratiow,717*ratioh,539*ratiow,727*ratioh,547*ratiow,739*ratioh,552*ratiow,749*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(666*ratiow,444*ratioh,649*ratiow,445*ratioh,643*ratiow,446*ratioh,638*ratiow,448*ratioh,628*ratiow,457*ratioh,617*ratiow,467*ratioh,611*ratiow,475*ratioh,608*ratiow,488*ratioh,613*ratiow,508*ratioh,620*ratiow,523*ratioh,625*ratiow,524*ratioh,635*ratiow,528*ratioh,644*ratiow,534*ratioh,650*ratiow,541*ratioh,654*ratiow,551*ratioh,654*ratiow,559*ratioh,652*ratiow,566*ratioh,651*ratiow,569*ratioh,656*ratiow,570*ratioh,659*ratiow,564*ratioh,663*ratiow,559*ratioh,665*ratiow,565*ratioh,666*ratiow,568*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(14*ratiow,281*ratioh,18*ratiow,291*ratioh,25*ratiow,302*ratioh,36*ratiow,313*ratioh,51*ratiow,322*ratioh,71*ratiow,329*ratioh,81*ratiow,329*ratioh,91*ratiow,326*ratioh,137*ratiow,326*ratioh,166*ratiow,324*ratioh,185*ratiow,324*ratioh,204*ratiow,328*ratioh,213*ratiow,331*ratioh,220*ratiow,337*ratioh,234*ratiow,337*ratioh,254*ratiow,341*ratioh,276*ratiow,348*ratioh,298*ratiow,359*ratioh,321*ratiow,367*ratioh,340*ratiow,378*ratioh,347*ratiow,385*ratioh,355*ratiow,396*ratioh,362*ratiow,412*ratioh,369*ratiow,434*ratioh,374*ratiow,460*ratioh,375*ratiow,482*ratioh,371*ratiow,513*ratioh,368*ratiow,541*ratioh,365*ratiow,563*ratioh,355*ratiow,579*ratioh,343*ratiow,597*ratioh,332*ratiow,617*ratioh,325*ratiow,635*ratioh,300*ratiow,674*ratioh,285*ratiow,696*ratioh,267*ratiow,718*ratioh,256*ratiow,732*ratioh,257*ratiow,735*ratioh,256*ratiow,739*ratioh,252*ratiow,746*ratioh,242*ratiow,755*ratioh,242*ratiow,767*ratioh,243*ratiow,773*ratioh,246*ratiow,776*ratioh,250*ratiow,780*ratioh,261*ratiow,780*ratioh,264*ratiow,779*ratioh,261*ratiow,788*ratioh,260*ratiow,800*ratioh,263*ratiow,816*ratioh,270*ratiow,828*ratioh,282*ratiow,838*ratioh,298*ratiow,844*ratioh,308*ratiow,846*ratioh,311*ratiow,834*ratioh,312*ratiow,825*ratioh,321*ratiow,815*ratioh,333*ratiow,806*ratioh,343*ratiow,801*ratioh,345*ratiow,799*ratioh,344*ratiow,796*ratioh,353*ratiow,792*ratioh,378*ratiow,786*ratioh,410*ratiow,776*ratioh,442*ratiow,764*ratioh,465*ratiow,752*ratioh,492*ratiow,735*ratioh,508*ratiow,720*ratioh,520*ratiow,698*ratioh,529*ratiow,672*ratioh,539*ratiow,627*ratioh,543*ratiow,583*ratioh,543*ratiow,549*ratioh,541*ratiow,520*ratioh,536*ratiow,481*ratioh,526*ratiow,438*ratioh,520*ratiow,416*ratioh,508*ratiow,378*ratioh,496*ratiow,344*ratioh,484*ratiow,321*ratioh,470*ratiow,296*ratioh,451*ratiow,272*ratioh,429*ratiow,252*ratioh,402*ratiow,232*ratioh,362*ratiow,214*ratioh,335*ratiow,202*ratioh,303*ratiow,191*ratioh,275*ratiow,183*ratioh,258*ratiow,180*ratioh,233*ratiow,180*ratioh,219*ratiow,182*ratioh,202*ratiow,190*ratioh,194*ratiow,196*ratioh,185*ratiow,212*ratioh,192*ratiow,230*ratioh,195*ratiow,247*ratioh,192*ratiow,270*ratioh,187*ratiow,286*ratioh,172*ratiow,300*ratioh,158*ratiow,307*ratioh,136*ratiow,309*ratioh,102*ratiow,310*ratioh,72*ratiow,307*ratioh,55*ratiow,302*ratioh,41*ratiow,291*ratioh,31*ratiow,280*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(113*ratiow,763*ratioh,120*ratiow,767*ratioh,133*ratiow,769*ratioh,153*ratiow,768*ratioh,183*ratiow,760*ratioh,217*ratiow,744*ratioh,236*ratiow,730*ratioh,253*ratiow,712*ratioh,277*ratiow,680*ratioh,289*ratiow,656*ratioh,290*ratiow,647*ratioh,286*ratiow,643*ratioh,272*ratiow,639*ratioh,253*ratiow,635*ratioh,236*ratiow,638*ratioh,207*ratiow,663*ratioh,179*ratiow,683*ratioh,153*ratiow,704*ratioh,136*ratiow,717*ratioh,128*ratiow,727*ratioh,120*ratiow,739*ratioh,115*ratiow,749*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(1*ratiow,444*ratioh,18*ratiow,445*ratioh,24*ratiow,446*ratioh,29*ratiow,448*ratioh,39*ratiow,457*ratioh,50*ratiow,467*ratioh,56*ratiow,475*ratioh,59*ratiow,488*ratioh,54*ratiow,508*ratioh,47*ratiow,523*ratioh,42*ratiow,524*ratioh,32*ratiow,528*ratioh,23*ratiow,534*ratioh,17*ratiow,541*ratioh,13*ratiow,551*ratioh,13*ratiow,559*ratioh,15*ratiow,566*ratioh,16*ratiow,569*ratioh,11*ratiow,570*ratioh,8*ratiow,564*ratioh,4*ratiow,559*ratioh,2*ratiow,565*ratioh,1*ratiow,568*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile77(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 677;
var baseHeight = 856;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, PAG";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(454*ratiow,286*ratioh,456*ratiow,297*ratioh,456*ratiow,304*ratioh,452*ratiow,310*ratioh,431*ratiow,321*ratioh,391*ratiow,338*ratioh,368*ratiow,349*ratioh,343*ratiow,357*ratioh,329*ratiow,362*ratioh,322*ratiow,368*ratioh,316*ratiow,380*ratioh,308*ratiow,397*ratioh,303*ratiow,420*ratioh,300*ratiow,450*ratioh,303*ratiow,505*ratioh,305*ratiow,527*ratioh,304*ratiow,537*ratioh,309*ratiow,553*ratioh,322*ratiow,571*ratioh,337*ratiow,589*ratioh,349*ratiow,604*ratioh,370*ratiow,641*ratioh,398*ratiow,689*ratioh,407*ratiow,703*ratioh,414*ratiow,710*ratioh,418*ratiow,712*ratioh,416*ratiow,716*ratioh,418*ratiow,721*ratioh,425*ratiow,720*ratioh,428*ratiow,726*ratioh,437*ratiow,745*ratioh,440*ratiow,756*ratioh,438*ratiow,764*ratioh,432*ratiow,769*ratioh,424*ratiow,771*ratioh,416*ratiow,768*ratioh,400*ratiow,749*ratioh,390*ratiow,733*ratioh,382*ratiow,723*ratioh,372*ratiow,716*ratioh,358*ratiow,708*ratioh,305*ratiow,685*ratioh,302*ratiow,688*ratioh,294*ratiow,693*ratioh,281*ratiow,699*ratioh,269*ratiow,701*ratioh,261*ratiow,701*ratioh,268*ratiow,708*ratioh,275*ratiow,720*ratioh,278*ratiow,729*ratioh,277*ratiow,735*ratioh,316*ratiow,745*ratioh,346*ratiow,757*ratioh,373*ratiow,770*ratioh,388*ratiow,782*ratioh,394*ratiow,790*ratioh,393*ratiow,796*ratioh,391*ratiow,804*ratioh,386*ratiow,808*ratioh,379*ratiow,812*ratioh,370*ratiow,814*ratioh,365*ratiow,815*ratioh,365*ratiow,807*ratioh,359*ratiow,799*ratioh,351*ratiow,792*ratioh,344*ratiow,788*ratioh,345*ratiow,785*ratioh,335*ratiow,778*ratioh,294*ratiow,765*ratioh,249*ratiow,748*ratioh,210*ratiow,731*ratioh,189*ratiow,718*ratioh,172*ratiow,704*ratioh,155*ratiow,677*ratioh,138*ratiow,634*ratioh,133*ratiow,598*ratioh,131*ratiow,557*ratioh,131*ratiow,505*ratioh,137*ratiow,464*ratioh,146*ratiow,424*ratioh,150*ratiow,409*ratioh,160*ratiow,372*ratioh,174*ratiow,335*ratioh,187*ratiow,309*ratioh,204*ratiow,283*ratioh,222*ratiow,261*ratioh,242*ratiow,244*ratioh,275*ratiow,219*ratioh,301*ratiow,204*ratioh,329*ratiow,191*ratioh,363*ratiow,177*ratioh,390*ratiow,171*ratioh,405*ratiow,169*ratioh,441*ratiow,172*ratioh,465*ratiow,182*ratioh,474*ratiow,189*ratioh,483*ratiow,205*ratioh,494*ratiow,227*ratioh,474*ratiow,191*ratioh,476*ratiow,210*ratioh,473*ratiow,226*ratioh,465*ratiow,239*ratioh,455*ratiow,245*ratioh,457*ratiow,258*ratioh,457*ratiow,277*ratioh,456*ratiow,284*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(572*ratiow,764*ratioh,567*ratiow,760*ratioh,562*ratiow,759*ratioh,553*ratiow,761*ratioh,541*ratiow,763*ratioh,530*ratiow,763*ratioh,500*ratiow,755*ratioh,475*ratiow,743*ratioh,452*ratiow,727*ratioh,422*ratiow,699*ratioh,405*ratiow,675*ratioh,395*ratiow,659*ratioh,391*ratiow,644*ratioh,391*ratiow,636*ratioh,413*ratiow,624*ratioh,429*ratiow,621*ratioh,438*ratiow,621*ratioh,442*ratiow,626*ratioh,453*ratiow,635*ratioh,467*ratiow,646*ratioh,479*ratiow,657*ratioh,509*ratiow,683*ratioh,529*ratiow,702*ratioh,540*ratiow,709*ratioh,545*ratiow,708*ratioh,558*ratiow,724*ratioh,566*ratiow,737*ratioh,569*ratiow,749*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(676*ratiow,451*ratioh,671*ratiow,449*ratioh,668*ratiow,446*ratioh,666*ratiow,439*ratioh,662*ratiow,439*ratioh,649*ratiow,445*ratioh,637*ratiow,454*ratioh,627*ratiow,471*ratioh,619*ratiow,489*ratioh,620*ratiow,503*ratioh,625*ratiow,517*ratioh,630*ratiow,525*ratioh,639*ratiow,522*ratioh,651*ratiow,523*ratioh,659*ratiow,527*ratioh,665*ratiow,534*ratioh,668*ratiow,544*ratioh,668*ratiow,556*ratioh,659*ratiow,578*ratioh,653*ratiow,589*ratioh,649*ratiow,593*ratioh,650*ratiow,604*ratioh,654*ratiow,621*ratioh,661*ratiow,631*ratioh,666*ratiow,617*ratioh,674*ratiow,600*ratioh,668*ratiow,598*ratioh,667*ratiow,593*ratioh,666*ratiow,582*ratioh,668*ratiow,570*ratioh,670*ratiow,563*ratioh,672*ratiow,561*ratioh,674*ratiow,575*ratioh,676*ratiow,595*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(223*ratiow,286*ratioh,221*ratiow,297*ratioh,221*ratiow,304*ratioh,225*ratiow,310*ratioh,246*ratiow,321*ratioh,286*ratiow,338*ratioh,309*ratiow,349*ratioh,334*ratiow,357*ratioh,348*ratiow,362*ratioh,355*ratiow,368*ratioh,361*ratiow,380*ratioh,369*ratiow,397*ratioh,374*ratiow,420*ratioh,377*ratiow,450*ratioh,374*ratiow,505*ratioh,372*ratiow,527*ratioh,373*ratiow,537*ratioh,368*ratiow,553*ratioh,355*ratiow,571*ratioh,340*ratiow,589*ratioh,328*ratiow,604*ratioh,307*ratiow,641*ratioh,279*ratiow,689*ratioh,270*ratiow,703*ratioh,263*ratiow,710*ratioh,259*ratiow,712*ratioh,261*ratiow,716*ratioh,259*ratiow,721*ratioh,252*ratiow,720*ratioh,249*ratiow,726*ratioh,240*ratiow,745*ratioh,237*ratiow,756*ratioh,239*ratiow,764*ratioh,245*ratiow,769*ratioh,253*ratiow,771*ratioh,261*ratiow,768*ratioh,277*ratiow,749*ratioh,287*ratiow,733*ratioh,295*ratiow,723*ratioh,305*ratiow,716*ratioh,319*ratiow,708*ratioh,372*ratiow,685*ratioh,375*ratiow,688*ratioh,383*ratiow,693*ratioh,396*ratiow,699*ratioh,408*ratiow,701*ratioh,416*ratiow,701*ratioh,409*ratiow,708*ratioh,402*ratiow,720*ratioh,399*ratiow,729*ratioh,400*ratiow,735*ratioh,361*ratiow,745*ratioh,331*ratiow,757*ratioh,304*ratiow,770*ratioh,289*ratiow,782*ratioh,283*ratiow,790*ratioh,284*ratiow,796*ratioh,286*ratiow,804*ratioh,291*ratiow,808*ratioh,298*ratiow,812*ratioh,307*ratiow,814*ratioh,312*ratiow,815*ratioh,312*ratiow,807*ratioh,318*ratiow,799*ratioh,326*ratiow,792*ratioh,333*ratiow,788*ratioh,332*ratiow,785*ratioh,342*ratiow,778*ratioh,383*ratiow,765*ratioh,428*ratiow,748*ratioh,467*ratiow,731*ratioh,488*ratiow,718*ratioh,505*ratiow,704*ratioh,522*ratiow,677*ratioh,539*ratiow,634*ratioh,544*ratiow,598*ratioh,546*ratiow,557*ratioh,546*ratiow,505*ratioh,540*ratiow,464*ratioh,531*ratiow,424*ratioh,527*ratiow,409*ratioh,517*ratiow,372*ratioh,503*ratiow,335*ratioh,490*ratiow,309*ratioh,473*ratiow,283*ratioh,455*ratiow,261*ratioh,435*ratiow,244*ratioh,402*ratiow,219*ratioh,376*ratiow,204*ratioh,348*ratiow,191*ratioh,314*ratiow,177*ratioh,287*ratiow,171*ratioh,272*ratiow,169*ratioh,236*ratiow,172*ratioh,212*ratiow,182*ratioh,203*ratiow,189*ratioh,194*ratiow,205*ratioh,183*ratiow,227*ratioh,203*ratiow,191*ratioh,201*ratiow,210*ratioh,204*ratiow,226*ratioh,212*ratiow,239*ratioh,222*ratiow,245*ratioh,220*ratiow,258*ratioh,220*ratiow,277*ratioh,221*ratiow,284*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(105*ratiow,764*ratioh,110*ratiow,760*ratioh,115*ratiow,759*ratioh,124*ratiow,761*ratioh,136*ratiow,763*ratioh,147*ratiow,763*ratioh,177*ratiow,755*ratioh,202*ratiow,743*ratioh,225*ratiow,727*ratioh,255*ratiow,699*ratioh,272*ratiow,675*ratioh,282*ratiow,659*ratioh,286*ratiow,644*ratioh,286*ratiow,636*ratioh,264*ratiow,624*ratioh,248*ratiow,621*ratioh,239*ratiow,621*ratioh,235*ratiow,626*ratioh,224*ratiow,635*ratioh,210*ratiow,646*ratioh,198*ratiow,657*ratioh,168*ratiow,683*ratioh,148*ratiow,702*ratioh,137*ratiow,709*ratioh,132*ratiow,708*ratioh,119*ratiow,724*ratioh,111*ratiow,737*ratioh,108*ratiow,749*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(1*ratiow,451*ratioh,6*ratiow,449*ratioh,9*ratiow,446*ratioh,11*ratiow,439*ratioh,15*ratiow,439*ratioh,28*ratiow,445*ratioh,40*ratiow,454*ratioh,50*ratiow,471*ratioh,58*ratiow,489*ratioh,57*ratiow,503*ratioh,52*ratiow,517*ratioh,47*ratiow,525*ratioh,38*ratiow,522*ratioh,26*ratiow,523*ratioh,18*ratiow,527*ratioh,12*ratiow,534*ratioh,9*ratiow,544*ratioh,9*ratiow,556*ratioh,18*ratiow,578*ratioh,24*ratiow,589*ratioh,28*ratiow,593*ratioh,27*ratiow,604*ratioh,23*ratiow,621*ratioh,16*ratiow,631*ratioh,11*ratiow,617*ratioh,3*ratiow,600*ratioh,9*ratiow,598*ratioh,10*ratiow,593*ratioh,11*ratiow,582*ratioh,9*ratiow,570*ratioh,7*ratiow,563*ratioh,5*ratiow,561*ratioh,3*ratiow,575*ratioh,1*ratiow,595*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile78(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 686;
var baseHeight = 853;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, PAG";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(463*ratiow,292*ratioh,463*ratiow,296*ratioh,465*ratiow,302*ratioh,460*ratiow,312*ratioh,445*ratiow,326*ratioh,407*ratiow,347*ratioh,364*ratiow,372*ratioh,349*ratiow,381*ratioh,341*ratiow,387*ratioh,333*ratiow,400*ratioh,323*ratiow,451*ratioh,319*ratiow,472*ratioh,317*ratiow,496*ratioh,318*ratiow,518*ratioh,329*ratiow,549*ratioh,344*ratiow,576*ratioh,362*ratiow,597*ratioh,383*ratiow,617*ratioh,392*ratiow,628*ratioh,410*ratiow,655*ratioh,418*ratiow,663*ratioh,424*ratiow,672*ratioh,427*ratiow,679*ratioh,434*ratiow,685*ratioh,436*ratiow,693*ratioh,448*ratiow,708*ratioh,458*ratiow,723*ratioh,462*ratiow,739*ratioh,459*ratiow,750*ratioh,451*ratiow,759*ratioh,444*ratiow,758*ratioh,430*ratiow,745*ratioh,414*ratiow,725*ratioh,395*ratiow,710*ratioh,366*ratiow,694*ratioh,308*ratiow,672*ratioh,298*ratiow,670*ratioh,295*ratiow,674*ratioh,287*ratiow,681*ratioh,277*ratiow,685*ratioh,266*ratiow,686*ratioh,255*ratiow,685*ratioh,261*ratiow,692*ratioh,265*ratiow,702*ratioh,266*ratiow,712*ratioh,264*ratiow,717*ratioh,259*ratiow,722*ratioh,248*ratiow,725*ratioh,237*ratiow,728*ratioh,217*ratiow,716*ratioh,196*ratiow,701*ratioh,177*ratiow,682*ratioh,160*ratiow,652*ratioh,150*ratiow,618*ratioh,144*ratiow,538*ratioh,143*ratiow,488*ratioh,146*ratiow,457*ratioh,163*ratiow,394*ratioh,175*ratiow,360*ratioh,192*ratiow,321*ratioh,206*ratiow,297*ratioh,226*ratiow,272*ratioh,247*ratiow,250*ratioh,262*ratiow,238*ratioh,282*ratiow,225*ratioh,311*ratiow,209*ratioh,341*ratiow,195*ratioh,372*ratiow,184*ratioh,401*ratiow,180*ratioh,429*ratiow,180*ratioh,450*ratiow,184*ratioh,465*ratiow,191*ratioh,483*ratiow,206*ratioh,505*ratiow,234*ratioh,520*ratiow,245*ratioh,539*ratiow,251*ratioh,568*ratiow,258*ratioh,605*ratiow,262*ratioh,620*ratiow,269*ratioh,631*ratiow,282*ratioh,633*ratiow,287*ratioh,635*ratiow,295*ratioh,610*ratiow,297*ratioh,556*ratiow,302*ratioh,524*ratiow,305*ratioh,516*ratiow,306*ratioh,508*ratiow,303*ratioh,478*ratiow,296*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(588*ratiow,745*ratioh,567*ratiow,748*ratioh,548*ratiow,748*ratioh,524*ratiow,739*ratioh,495*ratiow,729*ratioh,474*ratiow,718*ratioh,453*ratiow,697*ratioh,437*ratiow,675*ratioh,424*ratiow,646*ratioh,422*ratiow,638*ratioh,429*ratiow,624*ratioh,436*ratiow,617*ratioh,444*ratiow,613*ratioh,454*ratiow,612*ratioh,470*ratiow,624*ratioh,491*ratiow,642*ratioh,505*ratiow,658*ratioh,522*ratiow,673*ratioh,535*ratiow,680*ratioh,538*ratiow,682*ratioh,545*ratiow,682*ratioh,555*ratiow,688*ratioh,569*ratiow,701*ratioh,578*ratiow,715*ratioh,585*ratiow,730*ratioh,588*ratiow,745*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(676*ratiow,405*ratioh,658*ratiow,407*ratioh,638*ratiow,415*ratioh,624*ratiow,425*ratioh,620*ratiow,432*ratioh,620*ratiow,437*ratioh,627*ratiow,438*ratioh,635*ratiow,443*ratioh,638*ratiow,449*ratioh,637*ratiow,456*ratioh,627*ratiow,463*ratioh,619*ratiow,469*ratioh,614*ratiow,473*ratioh,614*ratiow,489*ratioh,617*ratiow,494*ratioh,631*ratiow,503*ratioh,637*ratiow,508*ratioh,642*ratiow,506*ratioh,650*ratiow,503*ratioh,658*ratiow,502*ratioh,665*ratiow,506*ratioh,670*ratiow,510*ratioh,674*ratiow,516*ratioh,672*ratiow,528*ratioh,675*ratiow,542*ratioh,679*ratiow,526*ratioh,683*ratiow,524*ratioh,684*ratiow,570*ratioh,685*ratiow,570*ratioh,685*ratiow,452*ratioh,681*ratiow,449*ratioh,677*ratiow,441*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(223*ratiow,292*ratioh,223*ratiow,296*ratioh,221*ratiow,302*ratioh,226*ratiow,312*ratioh,241*ratiow,326*ratioh,279*ratiow,347*ratioh,322*ratiow,372*ratioh,337*ratiow,381*ratioh,345*ratiow,387*ratioh,353*ratiow,400*ratioh,363*ratiow,451*ratioh,367*ratiow,472*ratioh,369*ratiow,496*ratioh,368*ratiow,518*ratioh,357*ratiow,549*ratioh,342*ratiow,576*ratioh,324*ratiow,597*ratioh,303*ratiow,617*ratioh,294*ratiow,628*ratioh,276*ratiow,655*ratioh,268*ratiow,663*ratioh,262*ratiow,672*ratioh,259*ratiow,679*ratioh,252*ratiow,685*ratioh,250*ratiow,693*ratioh,238*ratiow,708*ratioh,228*ratiow,723*ratioh,224*ratiow,739*ratioh,227*ratiow,750*ratioh,235*ratiow,759*ratioh,242*ratiow,758*ratioh,256*ratiow,745*ratioh,272*ratiow,725*ratioh,291*ratiow,710*ratioh,320*ratiow,694*ratioh,378*ratiow,672*ratioh,388*ratiow,670*ratioh,391*ratiow,674*ratioh,399*ratiow,681*ratioh,409*ratiow,685*ratioh,420*ratiow,686*ratioh,431*ratiow,685*ratioh,425*ratiow,692*ratioh,421*ratiow,702*ratioh,420*ratiow,712*ratioh,422*ratiow,717*ratioh,427*ratiow,722*ratioh,438*ratiow,725*ratioh,449*ratiow,728*ratioh,469*ratiow,716*ratioh,490*ratiow,701*ratioh,509*ratiow,682*ratioh,526*ratiow,652*ratioh,536*ratiow,618*ratioh,542*ratiow,538*ratioh,543*ratiow,488*ratioh,540*ratiow,457*ratioh,523*ratiow,394*ratioh,511*ratiow,360*ratioh,494*ratiow,321*ratioh,480*ratiow,297*ratioh,460*ratiow,272*ratioh,439*ratiow,250*ratioh,424*ratiow,238*ratioh,404*ratiow,225*ratioh,375*ratiow,209*ratioh,345*ratiow,195*ratioh,314*ratiow,184*ratioh,285*ratiow,180*ratioh,257*ratiow,180*ratioh,236*ratiow,184*ratioh,221*ratiow,191*ratioh,203*ratiow,206*ratioh,181*ratiow,234*ratioh,166*ratiow,245*ratioh,147*ratiow,251*ratioh,118*ratiow,258*ratioh,81*ratiow,262*ratioh,66*ratiow,269*ratioh,55*ratiow,282*ratioh,53*ratiow,287*ratioh,51*ratiow,295*ratioh,76*ratiow,297*ratioh,130*ratiow,302*ratioh,162*ratiow,305*ratioh,170*ratiow,306*ratioh,178*ratiow,303*ratioh,208*ratiow,296*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(98*ratiow,745*ratioh,119*ratiow,748*ratioh,138*ratiow,748*ratioh,162*ratiow,739*ratioh,191*ratiow,729*ratioh,212*ratiow,718*ratioh,233*ratiow,697*ratioh,249*ratiow,675*ratioh,262*ratiow,646*ratioh,264*ratiow,638*ratioh,257*ratiow,624*ratioh,250*ratiow,617*ratioh,242*ratiow,613*ratioh,232*ratiow,612*ratioh,216*ratiow,624*ratioh,195*ratiow,642*ratioh,181*ratiow,658*ratioh,164*ratiow,673*ratioh,151*ratiow,680*ratioh,148*ratiow,682*ratioh,141*ratiow,682*ratioh,131*ratiow,688*ratioh,117*ratiow,701*ratioh,108*ratiow,715*ratioh,101*ratiow,730*ratioh,98*ratiow,745*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(10*ratiow,405*ratioh,28*ratiow,407*ratioh,48*ratiow,415*ratioh,62*ratiow,425*ratioh,66*ratiow,432*ratioh,66*ratiow,437*ratioh,59*ratiow,438*ratioh,51*ratiow,443*ratioh,48*ratiow,449*ratioh,49*ratiow,456*ratioh,59*ratiow,463*ratioh,67*ratiow,469*ratioh,72*ratiow,473*ratioh,72*ratiow,489*ratioh,69*ratiow,494*ratioh,55*ratiow,503*ratioh,49*ratiow,508*ratioh,44*ratiow,506*ratioh,36*ratiow,503*ratioh,28*ratiow,502*ratioh,21*ratiow,506*ratioh,16*ratiow,510*ratioh,12*ratiow,516*ratioh,14*ratiow,528*ratioh,11*ratiow,542*ratioh,7*ratiow,526*ratioh,3*ratiow,524*ratioh,2*ratiow,570*ratioh,1*ratiow,570*ratioh,1*ratiow,452*ratioh,5*ratiow,449*ratioh,9*ratiow,441*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile79(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 687;
var baseHeight = 828;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, PAG";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(444*ratiow,283*ratioh,446*ratiow,288*ratioh,444*ratiow,298*ratioh,433*ratiow,315*ratioh,411*ratiow,336*ratioh,391*ratiow,347*ratioh,370*ratiow,362*ratioh,343*ratiow,389*ratioh,329*ratiow,411*ratioh,322*ratiow,431*ratioh,327*ratiow,415*ratioh,320*ratiow,419*ratioh,317*ratiow,417*ratioh,314*ratiow,411*ratioh,313*ratiow,407*ratioh,308*ratiow,423*ratioh,304*ratiow,461*ratioh,307*ratiow,508*ratioh,316*ratiow,544*ratioh,328*ratiow,565*ratioh,345*ratiow,587*ratioh,371*ratiow,616*ratioh,375*ratiow,621*ratioh,378*ratiow,630*ratioh,381*ratiow,641*ratioh,390*ratiow,648*ratioh,394*ratiow,649*ratioh,411*ratiow,671*ratioh,407*ratiow,674*ratioh,406*ratiow,679*ratioh,408*ratiow,683*ratioh,410*ratiow,685*ratioh,415*ratiow,683*ratioh,418*ratiow,690*ratioh,426*ratiow,705*ratioh,436*ratiow,716*ratioh,444*ratiow,723*ratioh,443*ratiow,737*ratioh,439*ratiow,744*ratioh,428*ratiow,749*ratioh,420*ratiow,749*ratioh,409*ratiow,735*ratioh,394*ratiow,717*ratioh,380*ratiow,703*ratioh,368*ratiow,696*ratioh,337*ratiow,686*ratioh,305*ratiow,674*ratioh,276*ratiow,660*ratioh,255*ratiow,646*ratioh,246*ratiow,638*ratioh,239*ratiow,638*ratioh,226*ratiow,635*ratioh,213*ratiow,629*ratioh,203*ratiow,622*ratioh,194*ratiow,610*ratioh,195*ratiow,625*ratioh,192*ratiow,640*ratioh,184*ratiow,653*ratioh,181*ratiow,654*ratioh,177*ratiow,652*ratioh,161*ratiow,648*ratioh,153*ratiow,645*ratioh,144*ratiow,624*ratioh,136*ratiow,583*ratioh,133*ratiow,546*ratioh,130*ratiow,506*ratioh,130*ratiow,475*ratioh,132*ratiow,454*ratioh,138*ratiow,424*ratioh,141*ratiow,411*ratioh,151*ratiow,379*ratioh,167*ratiow,343*ratioh,181*ratiow,318*ratioh,199*ratiow,287*ratioh,213*ratiow,268*ratioh,232*ratiow,248*ratioh,251*ratiow,232*ratioh,274*ratiow,216*ratioh,306*ratiow,200*ratioh,318*ratiow,196*ratioh,355*ratiow,182*ratioh,386*ratiow,176*ratioh,407*ratiow,176*ratioh,436*ratiow,180*ratioh,449*ratiow,186*ratioh,439*ratiow,183*ratioh,442*ratiow,197*ratioh,442*ratiow,214*ratioh,434*ratiow,231*ratioh,433*ratiow,233*ratioh,418*ratiow,249*ratioh,426*ratiow,253*ratioh,436*ratiow,261*ratioh,444*ratiow,270*ratioh,447*ratiow,279*ratioh,447*ratiow,283*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(617*ratiow,739*ratioh,611*ratiow,744*ratioh,585*ratiow,744*ratioh,563*ratiow,744*ratioh,522*ratiow,733*ratioh,477*ratiow,717*ratioh,452*ratiow,705*ratioh,433*ratiow,681*ratioh,410*ratiow,646*ratioh,406*ratiow,633*ratioh,407*ratiow,619*ratioh,440*ratiow,602*ratioh,451*ratiow,598*ratioh,458*ratiow,609*ratioh,477*ratiow,623*ratioh,494*ratiow,633*ratioh,510*ratiow,639*ratioh,521*ratiow,643*ratioh,527*ratiow,649*ratioh,530*ratiow,659*ratioh,541*ratiow,671*ratioh,559*ratiow,685*ratioh,570*ratiow,696*ratioh,602*ratiow,728*ratioh,612*ratiow,736*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(678*ratiow,397*ratioh,649*ratiow,401*ratioh,630*ratiow,405*ratioh,626*ratiow,409*ratioh,614*ratiow,427*ratioh,606*ratiow,451*ratioh,626*ratiow,462*ratioh,626*ratiow,484*ratioh,628*ratiow,491*ratioh,632*ratiow,499*ratioh,638*ratiow,508*ratioh,649*ratiow,506*ratioh,659*ratiow,508*ratioh,666*ratiow,511*ratioh,672*ratiow,516*ratioh,676*ratiow,521*ratioh,678*ratiow,530*ratioh,676*ratiow,534*ratioh,682*ratiow,540*ratioh,684*ratiow,529*ratioh,686*ratiow,530*ratioh,686*ratiow,440*ratioh,681*ratiow,436*ratioh,677*ratiow,426*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(243*ratiow,283*ratioh,241*ratiow,288*ratioh,243*ratiow,298*ratioh,254*ratiow,315*ratioh,276*ratiow,336*ratioh,296*ratiow,347*ratioh,317*ratiow,362*ratioh,344*ratiow,389*ratioh,358*ratiow,411*ratioh,365*ratiow,431*ratioh,360*ratiow,415*ratioh,367*ratiow,419*ratioh,370*ratiow,417*ratioh,373*ratiow,411*ratioh,374*ratiow,407*ratioh,379*ratiow,423*ratioh,383*ratiow,461*ratioh,380*ratiow,508*ratioh,371*ratiow,544*ratioh,359*ratiow,565*ratioh,342*ratiow,587*ratioh,316*ratiow,616*ratioh,312*ratiow,621*ratioh,309*ratiow,630*ratioh,306*ratiow,641*ratioh,297*ratiow,648*ratioh,293*ratiow,649*ratioh,276*ratiow,671*ratioh,280*ratiow,674*ratioh,281*ratiow,679*ratioh,279*ratiow,683*ratioh,277*ratiow,685*ratioh,272*ratiow,683*ratioh,269*ratiow,690*ratioh,261*ratiow,705*ratioh,251*ratiow,716*ratioh,243*ratiow,723*ratioh,244*ratiow,737*ratioh,248*ratiow,744*ratioh,259*ratiow,749*ratioh,267*ratiow,749*ratioh,278*ratiow,735*ratioh,293*ratiow,717*ratioh,307*ratiow,703*ratioh,319*ratiow,696*ratioh,350*ratiow,686*ratioh,382*ratiow,674*ratioh,411*ratiow,660*ratioh,432*ratiow,646*ratioh,441*ratiow,638*ratioh,448*ratiow,638*ratioh,461*ratiow,635*ratioh,474*ratiow,629*ratioh,484*ratiow,622*ratioh,493*ratiow,610*ratioh,492*ratiow,625*ratioh,495*ratiow,640*ratioh,503*ratiow,653*ratioh,506*ratiow,654*ratioh,510*ratiow,652*ratioh,526*ratiow,648*ratioh,534*ratiow,645*ratioh,543*ratiow,624*ratioh,551*ratiow,583*ratioh,554*ratiow,546*ratioh,557*ratiow,506*ratioh,557*ratiow,475*ratioh,555*ratiow,454*ratioh,549*ratiow,424*ratioh,546*ratiow,411*ratioh,536*ratiow,379*ratioh,520*ratiow,343*ratioh,506*ratiow,318*ratioh,488*ratiow,287*ratioh,474*ratiow,268*ratioh,455*ratiow,248*ratioh,436*ratiow,232*ratioh,413*ratiow,216*ratioh,381*ratiow,200*ratioh,369*ratiow,196*ratioh,332*ratiow,182*ratioh,301*ratiow,176*ratioh,280*ratiow,176*ratioh,251*ratiow,180*ratioh,238*ratiow,186*ratioh,248*ratiow,183*ratioh,245*ratiow,197*ratioh,245*ratiow,214*ratioh,253*ratiow,231*ratioh,254*ratiow,233*ratioh,269*ratiow,249*ratioh,261*ratiow,253*ratioh,251*ratiow,261*ratioh,243*ratiow,270*ratioh,240*ratiow,279*ratioh,240*ratiow,283*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(70*ratiow,739*ratioh,76*ratiow,744*ratioh,102*ratiow,744*ratioh,124*ratiow,744*ratioh,165*ratiow,733*ratioh,210*ratiow,717*ratioh,235*ratiow,705*ratioh,254*ratiow,681*ratioh,277*ratiow,646*ratioh,281*ratiow,633*ratioh,280*ratiow,619*ratioh,247*ratiow,602*ratioh,236*ratiow,598*ratioh,229*ratiow,609*ratioh,210*ratiow,623*ratioh,193*ratiow,633*ratioh,177*ratiow,639*ratioh,166*ratiow,643*ratioh,160*ratiow,649*ratioh,157*ratiow,659*ratioh,146*ratiow,671*ratioh,128*ratiow,685*ratioh,117*ratiow,696*ratioh,85*ratiow,728*ratioh,75*ratiow,736*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(9*ratiow,397*ratioh,38*ratiow,401*ratioh,57*ratiow,405*ratioh,61*ratiow,409*ratioh,73*ratiow,427*ratioh,81*ratiow,451*ratioh,61*ratiow,462*ratioh,61*ratiow,484*ratioh,59*ratiow,491*ratioh,55*ratiow,499*ratioh,49*ratiow,508*ratioh,38*ratiow,506*ratioh,28*ratiow,508*ratioh,21*ratiow,511*ratioh,15*ratiow,516*ratioh,11*ratiow,521*ratioh,9*ratiow,530*ratioh,11*ratiow,534*ratioh,5*ratiow,540*ratioh,3*ratiow,529*ratioh,1*ratiow,530*ratioh,1*ratiow,440*ratioh,6*ratiow,436*ratioh,10*ratiow,426*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile80(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 695;
var baseHeight = 819;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, PAG";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(439*ratiow,288*ratioh,443*ratiow,294*ratioh,444*ratiow,307*ratioh,437*ratiow,325*ratioh,428*ratiow,336*ratioh,412*ratiow,346*ratioh,371*ratiow,383*ratioh,343*ratiow,411*ratioh,328*ratiow,433*ratioh,320*ratiow,453*ratioh,316*ratiow,469*ratioh,310*ratiow,477*ratioh,305*ratiow,477*ratioh,304*ratiow,474*ratioh,304*ratiow,512*ratioh,311*ratiow,507*ratioh,320*ratiow,511*ratioh,342*ratiow,544*ratioh,356*ratiow,571*ratioh,371*ratiow,591*ratioh,379*ratiow,606*ratioh,392*ratiow,615*ratioh,400*ratiow,627*ratioh,418*ratiow,655*ratioh,435*ratiow,679*ratioh,451*ratiow,698*ratioh,454*ratiow,709*ratioh,456*ratiow,723*ratioh,450*ratiow,735*ratioh,443*ratiow,746*ratioh,438*ratiow,750*ratioh,427*ratiow,735*ratioh,413*ratiow,719*ratioh,396*ratiow,705*ratioh,373*ratiow,691*ratioh,344*ratiow,681*ratioh,313*ratiow,672*ratioh,291*ratiow,662*ratioh,264*ratiow,646*ratioh,252*ratiow,637*ratioh,245*ratiow,640*ratioh,227*ratiow,636*ratioh,206*ratiow,624*ratioh,201*ratiow,619*ratioh,207*ratiow,637*ratioh,213*ratiow,654*ratioh,215*ratiow,665*ratioh,214*ratiow,675*ratioh,207*ratiow,676*ratioh,202*ratiow,675*ratioh,185*ratiow,666*ratioh,164*ratiow,654*ratioh,158*ratiow,647*ratioh,149*ratiow,624*ratioh,142*ratiow,601*ratioh,136*ratiow,569*ratioh,134*ratiow,550*ratioh,131*ratiow,509*ratioh,133*ratiow,468*ratioh,137*ratiow,441*ratioh,145*ratiow,412*ratioh,154*ratiow,388*ratioh,178*ratiow,333*ratioh,193*ratiow,305*ratioh,213*ratiow,274*ratioh,236*ratiow,250*ratioh,259*ratiow,233*ratioh,300*ratiow,211*ratioh,334*ratiow,198*ratioh,358*ratiow,191*ratioh,385*ratiow,188*ratioh,420*ratiow,188*ratioh,418*ratiow,191*ratioh,424*ratiow,211*ratioh,425*ratiow,230*ratioh,424*ratiow,237*ratioh,421*ratiow,246*ratioh,412*ratiow,255*ratioh,407*ratiow,257*ratioh,418*ratiow,263*ratioh,431*ratiow,273*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(612*ratiow,741*ratioh,606*ratiow,740*ratioh,595*ratiow,743*ratioh,580*ratiow,743*ratioh,563*ratiow,737*ratioh,531*ratiow,726*ratioh,509*ratiow,720*ratioh,480*ratiow,709*ratioh,467*ratiow,700*ratioh,448*ratiow,674*ratioh,434*ratiow,644*ratioh,439*ratiow,630*ratioh,449*ratiow,618*ratioh,464*ratiow,610*ratioh,471*ratiow,610*ratioh,486*ratiow,617*ratioh,499*ratiow,630*ratioh,513*ratiow,644*ratioh,532*ratiow,663*ratioh,553*ratiow,679*ratioh,569*ratiow,692*ratioh,582*ratiow,704*ratioh,592*ratiow,714*ratioh,602*ratiow,727*ratioh,619*ratiow,731*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(692*ratiow,393*ratioh,669*ratiow,393*ratioh,658*ratiow,395*ratioh,638*ratiow,412*ratioh,624*ratiow,432*ratioh,618*ratiow,444*ratioh,618*ratiow,458*ratioh,634*ratiow,482*ratioh,646*ratiow,499*ratioh,650*ratiow,507*ratioh,662*ratiow,504*ratioh,670*ratiow,504*ratioh,679*ratiow,509*ratioh,686*ratiow,518*ratioh,684*ratiow,529*ratioh,680*ratiow,539*ratioh,677*ratiow,543*ratioh,683*ratiow,552*ratioh,690*ratiow,529*ratioh,694*ratiow,531*ratioh,694*ratiow,443*ratioh,690*ratiow,438*ratioh,685*ratiow,428*ratioh,687*ratiow,417*ratioh,694*ratiow,412*ratioh,694*ratiow,394*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(256*ratiow,288*ratioh,252*ratiow,294*ratioh,251*ratiow,307*ratioh,258*ratiow,325*ratioh,267*ratiow,336*ratioh,283*ratiow,346*ratioh,324*ratiow,383*ratioh,352*ratiow,411*ratioh,367*ratiow,433*ratioh,375*ratiow,453*ratioh,379*ratiow,469*ratioh,385*ratiow,477*ratioh,390*ratiow,477*ratioh,391*ratiow,474*ratioh,391*ratiow,512*ratioh,384*ratiow,507*ratioh,375*ratiow,511*ratioh,353*ratiow,544*ratioh,339*ratiow,571*ratioh,324*ratiow,591*ratioh,316*ratiow,606*ratioh,303*ratiow,615*ratioh,295*ratiow,627*ratioh,277*ratiow,655*ratioh,260*ratiow,679*ratioh,244*ratiow,698*ratioh,241*ratiow,709*ratioh,239*ratiow,723*ratioh,245*ratiow,735*ratioh,252*ratiow,746*ratioh,257*ratiow,750*ratioh,268*ratiow,735*ratioh,282*ratiow,719*ratioh,299*ratiow,705*ratioh,322*ratiow,691*ratioh,351*ratiow,681*ratioh,382*ratiow,672*ratioh,404*ratiow,662*ratioh,431*ratiow,646*ratioh,443*ratiow,637*ratioh,450*ratiow,640*ratioh,468*ratiow,636*ratioh,489*ratiow,624*ratioh,494*ratiow,619*ratioh,488*ratiow,637*ratioh,482*ratiow,654*ratioh,480*ratiow,665*ratioh,481*ratiow,675*ratioh,488*ratiow,676*ratioh,493*ratiow,675*ratioh,510*ratiow,666*ratioh,531*ratiow,654*ratioh,537*ratiow,647*ratioh,546*ratiow,624*ratioh,553*ratiow,601*ratioh,559*ratiow,569*ratioh,561*ratiow,550*ratioh,564*ratiow,509*ratioh,562*ratiow,468*ratioh,558*ratiow,441*ratioh,550*ratiow,412*ratioh,541*ratiow,388*ratioh,517*ratiow,333*ratioh,502*ratiow,305*ratioh,482*ratiow,274*ratioh,459*ratiow,250*ratioh,436*ratiow,233*ratioh,395*ratiow,211*ratioh,361*ratiow,198*ratioh,337*ratiow,191*ratioh,310*ratiow,188*ratioh,275*ratiow,188*ratioh,277*ratiow,191*ratioh,271*ratiow,211*ratioh,270*ratiow,230*ratioh,271*ratiow,237*ratioh,274*ratiow,246*ratioh,283*ratiow,255*ratioh,288*ratiow,257*ratioh,277*ratiow,263*ratioh,264*ratiow,273*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(83*ratiow,741*ratioh,89*ratiow,740*ratioh,100*ratiow,743*ratioh,115*ratiow,743*ratioh,132*ratiow,737*ratioh,164*ratiow,726*ratioh,186*ratiow,720*ratioh,215*ratiow,709*ratioh,228*ratiow,700*ratioh,247*ratiow,674*ratioh,261*ratiow,644*ratioh,256*ratiow,630*ratioh,246*ratiow,618*ratioh,231*ratiow,610*ratioh,224*ratiow,610*ratioh,209*ratiow,617*ratioh,196*ratiow,630*ratioh,182*ratiow,644*ratioh,163*ratiow,663*ratioh,142*ratiow,679*ratioh,126*ratiow,692*ratioh,113*ratiow,704*ratioh,103*ratiow,714*ratioh,93*ratiow,727*ratioh,76*ratiow,731*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(3*ratiow,393*ratioh,26*ratiow,393*ratioh,37*ratiow,395*ratioh,57*ratiow,412*ratioh,71*ratiow,432*ratioh,77*ratiow,444*ratioh,77*ratiow,458*ratioh,61*ratiow,482*ratioh,49*ratiow,499*ratioh,45*ratiow,507*ratioh,33*ratiow,504*ratioh,25*ratiow,504*ratioh,16*ratiow,509*ratioh,9*ratiow,518*ratioh,11*ratiow,529*ratioh,15*ratiow,539*ratioh,18*ratiow,543*ratioh,12*ratiow,552*ratioh,5*ratiow,529*ratioh,1*ratiow,531*ratioh,1*ratiow,443*ratioh,5*ratiow,438*ratioh,10*ratiow,428*ratioh,8*ratiow,417*ratioh,1*ratiow,412*ratioh,1*ratiow,394*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile81(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 688;
var baseHeight = 805;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, PAG";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(413*ratiow,281*ratioh,421*ratiow,290*ratioh,425*ratiow,300*ratioh,425*ratiow,314*ratioh,418*ratiow,327*ratioh,404*ratiow,339*ratioh,396*ratiow,348*ratioh,388*ratiow,356*ratioh,371*ratiow,370*ratioh,351*ratiow,385*ratioh,332*ratiow,402*ratioh,322*ratiow,417*ratioh,315*ratiow,424*ratioh,305*ratiow,449*ratioh,304*ratiow,486*ratioh,311*ratiow,507*ratioh,333*ratiow,541*ratioh,337*ratiow,549*ratioh,345*ratiow,566*ratioh,357*ratiow,582*ratioh,373*ratiow,597*ratioh,392*ratiow,633*ratioh,396*ratiow,643*ratioh,394*ratiow,647*ratioh,395*ratiow,654*ratioh,400*ratiow,659*ratioh,404*ratiow,658*ratioh,411*ratiow,667*ratioh,429*ratiow,693*ratioh,432*ratiow,699*ratioh,431*ratiow,706*ratioh,429*ratiow,716*ratioh,419*ratiow,726*ratioh,412*ratiow,727*ratioh,402*ratiow,722*ratioh,395*ratiow,717*ratioh,379*ratiow,699*ratioh,363*ratiow,685*ratioh,351*ratiow,677*ratioh,332*ratiow,671*ratioh,303*ratiow,660*ratioh,276*ratiow,648*ratioh,262*ratiow,640*ratioh,245*ratiow,624*ratioh,229*ratiow,600*ratioh,220*ratiow,605*ratioh,209*ratiow,605*ratioh,195*ratiow,589*ratioh,193*ratiow,585*ratioh,194*ratiow,597*ratioh,190*ratiow,608*ratioh,183*ratiow,615*ratioh,179*ratiow,617*ratioh,175*ratiow,619*ratioh,166*ratiow,613*ratioh,152*ratiow,605*ratioh,141*ratiow,598*ratioh,137*ratiow,585*ratioh,129*ratiow,536*ratioh,125*ratiow,472*ratioh,127*ratiow,436*ratioh,136*ratiow,403*ratioh,147*ratiow,371*ratioh,165*ratiow,333*ratioh,192*ratiow,289*ratioh,212*ratiow,261*ratioh,227*ratiow,244*ratioh,259*ratiow,219*ratioh,292*ratiow,203*ratioh,329*ratiow,189*ratioh,348*ratiow,184*ratioh,363*ratiow,182*ratioh,389*ratiow,182*ratioh,413*ratiow,185*ratioh,415*ratiow,194*ratioh,417*ratiow,210*ratioh,416*ratiow,222*ratioh,414*ratiow,228*ratioh,412*ratiow,230*ratioh,411*ratiow,235*ratioh,417*ratiow,243*ratioh,404*ratiow,233*ratioh,406*ratiow,240*ratioh,405*ratiow,247*ratioh,399*ratiow,250*ratioh,393*ratiow,252*ratioh,404*ratiow,261*ratioh,410*ratiow,270*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(599*ratiow,725*ratioh,582*ratiow,728*ratioh,558*ratiow,727*ratioh,527*ratiow,719*ratioh,494*ratiow,709*ratioh,468*ratiow,702*ratioh,452*ratiow,693*ratioh,437*ratiow,681*ratioh,423*ratiow,658*ratioh,407*ratiow,627*ratioh,415*ratiow,612*ratioh,426*ratiow,602*ratioh,437*ratiow,599*ratioh,453*ratiow,602*ratioh,471*ratiow,611*ratioh,485*ratiow,620*ratioh,499*ratiow,630*ratioh,514*ratiow,644*ratioh,532*ratiow,660*ratioh,554*ratiow,675*ratioh,572*ratiow,687*ratioh,587*ratiow,699*ratioh,594*ratiow,704*ratioh,597*ratiow,710*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(687*ratiow,380*ratioh,668*ratiow,381*ratioh,651*ratiow,385*ratioh,638*ratiow,390*ratioh,620*ratiow,404*ratioh,605*ratiow,426*ratioh,602*ratiow,440*ratioh,605*ratiow,453*ratioh,614*ratiow,469*ratioh,632*ratiow,491*ratioh,635*ratiow,494*ratioh,642*ratiow,491*ratioh,650*ratiow,490*ratioh,662*ratiow,493*ratioh,670*ratiow,501*ratioh,674*ratiow,511*ratioh,674*ratiow,519*ratioh,672*ratiow,523*ratioh,680*ratiow,532*ratioh,681*ratiow,516*ratioh,683*ratiow,509*ratioh,685*ratiow,510*ratioh,686*ratiow,517*ratioh,685*ratiow,535*ratioh,683*ratiow,550*ratioh,683*ratiow,557*ratioh,687*ratiow,556*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(275*ratiow,281*ratioh,267*ratiow,290*ratioh,263*ratiow,300*ratioh,263*ratiow,314*ratioh,270*ratiow,327*ratioh,284*ratiow,339*ratioh,292*ratiow,348*ratioh,300*ratiow,356*ratioh,317*ratiow,370*ratioh,337*ratiow,385*ratioh,356*ratiow,402*ratioh,366*ratiow,417*ratioh,373*ratiow,424*ratioh,383*ratiow,449*ratioh,384*ratiow,486*ratioh,377*ratiow,507*ratioh,355*ratiow,541*ratioh,351*ratiow,549*ratioh,343*ratiow,566*ratioh,331*ratiow,582*ratioh,315*ratiow,597*ratioh,296*ratiow,633*ratioh,292*ratiow,643*ratioh,294*ratiow,647*ratioh,293*ratiow,654*ratioh,288*ratiow,659*ratioh,284*ratiow,658*ratioh,277*ratiow,667*ratioh,259*ratiow,693*ratioh,256*ratiow,699*ratioh,257*ratiow,706*ratioh,259*ratiow,716*ratioh,269*ratiow,726*ratioh,276*ratiow,727*ratioh,286*ratiow,722*ratioh,293*ratiow,717*ratioh,309*ratiow,699*ratioh,325*ratiow,685*ratioh,337*ratiow,677*ratioh,356*ratiow,671*ratioh,385*ratiow,660*ratioh,412*ratiow,648*ratioh,426*ratiow,640*ratioh,443*ratiow,624*ratioh,459*ratiow,600*ratioh,468*ratiow,605*ratioh,479*ratiow,605*ratioh,493*ratiow,589*ratioh,495*ratiow,585*ratioh,494*ratiow,597*ratioh,498*ratiow,608*ratioh,505*ratiow,615*ratioh,509*ratiow,617*ratioh,513*ratiow,619*ratioh,522*ratiow,613*ratioh,536*ratiow,605*ratioh,547*ratiow,598*ratioh,551*ratiow,585*ratioh,559*ratiow,536*ratioh,563*ratiow,472*ratioh,561*ratiow,436*ratioh,552*ratiow,403*ratioh,541*ratiow,371*ratioh,523*ratiow,333*ratioh,496*ratiow,289*ratioh,476*ratiow,261*ratioh,461*ratiow,244*ratioh,429*ratiow,219*ratioh,396*ratiow,203*ratioh,359*ratiow,189*ratioh,340*ratiow,184*ratioh,325*ratiow,182*ratioh,299*ratiow,182*ratioh,275*ratiow,185*ratioh,273*ratiow,194*ratioh,271*ratiow,210*ratioh,272*ratiow,222*ratioh,274*ratiow,228*ratioh,276*ratiow,230*ratioh,277*ratiow,235*ratioh,271*ratiow,243*ratioh,284*ratiow,233*ratioh,282*ratiow,240*ratioh,283*ratiow,247*ratioh,289*ratiow,250*ratioh,295*ratiow,252*ratioh,284*ratiow,261*ratioh,278*ratiow,270*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(89*ratiow,725*ratioh,106*ratiow,728*ratioh,130*ratiow,727*ratioh,161*ratiow,719*ratioh,194*ratiow,709*ratioh,220*ratiow,702*ratioh,236*ratiow,693*ratioh,251*ratiow,681*ratioh,265*ratiow,658*ratioh,281*ratiow,627*ratioh,273*ratiow,612*ratioh,262*ratiow,602*ratioh,251*ratiow,599*ratioh,235*ratiow,602*ratioh,217*ratiow,611*ratioh,203*ratiow,620*ratioh,189*ratiow,630*ratioh,174*ratiow,644*ratioh,156*ratiow,660*ratioh,134*ratiow,675*ratioh,116*ratiow,687*ratioh,101*ratiow,699*ratioh,94*ratiow,704*ratioh,91*ratiow,710*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(1*ratiow,380*ratioh,20*ratiow,381*ratioh,37*ratiow,385*ratioh,50*ratiow,390*ratioh,68*ratiow,404*ratioh,83*ratiow,426*ratioh,86*ratiow,440*ratioh,83*ratiow,453*ratioh,74*ratiow,469*ratioh,56*ratiow,491*ratioh,53*ratiow,494*ratioh,46*ratiow,491*ratioh,38*ratiow,490*ratioh,26*ratiow,493*ratioh,18*ratiow,501*ratioh,14*ratiow,511*ratioh,14*ratiow,519*ratioh,16*ratiow,523*ratioh,8*ratiow,532*ratioh,7*ratiow,516*ratioh,5*ratiow,509*ratioh,3*ratiow,510*ratioh,2*ratiow,517*ratioh,3*ratiow,535*ratioh,5*ratiow,550*ratioh,5*ratiow,557*ratioh,1*ratiow,556*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile82(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 702;
var baseHeight = 822;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, PAG";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(431*ratiow,296*ratioh,441*ratiow,303*ratioh,445*ratiow,314*ratioh,443*ratiow,325*ratioh,433*ratiow,343*ratioh,412*ratiow,371*ratioh,397*ratiow,389*ratioh,384*ratiow,399*ratioh,373*ratiow,407*ratioh,357*ratiow,418*ratioh,350*ratiow,430*ratioh,337*ratiow,461*ratioh,330*ratiow,481*ratioh,332*ratiow,502*ratioh,342*ratiow,528*ratioh,356*ratiow,548*ratioh,360*ratiow,555*ratioh,367*ratiow,565*ratioh,380*ratiow,580*ratioh,398*ratiow,593*ratioh,416*ratiow,621*ratioh,430*ratiow,646*ratioh,442*ratiow,667*ratioh,458*ratiow,696*ratioh,466*ratiow,713*ratioh,466*ratiow,726*ratioh,463*ratiow,733*ratioh,457*ratiow,737*ratioh,444*ratiow,736*ratioh,432*ratiow,721*ratioh,410*ratiow,704*ratioh,387*ratiow,689*ratioh,365*ratiow,681*ratioh,350*ratiow,677*ratioh,329*ratiow,676*ratioh,306*ratiow,667*ratioh,286*ratiow,654*ratioh,270*ratiow,641*ratioh,254*ratiow,640*ratioh,238*ratiow,635*ratioh,226*ratiow,626*ratioh,221*ratiow,619*ratioh,222*ratiow,627*ratioh,218*ratiow,639*ratioh,211*ratiow,644*ratioh,200*ratiow,645*ratioh,187*ratiow,641*ratioh,170*ratiow,633*ratioh,162*ratiow,627*ratioh,154*ratiow,607*ratioh,148*ratiow,577*ratioh,139*ratiow,516*ratioh,139*ratiow,471*ratioh,143*ratiow,439*ratioh,151*ratiow,408*ratioh,160*ratiow,381*ratioh,169*ratiow,361*ratioh,186*ratiow,330*ratioh,212*ratiow,291*ratioh,240*ratiow,260*ratioh,266*ratiow,239*ratioh,299*ratiow,221*ratioh,331*ratiow,208*ratioh,355*ratiow,201*ratioh,369*ratiow,198*ratioh,375*ratiow,203*ratioh,389*ratiow,210*ratioh,403*ratiow,221*ratioh,410*ratiow,229*ratioh,411*ratiow,235*ratioh,411*ratiow,238*ratioh,407*ratiow,241*ratioh,412*ratiow,245*ratioh,429*ratiow,257*ratioh,442*ratiow,262*ratioh,477*ratiow,263*ratioh,492*ratiow,263*ratioh,525*ratiow,260*ratioh,540*ratiow,258*ratioh,540*ratiow,268*ratioh,518*ratiow,277*ratioh,491*ratiow,288*ratioh,470*ratiow,293*ratioh,449*ratiow,295*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(615*ratiow,757*ratioh,596*ratiow,756*ratioh,570*ratiow,751*ratioh,527*ratiow,738*ratioh,504*ratiow,727*ratioh,486*ratiow,714*ratioh,475*ratiow,702*ratioh,461*ratiow,677*ratioh,445*ratiow,646*ratioh,455*ratiow,633*ratioh,473*ratiow,619*ratioh,485*ratiow,625*ratioh,498*ratiow,635*ratioh,515*ratiow,651*ratioh,535*ratiow,672*ratioh,555*ratiow,689*ratioh,576*ratiow,707*ratioh,591*ratiow,724*ratioh,604*ratiow,741*ratioh,612*ratiow,752*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(701*ratiow,386*ratioh,677*ratiow,389*ratioh,653*ratiow,395*ratioh,632*ratiow,408*ratioh,637*ratiow,410*ratioh,642*ratiow,422*ratioh,643*ratiow,427*ratioh,641*ratiow,429*ratioh,633*ratiow,429*ratioh,619*ratiow,424*ratioh,616*ratiow,430*ratioh,615*ratiow,456*ratioh,617*ratiow,470*ratioh,626*ratiow,483*ratioh,645*ratiow,498*ratioh,648*ratiow,502*ratioh,659*ratiow,498*ratioh,671*ratiow,498*ratioh,679*ratiow,500*ratioh,684*ratiow,504*ratioh,689*ratiow,514*ratioh,690*ratiow,527*ratioh,695*ratiow,517*ratioh,697*ratiow,518*ratioh,698*ratiow,533*ratioh,697*ratiow,555*ratioh,696*ratiow,568*ratioh,695*ratiow,578*ratioh,692*ratiow,581*ratioh,691*ratiow,584*ratioh,695*ratiow,593*ratioh,701*ratiow,583*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(271*ratiow,296*ratioh,261*ratiow,303*ratioh,257*ratiow,314*ratioh,259*ratiow,325*ratioh,269*ratiow,343*ratioh,290*ratiow,371*ratioh,305*ratiow,389*ratioh,318*ratiow,399*ratioh,329*ratiow,407*ratioh,345*ratiow,418*ratioh,352*ratiow,430*ratioh,365*ratiow,461*ratioh,372*ratiow,481*ratioh,370*ratiow,502*ratioh,360*ratiow,528*ratioh,346*ratiow,548*ratioh,342*ratiow,555*ratioh,335*ratiow,565*ratioh,322*ratiow,580*ratioh,304*ratiow,593*ratioh,286*ratiow,621*ratioh,272*ratiow,646*ratioh,260*ratiow,667*ratioh,244*ratiow,696*ratioh,236*ratiow,713*ratioh,236*ratiow,726*ratioh,239*ratiow,733*ratioh,245*ratiow,737*ratioh,258*ratiow,736*ratioh,270*ratiow,721*ratioh,292*ratiow,704*ratioh,315*ratiow,689*ratioh,337*ratiow,681*ratioh,352*ratiow,677*ratioh,373*ratiow,676*ratioh,396*ratiow,667*ratioh,416*ratiow,654*ratioh,432*ratiow,641*ratioh,448*ratiow,640*ratioh,464*ratiow,635*ratioh,476*ratiow,626*ratioh,481*ratiow,619*ratioh,480*ratiow,627*ratioh,484*ratiow,639*ratioh,491*ratiow,644*ratioh,502*ratiow,645*ratioh,515*ratiow,641*ratioh,532*ratiow,633*ratioh,540*ratiow,627*ratioh,548*ratiow,607*ratioh,554*ratiow,577*ratioh,563*ratiow,516*ratioh,563*ratiow,471*ratioh,559*ratiow,439*ratioh,551*ratiow,408*ratioh,542*ratiow,381*ratioh,533*ratiow,361*ratioh,516*ratiow,330*ratioh,490*ratiow,291*ratioh,462*ratiow,260*ratioh,436*ratiow,239*ratioh,403*ratiow,221*ratioh,371*ratiow,208*ratioh,347*ratiow,201*ratioh,333*ratiow,198*ratioh,327*ratiow,203*ratioh,313*ratiow,210*ratioh,299*ratiow,221*ratioh,292*ratiow,229*ratioh,291*ratiow,235*ratioh,291*ratiow,238*ratioh,295*ratiow,241*ratioh,290*ratiow,245*ratioh,273*ratiow,257*ratioh,260*ratiow,262*ratioh,225*ratiow,263*ratioh,210*ratiow,263*ratioh,177*ratiow,260*ratioh,162*ratiow,258*ratioh,162*ratiow,268*ratioh,184*ratiow,277*ratioh,211*ratiow,288*ratioh,232*ratiow,293*ratioh,253*ratiow,295*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(87*ratiow,757*ratioh,106*ratiow,756*ratioh,132*ratiow,751*ratioh,175*ratiow,738*ratioh,198*ratiow,727*ratioh,216*ratiow,714*ratioh,227*ratiow,702*ratioh,241*ratiow,677*ratioh,257*ratiow,646*ratioh,247*ratiow,633*ratioh,229*ratiow,619*ratioh,217*ratiow,625*ratioh,204*ratiow,635*ratioh,187*ratiow,651*ratioh,167*ratiow,672*ratioh,147*ratiow,689*ratioh,126*ratiow,707*ratioh,111*ratiow,724*ratioh,98*ratiow,741*ratioh,90*ratiow,752*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(1*ratiow,386*ratioh,25*ratiow,389*ratioh,49*ratiow,395*ratioh,70*ratiow,408*ratioh,65*ratiow,410*ratioh,60*ratiow,422*ratioh,59*ratiow,427*ratioh,61*ratiow,429*ratioh,69*ratiow,429*ratioh,83*ratiow,424*ratioh,86*ratiow,430*ratioh,87*ratiow,456*ratioh,85*ratiow,470*ratioh,76*ratiow,483*ratioh,57*ratiow,498*ratioh,54*ratiow,502*ratioh,43*ratiow,498*ratioh,31*ratiow,498*ratioh,23*ratiow,500*ratioh,18*ratiow,504*ratioh,13*ratiow,514*ratioh,12*ratiow,527*ratioh,7*ratiow,517*ratioh,5*ratiow,518*ratioh,4*ratiow,533*ratioh,5*ratiow,555*ratioh,6*ratiow,568*ratioh,7*ratiow,578*ratioh,10*ratiow,581*ratioh,11*ratiow,584*ratioh,7*ratiow,593*ratioh,1*ratiow,583*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile83(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 698;
var baseHeight = 808;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, PAG";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(425*ratiow,300*ratioh,431*ratiow,311*ratioh,432*ratiow,324*ratioh,423*ratiow,345*ratioh,404*ratiow,374*ratioh,393*ratiow,388*ratioh,382*ratiow,398*ratioh,362*ratiow,407*ratioh,347*ratiow,419*ratioh,335*ratiow,433*ratioh,326*ratiow,455*ratioh,319*ratiow,479*ratioh,319*ratiow,502*ratioh,334*ratiow,530*ratioh,336*ratiow,538*ratioh,343*ratiow,548*ratioh,348*ratiow,551*ratioh,354*ratiow,560*ratioh,360*ratiow,574*ratioh,377*ratiow,591*ratioh,400*ratiow,611*ratioh,412*ratiow,635*ratioh,411*ratiow,641*ratioh,414*ratiow,648*ratioh,420*ratiow,652*ratioh,430*ratiow,679*ratioh,436*ratiow,696*ratioh,436*ratiow,718*ratioh,432*ratiow,724*ratioh,427*ratiow,725*ratioh,418*ratiow,721*ratioh,406*ratiow,707*ratioh,388*ratiow,693*ratioh,364*ratiow,680*ratioh,320*ratiow,665*ratioh,293*ratiow,657*ratioh,280*ratiow,651*ratioh,262*ratiow,632*ratioh,247*ratiow,617*ratioh,224*ratiow,612*ratioh,208*ratiow,599*ratioh,198*ratiow,588*ratioh,199*ratiow,600*ratioh,197*ratiow,612*ratioh,189*ratiow,619*ratioh,184*ratiow,623*ratioh,171*ratiow,620*ratioh,158*ratiow,612*ratioh,152*ratiow,605*ratioh,144*ratiow,575*ratioh,134*ratiow,515*ratioh,134*ratiow,490*ratioh,135*ratiow,449*ratioh,142*ratiow,418*ratioh,153*ratiow,383*ratioh,165*ratiow,356*ratioh,187*ratiow,313*ratioh,209*ratiow,286*ratioh,229*ratiow,267*ratioh,266*ratiow,238*ratioh,296*ratiow,221*ratioh,331*ratiow,206*ratioh,345*ratiow,215*ratioh,357*ratiow,224*ratioh,367*ratiow,240*ratioh,370*ratiow,254*ratioh,366*ratiow,260*ratioh,361*ratiow,262*ratioh,377*ratiow,268*ratioh,393*ratiow,278*ratioh,412*ratiow,291*ratioh,425*ratiow,300*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(616*ratiow,757*ratioh,611*ratiow,759*ratioh,593*ratiow,758*ratioh,563*ratiow,747*ratioh,527*ratiow,728*ratioh,497*ratiow,719*ratioh,482*ratiow,713*ratioh,461*ratiow,702*ratioh,450*ratiow,687*ratioh,438*ratiow,653*ratioh,435*ratiow,641*ratioh,443*ratiow,620*ratioh,452*ratiow,611*ratioh,466*ratiow,608*ratioh,482*ratiow,621*ratioh,503*ratiow,636*ratioh,523*ratiow,653*ratioh,537*ratiow,666*ratioh,565*ratiow,695*ratioh,580*ratiow,710*ratioh,585*ratiow,723*ratioh,603*ratiow,744*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(697*ratiow,381*ratioh,680*ratiow,383*ratioh,662*ratiow,387*ratioh,642*ratiow,397*ratioh,639*ratiow,398*ratioh,649*ratiow,412*ratioh,655*ratiow,426*ratioh,656*ratiow,434*ratioh,653*ratiow,440*ratioh,645*ratiow,443*ratioh,635*ratiow,442*ratioh,608*ratiow,431*ratioh,603*ratiow,441*ratioh,602*ratiow,458*ratioh,602*ratiow,466*ratioh,609*ratiow,476*ratioh,619*ratiow,483*ratioh,629*ratiow,486*ratioh,641*ratiow,493*ratioh,647*ratiow,501*ratioh,656*ratiow,500*ratioh,671*ratiow,501*ratioh,683*ratiow,505*ratioh,689*ratiow,511*ratioh,691*ratiow,518*ratioh,695*ratiow,519*ratioh,697*ratiow,526*ratioh,696*ratiow,480*ratioh,696*ratiow,462*ratioh,694*ratiow,456*ratioh,693*ratiow,453*ratioh,697*ratiow,448*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(273*ratiow,300*ratioh,267*ratiow,311*ratioh,266*ratiow,324*ratioh,275*ratiow,345*ratioh,294*ratiow,374*ratioh,305*ratiow,388*ratioh,316*ratiow,398*ratioh,336*ratiow,407*ratioh,351*ratiow,419*ratioh,363*ratiow,433*ratioh,372*ratiow,455*ratioh,379*ratiow,479*ratioh,379*ratiow,502*ratioh,364*ratiow,530*ratioh,362*ratiow,538*ratioh,355*ratiow,548*ratioh,350*ratiow,551*ratioh,344*ratiow,560*ratioh,338*ratiow,574*ratioh,321*ratiow,591*ratioh,298*ratiow,611*ratioh,286*ratiow,635*ratioh,287*ratiow,641*ratioh,284*ratiow,648*ratioh,278*ratiow,652*ratioh,268*ratiow,679*ratioh,262*ratiow,696*ratioh,262*ratiow,718*ratioh,266*ratiow,724*ratioh,271*ratiow,725*ratioh,280*ratiow,721*ratioh,292*ratiow,707*ratioh,310*ratiow,693*ratioh,334*ratiow,680*ratioh,378*ratiow,665*ratioh,405*ratiow,657*ratioh,418*ratiow,651*ratioh,436*ratiow,632*ratioh,451*ratiow,617*ratioh,474*ratiow,612*ratioh,490*ratiow,599*ratioh,500*ratiow,588*ratioh,499*ratiow,600*ratioh,501*ratiow,612*ratioh,509*ratiow,619*ratioh,514*ratiow,623*ratioh,527*ratiow,620*ratioh,540*ratiow,612*ratioh,546*ratiow,605*ratioh,554*ratiow,575*ratioh,564*ratiow,515*ratioh,564*ratiow,490*ratioh,563*ratiow,449*ratioh,556*ratiow,418*ratioh,545*ratiow,383*ratioh,533*ratiow,356*ratioh,511*ratiow,313*ratioh,489*ratiow,286*ratioh,469*ratiow,267*ratioh,432*ratiow,238*ratioh,402*ratiow,221*ratioh,367*ratiow,206*ratioh,353*ratiow,215*ratioh,341*ratiow,224*ratioh,331*ratiow,240*ratioh,328*ratiow,254*ratioh,332*ratiow,260*ratioh,337*ratiow,262*ratioh,321*ratiow,268*ratioh,305*ratiow,278*ratioh,286*ratiow,291*ratioh,273*ratiow,300*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(82*ratiow,757*ratioh,87*ratiow,759*ratioh,105*ratiow,758*ratioh,135*ratiow,747*ratioh,171*ratiow,728*ratioh,201*ratiow,719*ratioh,216*ratiow,713*ratioh,237*ratiow,702*ratioh,248*ratiow,687*ratioh,260*ratiow,653*ratioh,263*ratiow,641*ratioh,255*ratiow,620*ratioh,246*ratiow,611*ratioh,232*ratiow,608*ratioh,216*ratiow,621*ratioh,195*ratiow,636*ratioh,175*ratiow,653*ratioh,161*ratiow,666*ratioh,133*ratiow,695*ratioh,118*ratiow,710*ratioh,113*ratiow,723*ratioh,95*ratiow,744*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(1*ratiow,381*ratioh,18*ratiow,383*ratioh,36*ratiow,387*ratioh,56*ratiow,397*ratioh,59*ratiow,398*ratioh,49*ratiow,412*ratioh,43*ratiow,426*ratioh,42*ratiow,434*ratioh,45*ratiow,440*ratioh,53*ratiow,443*ratioh,63*ratiow,442*ratioh,90*ratiow,431*ratioh,95*ratiow,441*ratioh,96*ratiow,458*ratioh,96*ratiow,466*ratioh,89*ratiow,476*ratioh,79*ratiow,483*ratioh,69*ratiow,486*ratioh,57*ratiow,493*ratioh,51*ratiow,501*ratioh,42*ratiow,500*ratioh,27*ratiow,501*ratioh,15*ratiow,505*ratioh,9*ratiow,511*ratioh,7*ratiow,518*ratioh,3*ratiow,519*ratioh,1*ratiow,526*ratioh,2*ratiow,480*ratioh,2*ratiow,462*ratioh,4*ratiow,456*ratioh,5*ratiow,453*ratioh,1*ratiow,448*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile84(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 681;
var baseHeight = 812;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, PAG";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(397*ratiow,314*ratioh,404*ratiow,321*ratioh,406*ratiow,333*ratioh,402*ratiow,350*ratioh,386*ratiow,382*ratioh,374*ratiow,400*ratioh,369*ratiow,406*ratioh,352*ratiow,416*ratioh,332*ratiow,433*ratioh,319*ratiow,458*ratioh,312*ratiow,483*ratioh,313*ratiow,506*ratioh,318*ratiow,521*ratioh,319*ratiow,526*ratioh,317*ratiow,530*ratioh,321*ratiow,535*ratioh,326*ratiow,536*ratioh,329*ratiow,545*ratioh,327*ratiow,546*ratioh,328*ratiow,549*ratioh,329*ratiow,552*ratioh,335*ratiow,552*ratioh,343*ratiow,564*ratioh,346*ratiow,573*ratioh,355*ratiow,587*ratioh,365*ratiow,597*ratioh,391*ratiow,617*ratioh,396*ratiow,625*ratioh,395*ratiow,629*ratioh,398*ratiow,633*ratioh,403*ratiow,639*ratioh,406*ratiow,639*ratioh,415*ratiow,653*ratioh,423*ratiow,673*ratioh,426*ratiow,697*ratioh,424*ratiow,708*ratioh,417*ratiow,712*ratioh,409*ratiow,712*ratioh,401*ratiow,709*ratioh,382*ratiow,696*ratioh,361*ratiow,682*ratioh,336*ratiow,675*ratioh,312*ratiow,670*ratioh,287*ratiow,661*ratioh,270*ratiow,654*ratioh,258*ratiow,640*ratioh,245*ratiow,623*ratioh,225*ratiow,620*ratioh,214*ratiow,613*ratioh,208*ratiow,607*ratioh,208*ratiow,615*ratioh,206*ratiow,626*ratioh,203*ratiow,635*ratioh,200*ratiow,641*ratioh,194*ratiow,645*ratioh,186*ratiow,640*ratioh,182*ratiow,633*ratioh,168*ratiow,621*ratioh,141*ratiow,590*ratioh,134*ratiow,563*ratioh,125*ratiow,506*ratioh,125*ratiow,471*ratioh,129*ratiow,445*ratioh,138*ratiow,407*ratioh,149*ratiow,379*ratioh,158*ratiow,361*ratioh,169*ratiow,340*ratioh,181*ratiow,320*ratioh,204*ratiow,288*ratioh,232*ratiow,264*ratioh,269*ratiow,242*ratioh,297*ratiow,227*ratioh,318*ratiow,219*ratioh,327*ratiow,219*ratioh,332*ratiow,222*ratioh,340*ratiow,231*ratioh,345*ratiow,238*ratioh,347*ratiow,245*ratioh,348*ratiow,254*ratioh,346*ratiow,264*ratioh,336*ratiow,275*ratioh,342*ratiow,278*ratioh,348*ratiow,285*ratioh,352*ratiow,297*ratioh,352*ratiow,305*ratioh,372*ratiow,308*ratioh,392*ratiow,312*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(609*ratiow,744*ratioh,599*ratiow,750*ratioh,584*ratiow,749*ratioh,554*ratiow,738*ratioh,518*ratiow,722*ratioh,480*ratiow,705*ratioh,457*ratiow,691*ratioh,442*ratiow,675*ratioh,429*ratiow,641*ratioh,427*ratiow,634*ratioh,433*ratiow,619*ratioh,446*ratiow,606*ratioh,460*ratiow,600*ratioh,471*ratiow,599*ratioh,476*ratiow,613*ratioh,491*ratiow,631*ratioh,518*ratiow,659*ratioh,550*ratiow,693*ratioh,564*ratiow,708*ratioh,573*ratiow,721*ratioh,594*ratiow,737*ratioh,604*ratiow,743*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(680*ratiow,374*ratioh,659*ratiow,375*ratioh,638*ratiow,379*ratioh,621*ratiow,384*ratioh,616*ratiow,389*ratioh,629*ratiow,398*ratioh,641*ratiow,409*ratioh,646*ratiow,419*ratioh,646*ratiow,428*ratioh,641*ratiow,432*ratioh,627*ratiow,435*ratioh,596*ratiow,432*ratioh,584*ratiow,429*ratioh,579*ratiow,447*ratioh,582*ratiow,464*ratioh,587*ratiow,471*ratioh,598*ratiow,478*ratioh,616*ratiow,487*ratioh,622*ratiow,484*ratioh,638*ratiow,483*ratioh,655*ratiow,486*ratioh,661*ratiow,490*ratioh,662*ratiow,494*ratioh,680*ratiow,491*ratioh,680*ratiow,474*ratioh,678*ratiow,471*ratioh,679*ratiow,443*ratioh,680*ratiow,438*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(284*ratiow,314*ratioh,277*ratiow,321*ratioh,275*ratiow,333*ratioh,279*ratiow,350*ratioh,295*ratiow,382*ratioh,307*ratiow,400*ratioh,312*ratiow,406*ratioh,329*ratiow,416*ratioh,349*ratiow,433*ratioh,362*ratiow,458*ratioh,369*ratiow,483*ratioh,368*ratiow,506*ratioh,363*ratiow,521*ratioh,362*ratiow,526*ratioh,364*ratiow,530*ratioh,360*ratiow,535*ratioh,355*ratiow,536*ratioh,352*ratiow,545*ratioh,354*ratiow,546*ratioh,353*ratiow,549*ratioh,352*ratiow,552*ratioh,346*ratiow,552*ratioh,338*ratiow,564*ratioh,335*ratiow,573*ratioh,326*ratiow,587*ratioh,316*ratiow,597*ratioh,290*ratiow,617*ratioh,285*ratiow,625*ratioh,286*ratiow,629*ratioh,283*ratiow,633*ratioh,278*ratiow,639*ratioh,275*ratiow,639*ratioh,266*ratiow,653*ratioh,258*ratiow,673*ratioh,255*ratiow,697*ratioh,257*ratiow,708*ratioh,264*ratiow,712*ratioh,272*ratiow,712*ratioh,280*ratiow,709*ratioh,299*ratiow,696*ratioh,320*ratiow,682*ratioh,345*ratiow,675*ratioh,369*ratiow,670*ratioh,394*ratiow,661*ratioh,411*ratiow,654*ratioh,423*ratiow,640*ratioh,436*ratiow,623*ratioh,456*ratiow,620*ratioh,467*ratiow,613*ratioh,473*ratiow,607*ratioh,473*ratiow,615*ratioh,475*ratiow,626*ratioh,478*ratiow,635*ratioh,481*ratiow,641*ratioh,487*ratiow,645*ratioh,495*ratiow,640*ratioh,499*ratiow,633*ratioh,513*ratiow,621*ratioh,540*ratiow,590*ratioh,547*ratiow,563*ratioh,556*ratiow,506*ratioh,556*ratiow,471*ratioh,552*ratiow,445*ratioh,543*ratiow,407*ratioh,532*ratiow,379*ratioh,523*ratiow,361*ratioh,512*ratiow,340*ratioh,500*ratiow,320*ratioh,477*ratiow,288*ratioh,449*ratiow,264*ratioh,412*ratiow,242*ratioh,384*ratiow,227*ratioh,363*ratiow,219*ratioh,354*ratiow,219*ratioh,349*ratiow,222*ratioh,341*ratiow,231*ratioh,336*ratiow,238*ratioh,334*ratiow,245*ratioh,333*ratiow,254*ratioh,335*ratiow,264*ratioh,345*ratiow,275*ratioh,339*ratiow,278*ratioh,333*ratiow,285*ratioh,329*ratiow,297*ratioh,329*ratiow,305*ratioh,309*ratiow,308*ratioh,289*ratiow,312*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(72*ratiow,744*ratioh,82*ratiow,750*ratioh,97*ratiow,749*ratioh,127*ratiow,738*ratioh,163*ratiow,722*ratioh,201*ratiow,705*ratioh,224*ratiow,691*ratioh,239*ratiow,675*ratioh,252*ratiow,641*ratioh,254*ratiow,634*ratioh,248*ratiow,619*ratioh,235*ratiow,606*ratioh,221*ratiow,600*ratioh,210*ratiow,599*ratioh,205*ratiow,613*ratioh,190*ratiow,631*ratioh,163*ratiow,659*ratioh,131*ratiow,693*ratioh,117*ratiow,708*ratioh,108*ratiow,721*ratioh,87*ratiow,737*ratioh,77*ratiow,743*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(1*ratiow,374*ratioh,22*ratiow,375*ratioh,43*ratiow,379*ratioh,60*ratiow,384*ratioh,65*ratiow,389*ratioh,52*ratiow,398*ratioh,40*ratiow,409*ratioh,35*ratiow,419*ratioh,35*ratiow,428*ratioh,40*ratiow,432*ratioh,54*ratiow,435*ratioh,85*ratiow,432*ratioh,97*ratiow,429*ratioh,102*ratiow,447*ratioh,99*ratiow,464*ratioh,94*ratiow,471*ratioh,83*ratiow,478*ratioh,65*ratiow,487*ratioh,59*ratiow,484*ratioh,43*ratiow,483*ratioh,26*ratiow,486*ratioh,20*ratiow,490*ratioh,19*ratiow,494*ratioh,1*ratiow,491*ratioh,1*ratiow,474*ratioh,3*ratiow,471*ratioh,2*ratiow,443*ratioh,1*ratiow,438*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile85(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 674;
var baseHeight = 802;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, PAG";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(415*ratiow,307*ratioh,421*ratiow,315*ratioh,424*ratiow,325*ratioh,421*ratiow,336*ratioh,412*ratiow,349*ratioh,408*ratiow,366*ratioh,403*ratiow,379*ratioh,393*ratiow,392*ratioh,377*ratiow,399*ratioh,360*ratiow,412*ratioh,344*ratiow,431*ratioh,333*ratiow,454*ratioh,329*ratiow,475*ratioh,330*ratiow,497*ratioh,339*ratiow,523*ratioh,342*ratiow,533*ratioh,349*ratiow,545*ratioh,355*ratiow,561*ratioh,367*ratiow,577*ratioh,386*ratiow,599*ratioh,394*ratiow,608*ratioh,404*ratiow,623*ratioh,412*ratiow,638*ratioh,417*ratiow,657*ratioh,418*ratiow,673*ratioh,413*ratiow,683*ratioh,408*ratiow,686*ratioh,398*ratiow,683*ratioh,390*ratiow,675*ratioh,376*ratiow,663*ratioh,362*ratiow,654*ratioh,339*ratiow,644*ratioh,309*ratiow,638*ratioh,292*ratiow,632*ratioh,276*ratiow,620*ratioh,262*ratiow,602*ratioh,252*ratiow,588*ratioh,242*ratiow,587*ratioh,226*ratiow,583*ratioh,194*ratiow,572*ratioh,173*ratiow,559*ratioh,153*ratiow,543*ratioh,145*ratiow,533*ratioh,138*ratiow,470*ratioh,138*ratiow,435*ratioh,144*ratiow,401*ratioh,154*ratiow,375*ratioh,170*ratiow,346*ratioh,190*ratiow,315*ratioh,228*ratiow,274*ratioh,255*ratiow,254*ratioh,291*ratiow,232*ratioh,322*ratiow,218*ratioh,319*ratiow,224*ratioh,333*ratiow,234*ratioh,340*ratiow,240*ratioh,345*ratiow,246*ratioh,349*ratiow,254*ratioh,357*ratiow,267*ratioh,366*ratiow,283*ratioh,371*ratiow,299*ratioh,394*ratiow,302*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(609*ratiow,758*ratioh,596*ratiow,753*ratioh,572*ratiow,746*ratioh,551*ratiow,736*ratioh,530*ratiow,720*ratioh,507*ratiow,709*ratioh,480*ratiow,697*ratioh,458*ratiow,683*ratioh,449*ratiow,674*ratioh,443*ratiow,661*ratioh,440*ratiow,638*ratioh,437*ratiow,631*ratioh,437*ratiow,606*ratioh,443*ratiow,600*ratioh,470*ratiow,591*ratioh,474*ratiow,601*ratioh,483*ratiow,618*ratioh,496*ratiow,635*ratioh,521*ratiow,656*ratioh,530*ratiow,662*ratioh,533*ratiow,673*ratioh,539*ratiow,690*ratioh,551*ratiow,709*ratioh,566*ratiow,727*ratioh,579*ratiow,738*ratioh,589*ratiow,744*ratioh,595*ratiow,744*ratioh,598*ratiow,741*ratioh,608*ratiow,742*ratioh,618*ratiow,739*ratioh,624*ratiow,726*ratioh,644*ratiow,705*ratioh,659*ratiow,691*ratioh,655*ratiow,716*ratioh,648*ratiow,721*ratioh,637*ratiow,731*ratioh,626*ratiow,742*ratioh,616*ratiow,747*ratioh,611*ratiow,751*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(673*ratiow,374*ratioh,662*ratiow,375*ratioh,645*ratiow,381*ratioh,629*ratiow,389*ratioh,621*ratiow,394*ratioh,628*ratiow,405*ratioh,637*ratiow,417*ratioh,645*ratiow,428*ratioh,647*ratiow,438*ratioh,643*ratiow,445*ratioh,629*ratiow,445*ratioh,606*ratiow,440*ratioh,589*ratiow,435*ratioh,583*ratiow,433*ratioh,581*ratiow,433*ratioh,580*ratiow,445*ratioh,580*ratiow,455*ratioh,583*ratiow,464*ratioh,589*ratiow,475*ratioh,595*ratiow,481*ratioh,610*ratiow,489*ratioh,615*ratiow,491*ratioh,623*ratiow,487*ratioh,638*ratiow,486*ratioh,657*ratiow,491*ratioh,665*ratiow,495*ratioh,671*ratiow,498*ratioh,673*ratiow,497*ratioh,673*ratiow,474*ratioh,670*ratiow,470*ratioh,671*ratiow,455*ratioh,669*ratiow,453*ratioh,669*ratiow,451*ratioh,670*ratiow,449*ratioh,671*ratiow,446*ratioh,671*ratiow,444*ratioh,673*ratiow,442*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(259*ratiow,307*ratioh,253*ratiow,315*ratioh,250*ratiow,325*ratioh,253*ratiow,336*ratioh,262*ratiow,349*ratioh,266*ratiow,366*ratioh,271*ratiow,379*ratioh,281*ratiow,392*ratioh,297*ratiow,399*ratioh,314*ratiow,412*ratioh,330*ratiow,431*ratioh,341*ratiow,454*ratioh,345*ratiow,475*ratioh,344*ratiow,497*ratioh,335*ratiow,523*ratioh,332*ratiow,533*ratioh,325*ratiow,545*ratioh,319*ratiow,561*ratioh,307*ratiow,577*ratioh,288*ratiow,599*ratioh,280*ratiow,608*ratioh,270*ratiow,623*ratioh,262*ratiow,638*ratioh,257*ratiow,657*ratioh,256*ratiow,673*ratioh,261*ratiow,683*ratioh,266*ratiow,686*ratioh,276*ratiow,683*ratioh,284*ratiow,675*ratioh,298*ratiow,663*ratioh,312*ratiow,654*ratioh,335*ratiow,644*ratioh,365*ratiow,638*ratioh,382*ratiow,632*ratioh,398*ratiow,620*ratioh,412*ratiow,602*ratioh,422*ratiow,588*ratioh,432*ratiow,587*ratioh,448*ratiow,583*ratioh,480*ratiow,572*ratioh,501*ratiow,559*ratioh,521*ratiow,543*ratioh,529*ratiow,533*ratioh,536*ratiow,470*ratioh,536*ratiow,435*ratioh,530*ratiow,401*ratioh,520*ratiow,375*ratioh,504*ratiow,346*ratioh,484*ratiow,315*ratioh,446*ratiow,274*ratioh,419*ratiow,254*ratioh,383*ratiow,232*ratioh,352*ratiow,218*ratioh,355*ratiow,224*ratioh,341*ratiow,234*ratioh,334*ratiow,240*ratioh,329*ratiow,246*ratioh,325*ratiow,254*ratioh,317*ratiow,267*ratioh,308*ratiow,283*ratioh,303*ratiow,299*ratioh,280*ratiow,302*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(65*ratiow,758*ratioh,78*ratiow,753*ratioh,102*ratiow,746*ratioh,123*ratiow,736*ratioh,144*ratiow,720*ratioh,167*ratiow,709*ratioh,194*ratiow,697*ratioh,216*ratiow,683*ratioh,225*ratiow,674*ratioh,231*ratiow,661*ratioh,234*ratiow,638*ratioh,237*ratiow,631*ratioh,237*ratiow,606*ratioh,231*ratiow,600*ratioh,204*ratiow,591*ratioh,200*ratiow,601*ratioh,191*ratiow,618*ratioh,178*ratiow,635*ratioh,153*ratiow,656*ratioh,144*ratiow,662*ratioh,141*ratiow,673*ratioh,135*ratiow,690*ratioh,123*ratiow,709*ratioh,108*ratiow,727*ratioh,95*ratiow,738*ratioh,85*ratiow,744*ratioh,79*ratiow,744*ratioh,76*ratiow,741*ratioh,66*ratiow,742*ratioh,56*ratiow,739*ratioh,50*ratiow,726*ratioh,30*ratiow,705*ratioh,15*ratiow,691*ratioh,19*ratiow,716*ratioh,26*ratiow,721*ratioh,37*ratiow,731*ratioh,48*ratiow,742*ratioh,58*ratiow,747*ratioh,63*ratiow,751*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(1*ratiow,374*ratioh,12*ratiow,375*ratioh,29*ratiow,381*ratioh,45*ratiow,389*ratioh,53*ratiow,394*ratioh,46*ratiow,405*ratioh,37*ratiow,417*ratioh,29*ratiow,428*ratioh,27*ratiow,438*ratioh,31*ratiow,445*ratioh,45*ratiow,445*ratioh,68*ratiow,440*ratioh,85*ratiow,435*ratioh,91*ratiow,433*ratioh,93*ratiow,433*ratioh,94*ratiow,445*ratioh,94*ratiow,455*ratioh,91*ratiow,464*ratioh,85*ratiow,475*ratioh,79*ratiow,481*ratioh,64*ratiow,489*ratioh,59*ratiow,491*ratioh,51*ratiow,487*ratioh,36*ratiow,486*ratioh,17*ratiow,491*ratioh,9*ratiow,495*ratioh,3*ratiow,498*ratioh,1*ratiow,497*ratioh,1*ratiow,474*ratioh,4*ratiow,470*ratioh,3*ratiow,455*ratioh,5*ratiow,453*ratioh,5*ratiow,451*ratioh,4*ratiow,449*ratioh,3*ratiow,446*ratioh,3*ratiow,444*ratioh,1*ratiow,442*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile86(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 681;
var baseHeight = 816;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, PAG";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(390*ratiow,328*ratioh,395*ratiow,337*ratioh,399*ratiow,347*ratioh,399*ratiow,365*ratioh,396*ratiow,381*ratioh,389*ratiow,397*ratioh,374*ratiow,413*ratioh,356*ratiow,429*ratioh,343*ratiow,449*ratioh,334*ratiow,480*ratioh,332*ratiow,500*ratioh,336*ratiow,516*ratioh,338*ratiow,529*ratioh,345*ratiow,557*ratioh,354*ratiow,575*ratioh,370*ratiow,603*ratioh,388*ratiow,626*ratioh,405*ratiow,639*ratioh,414*ratiow,651*ratioh,420*ratiow,668*ratioh,419*ratiow,676*ratioh,414*ratiow,680*ratioh,403*ratiow,679*ratioh,392*ratiow,667*ratioh,373*ratiow,656*ratioh,333*ratiow,643*ratioh,310*ratiow,637*ratioh,287*ratiow,625*ratioh,267*ratiow,605*ratioh,258*ratiow,593*ratioh,246*ratiow,597*ratioh,230*ratiow,598*ratioh,214*ratiow,598*ratioh,195*ratiow,594*ratioh,176*ratiow,582*ratioh,162*ratiow,570*ratioh,153*ratiow,562*ratioh,141*ratiow,508*ratioh,138*ratiow,485*ratioh,138*ratiow,458*ratioh,142*ratiow,430*ratioh,150*ratiow,404*ratioh,163*ratiow,372*ratioh,171*ratiow,354*ratioh,184*ratiow,333*ratioh,204*ratiow,308*ratioh,229*ratiow,284*ratioh,250*ratiow,268*ratioh,268*ratiow,263*ratioh,291*ratiow,260*ratioh,319*ratiow,259*ratioh,328*ratiow,261*ratioh,338*ratiow,267*ratioh,343*ratiow,275*ratioh,351*ratiow,290*ratioh,355*ratiow,304*ratioh,355*ratiow,321*ratioh,374*ratiow,322*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(604*ratiow,750*ratioh,601*ratiow,751*ratioh,590*ratiow,748*ratioh,566*ratiow,736*ratioh,529*ratiow,721*ratioh,503*ratiow,707*ratioh,484*ratiow,692*ratioh,471*ratiow,677*ratioh,459*ratiow,658*ratioh,451*ratiow,635*ratioh,450*ratiow,626*ratioh,458*ratiow,615*ratioh,472*ratiow,610*ratioh,486*ratiow,610*ratioh,493*ratiow,613*ratioh,497*ratiow,622*ratioh,504*ratiow,637*ratioh,525*ratiow,663*ratioh,543*ratiow,682*ratioh,545*ratiow,682*ratioh,546*ratiow,690*ratioh,548*ratiow,698*ratioh,564*ratiow,717*ratioh,586*ratiow,741*ratioh,592*ratiow,745*ratioh,594*ratiow,739*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(680*ratiow,442*ratioh,662*ratiow,444*ratioh,641*ratiow,444*ratioh,613*ratiow,439*ratioh,586*ratiow,427*ratioh,582*ratiow,435*ratioh,581*ratiow,447*ratioh,584*ratiow,459*ratioh,593*ratiow,469*ratioh,604*ratiow,482*ratioh,616*ratiow,495*ratioh,628*ratiow,493*ratioh,646*ratiow,491*ratioh,659*ratiow,489*ratioh,674*ratiow,494*ratioh,680*ratiow,497*ratioh,680*ratiow,472*ratioh,679*ratiow,458*ratioh,676*ratiow,451*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(291*ratiow,328*ratioh,286*ratiow,337*ratioh,282*ratiow,347*ratioh,282*ratiow,365*ratioh,285*ratiow,381*ratioh,292*ratiow,397*ratioh,307*ratiow,413*ratioh,325*ratiow,429*ratioh,338*ratiow,449*ratioh,347*ratiow,480*ratioh,349*ratiow,500*ratioh,345*ratiow,516*ratioh,343*ratiow,529*ratioh,336*ratiow,557*ratioh,327*ratiow,575*ratioh,311*ratiow,603*ratioh,293*ratiow,626*ratioh,276*ratiow,639*ratioh,267*ratiow,651*ratioh,261*ratiow,668*ratioh,262*ratiow,676*ratioh,267*ratiow,680*ratioh,278*ratiow,679*ratioh,289*ratiow,667*ratioh,308*ratiow,656*ratioh,348*ratiow,643*ratioh,371*ratiow,637*ratioh,394*ratiow,625*ratioh,414*ratiow,605*ratioh,423*ratiow,593*ratioh,435*ratiow,597*ratioh,451*ratiow,598*ratioh,467*ratiow,598*ratioh,486*ratiow,594*ratioh,505*ratiow,582*ratioh,519*ratiow,570*ratioh,528*ratiow,562*ratioh,540*ratiow,508*ratioh,543*ratiow,485*ratioh,543*ratiow,458*ratioh,539*ratiow,430*ratioh,531*ratiow,404*ratioh,518*ratiow,372*ratioh,510*ratiow,354*ratioh,497*ratiow,333*ratioh,477*ratiow,308*ratioh,452*ratiow,284*ratioh,431*ratiow,268*ratioh,413*ratiow,263*ratioh,390*ratiow,260*ratioh,362*ratiow,259*ratioh,353*ratiow,261*ratioh,343*ratiow,267*ratioh,338*ratiow,275*ratioh,330*ratiow,290*ratioh,326*ratiow,304*ratioh,326*ratiow,321*ratioh,307*ratiow,322*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(77*ratiow,750*ratioh,80*ratiow,751*ratioh,91*ratiow,748*ratioh,115*ratiow,736*ratioh,152*ratiow,721*ratioh,178*ratiow,707*ratioh,197*ratiow,692*ratioh,210*ratiow,677*ratioh,222*ratiow,658*ratioh,230*ratiow,635*ratioh,231*ratiow,626*ratioh,223*ratiow,615*ratioh,209*ratiow,610*ratioh,195*ratiow,610*ratioh,188*ratiow,613*ratioh,184*ratiow,622*ratioh,177*ratiow,637*ratioh,156*ratiow,663*ratioh,138*ratiow,682*ratioh,136*ratiow,682*ratioh,135*ratiow,690*ratioh,133*ratiow,698*ratioh,117*ratiow,717*ratioh,95*ratiow,741*ratioh,89*ratiow,745*ratioh,87*ratiow,739*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(1*ratiow,442*ratioh,19*ratiow,444*ratioh,40*ratiow,444*ratioh,68*ratiow,439*ratioh,95*ratiow,427*ratioh,99*ratiow,435*ratioh,100*ratiow,447*ratioh,97*ratiow,459*ratioh,88*ratiow,469*ratioh,77*ratiow,482*ratioh,65*ratiow,495*ratioh,53*ratiow,493*ratioh,35*ratiow,491*ratioh,22*ratiow,489*ratioh,7*ratiow,494*ratioh,1*ratiow,497*ratioh,1*ratiow,472*ratioh,2*ratiow,458*ratioh,5*ratiow,451*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile87(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 690;
var baseHeight = 817;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, PAG";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(379*ratiow,337*ratioh,384*ratiow,347*ratioh,386*ratiow,362*ratioh,382*ratiow,382*ratioh,369*ratiow,401*ratioh,357*ratiow,410*ratioh,341*ratiow,436*ratioh,332*ratiow,460*ratioh,330*ratiow,487*ratioh,335*ratiow,516*ratioh,345*ratiow,579*ratioh,351*ratiow,607*ratioh,348*ratiow,612*ratioh,337*ratiow,613*ratioh,305*ratiow,610*ratioh,287*ratiow,606*ratioh,270*ratiow,593*ratioh,254*ratiow,575*ratioh,214*ratiow,570*ratioh,189*ratiow,560*ratioh,162*ratiow,545*ratioh,146*ratiow,527*ratioh,138*ratiow,487*ratioh,137*ratiow,461*ratioh,140*ratiow,430*ratioh,145*ratiow,409*ratioh,156*ratiow,381*ratioh,180*ratiow,337*ratioh,195*ratiow,314*ratioh,225*ratiow,284*ratioh,260*ratiow,258*ratioh,243*ratiow,272*ratioh,264*ratiow,273*ratioh,283*ratiow,277*ratioh,305*ratiow,286*ratioh,323*ratiow,299*ratioh,336*ratiow,313*ratioh,345*ratiow,328*ratioh,360*ratiow,330*ratioh,373*ratiow,334*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(609*ratiow,747*ratioh,583*ratiow,733*ratioh,557*ratiow,721*ratioh,533*ratiow,709*ratioh,499*ratiow,689*ratioh,471*ratiow,669*ratioh,453*ratiow,645*ratioh,454*ratiow,634*ratioh,456*ratiow,614*ratioh,461*ratiow,601*ratioh,467*ratiow,595*ratioh,475*ratiow,593*ratioh,481*ratiow,595*ratioh,496*ratiow,609*ratioh,502*ratiow,620*ratioh,526*ratiow,653*ratioh,539*ratiow,673*ratioh,541*ratiow,684*ratioh,551*ratiow,698*ratioh,569*ratiow,714*ratioh,588*ratiow,729*ratioh,603*ratiow,740*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(683*ratiow,444*ratioh,637*ratiow,432*ratioh,608*ratiow,428*ratioh,586*ratiow,427*ratioh,585*ratiow,434*ratioh,586*ratiow,446*ratioh,591*ratiow,467*ratioh,593*ratiow,471*ratioh,606*ratiow,480*ratioh,620*ratiow,489*ratioh,627*ratiow,488*ratioh,641*ratiow,484*ratioh,655*ratiow,483*ratioh,675*ratiow,483*ratioh,686*ratiow,483*ratioh,689*ratiow,484*ratioh,689*ratiow,462*ratioh,686*ratiow,459*ratioh,685*ratiow,451*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(311*ratiow,337*ratioh,306*ratiow,347*ratioh,304*ratiow,362*ratioh,308*ratiow,382*ratioh,321*ratiow,401*ratioh,333*ratiow,410*ratioh,349*ratiow,436*ratioh,358*ratiow,460*ratioh,360*ratiow,487*ratioh,355*ratiow,516*ratioh,345*ratiow,579*ratioh,339*ratiow,607*ratioh,342*ratiow,612*ratioh,353*ratiow,613*ratioh,385*ratiow,610*ratioh,403*ratiow,606*ratioh,420*ratiow,593*ratioh,436*ratiow,575*ratioh,476*ratiow,570*ratioh,501*ratiow,560*ratioh,528*ratiow,545*ratioh,544*ratiow,527*ratioh,552*ratiow,487*ratioh,553*ratiow,461*ratioh,550*ratiow,430*ratioh,545*ratiow,409*ratioh,534*ratiow,381*ratioh,510*ratiow,337*ratioh,495*ratiow,314*ratioh,465*ratiow,284*ratioh,430*ratiow,258*ratioh,447*ratiow,272*ratioh,426*ratiow,273*ratioh,407*ratiow,277*ratioh,385*ratiow,286*ratioh,367*ratiow,299*ratioh,354*ratiow,313*ratioh,345*ratiow,328*ratioh,330*ratiow,330*ratioh,317*ratiow,334*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(81*ratiow,747*ratioh,107*ratiow,733*ratioh,133*ratiow,721*ratioh,157*ratiow,709*ratioh,191*ratiow,689*ratioh,219*ratiow,669*ratioh,237*ratiow,645*ratioh,236*ratiow,634*ratioh,234*ratiow,614*ratioh,229*ratiow,601*ratioh,223*ratiow,595*ratioh,215*ratiow,593*ratioh,209*ratiow,595*ratioh,194*ratiow,609*ratioh,188*ratiow,620*ratioh,164*ratiow,653*ratioh,151*ratiow,673*ratioh,149*ratiow,684*ratioh,139*ratiow,698*ratioh,121*ratiow,714*ratioh,102*ratiow,729*ratioh,87*ratiow,740*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(7*ratiow,444*ratioh,53*ratiow,432*ratioh,82*ratiow,428*ratioh,104*ratiow,427*ratioh,105*ratiow,434*ratioh,104*ratiow,446*ratioh,99*ratiow,467*ratioh,97*ratiow,471*ratioh,84*ratiow,480*ratioh,70*ratiow,489*ratioh,63*ratiow,488*ratioh,49*ratiow,484*ratioh,35*ratiow,483*ratioh,15*ratiow,483*ratioh,4*ratiow,483*ratioh,1*ratiow,484*ratioh,1*ratiow,462*ratioh,4*ratiow,459*ratioh,5*ratiow,451*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile88(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 688;
var baseHeight = 824;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, PAG";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(355*ratiow,345*ratioh,368*ratiow,354*ratioh,374*ratiow,363*ratioh,374*ratiow,373*ratioh,364*ratiow,392*ratioh,350*ratiow,414*ratioh,341*ratiow,432*ratioh,334*ratiow,455*ratioh,327*ratiow,500*ratioh,328*ratiow,528*ratioh,332*ratiow,549*ratioh,332*ratiow,566*ratioh,330*ratiow,575*ratioh,320*ratiow,582*ratioh,302*ratiow,588*ratioh,286*ratiow,587*ratioh,275*ratiow,582*ratioh,259*ratiow,570*ratioh,243*ratiow,550*ratioh,227*ratiow,555*ratioh,210*ratiow,559*ratioh,195*ratiow,559*ratioh,185*ratiow,555*ratioh,169*ratiow,543*ratioh,153*ratiow,525*ratioh,148*ratiow,500*ratioh,147*ratiow,478*ratioh,147*ratiow,454*ratioh,151*ratiow,425*ratioh,157*ratiow,398*ratioh,167*ratiow,371*ratioh,182*ratiow,345*ratioh,200*ratiow,320*ratioh,217*ratiow,300*ratioh,237*ratiow,293*ratioh,265*ratiow,284*ratioh,278*ratiow,283*ratioh,287*ratiow,286*ratioh,297*ratiow,297*ratioh,311*ratiow,314*ratioh,315*ratiow,326*ratioh,316*ratiow,337*ratioh,315*ratiow,341*ratioh,333*ratiow,341*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(606*ratiow,737*ratioh,585*ratiow,726*ratioh,569*ratiow,715*ratioh,536*ratiow,698*ratioh,511*ratiow,682*ratioh,482*ratiow,657*ratioh,468*ratiow,641*ratioh,459*ratiow,622*ratioh,454*ratiow,611*ratioh,445*ratiow,601*ratioh,443*ratiow,599*ratioh,449*ratiow,594*ratioh,465*ratiow,593*ratioh,478*ratiow,596*ratioh,493*ratiow,604*ratioh,501*ratiow,613*ratioh,509*ratiow,626*ratioh,509*ratiow,628*ratioh,506*ratiow,632*ratioh,509*ratiow,640*ratioh,517*ratiow,648*ratioh,519*ratiow,653*ratioh,511*ratiow,650*ratioh,506*ratiow,653*ratioh,509*ratiow,661*ratioh,518*ratiow,667*ratioh,529*ratiow,668*ratioh,536*ratiow,670*ratioh,541*ratiow,673*ratioh,549*ratiow,685*ratioh,563*ratiow,695*ratioh,573*ratiow,703*ratioh,577*ratiow,705*ratioh,580*ratiow,706*ratioh,590*ratiow,718*ratioh,607*ratiow,736*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(679*ratiow,429*ratioh,657*ratiow,428*ratioh,625*ratiow,428*ratioh,595*ratiow,425*ratioh,580*ratiow,423*ratioh,579*ratiow,430*ratioh,581*ratiow,439*ratioh,586*ratiow,453*ratioh,589*ratiow,458*ratioh,598*ratiow,462*ratioh,604*ratiow,467*ratioh,610*ratiow,474*ratioh,614*ratiow,477*ratioh,631*ratiow,470*ratioh,657*ratiow,459*ratioh,683*ratiow,447*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(333*ratiow,345*ratioh,320*ratiow,354*ratioh,314*ratiow,363*ratioh,314*ratiow,373*ratioh,324*ratiow,392*ratioh,338*ratiow,414*ratioh,347*ratiow,432*ratioh,354*ratiow,455*ratioh,361*ratiow,500*ratioh,360*ratiow,528*ratioh,356*ratiow,549*ratioh,356*ratiow,566*ratioh,358*ratiow,575*ratioh,368*ratiow,582*ratioh,386*ratiow,588*ratioh,402*ratiow,587*ratioh,413*ratiow,582*ratioh,429*ratiow,570*ratioh,445*ratiow,550*ratioh,461*ratiow,555*ratioh,478*ratiow,559*ratioh,493*ratiow,559*ratioh,503*ratiow,555*ratioh,519*ratiow,543*ratioh,535*ratiow,525*ratioh,540*ratiow,500*ratioh,541*ratiow,478*ratioh,541*ratiow,454*ratioh,537*ratiow,425*ratioh,531*ratiow,398*ratioh,521*ratiow,371*ratioh,506*ratiow,345*ratioh,488*ratiow,320*ratioh,471*ratiow,300*ratioh,451*ratiow,293*ratioh,423*ratiow,284*ratioh,410*ratiow,283*ratioh,401*ratiow,286*ratioh,391*ratiow,297*ratioh,377*ratiow,314*ratioh,373*ratiow,326*ratioh,372*ratiow,337*ratioh,373*ratiow,341*ratioh,355*ratiow,341*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(82*ratiow,737*ratioh,103*ratiow,726*ratioh,119*ratiow,715*ratioh,152*ratiow,698*ratioh,177*ratiow,682*ratioh,206*ratiow,657*ratioh,220*ratiow,641*ratioh,229*ratiow,622*ratioh,234*ratiow,611*ratioh,243*ratiow,601*ratioh,245*ratiow,599*ratioh,239*ratiow,594*ratioh,223*ratiow,593*ratioh,210*ratiow,596*ratioh,195*ratiow,604*ratioh,187*ratiow,613*ratioh,179*ratiow,626*ratioh,179*ratiow,628*ratioh,182*ratiow,632*ratioh,179*ratiow,640*ratioh,171*ratiow,648*ratioh,169*ratiow,653*ratioh,177*ratiow,650*ratioh,182*ratiow,653*ratioh,179*ratiow,661*ratioh,170*ratiow,667*ratioh,159*ratiow,668*ratioh,152*ratiow,670*ratioh,147*ratiow,673*ratioh,139*ratiow,685*ratioh,125*ratiow,695*ratioh,115*ratiow,703*ratioh,111*ratiow,705*ratioh,108*ratiow,706*ratioh,98*ratiow,718*ratioh,81*ratiow,736*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(9*ratiow,429*ratioh,31*ratiow,428*ratioh,63*ratiow,428*ratioh,93*ratiow,425*ratioh,108*ratiow,423*ratioh,109*ratiow,430*ratioh,107*ratiow,439*ratioh,102*ratiow,453*ratioh,99*ratiow,458*ratioh,90*ratiow,462*ratioh,84*ratiow,467*ratioh,78*ratiow,474*ratioh,74*ratiow,477*ratioh,57*ratiow,470*ratioh,31*ratiow,459*ratioh,5*ratiow,447*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile89(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 678;
var baseHeight = 831;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, SNR, PAG, VTA";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(335*ratiow,355*ratioh,340*ratiow,368*ratioh,341*ratiow,379*ratioh,334*ratiow,391*ratioh,323*ratiow,414*ratioh,305*ratiow,491*ratioh,305*ratiow,512*ratioh,307*ratiow,523*ratioh,303*ratiow,543*ratioh,297*ratiow,558*ratioh,292*ratiow,565*ratioh,285*ratiow,568*ratioh,278*ratiow,567*ratioh,261*ratiow,556*ratioh,246*ratiow,541*ratioh,234*ratiow,521*ratioh,228*ratiow,506*ratioh,224*ratiow,508*ratioh,216*ratiow,509*ratioh,196*ratiow,505*ratioh,174*ratiow,498*ratioh,157*ratiow,488*ratioh,141*ratiow,476*ratioh,129*ratiow,460*ratioh,129*ratiow,434*ratioh,134*ratiow,409*ratioh,142*ratiow,382*ratioh,156*ratiow,352*ratioh,169*ratiow,333*ratioh,182*ratiow,314*ratioh,191*ratiow,308*ratioh,214*ratiow,302*ratioh,230*ratiow,299*ratioh,244*ratiow,301*ratioh,249*ratiow,303*ratioh,255*ratiow,307*ratioh,261*ratiow,312*ratioh,268*ratiow,324*ratioh,270*ratiow,332*ratioh,270*ratiow,344*ratioh,268*ratiow,354*ratioh,266*ratiow,363*ratioh,277*ratiow,357*ratioh,295*ratiow,352*ratioh,310*ratiow,350*ratioh,326*ratiow,352*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(558*ratiow,709*ratioh,538*ratiow,697*ratioh,517*ratiow,683*ratioh,485*ratiow,658*ratioh,461*ratiow,636*ratioh,430*ratiow,600*ratioh,434*ratiow,601*ratioh,450*ratiow,609*ratioh,470*ratiow,621*ratioh,495*ratiow,640*ratioh,494*ratiow,646*ratioh,497*ratiow,652*ratioh,506*ratiow,656*ratioh,514*ratiow,658*ratioh,522*ratiow,665*ratioh,546*ratiow,686*ratioh,557*ratiow,698*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(663*ratiow,425*ratioh,599*ratiow,412*ratioh,573*ratiow,404*ratioh,568*ratiow,413*ratioh,567*ratiow,426*ratioh,575*ratiow,444*ratioh,583*ratiow,458*ratioh,588*ratiow,468*ratioh,600*ratiow,479*ratioh,606*ratiow,473*ratioh,619*ratiow,469*ratioh,633*ratiow,469*ratioh,646*ratiow,471*ratioh,659*ratiow,476*ratioh,671*ratiow,482*ratioh,673*ratiow,473*ratioh,675*ratiow,468*ratioh,677*ratiow,468*ratioh,677*ratiow,450*ratioh,674*ratiow,448*ratioh,673*ratiow,443*ratioh,670*ratiow,439*ratioh,664*ratiow,429*ratioh);
data = analyze_pic(data);

//VTA
selectWindow(name);
makePolygon(640*ratiow,709*ratioh,636*ratiow,705*ratioh,613*ratiow,699*ratioh,576*ratiow,692*ratioh,562*ratiow,688*ratioh,564*ratiow,682*ratioh,570*ratiow,678*ratioh,580*ratiow,673*ratioh,595*ratiow,673*ratioh,610*ratiow,675*ratioh,617*ratiow,676*ratioh,623*ratiow,682*ratioh,632*ratiow,686*ratioh,638*ratiow,686*ratioh,645*ratiow,684*ratioh,648*ratiow,682*ratioh,668*ratiow,684*ratioh,664*ratiow,687*ratioh,661*ratiow,694*ratioh,655*ratiow,697*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(343*ratiow,355*ratioh,338*ratiow,368*ratioh,337*ratiow,379*ratioh,344*ratiow,391*ratioh,355*ratiow,414*ratioh,373*ratiow,491*ratioh,373*ratiow,512*ratioh,371*ratiow,523*ratioh,375*ratiow,543*ratioh,381*ratiow,558*ratioh,386*ratiow,565*ratioh,393*ratiow,568*ratioh,400*ratiow,567*ratioh,417*ratiow,556*ratioh,432*ratiow,541*ratioh,444*ratiow,521*ratioh,450*ratiow,506*ratioh,454*ratiow,508*ratioh,462*ratiow,509*ratioh,482*ratiow,505*ratioh,504*ratiow,498*ratioh,521*ratiow,488*ratioh,537*ratiow,476*ratioh,549*ratiow,460*ratioh,549*ratiow,434*ratioh,544*ratiow,409*ratioh,536*ratiow,382*ratioh,522*ratiow,352*ratioh,509*ratiow,333*ratioh,496*ratiow,314*ratioh,487*ratiow,308*ratioh,464*ratiow,302*ratioh,448*ratiow,299*ratioh,434*ratiow,301*ratioh,429*ratiow,303*ratioh,423*ratiow,307*ratioh,417*ratiow,312*ratioh,410*ratiow,324*ratioh,408*ratiow,332*ratioh,408*ratiow,344*ratioh,410*ratiow,354*ratioh,412*ratiow,363*ratioh,401*ratiow,357*ratioh,383*ratiow,352*ratioh,368*ratiow,350*ratioh,352*ratiow,352*ratioh);
data = analyze_pic(data);

//SNR
selectWindow(name);
makePolygon(120*ratiow,709*ratioh,140*ratiow,697*ratioh,161*ratiow,683*ratioh,193*ratiow,658*ratioh,217*ratiow,636*ratioh,248*ratiow,600*ratioh,244*ratiow,601*ratioh,228*ratiow,609*ratioh,208*ratiow,621*ratioh,183*ratiow,640*ratioh,184*ratiow,646*ratioh,181*ratiow,652*ratioh,172*ratiow,656*ratioh,164*ratiow,658*ratioh,156*ratiow,665*ratioh,132*ratiow,686*ratioh,121*ratiow,698*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(15*ratiow,425*ratioh,79*ratiow,412*ratioh,105*ratiow,404*ratioh,110*ratiow,413*ratioh,111*ratiow,426*ratioh,103*ratiow,444*ratioh,95*ratiow,458*ratioh,90*ratiow,468*ratioh,78*ratiow,479*ratioh,72*ratiow,473*ratioh,59*ratiow,469*ratioh,45*ratiow,469*ratioh,32*ratiow,471*ratioh,19*ratiow,476*ratioh,7*ratiow,482*ratioh,5*ratiow,473*ratioh,3*ratiow,468*ratioh,1*ratiow,468*ratioh,1*ratiow,450*ratioh,4*ratiow,448*ratioh,5*ratiow,443*ratioh,8*ratiow,439*ratioh,14*ratiow,429*ratioh);
data = analyze_pic(data);

//VTA
selectWindow(name);
makePolygon(38*ratiow,709*ratioh,42*ratiow,705*ratioh,65*ratiow,699*ratioh,102*ratiow,692*ratioh,116*ratiow,688*ratioh,114*ratiow,682*ratioh,108*ratiow,678*ratioh,98*ratiow,673*ratioh,83*ratiow,673*ratioh,68*ratiow,675*ratioh,61*ratiow,676*ratioh,55*ratiow,682*ratioh,46*ratiow,686*ratioh,40*ratiow,686*ratioh,33*ratiow,684*ratioh,30*ratiow,682*ratioh,10*ratiow,684*ratioh,14*ratiow,687*ratioh,17*ratiow,694*ratioh,23*ratiow,697*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}

function processFile90(imagePath, dirResults) {
setBatchMode(false);
open(imagePath);
setBatchMode(true);
//data is an array that holds the final counts for each brain part for the section
data = newArray(0);
name = getTitle;

//basic thresholding to change into moments for further analysis
selectWindow(name);
run("Make Binary");
run("Watershed");

//the width and height of the left or right brain of brain slice ___
var baseWidth = 676;
var baseHeight = 863;

//determines ratio for each image based on the basewidth and height
w= getWidth;
h = getHeight;
ratiow = w/baseWidth;
ratioh = h/baseHeight;

//names of each part of the brain that is important in this slice
parts = "Hippo, VTA, PAG";
partNames = split(parts, ", ");

if (leftSide)  {
//Hippo
selectWindow(name);
makePolygon(362*ratiow,383*ratioh,356*ratiow,391*ratioh,347*ratiow,400*ratioh,341*ratiow,413*ratioh,341*ratiow,442*ratioh,345*ratiow,474*ratioh,348*ratiow,492*ratioh,331*ratiow,513*ratioh,305*ratiow,545*ratioh,276*ratiow,581*ratioh,263*ratiow,597*ratioh,246*ratiow,590*ratioh,232*ratiow,582*ratioh,217*ratiow,567*ratioh,198*ratiow,541*ratioh,185*ratiow,512*ratioh,177*ratiow,483*ratioh,175*ratiow,454*ratioh,181*ratiow,423*ratioh,197*ratiow,388*ratioh,221*ratiow,354*ratioh,241*ratiow,331*ratioh,262*ratiow,311*ratioh,276*ratiow,304*ratioh,289*ratiow,305*ratioh,301*ratiow,314*ratioh,316*ratiow,325*ratioh,336*ratiow,332*ratioh,327*ratiow,338*ratioh,324*ratiow,344*ratioh,330*ratiow,353*ratioh,362*ratiow,383*ratioh);
data = analyze_pic(data);

//VTA
selectWindow(name);
makePolygon(640*ratiow,733*ratioh,629*ratiow,728*ratioh,582*ratiow,725*ratioh,583*ratiow,721*ratioh,589*ratiow,714*ratioh,600*ratiow,706*ratioh,618*ratiow,701*ratioh,635*ratiow,699*ratioh,650*ratiow,699*ratioh,663*ratiow,701*ratioh,659*ratiow,708*ratioh,657*ratiow,717*ratioh,650*ratiow,725*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(662*ratiow,430*ratioh,596*ratiow,426*ratioh,574*ratiow,424*ratioh,574*ratiow,438*ratioh,578*ratiow,448*ratioh,585*ratiow,461*ratioh,592*ratiow,480*ratioh,596*ratiow,489*ratioh,614*ratiow,482*ratioh,636*ratiow,479*ratioh,651*ratiow,478*ratioh,665*ratiow,480*ratioh,671*ratiow,476*ratioh,675*ratiow,475*ratioh,675*ratiow,456*ratioh,673*ratiow,455*ratioh,672*ratiow,453*ratioh,672*ratiow,448*ratioh,663*ratiow,438*ratioh,663*ratiow,433*ratioh);
data = analyze_pic(data);

}

if (rightSide)  {
//Hippo
selectWindow(name);
makePolygon(314*ratiow,383*ratioh,320*ratiow,391*ratioh,329*ratiow,400*ratioh,335*ratiow,413*ratioh,335*ratiow,442*ratioh,331*ratiow,474*ratioh,328*ratiow,492*ratioh,345*ratiow,513*ratioh,371*ratiow,545*ratioh,400*ratiow,581*ratioh,413*ratiow,597*ratioh,430*ratiow,590*ratioh,444*ratiow,582*ratioh,459*ratiow,567*ratioh,478*ratiow,541*ratioh,491*ratiow,512*ratioh,499*ratiow,483*ratioh,501*ratiow,454*ratioh,495*ratiow,423*ratioh,479*ratiow,388*ratioh,455*ratiow,354*ratioh,435*ratiow,331*ratioh,414*ratiow,311*ratioh,400*ratiow,304*ratioh,387*ratiow,305*ratioh,375*ratiow,314*ratioh,360*ratiow,325*ratioh,340*ratiow,332*ratioh,349*ratiow,338*ratioh,352*ratiow,344*ratioh,346*ratiow,353*ratioh,314*ratiow,383*ratioh);
data = analyze_pic(data);

//VTA
selectWindow(name);
makePolygon(36*ratiow,733*ratioh,47*ratiow,728*ratioh,94*ratiow,725*ratioh,93*ratiow,721*ratioh,87*ratiow,714*ratioh,76*ratiow,706*ratioh,58*ratiow,701*ratioh,41*ratiow,699*ratioh,26*ratiow,699*ratioh,13*ratiow,701*ratioh,17*ratiow,708*ratioh,19*ratiow,717*ratioh,26*ratiow,725*ratioh);
data = analyze_pic(data);

//PAG
selectWindow(name);
makePolygon(14*ratiow,430*ratioh,80*ratiow,426*ratioh,102*ratiow,424*ratioh,102*ratiow,438*ratioh,98*ratiow,448*ratioh,91*ratiow,461*ratioh,84*ratiow,480*ratioh,80*ratiow,489*ratioh,62*ratiow,482*ratioh,40*ratiow,479*ratioh,25*ratiow,478*ratioh,11*ratiow,480*ratioh,5*ratiow,476*ratioh,1*ratiow,475*ratioh,1*ratiow,456*ratioh,3*ratiow,455*ratioh,4*ratiow,453*ratioh,4*ratiow,448*ratioh,13*ratiow,438*ratioh,13*ratiow,433*ratioh);
data = analyze_pic(data);

}

//puts the results in a new txt file 
imageName = substring(name, 0, lengthOf(name) - 4);

//makes a file based on whether it is left or right side and whether it already has left or right in the name
if (leftSide) {
   if ((indexOf(toLowerCase(imageName), "left")) == -1) {
   f = File.open(dirResults + imageName + "_left_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "left")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}
if (rightSide) {
   if ((indexOf(toLowerCase(imageName), "right")) == -1) {
   f = File.open(dirResults + imageName + "_right_data.txt");
   }
   if ((indexOf(toLowerCase(imageName), "right")) > -1) {
   f = File.open(dirResults + imageName + "_data.txt");
   }
}

//prints counts onto the text file
for (i=0; i<partNames.length; i++) {
   print_line(f, partNames, data, i);
}
File.close(f);

//finds folder where image can be found
selectWindow(name);
path = getInfo("image.directory");
close();

//assumes there is parent directory with 2 folders: 1 for images, 1 for atlas left and 1 for atlas right
atlasNum = substring(imageName, lengthOf(imageName) - 2, lengthOf(imageName));
upperDir = substring(path, 0, lastIndexOf(substring(path, 0, lengthOf(path) - 1), "\\")+1);
if (leftSide) {
atlasPath = upperDir + "Atlas Left\\"+ atlasNum + "_left.tif";
}
if (rightSide) {
atlasPath = upperDir + "Atlas Right\\"+ atlasNum + "_right.tif";
}

//rescales atlas image and overlays it over slide, then saves it in results folder
overlay_image(path, name, imageName, atlasPath, dirResults, leftSide, rightSide);

}


